<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom"><title>For system administrator - Denis Kadyshev</title><link href="https://metajiji.github.io/" rel="alternate"></link><link href="https://metajiji.github.io/feeds/denis-kadyshev.atom.xml" rel="self"></link><id>https://metajiji.github.io/</id><updated>2017-10-05T00:00:00+07:00</updated><entry><title>Fedora 25 install adobe flashplayer</title><link href="https://metajiji.github.io/blog/fedora-chromium-firefox-flashplayer/" rel="alternate"></link><published>2017-10-05T00:00:00+07:00</published><updated>2017-10-05T00:00:00+07:00</updated><author><name>Denis Kadyshev</name></author><id>tag:metajiji.github.io,2017-10-05:/blog/fedora-chromium-firefox-flashplayer/</id><summary type="html">&lt;h3&gt;Install Adobe repository:&lt;/h3&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;sudo dnf install http://linuxdownload.adobe.com/adobe-release/adobe-release-x86_64-1.0-1.noarch.rpm
&lt;/pre&gt;&lt;/div&gt;


&lt;h3&gt;Find and install required package for &lt;code&gt;chromium-browser&lt;/code&gt;:&lt;/h3&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;dnf provides */libpepflashplayer.so
sudo dnf install flash-player-ppapi
&lt;/pre&gt;&lt;/div&gt;


&lt;h3&gt;Activate PepperFlash plugin in chromium-browser:&lt;/h3&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;sudo ln -s /usr/lib64/flash-plugin/libpepflashplayer.so /usr/lib64/chromium-browser/PepperFlash/libpepflashplayer.so
sudo …&lt;/pre&gt;&lt;/div&gt;</summary><content type="html">&lt;h3&gt;Install Adobe repository:&lt;/h3&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;sudo dnf install http://linuxdownload.adobe.com/adobe-release/adobe-release-x86_64-1.0-1.noarch.rpm
&lt;/pre&gt;&lt;/div&gt;


&lt;h3&gt;Find and install required package for &lt;code&gt;chromium-browser&lt;/code&gt;:&lt;/h3&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;dnf provides */libpepflashplayer.so
sudo dnf install flash-player-ppapi
&lt;/pre&gt;&lt;/div&gt;


&lt;h3&gt;Activate PepperFlash plugin in chromium-browser:&lt;/h3&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;sudo ln -s /usr/lib64/flash-plugin/libpepflashplayer.so /usr/lib64/chromium-browser/PepperFlash/libpepflashplayer.so
sudo ln -s /usr/lib64/flash-plugin/manifest.json /usr/lib64/chromium-browser/PepperFlash/manifest.json
&lt;/pre&gt;&lt;/div&gt;


&lt;h3&gt;Install package for &lt;code&gt;firefox&lt;/code&gt;:&lt;/h3&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;sudo dnf install flash-plugin
&lt;/pre&gt;&lt;/div&gt;


&lt;h3&gt;For Firefox just do&lt;/h3&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;sudo dnf install http://linuxdownload.adobe.com/adobe-release/adobe-release-x86_64-1.0-1.noarch.rpm https://download1.rpmfusion.org/free/fedora/rpmfusion-free-release-stable.noarch.rpm https://download1.rpmfusion.org/nonfree/fedora/rpmfusion-nonfree-release-stable.noarch.rpm
sudo dnf install flash-plugin freshplayerplugin
&lt;/pre&gt;&lt;/div&gt;


&lt;hr&gt;
&lt;h1&gt;LINKS&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://ask.fedoraproject.org/en/question/10217/sticky-how-do-i-install-adobe-flash-on-fedora/"&gt;[Sticky] How do I install Adobe Flash on Fedora?&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://helpx.adobe.com/flash-player.html"&gt;Install Flash Player in five easy steps&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://www.if-not-true-then-false.com/2010/install-adobe-flash-player-10-on-fedora-centos-red-hat-rhel/"&gt;Adobe Flash Player 25 on Fedora 25/24, CentOS/RHEL 7.3/6.9/5.11&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</content><category term="Fedora"></category><category term="Linux"></category><category term="flashplayer"></category><category term="chromium"></category><category term="firefox"></category></entry><entry><title>Atlassian crowd apache tomcat jni native lib</title><link href="https://metajiji.github.io/blog/atlassian-crowd-jni-native-lib/" rel="alternate"></link><published>2017-07-03T00:00:00+07:00</published><updated>2017-07-03T00:00:00+07:00</updated><author><name>Denis Kadyshev</name></author><id>tag:metajiji.github.io,2017-07-03:/blog/atlassian-crowd-jni-native-lib/</id><summary type="html">&lt;ol&gt;
&lt;li&gt;Install Requirements&lt;/li&gt;
&lt;/ol&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;yum install -y gcc make apr-devel
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Download oracle jdk &lt;code&gt;tar.gz&lt;/code&gt; file and extract to /opt, create symlink for convenience:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nb"&gt;cd&lt;/span&gt; /opt
tar -xf jdk-8u121-linux-x64.tar.gz
ln -s jdk1.8.0_121 jdk-latest
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Now, for upgrade jdk, just extract new &lt;code&gt;tar.gz&lt;/code&gt; file and update symlink to new …&lt;/p&gt;</summary><content type="html">&lt;ol&gt;
&lt;li&gt;Install Requirements&lt;/li&gt;
&lt;/ol&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;yum install -y gcc make apr-devel
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Download oracle jdk &lt;code&gt;tar.gz&lt;/code&gt; file and extract to /opt, create symlink for convenience:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nb"&gt;cd&lt;/span&gt; /opt
tar -xf jdk-8u121-linux-x64.tar.gz
ln -s jdk1.8.0_121 jdk-latest
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Now, for upgrade jdk, just extract new &lt;code&gt;tar.gz&lt;/code&gt; file and update symlink to new jdk folder.&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Extract and build jni-native library&lt;/li&gt;
&lt;/ol&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nb"&gt;cd&lt;/span&gt; crowd/apache-tomcat/bin
tar -xf tomcat-native.tar.gz
&lt;span class="nb"&gt;cd&lt;/span&gt; tomcat-native-1.1.33-src/jni/native
&lt;span class="nv"&gt;JAVA_HOME&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;/opt/jdk-latest ./configure --with-apr&lt;span class="o"&gt;=&lt;/span&gt;/usr/bin/apr-1-config
make
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Now we have builded jni native so library in &lt;code&gt;.libs&lt;/code&gt; folder, if no errors.&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Use APR library. Add correct &lt;code&gt;java.library.path&lt;/code&gt; option in startup script:&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Create configuration file &lt;code&gt;/etc/default/crowd&lt;/code&gt; if you use my systemd unit for start crowd (link below):&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nv"&gt;JAVA_OPTS&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;-Djava.library.path=/opt/atlassian/crowd/apache-tomcat/bin/tomcat-native-1.1.33-src/jni/native/.libs&amp;quot;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Alternatively edit the &lt;code&gt;/opt/atlassian/crowd/apache-tomcat/bin/setenv.sh&lt;/code&gt;
and add this to &lt;code&gt;JAVA_OPTS&lt;/code&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;-Djava.library.path&lt;span class="o"&gt;=&lt;/span&gt;/opt/atlassian/crowd/apache-tomcat/bin/tomcat-native-1.1.33-src/jni/native/.libs&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;hr&gt;
&lt;p&gt;Ссылки по теме:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href="https://confluence.atlassian.com/crowd/setting-crowd-to-run-automatically-and-use-an-unprivileged-system-user-on-unix-211649189.html"&gt;Setting Crowd to Run Automatically and Use an Unprivileged System User on UNIX&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;</content><category term="Linux"></category><category term="CentOS"></category><category term="Atlassian"></category><category term="crowd"></category></entry><entry><title>Atlassian crowd systemd unit</title><link href="https://metajiji.github.io/blog/atlassian-crowd-systemd/" rel="alternate"></link><published>2017-07-03T00:00:00+07:00</published><updated>2017-07-03T00:00:00+07:00</updated><author><name>Denis Kadyshev</name></author><id>tag:metajiji.github.io,2017-07-03:/blog/atlassian-crowd-systemd/</id><summary type="html">&lt;p&gt;Create systemd service unit in &lt;code&gt;/etc/systemd/system/crowd.service&lt;/code&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;[Unit]&lt;/span&gt;
&lt;span class="na"&gt;Description&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;Crowd&lt;/span&gt;
&lt;span class="na"&gt;After&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;network.target&lt;/span&gt;

&lt;span class="k"&gt;[Service]&lt;/span&gt;
&lt;span class="na"&gt;Type&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;oneshot&lt;/span&gt;
&lt;span class="na"&gt;RemainAfterExit&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;yes&lt;/span&gt;
&lt;span class="na"&gt;User&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;nobody&lt;/span&gt;
&lt;span class="na"&gt;Group&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;nobody&lt;/span&gt;

&lt;span class="na"&gt;Environment&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;JAVA_HOME=/opt/jdk-latest&lt;/span&gt;
&lt;span class="na"&gt;Environment&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;PATH=/opt/jdk-latest/bin:/usr/sbin:/usr/bin&lt;/span&gt;
&lt;span class="na"&gt;EnvironmentFile&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;-/etc/default/crowd&lt;/span&gt;

&lt;span class="na"&gt;WorkingDirectory&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;/opt/atlassian/crowd&lt;/span&gt;

&lt;span class="na"&gt;ExecStart&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;/bin/sh start_crowd …&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;</summary><content type="html">&lt;p&gt;Create systemd service unit in &lt;code&gt;/etc/systemd/system/crowd.service&lt;/code&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;[Unit]&lt;/span&gt;
&lt;span class="na"&gt;Description&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;Crowd&lt;/span&gt;
&lt;span class="na"&gt;After&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;network.target&lt;/span&gt;

&lt;span class="k"&gt;[Service]&lt;/span&gt;
&lt;span class="na"&gt;Type&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;oneshot&lt;/span&gt;
&lt;span class="na"&gt;RemainAfterExit&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;yes&lt;/span&gt;
&lt;span class="na"&gt;User&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;nobody&lt;/span&gt;
&lt;span class="na"&gt;Group&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;nobody&lt;/span&gt;

&lt;span class="na"&gt;Environment&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;JAVA_HOME=/opt/jdk-latest&lt;/span&gt;
&lt;span class="na"&gt;Environment&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;PATH=/opt/jdk-latest/bin:/usr/sbin:/usr/bin&lt;/span&gt;
&lt;span class="na"&gt;EnvironmentFile&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;-/etc/default/crowd&lt;/span&gt;

&lt;span class="na"&gt;WorkingDirectory&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;/opt/atlassian/crowd&lt;/span&gt;

&lt;span class="na"&gt;ExecStart&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;/bin/sh start_crowd.sh&lt;/span&gt;
&lt;span class="na"&gt;ExecStop&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;/bin/sh stop_crowd.sh&lt;/span&gt;

&lt;span class="k"&gt;[Install]&lt;/span&gt;
&lt;span class="na"&gt;WantedBy&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;multi-user.target&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Create configuration file &lt;code&gt;/etc/default/crowd&lt;/code&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nv"&gt;JAVA_OPTS&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&amp;quot;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Enable and start service unit on system start:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;systemctl &lt;span class="nb"&gt;enable&lt;/span&gt; crowd.service
systemctl start crowd.service
&lt;/pre&gt;&lt;/div&gt;


&lt;hr&gt;
&lt;p&gt;Ссылки по теме:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href="https://confluence.atlassian.com/crowd/setting-crowd-to-run-automatically-and-use-an-unprivileged-system-user-on-unix-211649189.html"&gt;Setting Crowd to Run Automatically and Use an Unprivileged System User on UNIX&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;</content><category term="Linux"></category><category term="CentOS"></category><category term="Ubuntu"></category><category term="systemd"></category><category term="Atlassian"></category><category term="crowd"></category></entry><entry><title>Flash player not working in chrome incognito.</title><link href="https://metajiji.github.io/blog/flash-player-chrome-incognito/" rel="alternate"></link><published>2017-06-08T00:00:00+07:00</published><updated>2017-06-08T00:00:00+07:00</updated><author><name>Denis Kadyshev</name></author><id>tag:metajiji.github.io,2017-06-08:/blog/flash-player-chrome-incognito/</id><summary type="html">&lt;p&gt;Flash player now working in chrome private window (incognito), solution is simple stupid!&lt;/p&gt;
&lt;p&gt;Just open &lt;code&gt;chrome://flags/#prefer-html-over-flash&lt;/code&gt; and change the &lt;code&gt;Prefer HTML over Flash&lt;/code&gt; dropdown box to &lt;code&gt;disabled&lt;/code&gt;.&lt;/p&gt;
&lt;hr&gt;
&lt;h1&gt;LINKS&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;https://forums.adobe.com/thread/2298071&lt;/li&gt;
&lt;li&gt;chrome://flags/#prefer-html-over-flash&lt;/li&gt;
&lt;/ul&gt;</summary><content type="html">&lt;p&gt;Flash player now working in chrome private window (incognito), solution is simple stupid!&lt;/p&gt;
&lt;p&gt;Just open &lt;code&gt;chrome://flags/#prefer-html-over-flash&lt;/code&gt; and change the &lt;code&gt;Prefer HTML over Flash&lt;/code&gt; dropdown box to &lt;code&gt;disabled&lt;/code&gt;.&lt;/p&gt;
&lt;hr&gt;
&lt;h1&gt;LINKS&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;https://forums.adobe.com/thread/2298071&lt;/li&gt;
&lt;li&gt;chrome://flags/#prefer-html-over-flash&lt;/li&gt;
&lt;/ul&gt;</content><category term="Google chrome"></category><category term="chromium"></category><category term="flash"></category><category term="adobe flash"></category></entry><entry><title>Fedora - install Nvidia driver</title><link href="https://metajiji.github.io/blog/fedora-nvidia-driver/" rel="alternate"></link><published>2017-05-08T00:00:00+07:00</published><updated>2017-05-08T00:00:00+07:00</updated><author><name>Denis Kadyshev</name></author><id>tag:metajiji.github.io,2017-05-08:/blog/fedora-nvidia-driver/</id><summary type="html">&lt;h1&gt;Install RPMFusion repository&lt;/h1&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;sudo dnf install https://download1.rpmfusion.org/free/fedora/rpmfusion-free-release-stable.noarch.rpm https://download1.rpmfusion.org/nonfree/fedora/rpmfusion-nonfree-release-stable.noarch.rpm
&lt;/pre&gt;&lt;/div&gt;


&lt;h1&gt;Important! Upgrade to latest versions kernel and SELinux packages&lt;/h1&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;sudo dnf update kernel* selinux-policy*
&lt;/pre&gt;&lt;/div&gt;


&lt;h1&gt;Install required packages&lt;/h1&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;sudo dnf install gcc kernel-headers kernel-devel
&lt;/pre&gt;&lt;/div&gt;


&lt;h1&gt;Install Nvidia drivers …&lt;/h1&gt;</summary><content type="html">&lt;h1&gt;Install RPMFusion repository&lt;/h1&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;sudo dnf install https://download1.rpmfusion.org/free/fedora/rpmfusion-free-release-stable.noarch.rpm https://download1.rpmfusion.org/nonfree/fedora/rpmfusion-nonfree-release-stable.noarch.rpm
&lt;/pre&gt;&lt;/div&gt;


&lt;h1&gt;Important! Upgrade to latest versions kernel and SELinux packages&lt;/h1&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;sudo dnf update kernel* selinux-policy*
&lt;/pre&gt;&lt;/div&gt;


&lt;h1&gt;Install required packages&lt;/h1&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;sudo dnf install gcc kernel-headers kernel-devel
&lt;/pre&gt;&lt;/div&gt;


&lt;h1&gt;Install Nvidia drivers&lt;/h1&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;sudo dnf install akmod-nvidia xorg-x11-drv-nvidia-304xx xorg-x11-drv-nvidia-304xx-libs
&lt;/pre&gt;&lt;/div&gt;


&lt;h1&gt;Check akmod module&lt;/h1&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;sudo akmods
&lt;/pre&gt;&lt;/div&gt;


&lt;h1&gt;Rebuild initramfs&lt;/h1&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;sudo dracut -f /boot/initramfs-&lt;span class="k"&gt;$(&lt;/span&gt;uname -r&lt;span class="k"&gt;)&lt;/span&gt;.img &lt;span class="k"&gt;$(&lt;/span&gt;uname -r&lt;span class="k"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h1&gt;Known issues&lt;/h1&gt;
&lt;h2&gt;Black screen&lt;/h2&gt;
&lt;p&gt;Disable &lt;code&gt;nouveau&lt;/code&gt; driver&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nv"&gt;GRUB_CMDLINE_LINUX&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;... rd.drivers.blacklist=nouveau nouveau.modeset=0 ...&amp;quot;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;hr&gt;
&lt;h1&gt;LINKS&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;https://sys-adm.in/os/nix/425-fedora-install-nvidia-driver.html&lt;/li&gt;
&lt;li&gt;https://rpmfusion.org/Howto/NVIDIA&lt;/li&gt;
&lt;/ul&gt;</content><category term="Fedora"></category><category term="Linux"></category><category term="Nvidia"></category></entry><entry><title>Actual stable latest kernel in CentOS 7</title><link href="https://metajiji.github.io/blog/centos7-elrepo-kernel-latest-stable/" rel="alternate"></link><published>2017-05-06T00:00:00+07:00</published><updated>2017-05-06T00:00:00+07:00</updated><author><name>Denis Kadyshev</name></author><id>tag:metajiji.github.io,2017-05-06:/blog/centos7-elrepo-kernel-latest-stable/</id><summary type="html">&lt;p&gt;Устанавливаем актуальную версию ядра в CentOS 7.&lt;/p&gt;
&lt;h3&gt;Добавляем репозиторий &lt;code&gt;elrepo-kernel&lt;/code&gt; из &lt;code&gt;elrepo-release&lt;/code&gt;:&lt;/h3&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;rpm&lt;/span&gt; &lt;span class="o"&gt;--&lt;/span&gt;&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;https&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="o"&gt;//&lt;/span&gt;&lt;span class="n"&gt;www&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;elrepo&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;org&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;RPM&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;GPG&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;KEY&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;elrepo&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;org&lt;/span&gt;
&lt;span class="n"&gt;yum&lt;/span&gt; &lt;span class="n"&gt;install&lt;/span&gt; &lt;span class="n"&gt;http&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="o"&gt;//&lt;/span&gt;&lt;span class="n"&gt;www&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;elrepo&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;org&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;elrepo&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;release&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mf"&gt;7.0&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mf"&gt;2.&lt;/span&gt;&lt;span class="n"&gt;el7&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;elrepo&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;noarch&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;rpm&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h3&gt;Включаем репозиторий &lt;code&gt;elrepo-kernel&lt;/code&gt;:&lt;/h3&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;yum install -y yum-utils
yum-config-manager --enable elrepo-kernel
&lt;/pre&gt;&lt;/div&gt;


&lt;h3&gt;Установка (какая …&lt;/h3&gt;</summary><content type="html">&lt;p&gt;Устанавливаем актуальную версию ядра в CentOS 7.&lt;/p&gt;
&lt;h3&gt;Добавляем репозиторий &lt;code&gt;elrepo-kernel&lt;/code&gt; из &lt;code&gt;elrepo-release&lt;/code&gt;:&lt;/h3&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;rpm&lt;/span&gt; &lt;span class="o"&gt;--&lt;/span&gt;&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;https&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="o"&gt;//&lt;/span&gt;&lt;span class="n"&gt;www&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;elrepo&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;org&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;RPM&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;GPG&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;KEY&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;elrepo&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;org&lt;/span&gt;
&lt;span class="n"&gt;yum&lt;/span&gt; &lt;span class="n"&gt;install&lt;/span&gt; &lt;span class="n"&gt;http&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="o"&gt;//&lt;/span&gt;&lt;span class="n"&gt;www&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;elrepo&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;org&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;elrepo&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;release&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mf"&gt;7.0&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mf"&gt;2.&lt;/span&gt;&lt;span class="n"&gt;el7&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;elrepo&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;noarch&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;rpm&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h3&gt;Включаем репозиторий &lt;code&gt;elrepo-kernel&lt;/code&gt;:&lt;/h3&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;yum install -y yum-utils
yum-config-manager --enable elrepo-kernel
&lt;/pre&gt;&lt;/div&gt;


&lt;h3&gt;Установка (какая сейчас актуальная версия смотреть тут https://www.kernel.org/)&lt;/h3&gt;
&lt;p&gt;Перед установкой важно понимать следующее:&lt;/p&gt;
&lt;p&gt;Нет необходимости устанавливать пакет &lt;code&gt;kernel-lt-firmware&lt;/code&gt; или &lt;code&gt;kernel-ml-firmware&lt;/code&gt;. В дистрибутивном пакете &lt;code&gt;linux-firmware&lt;/code&gt; содержится больше файлов прошивки, чем в пакете &lt;code&gt;kernel-lt-firmware&lt;/code&gt; или &lt;code&gt;kernel-ml-firmware&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Нет необходимости устанавливать пакет &lt;code&gt;kernel-lt-headers&lt;/code&gt; или &lt;code&gt;kernel-ml-headers&lt;/code&gt;. Это необходимо, только если вы собираетесь пересобрать &lt;code&gt;glibc&lt;/code&gt; и следовательно, всю операционную систему.
Если необходимо, чтобы заголовки ядра были установлены, вы должны использовать текущий пакет &lt;code&gt;kernel-headers&lt;/code&gt; из вашего дистрибутива, поскольку это связано с текущей версией &lt;code&gt;glibc&lt;/code&gt;.&lt;/p&gt;
&lt;h4&gt;&lt;strong&gt;Текущая стабильная&lt;/strong&gt; (latest stable mainline kernel) версия ядра:&lt;/h4&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;yum install -y kernel-ml
&lt;/pre&gt;&lt;/div&gt;


&lt;h4&gt;&lt;strong&gt;LTS (Long Term Support)&lt;/strong&gt; версия ядра (предпочтительнее):&lt;/h4&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;yum install -y kernel-lt
&lt;/pre&gt;&lt;/div&gt;


&lt;h3&gt;Автозагрузка нового ядра&lt;/h3&gt;
&lt;p&gt;Необходимо убедиться в том, что новая версия ядра установлена и добавлена в загрузчик:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;awk -F&amp;quot;&amp;#39;|\&amp;quot;&amp;quot; &amp;#39;/^menuentry/&amp;amp;&amp;amp;/elrepo/{print $2}&amp;#39; /boot/grub2/grub.cfg
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Должно получиться примерно следующее:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;CentOS Linux (4.4.70-1.el7.elrepo.x86_64) 7 (Core)
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;На всякий случай проверим какое ядро загружется по умолчанию, для этого проверим каким образом &lt;code&gt;grub&lt;/code&gt; выбирает ядро для загруки:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;grep GRUB_DEFAULT /etc/default/grub
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Должно быть: &lt;code&gt;GRUB_DEFAULT=saved&lt;/code&gt;, если отличается, приводим к этому виду. Это означает, что будет загружена последняя сохраненная версия.&lt;/p&gt;
&lt;p&gt;Узнать какая версия ядра была загружена последней можно при помощи следующей команды:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;grub2-editenv list
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;В ответ получим примерно следующее:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;saved_entry=CentOS Linux (3.10.0-514.21.1.el7.x86_64) 7 (Core)
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;В моем случае грузится старое &lt;code&gt;3.10&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Изменим загружаемое по умолчанию ядро на свеже-установленное (которое получали при помощи &lt;code&gt;awk&lt;/code&gt;):&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;grub2-set-default &amp;#39;CentOS Linux (4.4.70-1.el7.elrepo.x86_64) 7 (Core)&amp;#39;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Убедимся, что  &lt;code&gt;grub&lt;/code&gt; выберет правильную версию ядра загружаемого по умолчанию:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;grub2-editenv list
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;В моем случае я получил то, что написал в &lt;code&gt;grub2-set-default&lt;/code&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;saved_entry=CentOS Linux (4.4.70-1.el7.elrepo.x86_64) 7 (Core)
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Сохраняем новую конфигурацию загрузчика:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;grub2-mkconfig -o /boot/grub2/grub.cfg
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Если ошибок небыло, то перезагружаем систему:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;reboot
&lt;/pre&gt;&lt;/div&gt;


&lt;h3&gt;После того, как система перезагрузилась можно проверить текущую версию ядра:&lt;/h3&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;uname -r
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Если в ответ получим &lt;code&gt;4.4.70-1.el7.elrepo.x86_64&lt;/code&gt;, значит все сделано верно.&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;Ссылки по теме:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/6/html/Deployment_Guide/sec-Managing_Yum_Repositories.html"&gt;8.4.5. Adding, Enabling, and Disabling a Yum Repository&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://elrepo.org/tiki/tiki-index.php"&gt;The Community Enterprise Linux Repository&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://www.kernel.org/"&gt;The Linux Kernel Archives&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;</content><category term="CentOS"></category><category term="kernel"></category></entry><entry><title>Автоматическое удаление бекапов confluence</title><link href="https://metajiji.github.io/blog/confluence-cron-delete-backups/" rel="alternate"></link><published>2017-03-20T00:00:00+07:00</published><updated>2017-03-20T00:00:00+07:00</updated><author><name>Denis Kadyshev</name></author><id>tag:metajiji.github.io,2017-03-20:/blog/confluence-cron-delete-backups/</id><summary type="html">&lt;p&gt;Создать файл &lt;code&gt;/etc/cron.daily/confluence-cleanup&lt;/code&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="ch"&gt;#!/bin/sh&lt;/span&gt;

&lt;span class="o"&gt;(&lt;/span&gt;
    &lt;span class="nb"&gt;cd&lt;/span&gt; /opt/atlassian/confluence.application-data/backups
    &lt;span class="k"&gt;for&lt;/span&gt; f in daily-backup-*.zip&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;
        &lt;span class="o"&gt;[&lt;/span&gt; &lt;span class="k"&gt;$(&lt;/span&gt;ls daily-backup-*.zip &lt;span class="p"&gt;|&lt;/span&gt; wc -l&lt;span class="k"&gt;)&lt;/span&gt; -gt &lt;span class="m"&gt;10&lt;/span&gt; &lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;||&lt;/span&gt; &lt;span class="nb"&gt;break&lt;/span&gt;
        rm -vf &lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;$f&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;
    &lt;span class="k"&gt;done&lt;/span&gt;
&lt;span class="o"&gt;)&lt;/span&gt;

&lt;span class="nv"&gt;EXITVALUE&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nv"&gt;$?&lt;/span&gt;
&lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="o"&gt;[&lt;/span&gt; &lt;span class="nv"&gt;$EXITVALUE&lt;/span&gt; !&lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="m"&gt;0&lt;/span&gt; &lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="k"&gt;then&lt;/span&gt;
    /usr/bin/logger -t confluence &lt;span class="s2"&gt;&amp;quot;ALERT exited abnormally with [&lt;/span&gt;&lt;span class="nv"&gt;$EXITVALUE&lt;/span&gt;&lt;span class="s2"&gt;]&amp;quot;&lt;/span&gt;
&lt;span class="k"&gt;fi&lt;/span&gt;
&lt;span class="nb"&gt;exit&lt;/span&gt; &lt;span class="m"&gt;0 …&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;</summary><content type="html">&lt;p&gt;Создать файл &lt;code&gt;/etc/cron.daily/confluence-cleanup&lt;/code&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="ch"&gt;#!/bin/sh&lt;/span&gt;

&lt;span class="o"&gt;(&lt;/span&gt;
    &lt;span class="nb"&gt;cd&lt;/span&gt; /opt/atlassian/confluence.application-data/backups
    &lt;span class="k"&gt;for&lt;/span&gt; f in daily-backup-*.zip&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;
        &lt;span class="o"&gt;[&lt;/span&gt; &lt;span class="k"&gt;$(&lt;/span&gt;ls daily-backup-*.zip &lt;span class="p"&gt;|&lt;/span&gt; wc -l&lt;span class="k"&gt;)&lt;/span&gt; -gt &lt;span class="m"&gt;10&lt;/span&gt; &lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;||&lt;/span&gt; &lt;span class="nb"&gt;break&lt;/span&gt;
        rm -vf &lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;$f&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;
    &lt;span class="k"&gt;done&lt;/span&gt;
&lt;span class="o"&gt;)&lt;/span&gt;

&lt;span class="nv"&gt;EXITVALUE&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nv"&gt;$?&lt;/span&gt;
&lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="o"&gt;[&lt;/span&gt; &lt;span class="nv"&gt;$EXITVALUE&lt;/span&gt; !&lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="m"&gt;0&lt;/span&gt; &lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="k"&gt;then&lt;/span&gt;
    /usr/bin/logger -t confluence &lt;span class="s2"&gt;&amp;quot;ALERT exited abnormally with [&lt;/span&gt;&lt;span class="nv"&gt;$EXITVALUE&lt;/span&gt;&lt;span class="s2"&gt;]&amp;quot;&lt;/span&gt;
&lt;span class="k"&gt;fi&lt;/span&gt;
&lt;span class="nb"&gt;exit&lt;/span&gt; &lt;span class="m"&gt;0&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Обазательно укажите верный путь до каталога с бекапами &lt;code&gt;/opt/atlassian/confluence.application-data/backups&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;Дать права на запуск для этого файла:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;chmod +x /etc/cron.daily/confluence-cleanup
&lt;/pre&gt;&lt;/div&gt;</content><category term="atlassian"></category><category term="confluence"></category><category term="linux"></category><category term="cron"></category></entry><entry><title>Gitlab SMTP not work via external smtp</title><link href="https://metajiji.github.io/blog/gitlab-smtp-not-work/" rel="alternate"></link><published>2017-03-20T00:00:00+07:00</published><updated>2017-03-20T00:00:00+07:00</updated><author><name>Denis Kadyshev</name></author><id>tag:metajiji.github.io,2017-03-20:/blog/gitlab-smtp-not-work/</id><summary type="html">&lt;p&gt;When gitlab try to send email via external smtp server, sidekiq mail queue crash with error like:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;SSL_connect returned=1 errno=0 state=SSLv3 read server certificate B: certificate verify failed
&lt;/pre&gt;&lt;/div&gt;


&lt;h1&gt;Fix for &lt;strong&gt;package installed&lt;/strong&gt; gitlab:&lt;/h1&gt;
&lt;h2&gt;Edit &lt;code&gt;/etc/gitlab/gitlab.rb&lt;/code&gt; and add:&lt;/h2&gt;
&lt;h3&gt;For ubuntu system wide ca bundle:&lt;/h3&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;gitlab_rails …&lt;/pre&gt;&lt;/div&gt;</summary><content type="html">&lt;p&gt;When gitlab try to send email via external smtp server, sidekiq mail queue crash with error like:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;SSL_connect returned=1 errno=0 state=SSLv3 read server certificate B: certificate verify failed
&lt;/pre&gt;&lt;/div&gt;


&lt;h1&gt;Fix for &lt;strong&gt;package installed&lt;/strong&gt; gitlab:&lt;/h1&gt;
&lt;h2&gt;Edit &lt;code&gt;/etc/gitlab/gitlab.rb&lt;/code&gt; and add:&lt;/h2&gt;
&lt;h3&gt;For ubuntu system wide ca bundle:&lt;/h3&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;gitlab_rails[&amp;#39;smtp_ca_file&amp;#39;] = &amp;quot;/etc/ssl/certs/ca-certificates.crt&amp;quot;
&lt;/pre&gt;&lt;/div&gt;


&lt;h3&gt;For centos system wide ca bundle:&lt;/h3&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;gitlab_rails[&amp;#39;smtp_ca_file&amp;#39;] = &amp;quot;/etc/pki/tls/certs/ca-bundle.crt&amp;quot;
&lt;/pre&gt;&lt;/div&gt;


&lt;h3&gt;Or omnibus gitlab package:&lt;/h3&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;gitlab_rails[&amp;#39;smtp_ca_file&amp;#39;] = &amp;quot;/opt/gitlab/embedded/ssl/cert.pem&amp;quot;
&lt;/pre&gt;&lt;/div&gt;


&lt;h2&gt;Then run &lt;code&gt;gitlab-ctl reconfigure&lt;/code&gt;.&lt;/h2&gt;
&lt;h1&gt;For gitlab installed from &lt;strong&gt;source code&lt;/strong&gt;:&lt;/h1&gt;
&lt;h3&gt;Edit file &lt;code&gt;config/initializers/smtp_settings.rb&lt;/code&gt;:&lt;/h3&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;ActionMailer::Base.smtp_settings = {
    authentication: :login,
    ...
    # For ubuntu
    ca_file: &amp;quot;/etc/ssl/certs/ca-certificates.crt&amp;quot;,
    # For centos
    #ca_file: &amp;quot;/etc/pki/tls/certs/ca-bundle.crt&amp;quot;,
}
&lt;/pre&gt;&lt;/div&gt;


&lt;h3&gt;Finnaly &lt;strong&gt;restart&lt;/strong&gt; &lt;code&gt;gitlab&lt;/code&gt; service:&lt;/h3&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;service gitlab restart
&lt;/pre&gt;&lt;/div&gt;


&lt;hr&gt;
&lt;p&gt;Links&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href="https://gitlab.com/gitlab-org/gitlab-ce/issues/1558#note_1183160"&gt;SSL certification error #1558&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://gitlab.com/gitlab-org/gitlab-ce/issues/2143"&gt;SMTP Gmail account working on gitlab but not on gitlab-ci #2143&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;</content><category term="gitlab"></category><category term="smtp"></category><category term="ruby"></category><category term="ssl"></category><category term="openssl"></category><category term="ca"></category><category term="certificates"></category></entry><entry><title>Enable ip forwarding in linux</title><link href="https://metajiji.github.io/blog/linux-enable-ip-forwarding/" rel="alternate"></link><published>2017-03-20T00:00:00+07:00</published><updated>2017-03-20T00:00:00+07:00</updated><author><name>Denis Kadyshev</name></author><id>tag:metajiji.github.io,2017-03-20:/blog/linux-enable-ip-forwarding/</id><summary type="html">&lt;h1&gt;Debian/Ubuntu &lt;code&gt;/etc/network/options&lt;/code&gt;:&lt;/h1&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;ip_forward=yes
&lt;/pre&gt;&lt;/div&gt;


&lt;h2&gt;For restart network service &lt;code&gt;procps&lt;/code&gt;:&lt;/h2&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;/etc/init.d/procps.sh restart
&lt;/pre&gt;&lt;/div&gt;


&lt;h1&gt;RedHat &lt;code&gt;/etc/sysconfig/network&lt;/code&gt;:&lt;/h1&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;FORWARD_IPV4=true
&lt;/pre&gt;&lt;/div&gt;</summary><content type="html">&lt;h1&gt;Debian/Ubuntu &lt;code&gt;/etc/network/options&lt;/code&gt;:&lt;/h1&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;ip_forward=yes
&lt;/pre&gt;&lt;/div&gt;


&lt;h2&gt;For restart network service &lt;code&gt;procps&lt;/code&gt;:&lt;/h2&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;/etc/init.d/procps.sh restart
&lt;/pre&gt;&lt;/div&gt;


&lt;h1&gt;RedHat &lt;code&gt;/etc/sysconfig/network&lt;/code&gt;:&lt;/h1&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;FORWARD_IPV4=true
&lt;/pre&gt;&lt;/div&gt;</content><category term="Linux"></category><category term="Centos"></category><category term="Ubuntu"></category><category term="ip_forwaring"></category></entry><entry><title>Openssl for check services</title><link href="https://metajiji.github.io/blog/openssl_for_check_services/" rel="alternate"></link><published>2017-03-16T00:00:00+07:00</published><updated>2017-03-16T00:00:00+07:00</updated><author><name>Denis Kadyshev</name></author><id>tag:metajiji.github.io,2017-03-16:/blog/openssl_for_check_services/</id><summary type="html">&lt;h1&gt;Проверка шифрования SSL/TLS.&lt;/h1&gt;
&lt;p&gt;Для шифрования трафика в почтовых протоколах между клиентом и сервером используется SSL/TLS в двух вариантах.
 Использование специальных портов, при соединении с которым сначала осуществляется установка SSL/TLS, после чего уже поверх него идет обычный почтовый трафик.
Этот метод, кстати, признан устаревшим (deprecated), относительно SMTP точно …&lt;/p&gt;</summary><content type="html">&lt;h1&gt;Проверка шифрования SSL/TLS.&lt;/h1&gt;
&lt;p&gt;Для шифрования трафика в почтовых протоколах между клиентом и сервером используется SSL/TLS в двух вариантах.
 Использование специальных портов, при соединении с которым сначала осуществляется установка SSL/TLS, после чего уже поверх него идет обычный почтовый трафик.
Этот метод, кстати, признан устаревшим (deprecated), относительно SMTP точно. Второй вариант, более предпочтительный — соединение с обычным портом для сервиса 
и переход сессии в зашифрованный вид с использованием расширения STARTTLS.&lt;/p&gt;
&lt;p&gt;Для проверки работы почтового сервера поверх SSL/TLS можно использовать утилиту &lt;code&gt;openssl&lt;/code&gt;, дальше действуя, как при обычной сессии через &lt;code&gt;telnet&lt;/code&gt;.&lt;/p&gt;
&lt;h2&gt;SMTP&lt;/h2&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;openssl s_client -starttls smtp -crlf -connect mail.example.com:25
openssl s_client -starttls smtp -crlf -connect mail.example.com:587
openssl s_client -crlf -connect mail.example.com:465
&lt;/pre&gt;&lt;/div&gt;


&lt;h2&gt;POP3&lt;/h2&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;openssl s_client -connect mail.example.com:995
openssl s_client -starttls pop3 -crlf -connect mail.example.com:110
&lt;/pre&gt;&lt;/div&gt;


&lt;h2&gt;IMAP&lt;/h2&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;openssl s_client -crlf -connect mail.example.com:993
openssl s_client -starttls imap -crlf -connect mail.example.com:143
&lt;/pre&gt;&lt;/div&gt;


&lt;h2&gt;Можно явным образом указать, что использовать для шифрования, ssl3 или tls1, а также конкретные алгоритмы:&lt;/h2&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;openssl s_client -ssl3 -starttls smtp -crlf -connect mail.example.com:25
&lt;/pre&gt;&lt;/div&gt;


&lt;h2&gt;Посмотреть перечень поддерживаемых протоколов в вашей версии &lt;code&gt;openssl&lt;/code&gt;:&lt;/h2&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;openssl ciphers -ssl3
openssl ciphers -tls1
&lt;/pre&gt;&lt;/div&gt;


&lt;hr&gt;
&lt;p&gt;Ссылки по теме:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href="https://habrahabr.ru/company/truevds/blog/262819/"&gt;Диагностика почтовых протоколов&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;</content><category term="openssl"></category><category term="bash"></category><category term="Linux"></category></entry><entry><title>CentOS 7 install python 3.5 rh sclo</title><link href="https://metajiji.github.io/blog/centos7-rh-python35-python/" rel="alternate"></link><published>2017-03-13T00:00:00+07:00</published><updated>2017-03-13T00:00:00+07:00</updated><author><name>Denis Kadyshev</name></author><id>tag:metajiji.github.io,2017-03-13:/blog/centos7-rh-python35-python/</id><summary type="html">&lt;h1&gt;Python35 on CentOS 7&lt;/h1&gt;
&lt;h2&gt;Install packages&lt;/h2&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;yum install -y centos-release-scl
yum install -y rh-python35-python
&lt;/pre&gt;&lt;/div&gt;


&lt;h2&gt;Enable &lt;code&gt;rh-python35&lt;/code&gt; globally for all users&lt;/h2&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;cat &amp;gt; /etc/profile.d/rh_python35.sh &amp;lt;&amp;lt;_EOF
#!/bin/sh

source /opt/rh/rh-python35/enable
_EOF
&lt;/pre&gt;&lt;/div&gt;


&lt;h3&gt;Activate without relogin&lt;/h3&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;. /etc/profile.d/rh_python35.sh
&lt;/pre&gt;&lt;/div&gt;


&lt;h2&gt;List available scl packages&lt;/h2&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;scl --list
&lt;/pre&gt;&lt;/div&gt;


&lt;h2&gt;Activate …&lt;/h2&gt;</summary><content type="html">&lt;h1&gt;Python35 on CentOS 7&lt;/h1&gt;
&lt;h2&gt;Install packages&lt;/h2&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;yum install -y centos-release-scl
yum install -y rh-python35-python
&lt;/pre&gt;&lt;/div&gt;


&lt;h2&gt;Enable &lt;code&gt;rh-python35&lt;/code&gt; globally for all users&lt;/h2&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;cat &amp;gt; /etc/profile.d/rh_python35.sh &amp;lt;&amp;lt;_EOF
#!/bin/sh

source /opt/rh/rh-python35/enable
_EOF
&lt;/pre&gt;&lt;/div&gt;


&lt;h3&gt;Activate without relogin&lt;/h3&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;. /etc/profile.d/rh_python35.sh
&lt;/pre&gt;&lt;/div&gt;


&lt;h2&gt;List available scl packages&lt;/h2&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;scl --list
&lt;/pre&gt;&lt;/div&gt;


&lt;h2&gt;Activate &lt;code&gt;rh-python35&lt;/code&gt; in current &lt;code&gt;bash&lt;/code&gt; session:&lt;/h2&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;scl enable rh-python35 bash
&lt;/pre&gt;&lt;/div&gt;


&lt;h2&gt;Or in bash scripts:&lt;/h2&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="s s-Atom"&gt;export&lt;/span&gt; &lt;span class="nv"&gt;PATH&lt;/span&gt;&lt;span class="s s-Atom"&gt;=/opt&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="s s-Atom"&gt;rh&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="s s-Atom"&gt;rh&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="s s-Atom"&gt;python35&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="s s-Atom"&gt;root&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="s s-Atom"&gt;usr&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="s s-Atom"&gt;bin$&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="nv"&gt;PATH&lt;/span&gt;&lt;span class="s s-Atom"&gt;:+:&lt;/span&gt;&lt;span class="err"&gt;$&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="nv"&gt;PATH&lt;/span&gt;&lt;span class="p"&gt;}}&lt;/span&gt;
&lt;span class="s s-Atom"&gt;export&lt;/span&gt; &lt;span class="nv"&gt;LD_LIBRARY_PATH&lt;/span&gt;&lt;span class="s s-Atom"&gt;=/opt&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="s s-Atom"&gt;rh&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="s s-Atom"&gt;rh&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="s s-Atom"&gt;python35&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="s s-Atom"&gt;root&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="s s-Atom"&gt;usr&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="s s-Atom"&gt;lib64$&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="nv"&gt;LD_LIBRARY_PATH&lt;/span&gt;&lt;span class="s s-Atom"&gt;:+:&lt;/span&gt;&lt;span class="err"&gt;$&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="nv"&gt;LD_LIBRARY_PATH&lt;/span&gt;&lt;span class="p"&gt;}}&lt;/span&gt;
&lt;span class="s s-Atom"&gt;export&lt;/span&gt; &lt;span class="nv"&gt;MANPATH&lt;/span&gt;&lt;span class="s s-Atom"&gt;=/opt&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="s s-Atom"&gt;rh&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="s s-Atom"&gt;rh&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="s s-Atom"&gt;python35&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="s s-Atom"&gt;root&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="s s-Atom"&gt;usr&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="s s-Atom"&gt;share&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="nn"&gt;man&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="err"&gt;$&lt;/span&gt;&lt;span class="nv"&gt;MANPATH&lt;/span&gt;
&lt;span class="s s-Atom"&gt;export&lt;/span&gt; &lt;span class="nv"&gt;PKG_CONFIG_PATH&lt;/span&gt;&lt;span class="s s-Atom"&gt;=/opt&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="s s-Atom"&gt;rh&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="s s-Atom"&gt;rh&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="s s-Atom"&gt;python35&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="s s-Atom"&gt;root&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="s s-Atom"&gt;usr&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="s s-Atom"&gt;lib64&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="s s-Atom"&gt;pkgconfig$&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="nv"&gt;PKG_CONFIG_PATH&lt;/span&gt;&lt;span class="s s-Atom"&gt;:+:&lt;/span&gt;&lt;span class="err"&gt;$&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="nv"&gt;PKG_CONFIG_PATH&lt;/span&gt;&lt;span class="p"&gt;}}&lt;/span&gt;
&lt;span class="s s-Atom"&gt;export&lt;/span&gt; &lt;span class="nv"&gt;XDG_DATA_DIRS&lt;/span&gt;&lt;span class="s s-Atom"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;/opt/rh/rh-python35/root/usr/share:${XDG_DATA_DIRS:-/usr/local/share:/usr/share}&amp;quot;&lt;/span&gt;

&lt;span class="s s-Atom"&gt;python&lt;/span&gt; &lt;span class="s s-Atom"&gt;--verion&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h2&gt;Or this method:&lt;/h2&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;. /opt/rh/rh-python35/enable
&lt;/pre&gt;&lt;/div&gt;


&lt;h2&gt;Create virtualenv in Python35:&lt;/h2&gt;
&lt;p&gt;Python 3 has a built-in support for virtual environments&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;https://docs.python.org/3/library/venv.html#module-venv&lt;/li&gt;
&lt;li&gt;https://docs.python.org/3.6/whatsnew/3.6.html#id7&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;python3 -m venv venv
&lt;/pre&gt;&lt;/div&gt;


&lt;h2&gt;Use &lt;code&gt;rh-python35&lt;/code&gt; in &lt;code&gt;supervisor&lt;/code&gt;&lt;/h2&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;[program:app]&lt;/span&gt;
&lt;span class="na"&gt;directory&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;/srv/app&lt;/span&gt;

&lt;span class="na"&gt;environment&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;PATH=/srv/app/venv/bin:/opt/rh/rh-python35/root/usr/bin,&lt;/span&gt;
&lt;span class="s"&gt;    LD_LIBRARY_PATH=/opt/rh/rh-python35/root/usr/lib64&lt;/span&gt;

&lt;span class="na"&gt;command&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;/srv/app/venv/bin/gunicorn ...&lt;/span&gt;

&lt;span class="na"&gt;stdout_logfile&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;/srv/app/logs/%(program_name)s.log&lt;/span&gt;
&lt;span class="na"&gt;stdout_logfile_maxbytes&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;5MB  ; max # logfile bytes b4 rotation (default 50MB)&lt;/span&gt;
&lt;span class="na"&gt;stdout_logfile_backups&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;5     ; # of stdout logfile backups (default 10)&lt;/span&gt;
&lt;span class="na"&gt;redirect_stderr&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;true&lt;/span&gt;

&lt;span class="na"&gt;user&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;nobody&lt;/span&gt;
&lt;span class="na"&gt;numprocs&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;1&lt;/span&gt;
&lt;span class="na"&gt;autostart&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;true&lt;/span&gt;
&lt;span class="na"&gt;autorestart&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;true&lt;/span&gt;
&lt;span class="na"&gt;startsecs&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;5&lt;/span&gt;
&lt;span class="na"&gt;stopwaitsecs&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;60&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h2&gt;Use &lt;code&gt;rh-python35&lt;/code&gt; in &lt;code&gt;systemd&lt;/code&gt;&lt;/h2&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;[Unit]&lt;/span&gt;
&lt;span class="na"&gt;Description&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;Foo bar service&lt;/span&gt;
&lt;span class="na"&gt;Requires&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;nginx.service&lt;/span&gt;
&lt;span class="na"&gt;Before&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;nginx.service&lt;/span&gt;
&lt;span class="na"&gt;After&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;network.target&lt;/span&gt;

&lt;span class="k"&gt;[Service]&lt;/span&gt;
&lt;span class="na"&gt;Type&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;notify&lt;/span&gt;
&lt;span class="na"&gt;User&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;jenkins&lt;/span&gt;
&lt;span class="na"&gt;Group&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;jenkins&lt;/span&gt;

&lt;span class="na"&gt;Environment&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;LD_LIBRARY_PATH=/opt/rh/rh-python35/root/usr/lib64&lt;/span&gt;
&lt;span class="na"&gt;Environment&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;PATH=/srv/app/venv/bin:/opt/rh/rh-python35/root/usr/bin&lt;/span&gt;

&lt;span class="na"&gt;WorkingDirectory&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;/srv/app&lt;/span&gt;
&lt;span class="na"&gt;ExecStart&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;/srv/app/venv/bin/uwsgi \&lt;/span&gt;
&lt;span class="s"&gt;    --module app.wsgi \&lt;/span&gt;
&lt;span class="s"&gt;    --http :8006 \&lt;/span&gt;
&lt;span class="s"&gt;    ...&lt;/span&gt;

&lt;span class="na"&gt;PIDFile&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;/srv/app/var/run/app.pid&lt;/span&gt;

&lt;span class="na"&gt;KillMode&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;process&lt;/span&gt;
&lt;span class="na"&gt;Restart&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;always&lt;/span&gt;
&lt;span class="na"&gt;KillSignal&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;SIGTERM&lt;/span&gt;
&lt;span class="na"&gt;NotifyAccess&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;all&lt;/span&gt;

&lt;span class="k"&gt;[Install]&lt;/span&gt;
&lt;span class="na"&gt;WantedBy&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;multi-user.target&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;hr&gt;
&lt;p&gt;Ссылки по теме:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href="http://xmodulo.com/enable-software-collections-centos.html"&gt;How to enable Software Collections (SCL) on CentOS&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;</content><category term="Linux"></category><category term="Centos"></category><category term="Centos 7"></category><category term="python35"></category><category term="python3"></category><category term="python"></category></entry><entry><title>CentOS 7 install modern git 2.x rh sclo</title><link href="https://metajiji.github.io/blog/centos7-rh-sclo-git/" rel="alternate"></link><published>2017-03-13T00:00:00+07:00</published><updated>2017-03-13T00:00:00+07:00</updated><author><name>Denis Kadyshev</name></author><id>tag:metajiji.github.io,2017-03-13:/blog/centos7-rh-sclo-git/</id><summary type="html">&lt;h1&gt;Install requirements&lt;/h1&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;yum install -y scl-utils centos-release-scl
yum install -y sclo-git25
&lt;/pre&gt;&lt;/div&gt;


&lt;h1&gt;Enable git globally for all users&lt;/h1&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;cat &amp;gt; /etc/profile.d/sclo_git25.sh &amp;lt;&amp;lt;_EOF
#!/bin/sh

source /opt/rh/sclo-git25/enable
source /opt/rh/sclo-git25/root/usr/share/bash-completion/completions/git
_EOF
&lt;/pre&gt;&lt;/div&gt;


&lt;h1&gt;Activate without relogin&lt;/h1&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;. /etc/profile.d/sclo_git25.sh …&lt;/pre&gt;&lt;/div&gt;</summary><content type="html">&lt;h1&gt;Install requirements&lt;/h1&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;yum install -y scl-utils centos-release-scl
yum install -y sclo-git25
&lt;/pre&gt;&lt;/div&gt;


&lt;h1&gt;Enable git globally for all users&lt;/h1&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;cat &amp;gt; /etc/profile.d/sclo_git25.sh &amp;lt;&amp;lt;_EOF
#!/bin/sh

source /opt/rh/sclo-git25/enable
source /opt/rh/sclo-git25/root/usr/share/bash-completion/completions/git
_EOF
&lt;/pre&gt;&lt;/div&gt;


&lt;h1&gt;Activate without relogin&lt;/h1&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;. /etc/profile.d/sclo_git25.sh
&lt;/pre&gt;&lt;/div&gt;</content><category term="Linux"></category><category term="Centos"></category><category term="Centos 7"></category><category term="git"></category></entry><entry><title>Обновление подмодулей git</title><link href="https://metajiji.github.io/blog/git_submodule-update/" rel="alternate"></link><published>2016-12-10T00:00:00+07:00</published><updated>2016-12-10T00:00:00+07:00</updated><author><name>Denis Kadyshev</name></author><id>tag:metajiji.github.io,2016-12-10:/blog/git_submodule-update/</id><summary type="html">&lt;p&gt;Инициализуруются подмодули так:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;git submodule init
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Синхронизируются и обновляются так:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;git submodule sync
git submodule update
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Получить последние версии кода:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;git submodule update --recursive --remote
&lt;/pre&gt;&lt;/div&gt;


&lt;hr&gt;
&lt;p&gt;Ссылки по теме:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href="http://oddstyle.ru/wordpress-2/stati-wordpress/upravlenie-wordpress-sajtom-s-pomoshhyu-git-i-composer-chast-3-ispolzuem-podmoduli-git-dlya-upravleniya-temami-i-plaginami.html"&gt;Управление WordPress-сайтом с помощью Git и Composer. Часть 3. Используем подмодули Git для управления темами и плагинами&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;</summary><content type="html">&lt;p&gt;Инициализуруются подмодули так:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;git submodule init
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Синхронизируются и обновляются так:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;git submodule sync
git submodule update
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Получить последние версии кода:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;git submodule update --recursive --remote
&lt;/pre&gt;&lt;/div&gt;


&lt;hr&gt;
&lt;p&gt;Ссылки по теме:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href="http://oddstyle.ru/wordpress-2/stati-wordpress/upravlenie-wordpress-sajtom-s-pomoshhyu-git-i-composer-chast-3-ispolzuem-podmoduli-git-dlya-upravleniya-temami-i-plaginami.html"&gt;Управление WordPress-сайтом с помощью Git и Composer. Часть 3. Используем подмодули Git для управления темами и плагинами&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;</content><category term="git"></category><category term="bash"></category></entry><entry><title>Docker tmpfs systemd</title><link href="https://metajiji.github.io/blog/docker-tmpfs-systemd/" rel="alternate"></link><published>2016-11-28T00:00:00+07:00</published><updated>2016-11-28T00:00:00+07:00</updated><author><name>Denis Kadyshev</name></author><id>tag:metajiji.github.io,2016-11-28:/blog/docker-tmpfs-systemd/</id><summary type="html">&lt;p&gt;Создаем &lt;code&gt;override.conf&lt;/code&gt; для сервиса &lt;code&gt;docker&lt;/code&gt; командой &lt;code&gt;systemctl edit docker.service&lt;/code&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;[Service]&lt;/span&gt;
&lt;span class="na"&gt;ExecStartPre&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;/usr/bin/env install -m 711 -o root -g root -vd /var/lib/docker_ /var/lib/docker&lt;/span&gt;
&lt;span class="na"&gt;ExecStartPre&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;/usr/bin/env mount -t tmpfs none /var/lib/docker&lt;/span&gt;
&lt;span class="na"&gt;ExecStartPre&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;/usr/bin/env rsync -a /var/lib/docker_ …&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;</summary><content type="html">&lt;p&gt;Создаем &lt;code&gt;override.conf&lt;/code&gt; для сервиса &lt;code&gt;docker&lt;/code&gt; командой &lt;code&gt;systemctl edit docker.service&lt;/code&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;[Service]&lt;/span&gt;
&lt;span class="na"&gt;ExecStartPre&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;/usr/bin/env install -m 711 -o root -g root -vd /var/lib/docker_ /var/lib/docker&lt;/span&gt;
&lt;span class="na"&gt;ExecStartPre&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;/usr/bin/env mount -t tmpfs none /var/lib/docker&lt;/span&gt;
&lt;span class="na"&gt;ExecStartPre&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;/usr/bin/env rsync -a /var/lib/docker_/ /var/lib/docker/&lt;/span&gt;

&lt;span class="na"&gt;ExecStopPost&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;/usr/bin/env install -m 711 -o root -g root -vd /var/lib/docker_&lt;/span&gt;
&lt;span class="na"&gt;ExecStopPost&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;-/usr/bin/env rsync -a /var/lib/docker/ /var/lib/docker_/&lt;/span&gt;
&lt;span class="na"&gt;ExecStopPost&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;/usr/bin/env umount /var/lib/docker&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Где:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;/var/lib/docker_&lt;/code&gt; - каталог для хранения образов и контейнеров на диске&lt;/li&gt;
&lt;li&gt;&lt;code&gt;/var/lib/docker&lt;/code&gt; - tmpfs в RAM&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Перед запуском сервиса &lt;code&gt;docker&lt;/code&gt; будут создаваться, при необходимости нужные для работы каталоги,
затем монтируется &lt;code&gt;tmpfs&lt;/code&gt; в &lt;code&gt;/var/lib/docker&lt;/code&gt; после чего в этот каталог будет скопировано
 содержимое с диска &lt;code&gt;/var/lib/docker_&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;При остановке сервиса все происходи в обратной последовательности, после остановки сервиса &lt;code&gt;docker&lt;/code&gt;
 данные копируются из &lt;code&gt;tmpfs&lt;/code&gt; на диск, после чего &lt;code&gt;/var/lib/docker&lt;/code&gt; отмонтируется, а все данные 
из этого каталога мгновенно уничтожаются.&lt;/p&gt;
&lt;p&gt;Таким образом при запуске сервиса автоматически файловая система контейнеров и образов помещается в &lt;strong&gt;RAM&lt;/strong&gt;,
 а при остановке копируется на диск, чтобы при следующем запуске данные не потерялись.&lt;/p&gt;</content><category term="docker systemd tmpfs"></category></entry><entry><title>lightbox markdown pelican</title><link href="https://metajiji.github.io/blog/lightbox-markdown-pelican/" rel="alternate"></link><published>2016-10-21T00:00:00+07:00</published><updated>2016-10-21T00:00:00+07:00</updated><author><name>Denis Kadyshev</name></author><id>tag:metajiji.github.io,2016-10-21:/blog/lightbox-markdown-pelican/</id><summary type="html">&lt;p&gt;В заголовке документа&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;lightbox: true
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;После чего в шаблоне &lt;code&gt;base.html&lt;/code&gt; срабатывают условия:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;head&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
...
    {% if (article and article.lightbox) %}
        &lt;span class="c"&gt;&amp;lt;!-- Enable lightbox (https://github.com/dimsemenov/Magnific-Popup) --&amp;gt;&lt;/span&gt;
        &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;link&lt;/span&gt; &lt;span class="na"&gt;href&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;//cdnjs.cloudflare.com/ajax/libs/magnific-popup.js/1.1.0/magnific-popup.min.css&amp;quot;&lt;/span&gt; &lt;span class="na"&gt;rel&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;stylesheet&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
    {% endif %}
&lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;head&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;

...
{% if (article and article.lightbox …&lt;/pre&gt;&lt;/div&gt;</summary><content type="html">&lt;p&gt;В заголовке документа&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;lightbox: true
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;После чего в шаблоне &lt;code&gt;base.html&lt;/code&gt; срабатывают условия:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;head&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
...
    {% if (article and article.lightbox) %}
        &lt;span class="c"&gt;&amp;lt;!-- Enable lightbox (https://github.com/dimsemenov/Magnific-Popup) --&amp;gt;&lt;/span&gt;
        &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;link&lt;/span&gt; &lt;span class="na"&gt;href&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;//cdnjs.cloudflare.com/ajax/libs/magnific-popup.js/1.1.0/magnific-popup.min.css&amp;quot;&lt;/span&gt; &lt;span class="na"&gt;rel&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;stylesheet&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
    {% endif %}
&lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;head&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;

...
{% if (article and article.lightbox) %}
&lt;span class="c"&gt;&amp;lt;!-- Enable lightbox gallery plugin for Bootstrap (https://github.com/ashleydw/lightbox) --&amp;gt;&lt;/span&gt;
&lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;script&lt;/span&gt; &lt;span class="na"&gt;src&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;//cdnjs.cloudflare.com/ajax/libs/magnific-popup.js/1.1.0/jquery.magnific-popup.min.js&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;script&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
&lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;script&lt;/span&gt; &lt;span class="na"&gt;type&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;text/javascript&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
&lt;span class="nx"&gt;$&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kd"&gt;function&lt;/span&gt;&lt;span class="p"&gt;(){&lt;/span&gt;
    &lt;span class="nx"&gt;$&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;{% if MAGNIFIC_POPUP_SELECTOR %}{{ MAGNIFIC_POPUP_SELECTOR }}{% else %}img[class*=&amp;quot;mfp-&amp;quot;]{% endif %}&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;).&lt;/span&gt;&lt;span class="nx"&gt;magnificPopup&lt;/span&gt;&lt;span class="p"&gt;({&lt;/span&gt;
        &lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="o"&gt;%&lt;/span&gt; &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="nx"&gt;MAGNIFIC_POPUP_OPTIONS&lt;/span&gt; &lt;span class="o"&gt;%&lt;/span&gt;&lt;span class="p"&gt;}{{&lt;/span&gt; &lt;span class="nx"&gt;MAGNIFIC_POPUP_OPTIONS&lt;/span&gt; &lt;span class="p"&gt;}}{&lt;/span&gt;&lt;span class="o"&gt;%&lt;/span&gt; &lt;span class="nx"&gt;endif&lt;/span&gt; &lt;span class="o"&gt;%&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;
    &lt;span class="p"&gt;});&lt;/span&gt;
&lt;span class="p"&gt;});&lt;/span&gt;
&lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;script&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
{% endif %}
&lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;body&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;А так же стоит упомянуть конфиг:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="c1"&gt;# Bootstrap magnific lightbox options&lt;/span&gt;
&lt;span class="n"&gt;MAGNIFIC_POPUP_OPTIONS&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;&amp;#39;&amp;#39;&lt;/span&gt;
&lt;span class="s1"&gt;closeOnContentClick: true,&lt;/span&gt;
&lt;span class="s1"&gt;callbacks: {&lt;/span&gt;
&lt;span class="s1"&gt;    elementParse: function(item){&lt;/span&gt;
&lt;span class="s1"&gt;        item.src = item.el.attr(&amp;#39;src&amp;#39;);  // read src from img tag&lt;/span&gt;
&lt;span class="s1"&gt;    },&lt;/span&gt;
&lt;span class="s1"&gt;},&lt;/span&gt;
&lt;span class="s1"&gt;gallery: {&lt;/span&gt;
&lt;span class="s1"&gt;    enabled: true&lt;/span&gt;
&lt;span class="s1"&gt;}&lt;/span&gt;
&lt;span class="s1"&gt;&amp;#39;&amp;#39;&amp;#39;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Эта строка &lt;code&gt;item.src = item.el.attr('src');&lt;/code&gt; помогает извлечь из тега &lt;code&gt;img&lt;/code&gt; путь до картинки, изначально скрипт умеет извлекать только из  аттрибута &lt;code&gt;href&lt;/code&gt; тега &lt;code&gt;a&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;При написании текстов картинки вставляется так:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;![&lt;span class="nt"&gt;image alt text&lt;/span&gt;](&lt;span class="na"&gt;{attach}folder/image.jpg &amp;quot;image title text&amp;quot;&lt;/span&gt;){: class=&amp;quot;mfp-image center-block&amp;quot;}
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Где:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;mfp-image&lt;/code&gt; - таким образом указывается тип встраиваемый в lightbox&lt;/li&gt;
&lt;li&gt;&lt;code&gt;center-block&lt;/code&gt; - это стандартный &lt;code&gt;bootstrap3&lt;/code&gt; клас для центрирования блока по центру страницы&lt;/li&gt;
&lt;li&gt;&lt;code&gt;{attach}&lt;/code&gt; - относительный путь от текущего документа&lt;/li&gt;
&lt;li&gt;&lt;code&gt;{attach}/&lt;/code&gt; - путь от корня сайта&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Вместо &lt;code&gt;{attach}&lt;/code&gt; можно использовать &lt;code&gt;{filename}&lt;/code&gt;, разница в том, что &lt;code&gt;{attach}&lt;/code&gt; копирует "вложения" вместе со страницей, а &lt;code&gt;{filename}&lt;/code&gt; не копирует, а лишь ссылается более, подробно читайте в документации pelican.&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;Ссылки по теме:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href="https://letchap.github.io/2013/12/11/realiser-une-galerie-dimages-avec-pelican-et-bootstrap/"&gt;Réaliser une galerie d'images avec Pelican et Bootstrap&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://kura.io/lightbox/"&gt;Lightbox — A pure CSS lightbox for Pelican&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/dimsemenov/Magnific-Popup/"&gt;Magnific-Popup&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://dimsemenov.com/plugins/magnific-popup/documentation.html"&gt;Magnific Popup Documentation&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://docs.getpelican.com/en/latest/content.html#articles-and-pages"&gt;Attaching static files&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;</content><category term="Blog"></category><category term="lightbox"></category><category term="markdown"></category><category term="pelican"></category></entry><entry><title>Screen cheatsheet</title><link href="https://metajiji.github.io/blog/screen-cheatsheet/" rel="alternate"></link><published>2016-10-16T00:00:00+07:00</published><updated>2016-10-16T00:00:00+07:00</updated><author><name>Denis Kadyshev</name></author><id>tag:metajiji.github.io,2016-10-16:/blog/screen-cheatsheet/</id><summary type="html">&lt;p&gt;&lt;code&gt;~/.screenrc&lt;/code&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;startup_message off
hardstatus alwayslastline
hardstatus alwayslastline &amp;#39;%{gk}[ %{G}%H %{g}]%{wk}%?%-Lw%?%{=b kR}(%{W}%n*%f %t%?(%u)%?%{=b kR})%{= kw}%?%+Lw%?%?%= %{W}[%1]&amp;#39;
vbell_msg &amp;quot; *beep* &amp;quot;

# Bind Shift+Arrow Left/Right for switch via screen-tab&amp;#39;s
bindkey ^[[1;2C next
bindkey ^[[1;2D prev
&lt;/pre&gt;&lt;/div&gt;


&lt;hr&gt;
&lt;p&gt;Ссылки по теме:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href="https://habrahabr.ru/company/mailru/blog/206814/"&gt;VIM …&lt;/a&gt;&lt;/li&gt;&lt;/ol&gt;</summary><content type="html">&lt;p&gt;&lt;code&gt;~/.screenrc&lt;/code&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;startup_message off
hardstatus alwayslastline
hardstatus alwayslastline &amp;#39;%{gk}[ %{G}%H %{g}]%{wk}%?%-Lw%?%{=b kR}(%{W}%n*%f %t%?(%u)%?%{=b kR})%{= kw}%?%+Lw%?%?%= %{W}[%1]&amp;#39;
vbell_msg &amp;quot; *beep* &amp;quot;

# Bind Shift+Arrow Left/Right for switch via screen-tab&amp;#39;s
bindkey ^[[1;2C next
bindkey ^[[1;2D prev
&lt;/pre&gt;&lt;/div&gt;


&lt;hr&gt;
&lt;p&gt;Ссылки по теме:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href="https://habrahabr.ru/company/mailru/blog/206814/"&gt;VIM + screen. Организация удаленной среды web-разработки&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;</content><category term="Linux"></category><category term="screen"></category><category term="cheatsheet"></category></entry><entry><title>Смена движка и хостинга</title><link href="https://metajiji.github.io/blog/blog-moved/" rel="alternate"></link><published>2016-10-09T00:00:00+07:00</published><updated>2016-10-09T00:00:00+07:00</updated><author><name>Denis Kadyshev</name></author><id>tag:metajiji.github.io,2016-10-09:/blog/blog-moved/</id><summary type="html">&lt;p&gt;Перенес блог на статический генератор сайтов &lt;code&gt;pelican&lt;/code&gt;, а в качестве хостинга решил использовать &lt;strong&gt;github pages&lt;/strong&gt;.&lt;/p&gt;</summary><content type="html">&lt;p&gt;Перенес блог на статический генератор сайтов &lt;code&gt;pelican&lt;/code&gt;, а в качестве хостинга решил использовать &lt;strong&gt;github pages&lt;/strong&gt;.&lt;/p&gt;</content><category term="blog"></category></entry><entry><title>zabbix in linux</title><link href="https://metajiji.github.io/blog/zabbix-in-linux/" rel="alternate"></link><published>2016-05-03T00:00:00+06:00</published><updated>2016-05-03T00:00:00+06:00</updated><author><name>Denis Kadyshev</name></author><id>tag:metajiji.github.io,2016-05-03:/blog/zabbix-in-linux/</id><summary type="html">&lt;h3&gt;Problem:&lt;/h3&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;root@host# &lt;span class="nv"&gt;LC_ALL&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;C su -m zabbix -c &lt;span class="s2"&gt;&amp;quot;ping ya.ru&amp;quot;&lt;/span&gt;
ping: icmp open socket: Operation not permitted
&lt;/pre&gt;&lt;/div&gt;


&lt;h5&gt;Solution:&lt;/h5&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;sudo chmod u+s &lt;span class="sb"&gt;`&lt;/span&gt;which ping&lt;span class="sb"&gt;`&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;hr&gt;
&lt;h3&gt;Problem:&lt;/h3&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;sudo: sorry, you must have a tty to run sudo
&lt;/pre&gt;&lt;/div&gt;


&lt;h5&gt;Solution:&lt;/h5&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;Defaults:zabbix !requiretty&amp;#39;&lt;/span&gt; &lt;span class="p"&gt;|&lt;/span&gt; sudo tee -a /etc/sudoers.d/zabbix
&lt;/pre&gt;&lt;/div&gt;


&lt;hr&gt;
&lt;h3&gt;Problem …&lt;/h3&gt;</summary><content type="html">&lt;h3&gt;Problem:&lt;/h3&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;root@host# &lt;span class="nv"&gt;LC_ALL&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;C su -m zabbix -c &lt;span class="s2"&gt;&amp;quot;ping ya.ru&amp;quot;&lt;/span&gt;
ping: icmp open socket: Operation not permitted
&lt;/pre&gt;&lt;/div&gt;


&lt;h5&gt;Solution:&lt;/h5&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;sudo chmod u+s &lt;span class="sb"&gt;`&lt;/span&gt;which ping&lt;span class="sb"&gt;`&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;hr&gt;
&lt;h3&gt;Problem:&lt;/h3&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;sudo: sorry, you must have a tty to run sudo
&lt;/pre&gt;&lt;/div&gt;


&lt;h5&gt;Solution:&lt;/h5&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;Defaults:zabbix !requiretty&amp;#39;&lt;/span&gt; &lt;span class="p"&gt;|&lt;/span&gt; sudo tee -a /etc/sudoers.d/zabbix
&lt;/pre&gt;&lt;/div&gt;


&lt;hr&gt;
&lt;h3&gt;Problem:&lt;/h3&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;sudo: no tty present and no askpass program specified
&lt;/pre&gt;&lt;/div&gt;


&lt;h5&gt;Solution:&lt;/h5&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;zabbix ALL=NOPASSWD:/usr/bin/nmap *&amp;#39;&lt;/span&gt; &lt;span class="p"&gt;|&lt;/span&gt; sudo tee -a /etc/sudoers.d/zabbix
&lt;/pre&gt;&lt;/div&gt;</content><category term="Zabbix"></category><category term="Linux"></category><category term="problems"></category><category term="fix"></category></entry><entry><title>Centos 7 broken nfsdcltrack: sqlite_insert_client</title><link href="https://metajiji.github.io/blog/centos-7-broken-nfsdcltrack/" rel="alternate"></link><published>2016-04-27T00:00:00+06:00</published><updated>2016-04-27T00:00:00+06:00</updated><author><name>Denis Kadyshev</name></author><id>tag:metajiji.github.io,2016-04-27:/blog/centos-7-broken-nfsdcltrack/</id><summary type="html">&lt;p&gt;После установки и настройки &lt;code&gt;nfs&lt;/code&gt; сервера под &lt;strong&gt;Centos 7&lt;/strong&gt; в логах были обнаружены ошибки:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;nfsdcltrack[3706]: sqlite_insert_client: insert statement prepare failed: table clients has 2 columns but 3 values were supplied
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Быстрый поиск привел в багзиллу, где нашлось решение, проблема была в структуре базы, для начала нужно открыть базу:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;sqlite3 …&lt;/pre&gt;&lt;/div&gt;</summary><content type="html">&lt;p&gt;После установки и настройки &lt;code&gt;nfs&lt;/code&gt; сервера под &lt;strong&gt;Centos 7&lt;/strong&gt; в логах были обнаружены ошибки:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;nfsdcltrack[3706]: sqlite_insert_client: insert statement prepare failed: table clients has 2 columns but 3 values were supplied
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Быстрый поиск привел в багзиллу, где нашлось решение, проблема была в структуре базы, для начала нужно открыть базу:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;sqlite3 /var/lib/nfs/nfsdcltrack/main.sqlite
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Затем выполнить запрос:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;alter&lt;/span&gt; &lt;span class="k"&gt;table&lt;/span&gt; &lt;span class="n"&gt;clients&lt;/span&gt; &lt;span class="k"&gt;add&lt;/span&gt; &lt;span class="k"&gt;column&lt;/span&gt; &lt;span class="n"&gt;has_session&lt;/span&gt; &lt;span class="nb"&gt;INTEGER&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;exit&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;После чего необходимо перезапустить &lt;code&gt;nfs&lt;/code&gt; сервер:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;systemctl restart nfs
&lt;/pre&gt;&lt;/div&gt;


&lt;hr&gt;
&lt;p&gt;Ссылки по теме:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href="https://bugzilla.redhat.com/show_bug.cgi?id=1285097"&gt;Bug 1285097 - nfs-utils package broke nfsdcltrack&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;</content><category term="Linux"></category><category term="CentOS"></category><category term="CentOS 7"></category><category term="nfsdcltrack"></category></entry><entry><title>Centos 6 install python 2.7</title><link href="https://metajiji.github.io/blog/centos-6-install-python-27/" rel="alternate"></link><published>2016-03-24T00:00:00+06:00</published><updated>2016-03-24T00:00:00+06:00</updated><author><name>Denis Kadyshev</name></author><id>tag:metajiji.github.io,2016-03-24:/blog/centos-6-install-python-27/</id><summary type="html">&lt;p&gt;&lt;strong&gt; Centos 6&lt;/strong&gt; install &lt;code&gt;python2.7&lt;/code&gt;&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;yum install centos-release-SCL
yum install python27 python27-python-virtualenv
&lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;/opt/rh/python27/root/usr/lib64&amp;#39;&lt;/span&gt; &amp;gt; /etc/ld.so.conf.d/python27.conf &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt; ldconfig
virtualenv --prompt&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;(proj_name)&amp;quot;&lt;/span&gt; -p /opt/rh/python27/root/usr/lib/python2.7 .env
&lt;/pre&gt;&lt;/div&gt;


&lt;h1&gt;А вот так лучше &lt;code&gt;не стоит делать&lt;/code&gt;:&lt;/h1&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;yum install -y …&lt;/pre&gt;&lt;/div&gt;</summary><content type="html">&lt;p&gt;&lt;strong&gt; Centos 6&lt;/strong&gt; install &lt;code&gt;python2.7&lt;/code&gt;&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;yum install centos-release-SCL
yum install python27 python27-python-virtualenv
&lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;/opt/rh/python27/root/usr/lib64&amp;#39;&lt;/span&gt; &amp;gt; /etc/ld.so.conf.d/python27.conf &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt; ldconfig
virtualenv --prompt&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;(proj_name)&amp;quot;&lt;/span&gt; -p /opt/rh/python27/root/usr/lib/python2.7 .env
&lt;/pre&gt;&lt;/div&gt;


&lt;h1&gt;А вот так лучше &lt;code&gt;не стоит делать&lt;/code&gt;:&lt;/h1&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;yum install -y rubygems ruby-devel tar
gem install fpm
curl https://www.python.org/ftp/python/2.7.11/Python-2.7.11.tgz &amp;gt; Python-2.7.11.tgz
tar -xvf Python-2.7.11.tgz
&lt;span class="nb"&gt;cd&lt;/span&gt; Python-2.7.11
yum -y install openssl-devel readline-devel bzip2-devel sqlite-devel zlib-devel ncurses-devel db4-devel expat-devel
./configure --prefix&lt;span class="o"&gt;=&lt;/span&gt;/usr/local --enable-unicode&lt;span class="o"&gt;=&lt;/span&gt;ucs4 --enable-shared --enable-ipv6
make -j&lt;span class="k"&gt;$(&lt;/span&gt;nproc&lt;span class="k"&gt;)&lt;/span&gt;
&lt;span class="nb"&gt;test&lt;/span&gt; -d /tmp/python-2.7 &lt;span class="o"&gt;||&lt;/span&gt; mkdir /tmp/python-2.7
make install &lt;span class="nv"&gt;DESTDIR&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;/tmp/python-2.7
&lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;/sbin/ldconfig&amp;#39;&lt;/span&gt; &amp;gt; /tmp/python-2.7/run-ldconfig.sh
&lt;span class="nb"&gt;test&lt;/span&gt; -d /tmp/python-2.7/etc/ld.so.conf.d &lt;span class="o"&gt;||&lt;/span&gt; mkdir /tmp/python-2.7/etc/ld.so.conf.d
&lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;/usr/local/lib&amp;#39;&lt;/span&gt; &amp;gt; /tmp/python-2.7/etc/ld.so.conf.d/python27.conf

fpm -s dir -t rpm -n python27 -v &lt;span class="m"&gt;2&lt;/span&gt;.7.11_1 -C /tmp/python-2.7 &lt;span class="se"&gt;\&lt;/span&gt;
  --after-install /tmp/python-2.7/run-ldconfig.sh &lt;span class="se"&gt;\&lt;/span&gt;
  -d &lt;span class="s1"&gt;&amp;#39;openssl&amp;#39;&lt;/span&gt; &lt;span class="se"&gt;\&lt;/span&gt;
  -d &lt;span class="s1"&gt;&amp;#39;bzip2&amp;#39;&lt;/span&gt; &lt;span class="se"&gt;\&lt;/span&gt;
  -d &lt;span class="s1"&gt;&amp;#39;zlib&amp;#39;&lt;/span&gt; &lt;span class="se"&gt;\&lt;/span&gt;
  -d &lt;span class="s1"&gt;&amp;#39;expat&amp;#39;&lt;/span&gt; &lt;span class="se"&gt;\&lt;/span&gt;
  -d &lt;span class="s1"&gt;&amp;#39;db4&amp;#39;&lt;/span&gt; &lt;span class="se"&gt;\&lt;/span&gt;
  -d &lt;span class="s1"&gt;&amp;#39;sqlite&amp;#39;&lt;/span&gt; &lt;span class="se"&gt;\&lt;/span&gt;
  -d &lt;span class="s1"&gt;&amp;#39;ncurses&amp;#39;&lt;/span&gt; &lt;span class="se"&gt;\&lt;/span&gt;
  -d &lt;span class="s1"&gt;&amp;#39;readline&amp;#39;&lt;/span&gt; &lt;span class="se"&gt;\&lt;/span&gt;
  --directories&lt;span class="o"&gt;=&lt;/span&gt;/usr/local/lib/python2.7/ &lt;span class="se"&gt;\&lt;/span&gt;
  --directories&lt;span class="o"&gt;=&lt;/span&gt;/usr/local/include/python2.7/ &lt;span class="se"&gt;\&lt;/span&gt;
  usr/local etc
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;&lt;code&gt;rpm&lt;/code&gt; конечно же соберется и даже все будет правильно и лучше, чем просто злобный &lt;code&gt;make install&lt;/code&gt;, но &lt;code&gt;python27&lt;/code&gt; есть в официальных репозиториях и лучше ставить оттуда,
 это избавит от необходимости собирать другие пакеты, например &lt;code&gt;python-virtualenv&lt;/code&gt;, &lt;code&gt;python-pip&lt;/code&gt; и другие.&lt;/p&gt;</content><category term="CentOS"></category><category term="Linux"></category><category term="Python 2.7"></category></entry><entry><title>Zimbra: Prevent send *SPAM* emails from self domain to self domain</title><link href="https://metajiji.github.io/blog/zimbra-reject-self-domain/" rel="alternate"></link><published>2016-02-11T00:00:00+06:00</published><updated>2016-02-11T00:00:00+06:00</updated><author><name>Denis Kadyshev</name></author><id>tag:metajiji.github.io,2016-02-11:/blog/zimbra-reject-self-domain/</id><summary type="html">&lt;p&gt;Prevent send &lt;em&gt;SPAM&lt;/em&gt; emails from self domain to self domain:&lt;/p&gt;
&lt;p&gt;Modify file &lt;code&gt;/opt/zimbra/conf/zmconfigd/smtpd_sender_restrictions.cf&lt;/code&gt;:&lt;/p&gt;
&lt;p&gt;Add string: &lt;code&gt;%%contains VAR:zimbraMtaSmtpdSenderRestrictions check_sender_access lmdb:/opt/zimbra/conf/postfix_sender_access%%&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;Result full content file:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="c"&gt;%%exact VAR:zimbraMtaSmtpdSenderRestrictions reject_authenticated_sender_login_mismatch%%&lt;/span&gt;
&lt;span class="c"&gt;%%contains VAR:zimbraMtaSmtpdSenderRestrictions check_sender_access lmdb:/opt/zimbra/conf/postfix_reject_sender%%&lt;/span&gt;
&lt;span class="c"&gt;%%contains VAR:zimbraServiceEnabled cbpolicyd …&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;</summary><content type="html">&lt;p&gt;Prevent send &lt;em&gt;SPAM&lt;/em&gt; emails from self domain to self domain:&lt;/p&gt;
&lt;p&gt;Modify file &lt;code&gt;/opt/zimbra/conf/zmconfigd/smtpd_sender_restrictions.cf&lt;/code&gt;:&lt;/p&gt;
&lt;p&gt;Add string: &lt;code&gt;%%contains VAR:zimbraMtaSmtpdSenderRestrictions check_sender_access lmdb:/opt/zimbra/conf/postfix_sender_access%%&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;Result full content file:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="c"&gt;%%exact VAR:zimbraMtaSmtpdSenderRestrictions reject_authenticated_sender_login_mismatch%%&lt;/span&gt;
&lt;span class="c"&gt;%%contains VAR:zimbraMtaSmtpdSenderRestrictions check_sender_access lmdb:/opt/zimbra/conf/postfix_reject_sender%%&lt;/span&gt;
&lt;span class="c"&gt;%%contains VAR:zimbraServiceEnabled cbpolicyd^ check_policy_service inet:localhost:%%zimbraCBPolicydBindPort%%%%&lt;/span&gt;
&lt;span class="c"&gt;%%contains VAR:zimbraServiceEnabled amavis^ check_sender_access regexp:/opt/zimbra/common/conf/tag_as_originating.re%%&lt;/span&gt;
&lt;span class="n"&gt;permit_mynetworks&lt;/span&gt;
&lt;span class="n"&gt;permit_sasl_authenticated&lt;/span&gt;
&lt;span class="n"&gt;permit_tls_clientcerts&lt;/span&gt;
&lt;span class="c"&gt;%%contains VAR:zimbraMtaSmtpdSenderRestrictions check_sender_access lmdb:/opt/zimbra/conf/postfix_sender_access%%&lt;/span&gt;
&lt;span class="c"&gt;%%contains VAR:zimbraServiceEnabled amavis^ check_sender_access regexp:/opt/zimbra/common/conf/tag_as_foreign.re%%&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Create file  &lt;code&gt;/opt/zimbra/conf/postfix_sender_access&lt;/code&gt; with content:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;domain1.ltd REJECT  Not authorized
domain2.ltd REJECT  Not authorized
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Enable modifications:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;su - zimbra
zmprov mcf zimbraMtaSmtpdSenderRestrictions &lt;span class="s1"&gt;&amp;#39;check_sender_access lmdb:/opt/zimbra/conf/postfix_sender_access&amp;#39;&lt;/span&gt;
postmap /opt/zimbra/conf/postfix_sender_access
zmmtactl reload
&lt;/pre&gt;&lt;/div&gt;


&lt;hr&gt;
&lt;h1&gt;LINKS&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;http://ossportal.org/forum/zimbra/1114&lt;/li&gt;
&lt;/ul&gt;</content><category term="Zimbra"></category><category term="self domain"></category><category term="spam"></category></entry><entry><title>PostgreSQL &amp; MySQL создать базу и пользователя</title><link href="https://metajiji.github.io/blog/postgresql-mysql-create-database-and-user/" rel="alternate"></link><published>2016-01-15T00:00:00+06:00</published><updated>2016-01-15T00:00:00+06:00</updated><author><name>Denis Kadyshev</name></author><id>tag:metajiji.github.io,2016-01-15:/blog/postgresql-mysql-create-database-and-user/</id><summary type="html">&lt;h1&gt;PostgreSQL&lt;/h1&gt;
&lt;p&gt;Создать базу и пользователя в &lt;strong&gt;PostgreSQL&lt;/strong&gt;, а так же установить пароль для этого пользователя:&lt;/p&gt;
&lt;p&gt;Запускаем &lt;strong&gt;PostgreSQL&lt;/strong&gt; клиент &lt;code&gt;psql&lt;/code&gt; от пользователя &lt;code&gt;postgres&lt;/code&gt;, используя &lt;code&gt;sudo&lt;/code&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;sudo -u postgres psql
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Либо через &lt;code&gt;su&lt;/code&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;su - postgres -c psql
&lt;/pre&gt;&lt;/div&gt;


&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;CREATE&lt;/span&gt; &lt;span class="k"&gt;USER&lt;/span&gt; &lt;span class="n"&gt;someuser&lt;/span&gt; &lt;span class="k"&gt;WITH&lt;/span&gt; &lt;span class="n"&gt;PASSWORD&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;somepassword&amp;#39;&lt;/span&gt; &lt;span class="k"&gt;CREATEDB&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="k"&gt;CREATE&lt;/span&gt; &lt;span class="k"&gt;DATABASE&lt;/span&gt; &lt;span class="n"&gt;somedb&lt;/span&gt; &lt;span class="k"&gt;WITH&lt;/span&gt; &lt;span class="k"&gt;encoding&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;UNICODE&amp;#39;&lt;/span&gt; &lt;span class="k"&gt;OWNER&lt;/span&gt; &lt;span class="n"&gt;someuser …&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;</summary><content type="html">&lt;h1&gt;PostgreSQL&lt;/h1&gt;
&lt;p&gt;Создать базу и пользователя в &lt;strong&gt;PostgreSQL&lt;/strong&gt;, а так же установить пароль для этого пользователя:&lt;/p&gt;
&lt;p&gt;Запускаем &lt;strong&gt;PostgreSQL&lt;/strong&gt; клиент &lt;code&gt;psql&lt;/code&gt; от пользователя &lt;code&gt;postgres&lt;/code&gt;, используя &lt;code&gt;sudo&lt;/code&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;sudo -u postgres psql
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Либо через &lt;code&gt;su&lt;/code&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;su - postgres -c psql
&lt;/pre&gt;&lt;/div&gt;


&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;CREATE&lt;/span&gt; &lt;span class="k"&gt;USER&lt;/span&gt; &lt;span class="n"&gt;someuser&lt;/span&gt; &lt;span class="k"&gt;WITH&lt;/span&gt; &lt;span class="n"&gt;PASSWORD&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;somepassword&amp;#39;&lt;/span&gt; &lt;span class="k"&gt;CREATEDB&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="k"&gt;CREATE&lt;/span&gt; &lt;span class="k"&gt;DATABASE&lt;/span&gt; &lt;span class="n"&gt;somedb&lt;/span&gt; &lt;span class="k"&gt;WITH&lt;/span&gt; &lt;span class="k"&gt;encoding&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;UNICODE&amp;#39;&lt;/span&gt; &lt;span class="k"&gt;OWNER&lt;/span&gt; &lt;span class="n"&gt;someuser&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="k"&gt;GRANT&lt;/span&gt; &lt;span class="k"&gt;ALL&lt;/span&gt; &lt;span class="k"&gt;PRIVILEGES&lt;/span&gt; &lt;span class="k"&gt;ON&lt;/span&gt; &lt;span class="k"&gt;DATABASE&lt;/span&gt; &lt;span class="n"&gt;somedb&lt;/span&gt; &lt;span class="k"&gt;TO&lt;/span&gt; &lt;span class="n"&gt;someuser&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Сменить пароль уже существующему пользователю:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;ALTER&lt;/span&gt; &lt;span class="k"&gt;USER&lt;/span&gt; &lt;span class="n"&gt;someuser&lt;/span&gt; &lt;span class="n"&gt;PASSWORD&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;superpassword&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h1&gt;MySQL&lt;/h1&gt;
&lt;p&gt;Создать базу и пользователя в &lt;strong&gt;MySQL&lt;/strong&gt;, а так же установить пароль для этого пользователя:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;CREATE&lt;/span&gt; &lt;span class="k"&gt;USER&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;someuser&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;@&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;127.0.%.%&amp;#39;&lt;/span&gt; &lt;span class="n"&gt;IDENTIFIED&lt;/span&gt; &lt;span class="k"&gt;BY&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;somepasswd&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="k"&gt;CREATE&lt;/span&gt; &lt;span class="k"&gt;DATABASE&lt;/span&gt; &lt;span class="o"&gt;`&lt;/span&gt;&lt;span class="n"&gt;somedb&lt;/span&gt;&lt;span class="o"&gt;`&lt;/span&gt; &lt;span class="nb"&gt;CHARACTER&lt;/span&gt; &lt;span class="k"&gt;SET&lt;/span&gt; &lt;span class="n"&gt;utf8&lt;/span&gt; &lt;span class="k"&gt;COLLATE&lt;/span&gt; &lt;span class="n"&gt;utf8_general_ci&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="k"&gt;GRANT&lt;/span&gt; &lt;span class="k"&gt;ALL&lt;/span&gt; &lt;span class="k"&gt;PRIVILEGES&lt;/span&gt; &lt;span class="k"&gt;ON&lt;/span&gt; &lt;span class="o"&gt;`&lt;/span&gt;&lt;span class="n"&gt;somedb&lt;/span&gt;&lt;span class="o"&gt;`&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="k"&gt;TO&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;someuser&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;@&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;10.135.%.%&amp;#39;&lt;/span&gt; &lt;span class="k"&gt;WITH&lt;/span&gt; &lt;span class="k"&gt;GRANT&lt;/span&gt; &lt;span class="k"&gt;OPTION&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="n"&gt;FLUSH&lt;/span&gt; &lt;span class="k"&gt;PRIVILEGES&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;</content><category term="PostgreSQL"></category><category term="MySQL"></category><category term="create database"></category><category term="create user"></category></entry><entry><title>Ubuntu add-architecture i386 ia32-libs</title><link href="https://metajiji.github.io/blog/ubuntu-add-architecture-i386-ia32-libs/" rel="alternate"></link><published>2015-12-30T00:00:00+06:00</published><updated>2015-12-30T00:00:00+06:00</updated><author><name>Denis Kadyshev</name></author><id>tag:metajiji.github.io,2015-12-30:/blog/ubuntu-add-architecture-i386-ia32-libs/</id><summary type="html">&lt;p&gt;В частности при попытке выполнить в командной строке файл, предназначенный для &lt;code&gt;32-х&lt;/code&gt; битной системы, может возникать ошибка вида:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;./somefile: Нет такого файла или каталога &lt;span class="o"&gt;(&lt;/span&gt;No such file or directory&lt;span class="o"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Чтобы &lt;code&gt;32-х&lt;/code&gt; битные приложения могли запускаться в &lt;code&gt;64-х&lt;/code&gt; битной системе &lt;strong&gt;Linux&lt;/strong&gt; нужно установить соответствующие библиотеки, например для &lt;strong&gt;Ubuntu 14.04&lt;/strong&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;sudo …&lt;/pre&gt;&lt;/div&gt;</summary><content type="html">&lt;p&gt;В частности при попытке выполнить в командной строке файл, предназначенный для &lt;code&gt;32-х&lt;/code&gt; битной системы, может возникать ошибка вида:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;./somefile: Нет такого файла или каталога &lt;span class="o"&gt;(&lt;/span&gt;No such file or directory&lt;span class="o"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Чтобы &lt;code&gt;32-х&lt;/code&gt; битные приложения могли запускаться в &lt;code&gt;64-х&lt;/code&gt; битной системе &lt;strong&gt;Linux&lt;/strong&gt; нужно установить соответствующие библиотеки, например для &lt;strong&gt;Ubuntu 14.04&lt;/strong&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;sudo dpkg --add-architecture i386
sudo apt-get update
sudo apt-get install lib32z1 lib32ncurses5 lib32bz2-1.0
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Удаление в обратном порядке:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;sudo dpkg --remove-architecture i386
sudo apt-get update
sudo apt-get purge lib32z1 lib32ncurses5 lib32bz2-1.0
&lt;/pre&gt;&lt;/div&gt;


&lt;hr&gt;
&lt;p&gt;Ссылки по теме:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href="http://askubuntu.com/questions/107230/what-happened-to-the-ia32-libs-package"&gt;Multiarch: What happened to the ia32-libs package?&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;</content><category term="Ubuntu"></category><category term="Linux"></category><category term="dpkg"></category><category term="architecture"></category><category term="add-architecture"></category><category term="i386"></category><category term="ia32-libs"></category></entry><entry><title>Ubuntu prevent open thunderbird mailto links, xdg-open, xdg-mime, xdg-mail</title><link href="https://metajiji.github.io/blog/ubuntu-prevent-open-thunderbird-mailto-links/" rel="alternate"></link><published>2015-12-18T00:00:00+06:00</published><updated>2015-12-18T00:00:00+06:00</updated><author><name>Denis Kadyshev</name></author><id>tag:metajiji.github.io,2015-12-18:/blog/ubuntu-prevent-open-thunderbird-mailto-links/</id><summary type="html">&lt;p&gt;Люблю выделять/копировать пароли/строки текста тройным ли двойным кликом мышки, но есть проблема со словами в которых есть символ &lt;code&gt;@&lt;/code&gt;,
 &lt;strong&gt;Ubuntu&lt;/strong&gt; распознает это как &lt;code&gt;email&lt;/code&gt; адрес и запускает &lt;strong&gt;Thunderbird&lt;/strong&gt;, что не желательно, недолго &lt;s&gt;погуглив рамблером в яндексе&lt;/s&gt; нашел такой хак:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;sudo sed -i &lt;span class="s1"&gt;&amp;#39;2 i exit 0&amp;#39;&lt;/span&gt; /usr/bin/xdg-email …&lt;/pre&gt;&lt;/div&gt;</summary><content type="html">&lt;p&gt;Люблю выделять/копировать пароли/строки текста тройным ли двойным кликом мышки, но есть проблема со словами в которых есть символ &lt;code&gt;@&lt;/code&gt;,
 &lt;strong&gt;Ubuntu&lt;/strong&gt; распознает это как &lt;code&gt;email&lt;/code&gt; адрес и запускает &lt;strong&gt;Thunderbird&lt;/strong&gt;, что не желательно, недолго &lt;s&gt;погуглив рамблером в яндексе&lt;/s&gt; нашел такой хак:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;sudo sed -i &lt;span class="s1"&gt;&amp;#39;2 i exit 0&amp;#39;&lt;/span&gt; /usr/bin/xdg-email
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Как легально отключить это поведение, через пользовательские настройки пока не нашел и остановился на этом варианте.&lt;/p&gt;</content><category term="Linux"></category><category term="Ubuntu"></category><category term="xdg-open"></category><category term="xdg-mime"></category><category term="xdg-mail"></category><category term="mail to links"></category><category term="thunderbird"></category></entry><entry><title>Centos7 LXC</title><link href="https://metajiji.github.io/blog/centos7-lxc/" rel="alternate"></link><published>2015-10-10T00:00:00+06:00</published><updated>2016-10-14T00:00:00+07:00</updated><author><name>Denis Kadyshev</name></author><id>tag:metajiji.github.io,2015-10-10:/blog/centos7-lxc/</id><summary type="html">&lt;p&gt;Сборка из исходных кодов стабильной версии &lt;code&gt;lxc&lt;/code&gt; для &lt;strong&gt;Centos 7&lt;/strong&gt; с поддержкой &lt;code&gt;python&lt;/code&gt;.
Поддержка &lt;code&gt;python&lt;/code&gt; необходима, например для работы команды &lt;code&gt;lxc-ls --fancy&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;Установка зависимостей:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;yum install -y epel-release
yum install -y gcc git rpm-build automake make python34 python34-devel
yum install -y libcap-devel docbook2X graphviz
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Согласно официальному сайту на момент написания …&lt;/p&gt;</summary><content type="html">&lt;p&gt;Сборка из исходных кодов стабильной версии &lt;code&gt;lxc&lt;/code&gt; для &lt;strong&gt;Centos 7&lt;/strong&gt; с поддержкой &lt;code&gt;python&lt;/code&gt;.
Поддержка &lt;code&gt;python&lt;/code&gt; необходима, например для работы команды &lt;code&gt;lxc-ls --fancy&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;Установка зависимостей:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;yum install -y epel-release
yum install -y gcc git rpm-build automake make python34 python34-devel
yum install -y libcap-devel docbook2X graphviz
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Согласно официальному сайту на момент написания статьи доступно 3 версии &lt;strong&gt;LXC&lt;/strong&gt;, я выбрал &lt;code&gt;LTS stable-1.0&lt;/code&gt;
Скачивание исходных кодов:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;git clone git://github.com/lxc/lxc -b stable-1.0
&lt;span class="nb"&gt;cd&lt;/span&gt; lxc
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Почитав немного доку и исходники, получился такой порядок действий:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;./autogen.sh
./configure --enable-python &lt;span class="nv"&gt;PYTHON&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;/usr/bin/python3.4 &lt;span class="nv"&gt;PYTHONDEV_CFLAGS&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;-I/usr/include/python-3.4m &lt;span class="nv"&gt;PYTHONDEV_LIBS&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;-l/usr/include/python-3.4m
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Как можно заметить, конфигурация происходит с явным указанием версии &lt;code&gt;python3.4&lt;/code&gt;, он появился сравнительно недавно в &lt;strong&gt;EPEL&lt;/strong&gt;, его и будем использовать далее.&lt;/p&gt;
&lt;p&gt;Т.к. у нас &lt;strong&gt;Centos&lt;/strong&gt; и тут не все &lt;s&gt;как у людей&lt;/s&gt; как в других дистрибутивах, изменим в исходниках путь до исполняемого файла &lt;strong&gt;Python&lt;/strong&gt;, но сперва найдем файлы, которые нужно модифицировать:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;grep -Rn &lt;span class="s1"&gt;&amp;#39;^#.*/python3&amp;#39;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;В результате у меня получился такой небольшой скрипт:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;for&lt;/span&gt; f in config/apparmor/lxc-generate-aa-rules.py src/lxc/lxc-device src/lxc/lxc-ls.in src/lxc/lxc-start-ephemeral.in src/lxc/lxc-ls src/lxc/lxc-start-ephemeral src/python-lxc/examples/api_test.py src/python-lxc/examples/pyconsole-vte.py src/python-lxc/examples/pyconsole.py src/python-lxc/setup.py src/python-lxc/setup.py.in&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;
    sed -i &lt;span class="s1"&gt;&amp;#39;s|#!/usr/bin/python3|#!/usr/bin/python3.4|&amp;#39;&lt;/span&gt; &lt;span class="nv"&gt;$f&lt;/span&gt;
&lt;span class="k"&gt;done&lt;/span&gt;

sed -i &lt;span class="s1"&gt;&amp;#39;s|Requires: python3|Requires: python34|&amp;#39;&lt;/span&gt; lxc.spec
sed -i &lt;span class="s1"&gt;&amp;#39;s|BuildRequires: python3-devel|BuildRequires: python34-devel|&amp;#39;&lt;/span&gt; lxc.spec
sed -i &lt;span class="s1"&gt;&amp;#39;s|/python3.3/site-packages/|/python3.4/site-packages/|&amp;#39;&lt;/span&gt; lxc.spec
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;После изменений проверим результат:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;grep -Rn &lt;span class="s1"&gt;&amp;#39;^#.*/python3&amp;#39;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Теперь соберем &lt;code&gt;rpm&lt;/code&gt; пакеты используя &lt;strong&gt;Python3.4&lt;/strong&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;make rpm &lt;span class="nv"&gt;PYTHON&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;/usr/bin/python3.4 &lt;span class="nv"&gt;PYTHONDEV_CFLAGS&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;-I/usr/include/python-3.4m &lt;span class="nv"&gt;PYTHONDEV_LIBS&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;-l/usr/include/python-3.4m
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Найти собранные пакеты можно в каталоге &lt;code&gt;cd /root/rpmbuild/RPMS/x86_64&lt;/code&gt;, а установить командой:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;yum localinstall lxc-libs-1.0.7-1.el7.centos.x86_64.rpm lxc-1.0.7-1.el7.centos.x86_64.rpm
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Не будем останавливаться на этом!
Для запуска &lt;strong&gt;Centos 7&lt;/strong&gt; контейнера необходимо проделать еще несколько манипуляций:
В файле &lt;code&gt;/usr/share/lxc/config/centos.common.conf&lt;/code&gt; нужно найти опцию &lt;code&gt;lxc.cap.drop&lt;/code&gt;, содержащую значения &lt;code&gt;setfcap&lt;/code&gt; и &lt;code&gt;setpcap&lt;/code&gt; их нужно убрать,
 например для хоста &lt;strong&gt;Ubuntu 14.04&lt;/strong&gt; нужно сделать примерно так:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="c1"&gt;#lxc.cap.drop = mac_admin mac_override setfcap setpcap&lt;/span&gt;
&lt;span class="na"&gt;lxc.cap.drop&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;mac_admin mac_override&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Не зависимо от дистрибутива нужно в тот же файл еще добавить в конец сроки:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="c1"&gt;# This lets LXC SUSE containers run on hosts with apparmor.&lt;/span&gt;
&lt;span class="c1"&gt;# It does nothing on hosts which do not have apparmor enabled.&lt;/span&gt;
&lt;span class="na"&gt;lxc.aa_profile&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;unconfined&lt;/span&gt;

&lt;span class="c1"&gt;# https://bugs.launchpad.net/ubuntu/+source/lxc/+bug/1347020&lt;/span&gt;
&lt;span class="na"&gt;lxc.kmsg&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;0&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;hr&gt;
&lt;p&gt;UPD: &lt;strong&gt;14.10.2016&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Под &lt;strong&gt;Centos 7&lt;/strong&gt; и начиная с &lt;strong&gt;Ubuntu 16.06&lt;/strong&gt; для персистентных контейнеров лучше использовать &lt;code&gt;systemd-nspawn&lt;/code&gt; и управлять ими через &lt;code&gt;machinectl&lt;/code&gt;.&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;Ссылки по теме:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href="https://bugzilla.redhat.com/show_bug.cgi?id=1176816"&gt;Bug 1176816 - booting a centos 7 container is extremely slow&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://bugs.launchpad.net/ubuntu/+source/lxc/+bug/1339781"&gt;centos 7 needs setpcap capability&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://bugs.launchpad.net/ubuntu/+source/lxc/+bug/1347020"&gt;systemd does not boot in a container&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;[[lxc-devel] [PATCH] Various fixes for Fedora/CentOS/OpenSUSE templates and systemd.](https://lists.linuxcontainers.org/pipermail/lxc-devel/2014-September/010261.html)&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/lxc/lxc/issues/340"&gt;big big login delays in CentOS 7 systemd #340&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://linuxcontainers.org/lxc/downloads/"&gt;Linux Containers: Downloads&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;[LXC 1.0: Troubleshooting and debugging &lt;a href="http://www.stgraber.org/2014/02/18/lxc-1-0-troubleshooting-and-debugging/"&gt;10/10&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;</content><category term="Linux"></category><category term="Centos"></category><category term="Centos 7"></category><category term="LXC"></category><category term="python"></category><category term="rpm"></category></entry><entry><title>Zimbra Google Chrome 45 Fix</title><link href="https://metajiji.github.io/blog/zimbra-google-chrome-45-fix/" rel="alternate"></link><published>2015-09-29T00:00:00+06:00</published><updated>2015-09-29T00:00:00+06:00</updated><author><name>Denis Kadyshev</name></author><id>tag:metajiji.github.io,2015-09-29:/blog/zimbra-google-chrome-45-fix/</id><summary type="html">&lt;p&gt;Возникла проблема с &lt;strong&gt;Zimbra Webmail&lt;/strong&gt; и &lt;strong&gt;Chrome&lt;/strong&gt; &lt;code&gt;v.45.0.2454.85&lt;/code&gt;, спустя неделю был опубликован фикс на офф сайте &lt;strong&gt;Zimbra&lt;/strong&gt;, я предлагаю очень похожий вариант, но без перезагрузки &lt;strong&gt;Zimbra&lt;/strong&gt;.&lt;/p&gt;
&lt;p&gt;Нужно найти в файлах, возможно необходимо будет сделать бекап или скопировать и закомментировать изменяемые строки:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;/opt/zimbra/jetty-distribution-7.6.12 …&lt;/pre&gt;&lt;/div&gt;</summary><content type="html">&lt;p&gt;Возникла проблема с &lt;strong&gt;Zimbra Webmail&lt;/strong&gt; и &lt;strong&gt;Chrome&lt;/strong&gt; &lt;code&gt;v.45.0.2454.85&lt;/code&gt;, спустя неделю был опубликован фикс на офф сайте &lt;strong&gt;Zimbra&lt;/strong&gt;, я предлагаю очень похожий вариант, но без перезагрузки &lt;strong&gt;Zimbra&lt;/strong&gt;.&lt;/p&gt;
&lt;p&gt;Нужно найти в файлах, возможно необходимо будет сделать бекап или скопировать и закомментировать изменяемые строки:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;/opt/zimbra/jetty-distribution-7.6.12.v20130726/webapps/zimbra/skins/_base/base2/skin.css
/opt/zimbra/jetty-distribution-7.6.12.v20130726/webapps/zimbra/skins/_base/base3/skin.css
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Eсли эти строки отличаются - привести их к этому виду:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="p"&gt;#&lt;/span&gt;&lt;span class="nn"&gt;skin_td_sidebar_ad&lt;/span&gt;        &lt;span class="p"&gt;{&lt;/span&gt; &lt;span class="k"&gt;width&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="o"&gt;@&lt;/span&gt;&lt;span class="n"&gt;SidebarAdWidth&lt;/span&gt;&lt;span class="o"&gt;@&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="p"&gt;#&lt;/span&gt;&lt;span class="nn"&gt;skin_container_sidebar_ad&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt; &lt;span class="err"&gt;@AdStyle@&lt;/span&gt; &lt;span class="k"&gt;width&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="o"&gt;@&lt;/span&gt;&lt;span class="n"&gt;SidebarAdWidth&lt;/span&gt;&lt;span class="o"&gt;@&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="p"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Затем нужно найти строку:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="p"&gt;#&lt;/span&gt;&lt;span class="nn"&gt;skin_td_main&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt; &lt;span class="k"&gt;width&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="kc"&gt;auto&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="k"&gt;height&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;100&lt;/span&gt;&lt;span class="kt"&gt;%&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="p"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;И привести её к виду:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="p"&gt;#&lt;/span&gt;&lt;span class="nn"&gt;skin_td_main&lt;/span&gt; &lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="nt"&gt;TABLE&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt; &lt;span class="k"&gt;table-layout&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="kc"&gt;fixed&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="p"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Напомню, сделать это нужно в обоих файлах &lt;code&gt;base3&lt;/code&gt; и &lt;code&gt;base2&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;Теперь самое интересное, чтобы не перезапускать &lt;strong&gt;Zimbra&lt;/strong&gt;, можно исправить уже имеющие стили в кеше:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nb"&gt;cd&lt;/span&gt; /opt/zimbra/jetty/work/resource-cache/skinres/latest
sed -i &lt;span class="s1"&gt;&amp;#39;s/#skin_td_main{width:auto;height:100%;}/#skin_td_main&amp;gt;TABLE{table-layout:fixed;}/g&amp;#39;&lt;/span&gt; ./*.css
&lt;/pre&gt;&lt;/div&gt;


&lt;hr&gt;
&lt;p&gt;Ссылки по теме:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href="http://forum.telus.com/thread/54935/category/Phones_Mobile_Devices/board/My_Home_Services_and_Devices/anyone-else-having-display-problems-with-telus-webmail-on-chrome-v-45-0-2454-85"&gt;Anyone else having display problems with Telus Webmail on Chrome v. 45.0.2454.85?&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://wiki.zimbra.com/wiki/Zimbra_Web_Client_in_ZCS_8.0.x_and_Google_Chrome_45%2B"&gt;Zimbra Web Client in ZCS 8.0.x and Google Chrome 45+&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/jorgedlcruz/Zimbra/blob/master/Zimbra%20Google%20Chrome%2045%20Fix/zimbra-chrome45-fix.sh"&gt;Github: Zimbra Google Chrome 45 Fix&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;</content><category term="Zimbra"></category><category term="bug"></category><category term="fix"></category><category term="chrome 45"></category><category term="chrome"></category></entry><entry><title>Запуск X приложений на полный экран в X сервере без DM</title><link href="https://metajiji.github.io/blog/run-x-applications-without-dm-nodm/" rel="alternate"></link><published>2015-08-27T00:00:00+06:00</published><updated>2015-08-27T00:00:00+06:00</updated><author><name>Denis Kadyshev</name></author><id>tag:metajiji.github.io,2015-08-27:/blog/run-x-applications-without-dm-nodm/</id><summary type="html">&lt;p&gt;Для запуска в &lt;code&gt;X&lt;/code&gt; сессии любой &lt;code&gt;X&lt;/code&gt; программы можно воспользоваться &lt;code&gt;nodm&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Установка необходимых пакетов:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;$ sudo apt-get install nodm
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Настройка &lt;strong&gt;nodm&lt;/strong&gt; в файле &lt;code&gt;/etc/default/nodm&lt;/code&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="c1"&gt;# nodm configuration&lt;/span&gt;

&lt;span class="c1"&gt;# Set NODM_ENABLED to something different than &amp;#39;false&amp;#39; to enable nodm&lt;/span&gt;
&lt;span class="nv"&gt;NODM_ENABLED&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nb"&gt;true&lt;/span&gt;

&lt;span class="c1"&gt;# User to autologin for&lt;/span&gt;
&lt;span class="nv"&gt;NODM_USER&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;metall

&lt;span class="c1"&gt;# First vt to try when …&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;</summary><content type="html">&lt;p&gt;Для запуска в &lt;code&gt;X&lt;/code&gt; сессии любой &lt;code&gt;X&lt;/code&gt; программы можно воспользоваться &lt;code&gt;nodm&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Установка необходимых пакетов:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;$ sudo apt-get install nodm
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Настройка &lt;strong&gt;nodm&lt;/strong&gt; в файле &lt;code&gt;/etc/default/nodm&lt;/code&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="c1"&gt;# nodm configuration&lt;/span&gt;

&lt;span class="c1"&gt;# Set NODM_ENABLED to something different than &amp;#39;false&amp;#39; to enable nodm&lt;/span&gt;
&lt;span class="nv"&gt;NODM_ENABLED&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nb"&gt;true&lt;/span&gt;

&lt;span class="c1"&gt;# User to autologin for&lt;/span&gt;
&lt;span class="nv"&gt;NODM_USER&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;metall

&lt;span class="c1"&gt;# First vt to try when looking for free VTs&lt;/span&gt;
&lt;span class="nv"&gt;NODM_FIRST_VT&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;7&amp;#39;&lt;/span&gt;

&lt;span class="c1"&gt;### xinit program&lt;/span&gt;
&lt;span class="c1"&gt;###NODM_XINIT=/usr/bin/xinit&lt;/span&gt;

&lt;span class="c1"&gt;# X session&lt;/span&gt;
&lt;span class="nv"&gt;NODM_XSESSION&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;/etc/X11/Xsession

&lt;span class="c1"&gt;# Options for the X server&lt;/span&gt;
&lt;span class="nv"&gt;NODM_X_OPTIONS&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;-nolisten tcp&amp;#39;&lt;/span&gt;

&lt;span class="c1"&gt;# If an X session will run for less than this time in seconds, nodm will wait an&lt;/span&gt;
&lt;span class="c1"&gt;# increasing bit of time before restarting the session.&lt;/span&gt;
&lt;span class="nv"&gt;NODM_MIN_SESSION_TIME&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;60&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;hr&gt;
&lt;p&gt;Ссылки по теме:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href="http://forum.kodi.tv/showthread.php?tid=111486&amp;amp;page=2"&gt;forum kodi, XBMC Server&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;</content><category term="Linux"></category><category term="nodm"></category><category term="X server"></category><category term="Xorg"></category></entry><entry><title>Ubuntu 14.04 LTS php5-fpm reload logrotate</title><link href="https://metajiji.github.io/blog/ubuntu-1404-lts-php5-fpm-reload/" rel="alternate"></link><published>2015-08-04T00:00:00+06:00</published><updated>2015-08-04T00:00:00+06:00</updated><author><name>Denis Kadyshev</name></author><id>tag:metajiji.github.io,2015-08-04:/blog/ubuntu-1404-lts-php5-fpm-reload/</id><summary type="html">&lt;p&gt;При установке &lt;code&gt;php-fpm&lt;/code&gt; под &lt;strong&gt;Ubuntu 14.04&lt;/strong&gt; обнаружились проблемы с логами, не работала ротация, а так же не работал &lt;code&gt;reload&lt;/code&gt; демона, демон завершал &lt;code&gt;master&lt;/code&gt; процесс,
 при этом оставляя свои дочерние процессы, в следствие чего дальнейшая работа с &lt;code&gt;php-fpm&lt;/code&gt; становилась невозможной, без ручной остановки каждого процесса &lt;code&gt;php-fpm&lt;/code&gt; и последующим запуском,
 в …&lt;/p&gt;</summary><content type="html">&lt;p&gt;При установке &lt;code&gt;php-fpm&lt;/code&gt; под &lt;strong&gt;Ubuntu 14.04&lt;/strong&gt; обнаружились проблемы с логами, не работала ротация, а так же не работал &lt;code&gt;reload&lt;/code&gt; демона, демон завершал &lt;code&gt;master&lt;/code&gt; процесс,
 при этом оставляя свои дочерние процессы, в следствие чего дальнейшая работа с &lt;code&gt;php-fpm&lt;/code&gt; становилась невозможной, без ручной остановки каждого процесса &lt;code&gt;php-fpm&lt;/code&gt; и последующим запуском,
 в общем надоело это безобразие, решил навести порядок.&lt;/p&gt;
&lt;p&gt;Создаем папку для логов:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;mkdir /var/log/php5-fpm
chmod &lt;span class="m"&gt;777&lt;/span&gt; /var/log/php5-fpm
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;&lt;code&gt;chmod 777&lt;/code&gt; сделан намерено, потому, что у меня &lt;code&gt;php-fpm&lt;/code&gt; пулы запускаются от разных пользователей и от разных групп.&lt;/p&gt;
&lt;p&gt;Затем переложим лог ошибок &lt;code&gt;php-fpm&lt;/code&gt; в созданную только что папку с логами, для этого в файле: &lt;code&gt;/etc/php5/fpm/php-fpm.conf&lt;/code&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nv"&gt;error_log&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; /var/log/php5-fpm/error.log
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Теперь займемся правильной ротацией логов, файл &lt;code&gt;/etc/logrotate.d/php5-fpm&lt;/code&gt; к такому виду:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;/var/log/php5-fpm/*.log &lt;span class="o"&gt;{&lt;/span&gt;
        rotate &lt;span class="m"&gt;5&lt;/span&gt;
&lt;span class="c1"&gt;#       weekly  # Не стоит терять логи, обнуляя файл раз в неделю!&lt;/span&gt;
        size 1k
        missingok
        notifempty
        compress
        delaycompress
        postrotate
                &lt;span class="c1"&gt;# http://stackoverflow.com/questions/19998526/ubuntu-php5-fpm-throws-unknown-instance-on-reload&lt;/span&gt;
                &lt;span class="c1"&gt;# The original reload command did never work&lt;/span&gt;
                &lt;span class="c1"&gt;#invoke-rc.d php5-fpm reopen-logs &amp;gt; /dev/null&lt;/span&gt;

                &lt;span class="c1"&gt;# Workaround for cases when the reload command fails for some reason&lt;/span&gt;
                service php5-fpm reload &amp;gt; /dev/null &lt;span class="m"&gt;2&lt;/span&gt;&amp;gt;&lt;span class="p"&gt;&amp;amp;&lt;/span&gt;&lt;span class="m"&gt;1&lt;/span&gt;
                &lt;span class="o"&gt;[&lt;/span&gt; &lt;span class="nv"&gt;$?&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="m"&gt;0&lt;/span&gt; &lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;||&lt;/span&gt; &lt;span class="o"&gt;(&lt;/span&gt; service php5-fpm stop&lt;span class="p"&gt;;&lt;/span&gt; killall php5-fpm&lt;span class="p"&gt;;&lt;/span&gt; service php5-fpm start &lt;span class="o"&gt;)&lt;/span&gt; &amp;gt; /dev/null
        endscript
&lt;span class="o"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Так же рекомендую привести в порядок логи каждого пула например для пула &lt;code&gt;www&lt;/code&gt; в файле &lt;code&gt;/etc/php5/fpm/pool.d/www.conf&lt;/code&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;access.log &lt;span class="o"&gt;=&lt;/span&gt; /var/log/php5-fpm/&lt;span class="nv"&gt;$pool&lt;/span&gt;-access.log
&lt;span class="nv"&gt;slowlog&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; /var/log/php5-fpm/&lt;span class="nv"&gt;$pool&lt;/span&gt;-slow.log
php_admin_value&lt;span class="o"&gt;[&lt;/span&gt;error_log&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; /var/log/php5-fpm/&lt;span class="nv"&gt;$pool&lt;/span&gt;-error.log
php_admin_flag&lt;span class="o"&gt;[&lt;/span&gt;log_errors&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; on
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Обратите внимание в имени файла используется переменная &lt;code&gt;$pool&lt;/code&gt;, которая позволяет избавиться от рутины, прописывания имени пула в каждой строчке в каждом пуле.&lt;/p&gt;
&lt;p&gt;Теперь решим проблему с &lt;code&gt;reload&lt;/code&gt; и с удобным хранением &lt;code&gt;php-fpm&lt;/code&gt; пулов приводим файл &lt;code&gt;/etc/init/php5-fpm.conf&lt;/code&gt; к такому виду:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="c1"&gt;# php5-fpm - The PHP FastCGI Process Manager&lt;/span&gt;

description &lt;span class="s2"&gt;&amp;quot;The PHP FastCGI Process Manager&amp;quot;&lt;/span&gt;
author &lt;span class="s2"&gt;&amp;quot;Ondřej Surý &amp;lt;ondrej@debian.org&amp;gt;&amp;quot;&lt;/span&gt;

start on runlevel &lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="m"&gt;2345&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;
stop on runlevel &lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="m"&gt;016&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;

&lt;span class="c1"&gt;# Precise upstart does not support reload signal, and thus rejects the&lt;/span&gt;
&lt;span class="c1"&gt;# job. We&amp;#39;d rather start the daemon, instead of forcing users to&lt;/span&gt;
&lt;span class="c1"&gt;# reboot https://bugs.launchpad.net/ubuntu/+source/php5/+bug/1272788&lt;/span&gt;
&lt;span class="c1"&gt;#&lt;/span&gt;
reload signal USR2

pre-start script
        &lt;span class="o"&gt;[&lt;/span&gt; -d /var/run/php5-fpm &lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;||&lt;/span&gt; install -m &lt;span class="m"&gt;777&lt;/span&gt; -o www-data -g root -d /var/run/php5-fpm
        /usr/lib/php5/php5-fpm-checkconf
end script

respawn
&lt;span class="nb"&gt;exec&lt;/span&gt; /usr/sbin/php5-fpm --nodaemonize --fpm-config /etc/php5/fpm/php-fpm.conf
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Для применения изменений в &lt;code&gt;upstart&lt;/code&gt;, необходимо выполнить команды, &lt;a href="auto-create-dir-var-run-php5-fpm.html" title="Автоматическое создание директории /var/run/php5-fpm после перезагрузки"&gt; подробнее [2]&lt;/a&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;root@Ubuntu# initctl reload-configuration
root@Ubuntu# initctl stop php5-fpm
initctl: Unknown instance: 
root@Ubuntu# initctl start php5-fpm
php5-fpm start/running, process &lt;span class="m"&gt;18467&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;В файле &lt;code&gt;/etc/init.d/php5-fpm&lt;/code&gt;, добавим вверху, после переменной &lt;code&gt;SCRIPTNAME&lt;/code&gt; строчку:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nv"&gt;SOCKETDIR&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;/var/run/&lt;span class="nv"&gt;$NAME&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;А затем, внутри функции &lt;code&gt;do_start() {&lt;/code&gt; добавим еще одну строчку:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt; -d &lt;span class="nv"&gt;$SOCKETDIR&lt;/span&gt; &lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;||&lt;/span&gt; install -m &lt;span class="m"&gt;777&lt;/span&gt; -o www-data -g root -d &lt;span class="nv"&gt;$SOCKETDIR&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;&lt;code&gt;-m 777&lt;/code&gt; я указал намеренно, как я уже упоминал ранее, у меня &lt;code&gt;php-fpm&lt;/code&gt; пулы запускаются от разных &lt;code&gt;uid:gid&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;Итак после всего этого:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Сокеты пулов лежат в ожидаемом месте: &lt;code&gt;/var/run/php5-fpm/&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Логи пулов, и лог ошибок демона &lt;code&gt;php-fpm&lt;/code&gt; в: &lt;code&gt;/var/log/php5-fpm/&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Логи не обнуляются раз в неделю, а ротация логов производится при достижении &lt;strong&gt;размера&lt;/strong&gt; файла в &lt;code&gt;1Кб&lt;/code&gt; и главное она &lt;strong&gt;работает&lt;/strong&gt;!&lt;/li&gt;
&lt;li&gt;Команда &lt;code&gt;service php5-fpm reload&lt;/code&gt; теперь ничего не ломает и работает корректно.&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;p&gt;Ссылки по теме:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href="http://stackoverflow.com/questions/19998526/ubuntu-php5-fpm-throws-unknown-instance-on-reload"&gt;Ubuntu php5-fpm throws unknown instance on reload&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="auto-create-dir-var-run-php5-fpm.html" title="Автоматическое создание директории /var/run/php5-fpm после перезагрузки"&gt;Автоматическое создание директории &lt;code&gt;/var/run/php5-fpm&lt;/code&gt; после перезагрузки&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;</content><category term="Ubuntu"></category><category term="Linux"></category><category term="php-fpm"></category><category term="php5-fpm"></category><category term="reload"></category></entry><entry><title>Ubuntu красивый motd при подключении по ssh.</title><link href="https://metajiji.github.io/blog/ubuntu-motd-ssh/" rel="alternate"></link><published>2015-08-03T00:00:00+06:00</published><updated>2015-08-03T00:00:00+06:00</updated><author><name>Denis Kadyshev</name></author><id>tag:metajiji.github.io,2015-08-03:/blog/ubuntu-motd-ssh/</id><summary type="html">&lt;p&gt;При подключении по ssh к Ubuntu серверу, при установленном пакете: &lt;code&gt;update-notifier-common&lt;/code&gt;&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;apt-get install update-notifier-common
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;В &lt;code&gt;motd&lt;/code&gt; будет добавлено примерно следующее:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="m"&gt;12&lt;/span&gt; packages can be updated.
&lt;span class="m"&gt;0&lt;/span&gt; updates are security updates.
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Но не все так гладко, ценой за это будет небольшая задержка при подключении...&lt;/p&gt;
&lt;p&gt;Есть приятные полезности, например, если вызывать скрипт …&lt;/p&gt;</summary><content type="html">&lt;p&gt;При подключении по ssh к Ubuntu серверу, при установленном пакете: &lt;code&gt;update-notifier-common&lt;/code&gt;&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;apt-get install update-notifier-common
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;В &lt;code&gt;motd&lt;/code&gt; будет добавлено примерно следующее:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="m"&gt;12&lt;/span&gt; packages can be updated.
&lt;span class="m"&gt;0&lt;/span&gt; updates are security updates.
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Но не все так гладко, ценой за это будет небольшая задержка при подключении...&lt;/p&gt;
&lt;p&gt;Есть приятные полезности, например, если вызывать скрипт напрямую, то он выдаст информацию о доступных обновлениях, которую можно использовать где угодно в своих целях.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;/usr/lib/update-notifier/apt-check
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Результат команды будет примерно таким &lt;code&gt;12;0&lt;/code&gt;.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Где цифры до &lt;code&gt;;&lt;/code&gt; - количество доступных пакетов для обновления в моем случае &lt;code&gt;12&lt;/code&gt;.&lt;/li&gt;
&lt;li&gt;А после &lt;code&gt;;&lt;/code&gt; - количество пакетов обновления безопасности.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Кому этого мало, то можно еще установить пакет &lt;code&gt;landscape-common&lt;/code&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;apt-get install landscape-common
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Этот пакет выдаст более подробную информацию о сервера, но при условии, что сервер не сильно загружен и в чрезвычайной ситуации этот скрипт не помешает админу подключаться по &lt;code&gt;ssh&lt;/code&gt;.&lt;/p&gt;</content><category term="Ubuntu"></category><category term="motd"></category><category term="ssh"></category></entry><entry><title>Сборка мощного домашнего сервера</title><link href="https://metajiji.github.io/blog/compact-home-powerful-server,minicase,noctua/" rel="alternate"></link><published>2015-07-26T00:00:00+06:00</published><updated>2016-10-13T00:00:00+07:00</updated><author><name>Denis Kadyshev</name></author><id>tag:metajiji.github.io,2015-07-26:/blog/compact-home-powerful-server,minicase,noctua/</id><summary type="html">&lt;p&gt;Стало не хватать домашнего сервера на &lt;code&gt;Atom D525&lt;/code&gt; с &lt;code&gt;4Гб&lt;/code&gt; оперативной памяти, вот такой он компактный:
&lt;img alt="Mini-ITX Morex T3310" class="mfp-image center-block" src="https://metajiji.github.io/blog/compact-home-powerful-server,minicase,noctua/26-07-2015_compact-home-powerful-server/1.jpg"&gt;&lt;/p&gt;
&lt;p&gt;Вон он в боевом положении, чтобы вы оценили насколько он компактный:
&lt;img alt="Mini-ITX Morex T3310" class="mfp-image center-block" src="https://metajiji.github.io/blog/compact-home-powerful-server,minicase,noctua/26-07-2015_compact-home-powerful-server/2.jpg"&gt;&lt;/p&gt;
&lt;p&gt;Это корпус &lt;code&gt;Mini-ITX Morex T3310&lt;/code&gt;, покупался еще в красноярском &lt;strong&gt;DNS-shop&lt;/strong&gt;, когда процессоры &lt;strong&gt;Atom&lt;/strong&gt; еще были в моде. :)
 Процессор вместе с радиатором распаяны на …&lt;/p&gt;</summary><content type="html">&lt;p&gt;Стало не хватать домашнего сервера на &lt;code&gt;Atom D525&lt;/code&gt; с &lt;code&gt;4Гб&lt;/code&gt; оперативной памяти, вот такой он компактный:
&lt;img alt="Mini-ITX Morex T3310" class="mfp-image center-block" src="https://metajiji.github.io/blog/compact-home-powerful-server,minicase,noctua/26-07-2015_compact-home-powerful-server/1.jpg"&gt;&lt;/p&gt;
&lt;p&gt;Вон он в боевом положении, чтобы вы оценили насколько он компактный:
&lt;img alt="Mini-ITX Morex T3310" class="mfp-image center-block" src="https://metajiji.github.io/blog/compact-home-powerful-server,minicase,noctua/26-07-2015_compact-home-powerful-server/2.jpg"&gt;&lt;/p&gt;
&lt;p&gt;Это корпус &lt;code&gt;Mini-ITX Morex T3310&lt;/code&gt;, покупался еще в красноярском &lt;strong&gt;DNS-shop&lt;/strong&gt;, когда процессоры &lt;strong&gt;Atom&lt;/strong&gt; еще были в моде. :)
 Процессор вместе с радиатором распаяны на материнской плате, внутри нет ни одного вентилятора, и  2 HDD от старых ноутбуков, да я собирал его из того, что было под рукой! :)
 Еще на плате имеется &lt;strong&gt;1 PCI&lt;/strong&gt; слот, куда вставлена вторая сетевая карточка, да, вы правильно догадались, это был домашний роутер!
 Внутри есть &lt;strong&gt;Mini-PCIe&lt;/strong&gt; с &lt;strong&gt;Wi-Fi&lt;/strong&gt; адаптером, но как видно на фото (плохо видно, но статья не о нем же), у меня появился &lt;code&gt;Mikrotik RB951G-2HnD&lt;/code&gt; и необходимость во 2 карточке отпала,
 но виртуалки с разными проектами остались, а так же файлопомойка, &lt;code&gt;PXE&lt;/code&gt; установщики и много других полезных вещей.&lt;/p&gt;
&lt;p&gt;В общем железо сильно устарело и я решил его обновить, получился такой список деталей:
&lt;table class="table table-striped table-bordered table-condensed table-hover"&gt;
&lt;tr&gt;
    &lt;th&gt;Наименование&lt;/th&gt;
    &lt;th&gt;Модель и описание&lt;/th&gt;
    &lt;th&gt;Цена&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
    &lt;td&gt;Материнская плата&lt;/td&gt;
    &lt;td&gt;ASRock H81TM-ITX, Scket1150, iH81, 2SODIMM DDRIII, 7.1-ch HDA, GLAN, USB 3.0, DVI, HDMI, Thin mini-ITX, Retail&lt;/td&gt;
    &lt;td&gt;3807&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
    &lt;td&gt;Блок питания&lt;/td&gt;
    &lt;td&gt;HP-A1501A3B1 19V 7.9A 150W&lt;/td&gt;
    &lt;td&gt;2400&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
    &lt;td&gt;Кулер+доставка&lt;/td&gt;
    &lt;td&gt;Dynatron K199 1U LGA115X&lt;/td&gt;
    &lt;td&gt;1794+1090&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
    &lt;td&gt;Память&lt;/td&gt;
    &lt;td&gt;DDR3L SODIMM 16Gb (2x8Gb) PC12800 1600MHz CL9 Kingston HyperX Impact Black Series (HX316LS9IBK2/16)&lt;/td&gt;
    &lt;td&gt;7650&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
    &lt;td&gt;Процессор&lt;/td&gt;
    &lt;td&gt;Intel Core i7-4790S 3200MHz 8Mb TDP-65W S1150 tray Haswell&lt;/td&gt;
    &lt;td&gt;24050&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class="warning"&gt;
    &lt;td&gt;Процессор&lt;/td&gt;
    &lt;td&gt;Intel Xeon E3-1246v3 3500MHz 8Mb 5GT/s TDP-84W S1150 tray&lt;/td&gt;
    &lt;td&gt;20675&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
    &lt;td&gt;Жесткий диск&lt;/td&gt;
    &lt;td&gt;Hitachi (HGST) 1Tb HTS721010A9E630 Travelstar 7K1000 2.5" 7200rpm 32Mb SATA3&lt;/td&gt;
    &lt;td&gt;4275+4275&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
    &lt;td&gt;Корпус&lt;/td&gt;
    &lt;td&gt;Lian Li PC-Q05B Black Mini-ITX 47x284x307&lt;/td&gt;
    &lt;td&gt;3663&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
    &lt;td&gt;&lt;/td&gt;
    &lt;td&gt;&lt;/td&gt;
    &lt;td&gt;&lt;strong&gt;53004 руб.&lt;/strong&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/table&gt;&lt;/p&gt;
&lt;p&gt;Сервер старался делать максимально миниатюрным, поэтому кулер выбрал очень специфичный &lt;strong&gt;Dynatron K199&lt;/strong&gt;, т.к. процессор хочется мощный и в то же время, чтобы сервер остался бесшумным и компактным.&lt;/p&gt;
&lt;p&gt;&lt;img alt="Dynatron K199" class="mfp-image center-block" src="https://metajiji.github.io/blog/compact-home-powerful-server,minicase,noctua/26-07-2015_compact-home-powerful-server/3.jpg"&gt;&lt;/p&gt;
&lt;p&gt;Выбранный кулер на момент покупки был доступен только в европейской части мира, аналогов в росии или китае я не нашел, поэтому пришлось заказать в штатах на *&lt;em&gt;Ebay&lt;/em&gt;,
 тут я изрядно переплатил еще и доставка была платная, но &lt;s&gt;оно того стоит&lt;/s&gt;! (позже я выяснил, что он не очень тихий, турбинка сильно шумит, при нагрузках, взамен купил &lt;code&gt;Noctua NH-L9i&lt;/code&gt;)
&lt;img alt="Noctua NH-L9i" class="mfp-image center-block" src="https://metajiji.github.io/blog/compact-home-powerful-server,minicase,noctua/26-07-2015_compact-home-powerful-server/5.jpg"&gt;&lt;/p&gt;
&lt;p&gt;Выбранный процессор &lt;code&gt;E3-1246v3&lt;/code&gt; имеет &lt;code&gt;4&lt;/code&gt; ядра, &lt;code&gt;8&lt;/code&gt; потоков (&lt;strong&gt;Hyper Threading&lt;/strong&gt;) и встроенное видео, которое пока никак не планируется использоваться,
 только для входа в &lt;strong&gt;BIOS&lt;/strong&gt; и при возможных неполадках, &lt;strong&gt;IPMI&lt;/strong&gt; решения или &lt;strong&gt;PCI-Ex&lt;/strong&gt; видеокарточки конечно вариант, но по деньгам дороже и в реализации сложнее,
 проще процессор с видеокарточкой взять, но есть еще одна проблема рассеиваемая мощность &lt;code&gt;84Вт&lt;/code&gt; у кулера запаса хватает (&lt;code&gt;95Вт&lt;/code&gt;), а у материнской платы по паспорту написано &lt;code&gt;65Вт&lt;/code&gt;,
 но думаю должно работать, если нет, то придется менять процессор на &lt;code&gt;E3-1286LV3&lt;/code&gt;, стоимостью в 2 раза дороже (примерно &lt;code&gt;$774&lt;/code&gt;).&lt;/p&gt;
&lt;p&gt;После долгих поисков, сравнений бенчмарков и технических характеристик, пришел к выводу, что наиболее подходящим будет процессор &lt;code&gt;Intel Core i7-4790S&lt;/code&gt; c &lt;code&gt;TDP 65W&lt;/code&gt;,
 он вполне производительный и энергоэффективный, судя по бенчмаркам производительность на уровне выбранного ранее &lt;code&gt;E3-1286LV3&lt;/code&gt; с &lt;code&gt;TDP 84W&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;С блоком питания тоже не все так просто, в городе небыло таких мощных &lt;code&gt;150Вт&lt;/code&gt;, пришлось заказать в китае на &lt;strong&gt;Ebay&lt;/strong&gt;.&lt;/p&gt;
&lt;p&gt;С выбором дисков одни разочарования, сперва выбрал то, что хотел &lt;code&gt;Seagate-ST2000NX0243&lt;/code&gt; Жесткий диск емкостью &lt;code&gt;2 ТБ&lt;/code&gt; с интерфейсом &lt;strong&gt;SAS/SATA&lt;/strong&gt; с низким энергопотреблением,
 но когда узнал, что он стоит &lt;code&gt;21000 рублей&lt;/code&gt; в лучшем случае, начал искать аналоги, но и тут проблема стоят они в 2 раза меньше и в объеме тоже меньше, по скорости хуже,
 поэтому взял самый простой вариант &lt;code&gt;Hitachi Travelstar 7K1000 HTS721010A9E630&lt;/code&gt;, а ведь я планирую &lt;code&gt;RAID1&lt;/code&gt;, значит диска нужно два!
 А если мне вдруг действительно понадобятся быстрые, ёмкие и компактные диски, то я всегда успею их докупить.
 Тем более у меня на материнской плате еще &lt;strong&gt;Mini-PCIe&lt;/strong&gt; пустой, можно туда купить &lt;strong&gt;SSD&lt;/strong&gt; с интерфейсом &lt;code&gt;M.2&lt;/code&gt; это будет дешевле и быстрее!&lt;/p&gt;
&lt;p&gt;Память выбиралась очень просто, материнская плата не умеет &lt;code&gt;ECC&lt;/code&gt;, максимальный объем &lt;code&gt;16Гб&lt;/code&gt;, максимальная частота &lt;code&gt;1600&lt;/code&gt;, процессор все это поддерживает,
 поэтому взял самую простую и дешевую с таймингами поменьше &lt;code&gt;CL9&lt;/code&gt;, разница с аналогичной, но с таймингами &lt;code&gt;CL11&lt;/code&gt; была небольшой.&lt;/p&gt;
&lt;p&gt;Корпус, самое интересное оставил на десерт, пока планирую уместить все в старый корпус, но еще не все детали из списка куплены, поэтому я еще выбираю корпуса, присматириваюсь, так сказать.
Пригляделся корпус &lt;s&gt;Lian Li PC-Q05B Black&lt;/s&gt; когда померял, оказалось, что такой корпус не подходит, по высоте не хватило 6мм :(&lt;/p&gt;
&lt;p&gt;Немного погуглив заказал сразу два у китайцев &lt;a href="http://www.minicase.net/product_E-W80.html" title="minicase.net: E-W80"&gt;minicase.net: E-W80 [6]&lt;/a&gt;, они подошли идеально!
&lt;img alt="E-W80" class="mfp-image center-block" src="https://metajiji.github.io/blog/compact-home-powerful-server,minicase,noctua/26-07-2015_compact-home-powerful-server/4.jpg"&gt;&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;Ссылки по теме:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href="http://www.dynatron-corp.com/en/product_detail_1.aspx?id=191"&gt;Dynatron K199 Socket LGA1150 &amp;amp; Sandy Bridge LGA1155 &amp;amp; LGA1156&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://www.seagate.com/ru/ru/products/enterprise-servers-storage/nearline-storage/enterprise-capacity-2-5-hdd/?sku=ST2000NX0243#features"&gt;Жесткий диск Enterprise Capacity 2.5 HDD&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://ru.wikipedia.org/wiki/M.2"&gt;Интерфейс M.2 Next Generation Form Factor и NGFF&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://ark.intel.com/ru/compare/75124,80916,80914,75462,80909,80910"&gt;Сравнение процессоров Intel®&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://www.cpubenchmark.net/socketType.html#id7"&gt;CPU Mark by Socket Type: LGA 1150&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://www.minicase.net/product_E-W80.html" title="minicase.net: E-W80"&gt;minicase.net: E-W80&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://www.pridopia.co.uk/faq-1.html"&gt;Intel D525MW mother board Mini PCI express slot not detect our card?&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;</content><category term="Home Server"></category><category term="HTPC"></category><category term="silent"></category><category term="powerful"></category><category term="compact"></category></entry><entry><title>OS X Mavericks + Windows 7 + Ubuntu 14.04 на одном HDD с блоками в 4k с GPT</title><link href="https://metajiji.github.io/blog/os-x-mavericks-windows-7-ubuntu-1404/" rel="alternate"></link><published>2015-07-24T00:00:00+06:00</published><updated>2015-07-24T00:00:00+06:00</updated><author><name>Denis Kadyshev</name></author><id>tag:metajiji.github.io,2015-07-24:/blog/os-x-mavericks-windows-7-ubuntu-1404/</id><summary type="html">&lt;h1&gt;STEP 0: Создание флешки с помощью [UniBeast [6]] [6]&lt;/h1&gt;
&lt;h1&gt;STEP 1: Разбиение диска.&lt;/h1&gt;
&lt;p&gt;Создать таблицу разделов &lt;code&gt;GPT&lt;/code&gt;.
Создать &lt;code&gt;3&lt;/code&gt; раздела заданного размера.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;hfs+&lt;/code&gt; Journaled (&lt;strong&gt;Mac&lt;/strong&gt;)&lt;/li&gt;
&lt;li&gt;&lt;code&gt;Ms-DOS FAT32&lt;/code&gt; (&lt;strong&gt;Windows&lt;/strong&gt;)&lt;/li&gt;
&lt;li&gt;&lt;code&gt;Ms-DOS FAT32&lt;/code&gt; (&lt;strong&gt;Linux&lt;/strong&gt;)&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Если вы выберете именно &lt;code&gt;Ms-Dos Fat32&lt;/code&gt;, то &lt;strong&gt;дисковая утилита MacOS&lt;/strong&gt; сама выберет &lt;code&gt;GPT&lt;/code&gt; в режиме совместимости с &lt;code&gt;MBR&lt;/code&gt;! (можете …&lt;/p&gt;</summary><content type="html">&lt;h1&gt;STEP 0: Создание флешки с помощью [UniBeast [6]] [6]&lt;/h1&gt;
&lt;h1&gt;STEP 1: Разбиение диска.&lt;/h1&gt;
&lt;p&gt;Создать таблицу разделов &lt;code&gt;GPT&lt;/code&gt;.
Создать &lt;code&gt;3&lt;/code&gt; раздела заданного размера.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;hfs+&lt;/code&gt; Journaled (&lt;strong&gt;Mac&lt;/strong&gt;)&lt;/li&gt;
&lt;li&gt;&lt;code&gt;Ms-DOS FAT32&lt;/code&gt; (&lt;strong&gt;Windows&lt;/strong&gt;)&lt;/li&gt;
&lt;li&gt;&lt;code&gt;Ms-DOS FAT32&lt;/code&gt; (&lt;strong&gt;Linux&lt;/strong&gt;)&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Если вы выберете именно &lt;code&gt;Ms-Dos Fat32&lt;/code&gt;, то &lt;strong&gt;дисковая утилита MacOS&lt;/strong&gt; сама выберет &lt;code&gt;GPT&lt;/code&gt; в режиме совместимости с &lt;code&gt;MBR&lt;/code&gt;! (можете вручную этим заняться с помощь &lt;code&gt;gdisk&lt;/code&gt;)&lt;/p&gt;
&lt;h2&gt;Установка &lt;strong&gt;OS X Mavericks&lt;/strong&gt;.&lt;/h2&gt;
&lt;p&gt;Загрузка с флешки и запуск установленной ОС.
Выполняете настройки и попадаете на рабочий стол.&lt;/p&gt;
&lt;h1&gt;STEP 2: Создание и монтирование &lt;strong&gt;EFI&lt;/strong&gt; раздела:&lt;/h1&gt;
&lt;p&gt;Открываем терминал - &lt;code&gt;Applications/Utilities/Terminal&lt;/code&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;$ sudo -s
&lt;span class="c1"&gt;# newfs_hfs -v EFI /dev/disk0s1&lt;/span&gt;
&lt;span class="c1"&gt;# mkdir /Volumes/EFI&lt;/span&gt;
&lt;span class="c1"&gt;# mount_hfs /dev/disk0s1 /Volumes/EFI&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h1&gt;STEP 3: Установка &lt;strong&gt;CHAMELEON&lt;/strong&gt; на &lt;strong&gt;EFI&lt;/strong&gt; раздел:&lt;/h1&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="c1"&gt;# cd /Volumes/OSX-USB/usr/standalone/i386&lt;/span&gt;
&lt;span class="c1"&gt;# fdisk -f boot0 -u -y /dev/rdisk0&lt;/span&gt;
&lt;span class="c1"&gt;# cp boot /Volumes/EFI/&lt;/span&gt;
&lt;span class="c1"&gt;# cp -R /Volumes/OSX-USB/Extra /Volumes/EFI&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Загружаемся в &lt;strong&gt;Linux&lt;/strong&gt; и записываем загрузчик на раздел &lt;strong&gt;EFI&lt;/strong&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nb"&gt;cd&lt;/span&gt; /media/ubuntu/OSX-USB/usr/standalone/i386
&lt;span class="c1"&gt;# dd if=boot1h of=/dev/sda1 bs=4096&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Если у вас диск с размером блоков в &lt;code&gt;512 байт&lt;/code&gt;, то можете обойтись без &lt;strong&gt;Linux&lt;/strong&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="c1"&gt;# dd if=boot1h of=/dev/rdisk0s1&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Чтобы &lt;strong&gt;MacOS&lt;/strong&gt; могла самостоятельно загружаться делаем активным &lt;strong&gt;EFI&lt;/strong&gt; раздел:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="c1"&gt;# fdisk -e /dev/rdisk0&lt;/span&gt;
&lt;span class="c1"&gt;# p&lt;/span&gt;
&lt;span class="c1"&gt;# f 1&lt;/span&gt;
&lt;span class="c1"&gt;# w&lt;/span&gt;
&lt;span class="c1"&gt;# y&lt;/span&gt;
&lt;span class="c1"&gt;# q&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Теперь у вас полностью рабочая &lt;strong&gt;MacOS&lt;/strong&gt;!&lt;/p&gt;
&lt;p&gt;Самое время добавить сюда &lt;strong&gt;Windows 7&lt;/strong&gt; и &lt;strong&gt;Ubuntu&lt;/strong&gt;.&lt;/p&gt;
&lt;p&gt;Загружаемся с флешки(диска) и устанавливаем &lt;strong&gt;Windows 7&lt;/strong&gt; на &lt;code&gt;2&lt;/code&gt; раздел.&lt;/p&gt;
&lt;p&gt;После завершения установки &lt;strong&gt;Windows&lt;/strong&gt; - потеряется загрузчик &lt;strong&gt;Chameleon&lt;/strong&gt;, но это легко исправить:&lt;/p&gt;
&lt;p&gt;Загружаем установленную &lt;strong&gt;OS X Mavericks&lt;/strong&gt; с флешки с которой только что её устанавливали.&lt;/p&gt;
&lt;p&gt;Прописываем загрузчик на диск:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="c1"&gt;# cd /Volumes/OSX-USB/usr/standalone/i386&lt;/span&gt;
&lt;span class="c1"&gt;# fdisk -f boot0 -u -y /dev/rdisk0&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Делаем активным раздел с &lt;strong&gt;Windows 7&lt;/strong&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="c1"&gt;# fdisk -e /dev/rdisk0&lt;/span&gt;
&lt;span class="c1"&gt;# p&lt;/span&gt;
&lt;span class="c1"&gt;# f 3&lt;/span&gt;
&lt;span class="c1"&gt;# w&lt;/span&gt;
&lt;span class="c1"&gt;# y&lt;/span&gt;
&lt;span class="c1"&gt;# q&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Загружаемся снова с диска/флешки &lt;strong&gt;Windows 7&lt;/strong&gt;, и запускаем восстановление проблем запуска &lt;strong&gt;Windows&lt;/strong&gt;.&lt;/p&gt;
&lt;p&gt;Перезагружаемся - теперь &lt;strong&gt;Windows 7&lt;/strong&gt; должна загружаться снова, но сама - без &lt;strong&gt;Chamelion&lt;/strong&gt;, а он нам нужен для запуска &lt;strong&gt;OS X&lt;/strong&gt;!&lt;/p&gt;
&lt;p&gt;В &lt;strong&gt;Windows&lt;/strong&gt; используем консольную утилиту &lt;code&gt;diskpart&lt;/code&gt;, чтобы сделать &lt;code&gt;EFI&lt;/code&gt; раздел &lt;strong&gt;активным&lt;/strong&gt;. Запускаем &lt;code&gt;cmd&lt;/code&gt; от &lt;strong&gt;администратора&lt;/strong&gt;.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;C&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="nl"&gt;\&lt;/span&gt;&lt;span class="c1"&gt;&amp;gt; diskpart&lt;/span&gt;
C&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="nl"&gt;\&lt;/span&gt;&lt;span class="c1"&gt;&amp;gt; select disk 0&lt;/span&gt;
C&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="nl"&gt;\&lt;/span&gt;&lt;span class="c1"&gt;&amp;gt; select partition 1&lt;/span&gt;
C&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="nl"&gt;\&lt;/span&gt;&lt;span class="c1"&gt;&amp;gt; active&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Перезагружаемся. &lt;strong&gt;Chameleon&lt;/strong&gt; должен запускаться с &lt;strong&gt;HDD&lt;/strong&gt;! &lt;strong&gt;Windows 7&lt;/strong&gt; и &lt;strong&gt;OS X&lt;/strong&gt; должны загружаться корректно.&lt;/p&gt;
&lt;p&gt;Теперь можно установить &lt;strong&gt;Linux&lt;/strong&gt; в последний раздел.
Я устанавливал &lt;strong&gt;Ubuntu 14.04&lt;/strong&gt;:&lt;/p&gt;
&lt;p&gt;В установщике выбираем свой вариант установки.
Последний &lt;code&gt;4&lt;/code&gt; раздел отмечаем &lt;code&gt;использовать как&lt;/code&gt;, файловая система &lt;code&gt;ext4&lt;/code&gt;.
И &lt;strong&gt;важно&lt;/strong&gt; загрузчик &lt;b&gt;GRUB&lt;/b&gt; устанавливаем на раздел(&lt;code&gt;sda4&lt;/code&gt;), &lt;s&gt;не на диск (&lt;code&gt;sda&lt;/code&gt;)&lt;/s&gt;!&lt;/p&gt;
&lt;p&gt;По завершению установки &lt;strong&gt;Linux&lt;/strong&gt; - &lt;strong&gt;Windows&lt;/strong&gt; опять поломается и перестанет грузиться!
Уж не знаю что там сделал установщик &lt;strong&gt;Ubuntu&lt;/strong&gt;, но &lt;strong&gt;GPT&lt;/strong&gt; теперь в режиме &lt;code&gt;Ptotected MBR&lt;/code&gt;, а нам нужно &lt;code&gt;Mixed MBR&lt;/code&gt;.
Но не беда, исправляем с помощью &lt;code&gt;gdisk&lt;/code&gt; (тот же &lt;code&gt;fdisk&lt;/code&gt; только для &lt;code&gt;GPT&lt;/code&gt;).&lt;/p&gt;
&lt;p&gt;Не знаю почему &lt;code&gt;1&lt;/code&gt; и &lt;code&gt;4&lt;/code&gt; разделы отображаются в &lt;code&gt;fdisk&lt;/code&gt; не корректно (до установки &lt;strong&gt;Linux&lt;/strong&gt;, было все норм).
Но зато раздел &lt;strong&gt;Windows&lt;/strong&gt; отображается нормально и загрузка всех ОС будет проходить успешно.&lt;/p&gt;
&lt;h1&gt;STEP 4: &lt;a href="https://www.multibeast.com/" title="MultiBeast"&gt;MultiBeast [7]&lt;/a&gt;&lt;/h1&gt;
&lt;p&gt;Можно загружаться в OS X и запускать &lt;a href="https://www.multibeast.com/" title="MultiBeast"&gt;MultiBeast [7]&lt;/a&gt;, устанавливать драйвера на звук и т.д.&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;Ссылки по теме:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href="https://www.unibeast.com/" title="UniBeast"&gt;UniBeast&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://www.tonymacx86.com/401-install-bootloader-extra-efi-partition.html"&gt;Install Bootloader and Extra to EFI Partition&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://tonymacx86.blogspot.ru/2010/01/tweaking-your-system-install-chameleon.html"&gt;Tweaking Your System: Install Chameleon, DSDT, &amp;amp; Extras to EFI Partition&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://www.insanelymac.com/forum/topic/165878-os-x-windows-7-gpt-chameleon-2-finally-works/"&gt;OS X + Windows 7 + GPT + Chameleon 2 = Finally Works&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://www.mydellmini.com/forum/dual-booting/13834-windows-7-0xc000000e-boot-error.html"&gt;Windows 7 0xc000000e boot error&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://www.tonymacx86.com/general-hardware-discussion/100568-latest-haswell-lga1150-motherboard-info.html"&gt;Latest Haswell (LGA1150) Motherboard Info&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://www.insanelymac.com/forum/topic/277947-hackintosh-chameleon-to-boot-centos-linux-in-gpt-hdd/"&gt;Hackintosh: Chameleon to boot CentOS (Linux) in GPT HDD&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://tonymacx86.blogspot.ru/2009/11/dual-boot-windows-7-and-os-x-snow.html"&gt;tonymacx86 Blog: Dual Boot Windows 7 and OS X Snow Leopard Using Chameleon&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://www.multibeast.com/" title="MultiBeast"&gt;MultiBeast&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;</content><category term="Linux"></category><category term="Ubuntu"></category><category term="OS X"></category><category term="Windows"></category><category term="GPT"></category></entry><entry><title>Ubuntu 14.04: Ускоряем работу Dash</title><link href="https://metajiji.github.io/blog/ubuntu-1404-dash-boost/" rel="alternate"></link><published>2015-07-24T00:00:00+06:00</published><updated>2015-07-24T00:00:00+06:00</updated><author><name>Denis Kadyshev</name></author><id>tag:metajiji.github.io,2015-07-24:/blog/ubuntu-1404-dash-boost/</id><summary type="html">&lt;p&gt;На мой взгляд &lt;strong&gt;Unity Dash&lt;/strong&gt; в &lt;strong&gt;Ubuntu&lt;/strong&gt; перегружен лишним функционалом, например искать файлы удобнее в &lt;strong&gt;Nautilus&lt;/strong&gt;, а приложения, доступные для установки лучше искать в &lt;strong&gt;Software Center&lt;/strong&gt;,
 и самое важное выполнять онлайн поиск лучше в браузере. А вот установленные приложения вполне удобно искать в &lt;strong&gt;Dash&lt;/strong&gt;.
Скрипт ниже выключает онлайн поиск и …&lt;/p&gt;</summary><content type="html">&lt;p&gt;На мой взгляд &lt;strong&gt;Unity Dash&lt;/strong&gt; в &lt;strong&gt;Ubuntu&lt;/strong&gt; перегружен лишним функционалом, например искать файлы удобнее в &lt;strong&gt;Nautilus&lt;/strong&gt;, а приложения, доступные для установки лучше искать в &lt;strong&gt;Software Center&lt;/strong&gt;,
 и самое важное выполнять онлайн поиск лучше в браузере. А вот установленные приложения вполне удобно искать в &lt;strong&gt;Dash&lt;/strong&gt;.
Скрипт ниже выключает онлайн поиск и все линзы, кроме установленных приложений.&lt;/p&gt;
&lt;p&gt;Код скрипта &lt;code&gt;disable_all_scopes_enable_listed.sh&lt;/code&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="ch"&gt;#!/bin/sh&lt;/span&gt;

&lt;span class="o"&gt;[&lt;/span&gt; &lt;span class="k"&gt;$(&lt;/span&gt;id -u&lt;span class="k"&gt;)&lt;/span&gt; -eq &lt;span class="m"&gt;0&lt;/span&gt; &lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;Please run from NOT root user!&amp;#39;&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class="nb"&gt;exit&lt;/span&gt; &lt;span class="m"&gt;1&lt;/span&gt;

&lt;span class="c1"&gt;# Delete unwanted packages.&lt;/span&gt;
sudo apt-get purge -y unity-lens-shopping unity-lens-friends unity-scope-video-remote unity-lens-music unity-lens-photos unity-webapps-common

&lt;span class="c1"&gt;# Disable online search.&lt;/span&gt;
gsettings &lt;span class="nb"&gt;set&lt;/span&gt; com.canonical.Unity.Lenses remote-content-search none

&lt;span class="c1"&gt;# Manually remove the link from dash.&lt;/span&gt;
sudo rm /usr/share/applications/ubuntu-amazon-default.desktop

get_application&lt;span class="o"&gt;()&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt;
 find /usr/share/unity/scopes/ &lt;span class="se"&gt;\(&lt;/span&gt; &lt;span class="se"&gt;\&lt;/span&gt;
   -name &lt;span class="s2"&gt;&amp;quot;*.scope&amp;quot;&lt;/span&gt; &lt;span class="se"&gt;\&lt;/span&gt;
   -not -name &lt;span class="s1"&gt;&amp;#39;applications.scope&amp;#39;&lt;/span&gt; &lt;span class="se"&gt;\&lt;/span&gt;
  &lt;span class="se"&gt;\)&lt;/span&gt; -printf &lt;span class="s2"&gt;&amp;quot;&amp;#39;%P&amp;#39;,&amp;quot;&lt;/span&gt; &lt;span class="p"&gt;|&lt;/span&gt; sed &lt;span class="s1"&gt;&amp;#39;s/\//-/g;s/,$//&amp;#39;&lt;/span&gt;
&lt;span class="o"&gt;}&lt;/span&gt;

&lt;span class="c1"&gt;# Disabling the scopes.&lt;/span&gt;
gsettings &lt;span class="nb"&gt;set&lt;/span&gt; com.canonical.Unity.Lenses disabled-scopes &lt;span class="s2"&gt;&amp;quot;[&lt;/span&gt;&lt;span class="k"&gt;$(&lt;/span&gt;get_application&lt;span class="k"&gt;)&lt;/span&gt;&lt;span class="s2"&gt;]&amp;quot;&lt;/span&gt;
gsettings get com.canonical.Unity.Lenses disabled-scopes

gsettings &lt;span class="nb"&gt;set&lt;/span&gt; com.canonical.Unity.Lenses always-search &lt;span class="s2"&gt;&amp;quot;[&amp;#39;applications.scope&amp;#39;]&amp;quot;&lt;/span&gt;
gsettings &lt;span class="nb"&gt;set&lt;/span&gt; com.canonical.Unity.Dash scopes &lt;span class="s2"&gt;&amp;quot;[&amp;#39;home.scope&amp;#39;, &amp;#39;applications.scope&amp;#39;]&amp;quot;&lt;/span&gt;

&lt;span class="c1"&gt;# Disable available apps.&lt;/span&gt;
gsettings &lt;span class="nb"&gt;set&lt;/span&gt; com.canonical.Unity.ApplicationsLens display-available-apps &lt;span class="s2"&gt;&amp;quot;false&amp;quot;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Посмотреть что еще можно покрутить в &lt;strong&gt;Unity&lt;/strong&gt; на свой вкус можно простой командой:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;gsettings list-recursively &lt;span class="p"&gt;|&lt;/span&gt; grep Unity
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Названия опций и их значения вполне интуитивно понятные, можно быстро разобраться что к чему.&lt;/p&gt;
&lt;p&gt;Например отключить показ доступных приложений:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;gsettings &lt;span class="nb"&gt;set&lt;/span&gt; com.canonical.Unity.ApplicationsLens display-available-apps &lt;span class="s2"&gt;&amp;quot;false&amp;quot;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Проверить результат можно так:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;gsettings get com.canonical.Unity.ApplicationsLens display-available-apps
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Сбросить настройки на дефолт можно например так:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;gsettings reset-recursively com.canonical.Unity.Dash
&lt;/pre&gt;&lt;/div&gt;


&lt;hr&gt;
&lt;p&gt;Ссылки по теме:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href="http://askubuntu.com/questions/192269/how-can-i-remove-amazon-search-results-from-the-dash-or-disable-the-feature"&gt;How can I remove Amazon search results from the dash or disable the feature?&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://www.helplinux.ru/wiki/en:kb:make-ubuntu-safe"&gt;Remove unsafe packages from Ubuntu&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;</content><category term="Ubuntu"></category><category term="Linux"></category><category term="Dash"></category><category term="Unity"></category></entry><entry><title>Восстановление Seagate 1Tb ST31000528AS 7200.12</title><link href="https://metajiji.github.io/blog/seagate-1tb-st31000528as-720012/" rel="alternate"></link><published>2015-07-03T00:00:00+06:00</published><updated>2015-07-03T00:00:00+06:00</updated><author><name>Denis Kadyshev</name></author><id>tag:metajiji.github.io,2015-07-03:/blog/seagate-1tb-st31000528as-720012/</id><summary type="html">&lt;p&gt;Перестал определяться в BIOS &lt;strong&gt;ST31000528AS&lt;/strong&gt; (&lt;code&gt;CC35&lt;/code&gt;) &lt;code&gt;7200.12&lt;/code&gt;, первое что подумал - 1Tb данных пропал безвозвратно, но погуглив, понял, что не все так плохо,
 как кажется и решил побороться за данные и &lt;strong&gt;HDD&lt;/strong&gt;, и так, подключаемся к &lt;strong&gt;HDD&lt;/strong&gt; через &lt;strong&gt;serial терминал&lt;/strong&gt;.&lt;/p&gt;
&lt;p&gt;&lt;img alt="HDD Serial port" class="mfp-image center-block" src="https://metajiji.github.io/blog/seagate-1tb-st31000528as-720012/07-03-2015_seagate-1tb-st31000528as-720012/1.jpg"&gt;
Для подключения использовал &lt;strong&gt;FTDI232&lt;/strong&gt;, в распоряжении был еще &lt;strong&gt;BusPirate&lt;/strong&gt;, но …&lt;/p&gt;</summary><content type="html">&lt;p&gt;Перестал определяться в BIOS &lt;strong&gt;ST31000528AS&lt;/strong&gt; (&lt;code&gt;CC35&lt;/code&gt;) &lt;code&gt;7200.12&lt;/code&gt;, первое что подумал - 1Tb данных пропал безвозвратно, но погуглив, понял, что не все так плохо,
 как кажется и решил побороться за данные и &lt;strong&gt;HDD&lt;/strong&gt;, и так, подключаемся к &lt;strong&gt;HDD&lt;/strong&gt; через &lt;strong&gt;serial терминал&lt;/strong&gt;.&lt;/p&gt;
&lt;p&gt;&lt;img alt="HDD Serial port" class="mfp-image center-block" src="https://metajiji.github.io/blog/seagate-1tb-st31000528as-720012/07-03-2015_seagate-1tb-st31000528as-720012/1.jpg"&gt;
Для подключения использовал &lt;strong&gt;FTDI232&lt;/strong&gt;, в распоряжении был еще &lt;strong&gt;BusPirate&lt;/strong&gt;, но до него дело не дошло, &lt;strong&gt;FTDI232&lt;/strong&gt; справился отлично.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="c1"&gt;# screen /dev/ttyUSB0 38400&lt;/span&gt;
Rst 0x20M
ASCII Diag mode

F3 T&amp;gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Как видно, тут что-то не так &lt;code&gt;Rst 0x20M&lt;/code&gt; - происходит сброс, зайдем в терминал нажатием &lt;kbd&gt;Ctrl+z&lt;/kbd&gt; и попробуем проверить работу электроники и механики путём отключения/включения шпинделя:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;F3 F&amp;gt;Z
Spin Down Complete
Elapsed Time &lt;span class="m"&gt;513&lt;/span&gt;.285 msecs 
F3 F&amp;gt;U
 HighPowerMode 
ExecuteSpinRequest

Spin Up Complete
Elapsed Time &lt;span class="m"&gt;5&lt;/span&gt;.776 secs 
F3 F&amp;gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Ошибок не было, значит с большей долей вероятности все живое и функционирует, поиск по интернету показал,
 что проблема в &lt;strong&gt;SMART&lt;/strong&gt; данных (они хранятся на пластинах диска) - можно попробовать сбросить &lt;strong&gt;SMART&lt;/strong&gt; данные:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;F3 T&amp;gt;/1
F3 &lt;span class="m"&gt;1&lt;/span&gt;&amp;gt;N1
Init SMART Fail
LED:000000CC FAddr:0024EE41
LED:000000CC FAddr:0024EE41
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;А вот и ошибки, опять же поиск подсказывает, что необходимо форматировать пользовательскую зону с сертификацией, без записи, используя &lt;code&gt;Slip(V1)&lt;/code&gt;-лист, т.е. пересчитать транслятор,
 пробуем, для этого я отключил кабель питания &lt;strong&gt;HDD&lt;/strong&gt;, дождался остановки шпинделя (почему-то я не отключил его) и включил снова:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="c1"&gt;# screen /dev/ttyUSB0 38400&lt;/span&gt;
Rst 0x20M
ASCII Diag mode

F3 T&amp;gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Снова зашел в терминал диска нажатием &lt;kbd&gt;Ctrl+z&lt;/kbd&gt; и попробовал пересчитать транслятор, как рекомендуют на форуме:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;F3 T&amp;gt;V4
Reassigned Sectors List
Original     New    log log   log     phy     phy
    LBA      PBA    cyl  hd  sctr zn  cyl hd  sctr     SFI

         Alt   Pending  Total    Alted  Total
       Entries Entries Entries    Alts   Alts
Head &lt;span class="m"&gt;0&lt;/span&gt;              &lt;span class="m"&gt;0&lt;/span&gt;
Head &lt;span class="m"&gt;1&lt;/span&gt;              &lt;span class="m"&gt;0&lt;/span&gt;
Head &lt;span class="m"&gt;2&lt;/span&gt;              &lt;span class="m"&gt;0&lt;/span&gt;
Head &lt;span class="m"&gt;3&lt;/span&gt;              &lt;span class="m"&gt;0&lt;/span&gt;
Total        &lt;span class="m"&gt;0&lt;/span&gt;      &lt;span class="m"&gt;0&lt;/span&gt;       &lt;span class="m"&gt;0&lt;/span&gt;        &lt;span class="m"&gt;0&lt;/span&gt;      &lt;span class="m"&gt;0&lt;/span&gt;
Total Alt Removals:    &lt;span class="m"&gt;0&lt;/span&gt;
&lt;span class="nv"&gt;Checksum&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="m"&gt;0000&lt;/span&gt;

F3 T&amp;gt;V1
 User Slip Defect List
                         log log   log     phys   phys
    LBA    span   cumm   cyl  hd  sctr zn   cyl   sctr     SFI      PBA
       &lt;span class="m"&gt;0&lt;/span&gt;      &lt;span class="m"&gt;0&lt;/span&gt;      &lt;span class="m"&gt;0&lt;/span&gt;     &lt;span class="m"&gt;0&lt;/span&gt;  &lt;span class="m"&gt;0&lt;/span&gt;     &lt;span class="m"&gt;0&lt;/span&gt;   &lt;span class="m"&gt;0&lt;/span&gt;      &lt;span class="m"&gt;0&lt;/span&gt;     &lt;span class="m"&gt;0&lt;/span&gt;        &lt;span class="m"&gt;4&lt;/span&gt;        &lt;span class="m"&gt;0&lt;/span&gt;

Head &lt;span class="m"&gt;0&lt;/span&gt;: entries      &lt;span class="m"&gt;1&lt;/span&gt;        slips        &lt;span class="m"&gt;0&lt;/span&gt;
Head &lt;span class="m"&gt;1&lt;/span&gt;: entries      &lt;span class="m"&gt;0&lt;/span&gt;        slips        &lt;span class="m"&gt;0&lt;/span&gt;
Head &lt;span class="m"&gt;2&lt;/span&gt;: entries      &lt;span class="m"&gt;0&lt;/span&gt;        slips        &lt;span class="m"&gt;0&lt;/span&gt;
Head &lt;span class="m"&gt;3&lt;/span&gt;: entries      &lt;span class="m"&gt;0&lt;/span&gt;        slips        &lt;span class="m"&gt;0&lt;/span&gt;
  Total Entries      &lt;span class="m"&gt;1&lt;/span&gt;  Total Slips        &lt;span class="m"&gt;0&lt;/span&gt;

F3 T&amp;gt;m0,2,2,,,,,22
Max Wr &lt;span class="nv"&gt;Retries&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="m"&gt;00&lt;/span&gt;, Max Rd &lt;span class="nv"&gt;Retries&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="m"&gt;00&lt;/span&gt;, Max ECC T-Level &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="m"&gt;16&lt;/span&gt;, Max Certify Rewrite &lt;span class="nv"&gt;Retries&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; 2DF8

User Partition Format Successful - Elapsed Time &lt;span class="m"&gt;0&lt;/span&gt; mins &lt;span class="m"&gt;00&lt;/span&gt; secs
Zone re-format was skipped.
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Ошибок не было, все прошло успешно, теперь необходимо обязательно отключить питание &lt;strong&gt;HDD&lt;/strong&gt; и можно пробовать подключать &lt;strong&gt;SATA&lt;/strong&gt; кабель и проверять данные!&lt;/p&gt;
&lt;p&gt;Итак, после включения диск определился в &lt;strong&gt;BIOS&lt;/strong&gt;, после загрузки ос я увидел все свои данные в целости и сохранности, на всякий случай скопировал оттуда фотографии и видео на другой диск.&lt;/p&gt;
&lt;p&gt;У меня был еще такой же диск, но с прошивкой поновее &lt;code&gt;CC38&lt;/code&gt;, поэтому я решил обновить её, делается это не так сложно,
 на &lt;a href="http://knowledge.seagate.com/articles/en_US/FAQ/213891en" title="Barracuda 7200.12 Firmware Update"&gt;сайте производителя [2]&lt;/a&gt; есть необходимый софт,
 мне очень подошел вариант с &lt;strong&gt;iso&lt;/strong&gt; образом - я загрузился по сети &lt;strong&gt;pxeboot&lt;/strong&gt; и произвел процедуру обновления, она не сложная.&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;Ссылки по теме:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href="http://ab57.ru/hdd.html"&gt;Восстановление работоспособности жесткого диска&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://knowledge.seagate.com/articles/en_US/FAQ/213891en" title="Barracuda 7200.12 Firmware Update"&gt;Barracuda 7200.12 Firmware Update&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://www.ihdd.ru/forum/viewtopic.php?t=8998"&gt;Maxtor DiamondMax 23 STM3500418AS не определяется в BIOS&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://xakep.ru/2014/11/02/exstence-standart-harddisk/"&gt;Расширяем стандартные возможности жесткого диска&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;</content><category term="HDD"></category><category term="Seagate"></category><category term="Recovery"></category><category term="Serial"></category><category term="7200.12"></category></entry><entry><title>Ubuntu 14.04 Rhythmbox перестал реагировать на кнопки в indicator-sound</title><link href="https://metajiji.github.io/blog/ubuntu-1404-rhythmbox-indicator-sound/" rel="alternate"></link><published>2015-06-15T00:00:00+06:00</published><updated>2015-06-15T00:00:00+06:00</updated><author><name>Denis Kadyshev</name></author><id>tag:metajiji.github.io,2015-06-15:/blog/ubuntu-1404-rhythmbox-indicator-sound/</id><summary type="html">&lt;p&gt;Столкнулся с проблемой, перестал работать индикатор звука в &lt;strong&gt;Ubuntu 14.04&lt;/strong&gt;, а именно кнопка &lt;strong&gt;Play/Pause&lt;/strong&gt; в &lt;strong&gt;Rhythmbox&lt;/strong&gt;, поискал в интернете подобные проблемы и кое-что нашел:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;$ gdbus call --session --dest org.mpris.MediaPlayer2.rhythmbox --object-path /org/mpris/MediaPlayer2 --method org.freedesktop.DBus.Properties.GetAll &lt;span class="s1"&gt;&amp;#39;org.mpris.MediaPlayer2.Player&amp;#39;&lt;/span&gt;
Ошибка: GDBus …&lt;/pre&gt;&lt;/div&gt;</summary><content type="html">&lt;p&gt;Столкнулся с проблемой, перестал работать индикатор звука в &lt;strong&gt;Ubuntu 14.04&lt;/strong&gt;, а именно кнопка &lt;strong&gt;Play/Pause&lt;/strong&gt; в &lt;strong&gt;Rhythmbox&lt;/strong&gt;, поискал в интернете подобные проблемы и кое-что нашел:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;$ gdbus call --session --dest org.mpris.MediaPlayer2.rhythmbox --object-path /org/mpris/MediaPlayer2 --method org.freedesktop.DBus.Properties.GetAll &lt;span class="s1"&gt;&amp;#39;org.mpris.MediaPlayer2.Player&amp;#39;&lt;/span&gt;
Ошибка: GDBus.Error:org.freedesktop.DBus.Error.ServiceUnknown: The name org.mpris.MediaPlayer2.rhythmbox was not provided by any .service files
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Как оказалось, я копался в плагинах &lt;strong&gt;Rhythmbox&lt;/strong&gt; и отключил &lt;code&gt;Интерфейс MPRIS D-Bus&lt;/code&gt;, не зная для чего он, но теперь я узнал &lt;a href="https://bugs.launchpad.net/ubuntu/+source/indicator-sound/+bug/1245495" title="Rhythmbox controls and track info broken"&gt;зачем он нужен из [2]&lt;/a&gt; и включил, после чего индикатор заработал в штатном режиме.&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;Ссылки по теме:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href="http://askubuntu.com/questions/481713/vlc-sound-menu-integration-broken-14-04"&gt;vlc sound menu integration broken 14.04&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://bugs.launchpad.net/ubuntu/+source/indicator-sound/+bug/1245495" title="Rhythmbox controls and track info broken"&gt;Rhythmbox controls and track info broken&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;</content><category term="Ubuntu"></category><category term="Linux"></category><category term="Rhythmbox"></category><category term="D-Bus"></category><category term="indicator-sound"></category></entry><entry><title>zabbix: мониторинг nginx status</title><link href="https://metajiji.github.io/blog/zabbix-nginx-status/" rel="alternate"></link><published>2015-05-31T00:00:00+06:00</published><updated>2015-05-31T00:00:00+06:00</updated><author><name>Denis Kadyshev</name></author><id>tag:metajiji.github.io,2015-05-31:/blog/zabbix-nginx-status/</id><summary type="html">&lt;p&gt;Скрипты и файлы конфигурации для мониторинга состояния &lt;strong&gt;Nginx&lt;/strong&gt;.&lt;/p&gt;
&lt;p&gt;Шаблон для &lt;strong&gt;Zabbix 2.2&lt;/strong&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="cp"&gt;&amp;lt;?xml version=&amp;quot;1.0&amp;quot; encoding=&amp;quot;UTF-8&amp;quot;?&amp;gt;&lt;/span&gt;
&lt;span class="nt"&gt;&amp;lt;zabbix_export&amp;gt;&lt;/span&gt;
    &lt;span class="nt"&gt;&amp;lt;version&amp;gt;&lt;/span&gt;2.0&lt;span class="nt"&gt;&amp;lt;/version&amp;gt;&lt;/span&gt;
    &lt;span class="nt"&gt;&amp;lt;date&amp;gt;&lt;/span&gt;2015-11-07T18:31:03Z&lt;span class="nt"&gt;&amp;lt;/date&amp;gt;&lt;/span&gt;
    &lt;span class="nt"&gt;&amp;lt;groups&amp;gt;&lt;/span&gt;
        &lt;span class="nt"&gt;&amp;lt;group&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;name&amp;gt;&lt;/span&gt;Templates&lt;span class="nt"&gt;&amp;lt;/name&amp;gt;&lt;/span&gt;
        &lt;span class="nt"&gt;&amp;lt;/group&amp;gt;&lt;/span&gt;
    &lt;span class="nt"&gt;&amp;lt;/groups&amp;gt;&lt;/span&gt;
    &lt;span class="nt"&gt;&amp;lt;templates&amp;gt;&lt;/span&gt;
        &lt;span class="nt"&gt;&amp;lt;template&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;template&amp;gt;&lt;/span&gt;Template App nginx&lt;span class="nt"&gt;&amp;lt;/template&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;name&amp;gt;&lt;/span&gt;Template App nginx&lt;span class="nt"&gt;&amp;lt;/name&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;groups&amp;gt;&lt;/span&gt;
                &lt;span class="nt"&gt;&amp;lt;group …&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;</summary><content type="html">&lt;p&gt;Скрипты и файлы конфигурации для мониторинга состояния &lt;strong&gt;Nginx&lt;/strong&gt;.&lt;/p&gt;
&lt;p&gt;Шаблон для &lt;strong&gt;Zabbix 2.2&lt;/strong&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="cp"&gt;&amp;lt;?xml version=&amp;quot;1.0&amp;quot; encoding=&amp;quot;UTF-8&amp;quot;?&amp;gt;&lt;/span&gt;
&lt;span class="nt"&gt;&amp;lt;zabbix_export&amp;gt;&lt;/span&gt;
    &lt;span class="nt"&gt;&amp;lt;version&amp;gt;&lt;/span&gt;2.0&lt;span class="nt"&gt;&amp;lt;/version&amp;gt;&lt;/span&gt;
    &lt;span class="nt"&gt;&amp;lt;date&amp;gt;&lt;/span&gt;2015-11-07T18:31:03Z&lt;span class="nt"&gt;&amp;lt;/date&amp;gt;&lt;/span&gt;
    &lt;span class="nt"&gt;&amp;lt;groups&amp;gt;&lt;/span&gt;
        &lt;span class="nt"&gt;&amp;lt;group&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;name&amp;gt;&lt;/span&gt;Templates&lt;span class="nt"&gt;&amp;lt;/name&amp;gt;&lt;/span&gt;
        &lt;span class="nt"&gt;&amp;lt;/group&amp;gt;&lt;/span&gt;
    &lt;span class="nt"&gt;&amp;lt;/groups&amp;gt;&lt;/span&gt;
    &lt;span class="nt"&gt;&amp;lt;templates&amp;gt;&lt;/span&gt;
        &lt;span class="nt"&gt;&amp;lt;template&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;template&amp;gt;&lt;/span&gt;Template App nginx&lt;span class="nt"&gt;&amp;lt;/template&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;name&amp;gt;&lt;/span&gt;Template App nginx&lt;span class="nt"&gt;&amp;lt;/name&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;groups&amp;gt;&lt;/span&gt;
                &lt;span class="nt"&gt;&amp;lt;group&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;name&amp;gt;&lt;/span&gt;Templates&lt;span class="nt"&gt;&amp;lt;/name&amp;gt;&lt;/span&gt;
                &lt;span class="nt"&gt;&amp;lt;/group&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;/groups&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;applications&amp;gt;&lt;/span&gt;
                &lt;span class="nt"&gt;&amp;lt;application&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;name&amp;gt;&lt;/span&gt;App nginx&lt;span class="nt"&gt;&amp;lt;/name&amp;gt;&lt;/span&gt;
                &lt;span class="nt"&gt;&amp;lt;/application&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;/applications&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;items&amp;gt;&lt;/span&gt;
                &lt;span class="nt"&gt;&amp;lt;item&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;name&amp;gt;&lt;/span&gt;Nginx accepts per second&lt;span class="nt"&gt;&amp;lt;/name&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;type&amp;gt;&lt;/span&gt;2&lt;span class="nt"&gt;&amp;lt;/type&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmp_community/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;multiplier&amp;gt;&lt;/span&gt;1&lt;span class="nt"&gt;&amp;lt;/multiplier&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmp_oid/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;key&amp;gt;&lt;/span&gt;nginx.accepts&lt;span class="nt"&gt;&amp;lt;/key&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;delay&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/delay&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;history&amp;gt;&lt;/span&gt;90&lt;span class="nt"&gt;&amp;lt;/history&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;trends&amp;gt;&lt;/span&gt;365&lt;span class="nt"&gt;&amp;lt;/trends&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;status&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/status&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;value_type&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/value_type&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;allowed_hosts/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;units&amp;gt;&lt;/span&gt;r/s&lt;span class="nt"&gt;&amp;lt;/units&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;delta&amp;gt;&lt;/span&gt;1&lt;span class="nt"&gt;&amp;lt;/delta&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_contextname/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_securityname/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_securitylevel&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/snmpv3_securitylevel&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_authprotocol&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/snmpv3_authprotocol&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_authpassphrase/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_privprotocol&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/snmpv3_privprotocol&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_privpassphrase/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;formula&amp;gt;&lt;/span&gt;1&lt;span class="nt"&gt;&amp;lt;/formula&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;delay_flex/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;params/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;ipmi_sensor/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;data_type&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/data_type&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;authtype&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/authtype&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;username/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;password/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;publickey/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;privatekey/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;port/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;description/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;inventory_link&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/inventory_link&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;applications&amp;gt;&lt;/span&gt;
                        &lt;span class="nt"&gt;&amp;lt;application&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;name&amp;gt;&lt;/span&gt;App nginx&lt;span class="nt"&gt;&amp;lt;/name&amp;gt;&lt;/span&gt;
                        &lt;span class="nt"&gt;&amp;lt;/application&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;/applications&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;valuemap/&amp;gt;&lt;/span&gt;
                &lt;span class="nt"&gt;&amp;lt;/item&amp;gt;&lt;/span&gt;
                &lt;span class="nt"&gt;&amp;lt;item&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;name&amp;gt;&lt;/span&gt;Nginx active connections&lt;span class="nt"&gt;&amp;lt;/name&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;type&amp;gt;&lt;/span&gt;2&lt;span class="nt"&gt;&amp;lt;/type&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmp_community/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;multiplier&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/multiplier&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmp_oid/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;key&amp;gt;&lt;/span&gt;nginx.connections.active&lt;span class="nt"&gt;&amp;lt;/key&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;delay&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/delay&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;history&amp;gt;&lt;/span&gt;90&lt;span class="nt"&gt;&amp;lt;/history&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;trends&amp;gt;&lt;/span&gt;365&lt;span class="nt"&gt;&amp;lt;/trends&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;status&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/status&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;value_type&amp;gt;&lt;/span&gt;3&lt;span class="nt"&gt;&amp;lt;/value_type&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;allowed_hosts/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;units/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;delta&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/delta&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_contextname/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_securityname/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_securitylevel&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/snmpv3_securitylevel&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_authprotocol&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/snmpv3_authprotocol&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_authpassphrase/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_privprotocol&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/snmpv3_privprotocol&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_privpassphrase/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;formula&amp;gt;&lt;/span&gt;1&lt;span class="nt"&gt;&amp;lt;/formula&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;delay_flex/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;params/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;ipmi_sensor/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;data_type&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/data_type&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;authtype&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/authtype&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;username/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;password/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;publickey/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;privatekey/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;port/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;description/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;inventory_link&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/inventory_link&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;applications&amp;gt;&lt;/span&gt;
                        &lt;span class="nt"&gt;&amp;lt;application&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;name&amp;gt;&lt;/span&gt;App nginx&lt;span class="nt"&gt;&amp;lt;/name&amp;gt;&lt;/span&gt;
                        &lt;span class="nt"&gt;&amp;lt;/application&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;/applications&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;valuemap/&amp;gt;&lt;/span&gt;
                &lt;span class="nt"&gt;&amp;lt;/item&amp;gt;&lt;/span&gt;
                &lt;span class="nt"&gt;&amp;lt;item&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;name&amp;gt;&lt;/span&gt;Nginx handled per second&lt;span class="nt"&gt;&amp;lt;/name&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;type&amp;gt;&lt;/span&gt;2&lt;span class="nt"&gt;&amp;lt;/type&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmp_community/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;multiplier&amp;gt;&lt;/span&gt;1&lt;span class="nt"&gt;&amp;lt;/multiplier&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmp_oid/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;key&amp;gt;&lt;/span&gt;nginx.handled&lt;span class="nt"&gt;&amp;lt;/key&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;delay&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/delay&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;history&amp;gt;&lt;/span&gt;90&lt;span class="nt"&gt;&amp;lt;/history&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;trends&amp;gt;&lt;/span&gt;365&lt;span class="nt"&gt;&amp;lt;/trends&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;status&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/status&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;value_type&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/value_type&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;allowed_hosts/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;units&amp;gt;&lt;/span&gt;r/s&lt;span class="nt"&gt;&amp;lt;/units&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;delta&amp;gt;&lt;/span&gt;1&lt;span class="nt"&gt;&amp;lt;/delta&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_contextname/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_securityname/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_securitylevel&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/snmpv3_securitylevel&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_authprotocol&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/snmpv3_authprotocol&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_authpassphrase/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_privprotocol&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/snmpv3_privprotocol&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_privpassphrase/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;formula&amp;gt;&lt;/span&gt;1&lt;span class="nt"&gt;&amp;lt;/formula&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;delay_flex/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;params/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;ipmi_sensor/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;data_type&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/data_type&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;authtype&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/authtype&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;username/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;password/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;publickey/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;privatekey/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;port/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;description/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;inventory_link&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/inventory_link&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;applications&amp;gt;&lt;/span&gt;
                        &lt;span class="nt"&gt;&amp;lt;application&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;name&amp;gt;&lt;/span&gt;App nginx&lt;span class="nt"&gt;&amp;lt;/name&amp;gt;&lt;/span&gt;
                        &lt;span class="nt"&gt;&amp;lt;/application&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;/applications&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;valuemap/&amp;gt;&lt;/span&gt;
                &lt;span class="nt"&gt;&amp;lt;/item&amp;gt;&lt;/span&gt;
                &lt;span class="nt"&gt;&amp;lt;item&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;name&amp;gt;&lt;/span&gt;Nginx latency&lt;span class="nt"&gt;&amp;lt;/name&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;type&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/type&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmp_community/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;multiplier&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/multiplier&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmp_oid/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;key&amp;gt;&lt;/span&gt;nginx.ping[{HOST.HOST}]&lt;span class="nt"&gt;&amp;lt;/key&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;delay&amp;gt;&lt;/span&gt;2&lt;span class="nt"&gt;&amp;lt;/delay&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;history&amp;gt;&lt;/span&gt;90&lt;span class="nt"&gt;&amp;lt;/history&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;trends&amp;gt;&lt;/span&gt;365&lt;span class="nt"&gt;&amp;lt;/trends&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;status&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/status&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;value_type&amp;gt;&lt;/span&gt;3&lt;span class="nt"&gt;&amp;lt;/value_type&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;allowed_hosts/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;units/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;delta&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/delta&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_contextname/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_securityname/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_securitylevel&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/snmpv3_securitylevel&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_authprotocol&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/snmpv3_authprotocol&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_authpassphrase/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_privprotocol&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/snmpv3_privprotocol&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_privpassphrase/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;formula&amp;gt;&lt;/span&gt;1&lt;span class="nt"&gt;&amp;lt;/formula&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;delay_flex/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;params/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;ipmi_sensor/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;data_type&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/data_type&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;authtype&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/authtype&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;username/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;password/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;publickey/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;privatekey/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;port/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;description/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;inventory_link&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/inventory_link&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;applications&amp;gt;&lt;/span&gt;
                        &lt;span class="nt"&gt;&amp;lt;application&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;name&amp;gt;&lt;/span&gt;App nginx&lt;span class="nt"&gt;&amp;lt;/name&amp;gt;&lt;/span&gt;
                        &lt;span class="nt"&gt;&amp;lt;/application&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;/applications&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;valuemap/&amp;gt;&lt;/span&gt;
                &lt;span class="nt"&gt;&amp;lt;/item&amp;gt;&lt;/span&gt;
                &lt;span class="nt"&gt;&amp;lt;item&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;name&amp;gt;&lt;/span&gt;Nginx memory allocated&lt;span class="nt"&gt;&amp;lt;/name&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;type&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/type&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmp_community/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;multiplier&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/multiplier&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmp_oid/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;key&amp;gt;&lt;/span&gt;proc.mem[nginx,nginx]&lt;span class="nt"&gt;&amp;lt;/key&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;delay&amp;gt;&lt;/span&gt;60&lt;span class="nt"&gt;&amp;lt;/delay&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;history&amp;gt;&lt;/span&gt;90&lt;span class="nt"&gt;&amp;lt;/history&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;trends&amp;gt;&lt;/span&gt;365&lt;span class="nt"&gt;&amp;lt;/trends&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;status&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/status&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;value_type&amp;gt;&lt;/span&gt;3&lt;span class="nt"&gt;&amp;lt;/value_type&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;allowed_hosts/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;units/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;delta&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/delta&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_contextname/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_securityname/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_securitylevel&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/snmpv3_securitylevel&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_authprotocol&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/snmpv3_authprotocol&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_authpassphrase/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_privprotocol&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/snmpv3_privprotocol&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_privpassphrase/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;formula&amp;gt;&lt;/span&gt;1&lt;span class="nt"&gt;&amp;lt;/formula&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;delay_flex/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;params/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;ipmi_sensor/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;data_type&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/data_type&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;authtype&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/authtype&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;username/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;password/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;publickey/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;privatekey/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;port/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;description/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;inventory_link&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/inventory_link&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;applications&amp;gt;&lt;/span&gt;
                        &lt;span class="nt"&gt;&amp;lt;application&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;name&amp;gt;&lt;/span&gt;App nginx&lt;span class="nt"&gt;&amp;lt;/name&amp;gt;&lt;/span&gt;
                        &lt;span class="nt"&gt;&amp;lt;/application&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;/applications&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;valuemap/&amp;gt;&lt;/span&gt;
                &lt;span class="nt"&gt;&amp;lt;/item&amp;gt;&lt;/span&gt;
                &lt;span class="nt"&gt;&amp;lt;item&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;name&amp;gt;&lt;/span&gt;Nginx process count&lt;span class="nt"&gt;&amp;lt;/name&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;type&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/type&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmp_community/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;multiplier&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/multiplier&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmp_oid/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;key&amp;gt;&lt;/span&gt;proc.num[nginx]&lt;span class="nt"&gt;&amp;lt;/key&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;delay&amp;gt;&lt;/span&gt;60&lt;span class="nt"&gt;&amp;lt;/delay&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;history&amp;gt;&lt;/span&gt;90&lt;span class="nt"&gt;&amp;lt;/history&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;trends&amp;gt;&lt;/span&gt;365&lt;span class="nt"&gt;&amp;lt;/trends&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;status&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/status&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;value_type&amp;gt;&lt;/span&gt;3&lt;span class="nt"&gt;&amp;lt;/value_type&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;allowed_hosts/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;units/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;delta&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/delta&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_contextname/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_securityname/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_securitylevel&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/snmpv3_securitylevel&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_authprotocol&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/snmpv3_authprotocol&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_authpassphrase/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_privprotocol&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/snmpv3_privprotocol&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_privpassphrase/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;formula&amp;gt;&lt;/span&gt;1&lt;span class="nt"&gt;&amp;lt;/formula&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;delay_flex/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;params/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;ipmi_sensor/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;data_type&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/data_type&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;authtype&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/authtype&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;username/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;password/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;publickey/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;privatekey/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;port/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;description/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;inventory_link&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/inventory_link&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;applications&amp;gt;&lt;/span&gt;
                        &lt;span class="nt"&gt;&amp;lt;application&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;name&amp;gt;&lt;/span&gt;App nginx&lt;span class="nt"&gt;&amp;lt;/name&amp;gt;&lt;/span&gt;
                        &lt;span class="nt"&gt;&amp;lt;/application&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;/applications&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;valuemap/&amp;gt;&lt;/span&gt;
                &lt;span class="nt"&gt;&amp;lt;/item&amp;gt;&lt;/span&gt;
                &lt;span class="nt"&gt;&amp;lt;item&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;name&amp;gt;&lt;/span&gt;Nginx reading state connection count&lt;span class="nt"&gt;&amp;lt;/name&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;type&amp;gt;&lt;/span&gt;2&lt;span class="nt"&gt;&amp;lt;/type&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmp_community/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;multiplier&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/multiplier&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmp_oid/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;key&amp;gt;&lt;/span&gt;nginx.connections.reading&lt;span class="nt"&gt;&amp;lt;/key&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;delay&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/delay&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;history&amp;gt;&lt;/span&gt;90&lt;span class="nt"&gt;&amp;lt;/history&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;trends&amp;gt;&lt;/span&gt;365&lt;span class="nt"&gt;&amp;lt;/trends&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;status&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/status&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;value_type&amp;gt;&lt;/span&gt;3&lt;span class="nt"&gt;&amp;lt;/value_type&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;allowed_hosts/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;units/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;delta&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/delta&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_contextname/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_securityname/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_securitylevel&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/snmpv3_securitylevel&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_authprotocol&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/snmpv3_authprotocol&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_authpassphrase/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_privprotocol&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/snmpv3_privprotocol&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_privpassphrase/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;formula&amp;gt;&lt;/span&gt;1&lt;span class="nt"&gt;&amp;lt;/formula&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;delay_flex/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;params/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;ipmi_sensor/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;data_type&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/data_type&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;authtype&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/authtype&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;username/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;password/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;publickey/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;privatekey/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;port/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;description/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;inventory_link&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/inventory_link&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;applications&amp;gt;&lt;/span&gt;
                        &lt;span class="nt"&gt;&amp;lt;application&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;name&amp;gt;&lt;/span&gt;App nginx&lt;span class="nt"&gt;&amp;lt;/name&amp;gt;&lt;/span&gt;
                        &lt;span class="nt"&gt;&amp;lt;/application&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;/applications&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;valuemap/&amp;gt;&lt;/span&gt;
                &lt;span class="nt"&gt;&amp;lt;/item&amp;gt;&lt;/span&gt;
                &lt;span class="nt"&gt;&amp;lt;item&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;name&amp;gt;&lt;/span&gt;Nginx requests per second&lt;span class="nt"&gt;&amp;lt;/name&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;type&amp;gt;&lt;/span&gt;2&lt;span class="nt"&gt;&amp;lt;/type&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmp_community/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;multiplier&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/multiplier&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmp_oid/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;key&amp;gt;&lt;/span&gt;nginx.requests&lt;span class="nt"&gt;&amp;lt;/key&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;delay&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/delay&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;history&amp;gt;&lt;/span&gt;90&lt;span class="nt"&gt;&amp;lt;/history&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;trends&amp;gt;&lt;/span&gt;365&lt;span class="nt"&gt;&amp;lt;/trends&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;status&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/status&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;value_type&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/value_type&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;allowed_hosts/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;units&amp;gt;&lt;/span&gt;r/s&lt;span class="nt"&gt;&amp;lt;/units&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;delta&amp;gt;&lt;/span&gt;1&lt;span class="nt"&gt;&amp;lt;/delta&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_contextname/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_securityname/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_securitylevel&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/snmpv3_securitylevel&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_authprotocol&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/snmpv3_authprotocol&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_authpassphrase/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_privprotocol&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/snmpv3_privprotocol&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_privpassphrase/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;formula&amp;gt;&lt;/span&gt;1&lt;span class="nt"&gt;&amp;lt;/formula&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;delay_flex/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;params/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;ipmi_sensor/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;data_type&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/data_type&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;authtype&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/authtype&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;username/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;password/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;publickey/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;privatekey/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;port/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;description/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;inventory_link&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/inventory_link&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;applications&amp;gt;&lt;/span&gt;
                        &lt;span class="nt"&gt;&amp;lt;application&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;name&amp;gt;&lt;/span&gt;App nginx&lt;span class="nt"&gt;&amp;lt;/name&amp;gt;&lt;/span&gt;
                        &lt;span class="nt"&gt;&amp;lt;/application&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;/applications&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;valuemap/&amp;gt;&lt;/span&gt;
                &lt;span class="nt"&gt;&amp;lt;/item&amp;gt;&lt;/span&gt;
                &lt;span class="nt"&gt;&amp;lt;item&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;name&amp;gt;&lt;/span&gt;Nginx waiting state connection count&lt;span class="nt"&gt;&amp;lt;/name&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;type&amp;gt;&lt;/span&gt;2&lt;span class="nt"&gt;&amp;lt;/type&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmp_community/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;multiplier&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/multiplier&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmp_oid/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;key&amp;gt;&lt;/span&gt;nginx.connections.waiting&lt;span class="nt"&gt;&amp;lt;/key&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;delay&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/delay&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;history&amp;gt;&lt;/span&gt;90&lt;span class="nt"&gt;&amp;lt;/history&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;trends&amp;gt;&lt;/span&gt;365&lt;span class="nt"&gt;&amp;lt;/trends&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;status&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/status&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;value_type&amp;gt;&lt;/span&gt;3&lt;span class="nt"&gt;&amp;lt;/value_type&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;allowed_hosts/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;units/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;delta&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/delta&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_contextname/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_securityname/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_securitylevel&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/snmpv3_securitylevel&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_authprotocol&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/snmpv3_authprotocol&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_authpassphrase/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_privprotocol&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/snmpv3_privprotocol&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_privpassphrase/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;formula&amp;gt;&lt;/span&gt;1&lt;span class="nt"&gt;&amp;lt;/formula&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;delay_flex/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;params/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;ipmi_sensor/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;data_type&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/data_type&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;authtype&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/authtype&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;username/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;password/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;publickey/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;privatekey/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;port/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;description/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;inventory_link&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/inventory_link&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;applications&amp;gt;&lt;/span&gt;
                        &lt;span class="nt"&gt;&amp;lt;application&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;name&amp;gt;&lt;/span&gt;App nginx&lt;span class="nt"&gt;&amp;lt;/name&amp;gt;&lt;/span&gt;
                        &lt;span class="nt"&gt;&amp;lt;/application&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;/applications&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;valuemap/&amp;gt;&lt;/span&gt;
                &lt;span class="nt"&gt;&amp;lt;/item&amp;gt;&lt;/span&gt;
                &lt;span class="nt"&gt;&amp;lt;item&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;name&amp;gt;&lt;/span&gt;Nginx writing state connection count&lt;span class="nt"&gt;&amp;lt;/name&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;type&amp;gt;&lt;/span&gt;2&lt;span class="nt"&gt;&amp;lt;/type&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmp_community/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;multiplier&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/multiplier&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmp_oid/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;key&amp;gt;&lt;/span&gt;nginx.connections.writing&lt;span class="nt"&gt;&amp;lt;/key&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;delay&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/delay&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;history&amp;gt;&lt;/span&gt;90&lt;span class="nt"&gt;&amp;lt;/history&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;trends&amp;gt;&lt;/span&gt;365&lt;span class="nt"&gt;&amp;lt;/trends&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;status&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/status&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;value_type&amp;gt;&lt;/span&gt;3&lt;span class="nt"&gt;&amp;lt;/value_type&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;allowed_hosts/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;units/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;delta&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/delta&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_contextname/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_securityname/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_securitylevel&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/snmpv3_securitylevel&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_authprotocol&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/snmpv3_authprotocol&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_authpassphrase/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_privprotocol&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/snmpv3_privprotocol&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_privpassphrase/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;formula&amp;gt;&lt;/span&gt;1&lt;span class="nt"&gt;&amp;lt;/formula&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;delay_flex/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;params/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;ipmi_sensor/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;data_type&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/data_type&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;authtype&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/authtype&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;username/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;password/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;publickey/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;privatekey/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;port/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;description/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;inventory_link&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/inventory_link&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;applications&amp;gt;&lt;/span&gt;
                        &lt;span class="nt"&gt;&amp;lt;application&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;name&amp;gt;&lt;/span&gt;App nginx&lt;span class="nt"&gt;&amp;lt;/name&amp;gt;&lt;/span&gt;
                        &lt;span class="nt"&gt;&amp;lt;/application&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;/applications&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;valuemap/&amp;gt;&lt;/span&gt;
                &lt;span class="nt"&gt;&amp;lt;/item&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;/items&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;discovery_rules/&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;macros/&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;templates/&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;screens/&amp;gt;&lt;/span&gt;
        &lt;span class="nt"&gt;&amp;lt;/template&amp;gt;&lt;/span&gt;
    &lt;span class="nt"&gt;&amp;lt;/templates&amp;gt;&lt;/span&gt;
    &lt;span class="nt"&gt;&amp;lt;triggers&amp;gt;&lt;/span&gt;
        &lt;span class="nt"&gt;&amp;lt;trigger&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;expression&amp;gt;&lt;/span&gt;{Template App nginx:proc.num[nginx].last(0)}=0&lt;span class="nt"&gt;&amp;lt;/expression&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;name&amp;gt;&lt;/span&gt;Nginx is down on {HOST.NAME}&lt;span class="nt"&gt;&amp;lt;/name&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;url/&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;status&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/status&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;priority&amp;gt;&lt;/span&gt;4&lt;span class="nt"&gt;&amp;lt;/priority&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;description/&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;type&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/type&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;dependencies/&amp;gt;&lt;/span&gt;
        &lt;span class="nt"&gt;&amp;lt;/trigger&amp;gt;&lt;/span&gt;
        &lt;span class="nt"&gt;&amp;lt;trigger&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;expression&amp;gt;&lt;/span&gt;{Template App nginx:nginx.ping[{HOST.HOST}].min(#10)}&lt;span class="ni"&gt;&amp;amp;gt;&lt;/span&gt;0.01&lt;span class="nt"&gt;&amp;lt;/expression&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;name&amp;gt;&lt;/span&gt;Nginx is slow to respond on {HOST.NAME}&lt;span class="nt"&gt;&amp;lt;/name&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;url/&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;status&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/status&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;priority&amp;gt;&lt;/span&gt;2&lt;span class="nt"&gt;&amp;lt;/priority&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;description/&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;type&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/type&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;dependencies/&amp;gt;&lt;/span&gt;
        &lt;span class="nt"&gt;&amp;lt;/trigger&amp;gt;&lt;/span&gt;
        &lt;span class="nt"&gt;&amp;lt;trigger&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;expression&amp;gt;&lt;/span&gt;{Template App nginx:nginx.ping[{HOST.HOST}].last()}&lt;span class="ni"&gt;&amp;amp;lt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/expression&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;name&amp;gt;&lt;/span&gt;Nginx response is invalid on {HOST.NAME}&lt;span class="nt"&gt;&amp;lt;/name&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;url/&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;status&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/status&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;priority&amp;gt;&lt;/span&gt;3&lt;span class="nt"&gt;&amp;lt;/priority&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;description&amp;gt;&lt;/span&gt;Nginx is not available via configured url&lt;span class="nt"&gt;&amp;lt;/description&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;type&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/type&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;dependencies/&amp;gt;&lt;/span&gt;
        &lt;span class="nt"&gt;&amp;lt;/trigger&amp;gt;&lt;/span&gt;
    &lt;span class="nt"&gt;&amp;lt;/triggers&amp;gt;&lt;/span&gt;
    &lt;span class="nt"&gt;&amp;lt;graphs&amp;gt;&lt;/span&gt;
        &lt;span class="nt"&gt;&amp;lt;graph&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;name&amp;gt;&lt;/span&gt;Nginx ping&lt;span class="nt"&gt;&amp;lt;/name&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;width&amp;gt;&lt;/span&gt;900&lt;span class="nt"&gt;&amp;lt;/width&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;height&amp;gt;&lt;/span&gt;200&lt;span class="nt"&gt;&amp;lt;/height&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;yaxismin&amp;gt;&lt;/span&gt;0.0000&lt;span class="nt"&gt;&amp;lt;/yaxismin&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;yaxismax&amp;gt;&lt;/span&gt;100.0000&lt;span class="nt"&gt;&amp;lt;/yaxismax&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;show_work_period&amp;gt;&lt;/span&gt;1&lt;span class="nt"&gt;&amp;lt;/show_work_period&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;show_triggers&amp;gt;&lt;/span&gt;1&lt;span class="nt"&gt;&amp;lt;/show_triggers&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;type&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/type&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;show_legend&amp;gt;&lt;/span&gt;1&lt;span class="nt"&gt;&amp;lt;/show_legend&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;show_3d&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/show_3d&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;percent_left&amp;gt;&lt;/span&gt;0.0000&lt;span class="nt"&gt;&amp;lt;/percent_left&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;percent_right&amp;gt;&lt;/span&gt;0.0000&lt;span class="nt"&gt;&amp;lt;/percent_right&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;ymin_type_1&amp;gt;&lt;/span&gt;1&lt;span class="nt"&gt;&amp;lt;/ymin_type_1&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;ymax_type_1&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/ymax_type_1&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;ymin_item_1&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/ymin_item_1&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;ymax_item_1&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/ymax_item_1&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;graph_items&amp;gt;&lt;/span&gt;
                &lt;span class="nt"&gt;&amp;lt;graph_item&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;sortorder&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/sortorder&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;drawtype&amp;gt;&lt;/span&gt;2&lt;span class="nt"&gt;&amp;lt;/drawtype&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;color&amp;gt;&lt;/span&gt;009900&lt;span class="nt"&gt;&amp;lt;/color&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;yaxisside&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/yaxisside&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;calc_fnc&amp;gt;&lt;/span&gt;2&lt;span class="nt"&gt;&amp;lt;/calc_fnc&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;type&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/type&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;item&amp;gt;&lt;/span&gt;
                        &lt;span class="nt"&gt;&amp;lt;host&amp;gt;&lt;/span&gt;Template App nginx&lt;span class="nt"&gt;&amp;lt;/host&amp;gt;&lt;/span&gt;
                        &lt;span class="nt"&gt;&amp;lt;key&amp;gt;&lt;/span&gt;nginx.ping[{HOST.HOST}]&lt;span class="nt"&gt;&amp;lt;/key&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;/item&amp;gt;&lt;/span&gt;
                &lt;span class="nt"&gt;&amp;lt;/graph_item&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;/graph_items&amp;gt;&lt;/span&gt;
        &lt;span class="nt"&gt;&amp;lt;/graph&amp;gt;&lt;/span&gt;
        &lt;span class="nt"&gt;&amp;lt;graph&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;name&amp;gt;&lt;/span&gt;Nginx status&lt;span class="nt"&gt;&amp;lt;/name&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;width&amp;gt;&lt;/span&gt;900&lt;span class="nt"&gt;&amp;lt;/width&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;height&amp;gt;&lt;/span&gt;200&lt;span class="nt"&gt;&amp;lt;/height&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;yaxismin&amp;gt;&lt;/span&gt;0.0000&lt;span class="nt"&gt;&amp;lt;/yaxismin&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;yaxismax&amp;gt;&lt;/span&gt;100.0000&lt;span class="nt"&gt;&amp;lt;/yaxismax&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;show_work_period&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/show_work_period&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;show_triggers&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/show_triggers&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;type&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/type&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;show_legend&amp;gt;&lt;/span&gt;1&lt;span class="nt"&gt;&amp;lt;/show_legend&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;show_3d&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/show_3d&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;percent_left&amp;gt;&lt;/span&gt;0.0000&lt;span class="nt"&gt;&amp;lt;/percent_left&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;percent_right&amp;gt;&lt;/span&gt;0.0000&lt;span class="nt"&gt;&amp;lt;/percent_right&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;ymin_type_1&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/ymin_type_1&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;ymax_type_1&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/ymax_type_1&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;ymin_item_1&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/ymin_item_1&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;ymax_item_1&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/ymax_item_1&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;graph_items&amp;gt;&lt;/span&gt;
                &lt;span class="nt"&gt;&amp;lt;graph_item&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;sortorder&amp;gt;&lt;/span&gt;1&lt;span class="nt"&gt;&amp;lt;/sortorder&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;drawtype&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/drawtype&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;color&amp;gt;&lt;/span&gt;FF3333&lt;span class="nt"&gt;&amp;lt;/color&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;yaxisside&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/yaxisside&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;calc_fnc&amp;gt;&lt;/span&gt;2&lt;span class="nt"&gt;&amp;lt;/calc_fnc&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;type&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/type&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;item&amp;gt;&lt;/span&gt;
                        &lt;span class="nt"&gt;&amp;lt;host&amp;gt;&lt;/span&gt;Template App nginx&lt;span class="nt"&gt;&amp;lt;/host&amp;gt;&lt;/span&gt;
                        &lt;span class="nt"&gt;&amp;lt;key&amp;gt;&lt;/span&gt;nginx.connections.writing&lt;span class="nt"&gt;&amp;lt;/key&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;/item&amp;gt;&lt;/span&gt;
                &lt;span class="nt"&gt;&amp;lt;/graph_item&amp;gt;&lt;/span&gt;
                &lt;span class="nt"&gt;&amp;lt;graph_item&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;sortorder&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/sortorder&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;drawtype&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/drawtype&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;color&amp;gt;&lt;/span&gt;009900&lt;span class="nt"&gt;&amp;lt;/color&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;yaxisside&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/yaxisside&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;calc_fnc&amp;gt;&lt;/span&gt;2&lt;span class="nt"&gt;&amp;lt;/calc_fnc&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;type&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/type&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;item&amp;gt;&lt;/span&gt;
                        &lt;span class="nt"&gt;&amp;lt;host&amp;gt;&lt;/span&gt;Template App nginx&lt;span class="nt"&gt;&amp;lt;/host&amp;gt;&lt;/span&gt;
                        &lt;span class="nt"&gt;&amp;lt;key&amp;gt;&lt;/span&gt;nginx.connections.active&lt;span class="nt"&gt;&amp;lt;/key&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;/item&amp;gt;&lt;/span&gt;
                &lt;span class="nt"&gt;&amp;lt;/graph_item&amp;gt;&lt;/span&gt;
                &lt;span class="nt"&gt;&amp;lt;graph_item&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;sortorder&amp;gt;&lt;/span&gt;3&lt;span class="nt"&gt;&amp;lt;/sortorder&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;drawtype&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/drawtype&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;color&amp;gt;&lt;/span&gt;0000FF&lt;span class="nt"&gt;&amp;lt;/color&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;yaxisside&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/yaxisside&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;calc_fnc&amp;gt;&lt;/span&gt;2&lt;span class="nt"&gt;&amp;lt;/calc_fnc&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;type&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/type&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;item&amp;gt;&lt;/span&gt;
                        &lt;span class="nt"&gt;&amp;lt;host&amp;gt;&lt;/span&gt;Template App nginx&lt;span class="nt"&gt;&amp;lt;/host&amp;gt;&lt;/span&gt;
                        &lt;span class="nt"&gt;&amp;lt;key&amp;gt;&lt;/span&gt;nginx.connections.reading&lt;span class="nt"&gt;&amp;lt;/key&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;/item&amp;gt;&lt;/span&gt;
                &lt;span class="nt"&gt;&amp;lt;/graph_item&amp;gt;&lt;/span&gt;
                &lt;span class="nt"&gt;&amp;lt;graph_item&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;sortorder&amp;gt;&lt;/span&gt;2&lt;span class="nt"&gt;&amp;lt;/sortorder&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;drawtype&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/drawtype&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;color&amp;gt;&lt;/span&gt;FF33FF&lt;span class="nt"&gt;&amp;lt;/color&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;yaxisside&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/yaxisside&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;calc_fnc&amp;gt;&lt;/span&gt;2&lt;span class="nt"&gt;&amp;lt;/calc_fnc&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;type&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/type&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;item&amp;gt;&lt;/span&gt;
                        &lt;span class="nt"&gt;&amp;lt;host&amp;gt;&lt;/span&gt;Template App nginx&lt;span class="nt"&gt;&amp;lt;/host&amp;gt;&lt;/span&gt;
                        &lt;span class="nt"&gt;&amp;lt;key&amp;gt;&lt;/span&gt;nginx.connections.waiting&lt;span class="nt"&gt;&amp;lt;/key&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;/item&amp;gt;&lt;/span&gt;
                &lt;span class="nt"&gt;&amp;lt;/graph_item&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;/graph_items&amp;gt;&lt;/span&gt;
        &lt;span class="nt"&gt;&amp;lt;/graph&amp;gt;&lt;/span&gt;
        &lt;span class="nt"&gt;&amp;lt;graph&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;name&amp;gt;&lt;/span&gt;Nginx workload&lt;span class="nt"&gt;&amp;lt;/name&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;width&amp;gt;&lt;/span&gt;900&lt;span class="nt"&gt;&amp;lt;/width&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;height&amp;gt;&lt;/span&gt;200&lt;span class="nt"&gt;&amp;lt;/height&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;yaxismin&amp;gt;&lt;/span&gt;0.0000&lt;span class="nt"&gt;&amp;lt;/yaxismin&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;yaxismax&amp;gt;&lt;/span&gt;100.0000&lt;span class="nt"&gt;&amp;lt;/yaxismax&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;show_work_period&amp;gt;&lt;/span&gt;1&lt;span class="nt"&gt;&amp;lt;/show_work_period&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;show_triggers&amp;gt;&lt;/span&gt;1&lt;span class="nt"&gt;&amp;lt;/show_triggers&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;type&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/type&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;show_legend&amp;gt;&lt;/span&gt;1&lt;span class="nt"&gt;&amp;lt;/show_legend&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;show_3d&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/show_3d&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;percent_left&amp;gt;&lt;/span&gt;0.0000&lt;span class="nt"&gt;&amp;lt;/percent_left&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;percent_right&amp;gt;&lt;/span&gt;0.0000&lt;span class="nt"&gt;&amp;lt;/percent_right&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;ymin_type_1&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/ymin_type_1&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;ymax_type_1&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/ymax_type_1&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;ymin_item_1&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/ymin_item_1&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;ymax_item_1&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/ymax_item_1&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;graph_items&amp;gt;&lt;/span&gt;
                &lt;span class="nt"&gt;&amp;lt;graph_item&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;sortorder&amp;gt;&lt;/span&gt;2&lt;span class="nt"&gt;&amp;lt;/sortorder&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;drawtype&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/drawtype&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;color&amp;gt;&lt;/span&gt;009900&lt;span class="nt"&gt;&amp;lt;/color&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;yaxisside&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/yaxisside&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;calc_fnc&amp;gt;&lt;/span&gt;2&lt;span class="nt"&gt;&amp;lt;/calc_fnc&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;type&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/type&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;item&amp;gt;&lt;/span&gt;
                        &lt;span class="nt"&gt;&amp;lt;host&amp;gt;&lt;/span&gt;Template App nginx&lt;span class="nt"&gt;&amp;lt;/host&amp;gt;&lt;/span&gt;
                        &lt;span class="nt"&gt;&amp;lt;key&amp;gt;&lt;/span&gt;nginx.accepts&lt;span class="nt"&gt;&amp;lt;/key&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;/item&amp;gt;&lt;/span&gt;
                &lt;span class="nt"&gt;&amp;lt;/graph_item&amp;gt;&lt;/span&gt;
                &lt;span class="nt"&gt;&amp;lt;graph_item&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;sortorder&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/sortorder&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;drawtype&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/drawtype&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;color&amp;gt;&lt;/span&gt;C80000&lt;span class="nt"&gt;&amp;lt;/color&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;yaxisside&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/yaxisside&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;calc_fnc&amp;gt;&lt;/span&gt;2&lt;span class="nt"&gt;&amp;lt;/calc_fnc&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;type&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/type&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;item&amp;gt;&lt;/span&gt;
                        &lt;span class="nt"&gt;&amp;lt;host&amp;gt;&lt;/span&gt;Template App nginx&lt;span class="nt"&gt;&amp;lt;/host&amp;gt;&lt;/span&gt;
                        &lt;span class="nt"&gt;&amp;lt;key&amp;gt;&lt;/span&gt;nginx.requests&lt;span class="nt"&gt;&amp;lt;/key&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;/item&amp;gt;&lt;/span&gt;
                &lt;span class="nt"&gt;&amp;lt;/graph_item&amp;gt;&lt;/span&gt;
                &lt;span class="nt"&gt;&amp;lt;graph_item&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;sortorder&amp;gt;&lt;/span&gt;1&lt;span class="nt"&gt;&amp;lt;/sortorder&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;drawtype&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/drawtype&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;color&amp;gt;&lt;/span&gt;3333FF&lt;span class="nt"&gt;&amp;lt;/color&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;yaxisside&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/yaxisside&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;calc_fnc&amp;gt;&lt;/span&gt;2&lt;span class="nt"&gt;&amp;lt;/calc_fnc&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;type&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/type&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;item&amp;gt;&lt;/span&gt;
                        &lt;span class="nt"&gt;&amp;lt;host&amp;gt;&lt;/span&gt;Template App nginx&lt;span class="nt"&gt;&amp;lt;/host&amp;gt;&lt;/span&gt;
                        &lt;span class="nt"&gt;&amp;lt;key&amp;gt;&lt;/span&gt;nginx.handled&lt;span class="nt"&gt;&amp;lt;/key&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;/item&amp;gt;&lt;/span&gt;
                &lt;span class="nt"&gt;&amp;lt;/graph_item&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;/graph_items&amp;gt;&lt;/span&gt;
        &lt;span class="nt"&gt;&amp;lt;/graph&amp;gt;&lt;/span&gt;
    &lt;span class="nt"&gt;&amp;lt;/graphs&amp;gt;&lt;/span&gt;
&lt;span class="nt"&gt;&amp;lt;/zabbix_export&amp;gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Шаблон для &lt;strong&gt;Zabbix 2.4&lt;/strong&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="cp"&gt;&amp;lt;?xml version=&amp;quot;1.0&amp;quot; encoding=&amp;quot;UTF-8&amp;quot;?&amp;gt;&lt;/span&gt;
&lt;span class="nt"&gt;&amp;lt;zabbix_export&amp;gt;&lt;/span&gt;
    &lt;span class="nt"&gt;&amp;lt;version&amp;gt;&lt;/span&gt;2.0&lt;span class="nt"&gt;&amp;lt;/version&amp;gt;&lt;/span&gt;
    &lt;span class="nt"&gt;&amp;lt;date&amp;gt;&lt;/span&gt;2015-05-31T06:58:40Z&lt;span class="nt"&gt;&amp;lt;/date&amp;gt;&lt;/span&gt;
    &lt;span class="nt"&gt;&amp;lt;groups&amp;gt;&lt;/span&gt;
        &lt;span class="nt"&gt;&amp;lt;group&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;name&amp;gt;&lt;/span&gt;Templates&lt;span class="nt"&gt;&amp;lt;/name&amp;gt;&lt;/span&gt;
        &lt;span class="nt"&gt;&amp;lt;/group&amp;gt;&lt;/span&gt;
    &lt;span class="nt"&gt;&amp;lt;/groups&amp;gt;&lt;/span&gt;
    &lt;span class="nt"&gt;&amp;lt;templates&amp;gt;&lt;/span&gt;
        &lt;span class="nt"&gt;&amp;lt;template&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;template&amp;gt;&lt;/span&gt;Template APP nginx&lt;span class="nt"&gt;&amp;lt;/template&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;name&amp;gt;&lt;/span&gt;Template APP nginx&lt;span class="nt"&gt;&amp;lt;/name&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;description/&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;groups&amp;gt;&lt;/span&gt;
                &lt;span class="nt"&gt;&amp;lt;group&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;name&amp;gt;&lt;/span&gt;Templates&lt;span class="nt"&gt;&amp;lt;/name&amp;gt;&lt;/span&gt;
                &lt;span class="nt"&gt;&amp;lt;/group&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;/groups&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;applications&amp;gt;&lt;/span&gt;
                &lt;span class="nt"&gt;&amp;lt;application&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;name&amp;gt;&lt;/span&gt;App nginx&lt;span class="nt"&gt;&amp;lt;/name&amp;gt;&lt;/span&gt;
                &lt;span class="nt"&gt;&amp;lt;/application&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;/applications&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;items&amp;gt;&lt;/span&gt;
                &lt;span class="nt"&gt;&amp;lt;item&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;name&amp;gt;&lt;/span&gt;Nginx accepts per second&lt;span class="nt"&gt;&amp;lt;/name&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;type&amp;gt;&lt;/span&gt;2&lt;span class="nt"&gt;&amp;lt;/type&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmp_community/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;multiplier&amp;gt;&lt;/span&gt;1&lt;span class="nt"&gt;&amp;lt;/multiplier&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmp_oid/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;key&amp;gt;&lt;/span&gt;nginx.accepts&lt;span class="nt"&gt;&amp;lt;/key&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;delay&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/delay&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;history&amp;gt;&lt;/span&gt;90&lt;span class="nt"&gt;&amp;lt;/history&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;trends&amp;gt;&lt;/span&gt;365&lt;span class="nt"&gt;&amp;lt;/trends&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;status&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/status&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;value_type&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/value_type&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;allowed_hosts/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;units&amp;gt;&lt;/span&gt;r/s&lt;span class="nt"&gt;&amp;lt;/units&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;delta&amp;gt;&lt;/span&gt;1&lt;span class="nt"&gt;&amp;lt;/delta&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_contextname/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_securityname/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_securitylevel&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/snmpv3_securitylevel&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_authprotocol&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/snmpv3_authprotocol&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_authpassphrase/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_privprotocol&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/snmpv3_privprotocol&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_privpassphrase/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;formula&amp;gt;&lt;/span&gt;1&lt;span class="nt"&gt;&amp;lt;/formula&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;delay_flex/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;params/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;ipmi_sensor/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;data_type&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/data_type&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;authtype&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/authtype&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;username/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;password/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;publickey/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;privatekey/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;port/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;description/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;inventory_link&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/inventory_link&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;applications&amp;gt;&lt;/span&gt;
                        &lt;span class="nt"&gt;&amp;lt;application&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;name&amp;gt;&lt;/span&gt;App nginx&lt;span class="nt"&gt;&amp;lt;/name&amp;gt;&lt;/span&gt;
                        &lt;span class="nt"&gt;&amp;lt;/application&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;/applications&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;valuemap/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;logtimefmt/&amp;gt;&lt;/span&gt;
                &lt;span class="nt"&gt;&amp;lt;/item&amp;gt;&lt;/span&gt;
                &lt;span class="nt"&gt;&amp;lt;item&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;name&amp;gt;&lt;/span&gt;Nginx active connections&lt;span class="nt"&gt;&amp;lt;/name&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;type&amp;gt;&lt;/span&gt;2&lt;span class="nt"&gt;&amp;lt;/type&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmp_community/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;multiplier&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/multiplier&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmp_oid/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;key&amp;gt;&lt;/span&gt;nginx.connections.active&lt;span class="nt"&gt;&amp;lt;/key&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;delay&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/delay&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;history&amp;gt;&lt;/span&gt;90&lt;span class="nt"&gt;&amp;lt;/history&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;trends&amp;gt;&lt;/span&gt;365&lt;span class="nt"&gt;&amp;lt;/trends&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;status&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/status&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;value_type&amp;gt;&lt;/span&gt;3&lt;span class="nt"&gt;&amp;lt;/value_type&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;allowed_hosts/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;units/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;delta&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/delta&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_contextname/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_securityname/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_securitylevel&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/snmpv3_securitylevel&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_authprotocol&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/snmpv3_authprotocol&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_authpassphrase/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_privprotocol&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/snmpv3_privprotocol&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_privpassphrase/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;formula&amp;gt;&lt;/span&gt;1&lt;span class="nt"&gt;&amp;lt;/formula&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;delay_flex/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;params/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;ipmi_sensor/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;data_type&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/data_type&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;authtype&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/authtype&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;username/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;password/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;publickey/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;privatekey/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;port/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;description/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;inventory_link&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/inventory_link&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;applications&amp;gt;&lt;/span&gt;
                        &lt;span class="nt"&gt;&amp;lt;application&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;name&amp;gt;&lt;/span&gt;App nginx&lt;span class="nt"&gt;&amp;lt;/name&amp;gt;&lt;/span&gt;
                        &lt;span class="nt"&gt;&amp;lt;/application&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;/applications&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;valuemap/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;logtimefmt/&amp;gt;&lt;/span&gt;
                &lt;span class="nt"&gt;&amp;lt;/item&amp;gt;&lt;/span&gt;
                &lt;span class="nt"&gt;&amp;lt;item&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;name&amp;gt;&lt;/span&gt;Nginx handled per second&lt;span class="nt"&gt;&amp;lt;/name&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;type&amp;gt;&lt;/span&gt;2&lt;span class="nt"&gt;&amp;lt;/type&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmp_community/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;multiplier&amp;gt;&lt;/span&gt;1&lt;span class="nt"&gt;&amp;lt;/multiplier&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmp_oid/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;key&amp;gt;&lt;/span&gt;nginx.handled&lt;span class="nt"&gt;&amp;lt;/key&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;delay&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/delay&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;history&amp;gt;&lt;/span&gt;90&lt;span class="nt"&gt;&amp;lt;/history&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;trends&amp;gt;&lt;/span&gt;365&lt;span class="nt"&gt;&amp;lt;/trends&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;status&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/status&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;value_type&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/value_type&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;allowed_hosts/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;units&amp;gt;&lt;/span&gt;r/s&lt;span class="nt"&gt;&amp;lt;/units&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;delta&amp;gt;&lt;/span&gt;1&lt;span class="nt"&gt;&amp;lt;/delta&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_contextname/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_securityname/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_securitylevel&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/snmpv3_securitylevel&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_authprotocol&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/snmpv3_authprotocol&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_authpassphrase/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_privprotocol&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/snmpv3_privprotocol&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_privpassphrase/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;formula&amp;gt;&lt;/span&gt;1&lt;span class="nt"&gt;&amp;lt;/formula&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;delay_flex/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;params/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;ipmi_sensor/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;data_type&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/data_type&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;authtype&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/authtype&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;username/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;password/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;publickey/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;privatekey/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;port/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;description/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;inventory_link&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/inventory_link&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;applications&amp;gt;&lt;/span&gt;
                        &lt;span class="nt"&gt;&amp;lt;application&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;name&amp;gt;&lt;/span&gt;App nginx&lt;span class="nt"&gt;&amp;lt;/name&amp;gt;&lt;/span&gt;
                        &lt;span class="nt"&gt;&amp;lt;/application&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;/applications&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;valuemap/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;logtimefmt/&amp;gt;&lt;/span&gt;
                &lt;span class="nt"&gt;&amp;lt;/item&amp;gt;&lt;/span&gt;
                &lt;span class="nt"&gt;&amp;lt;item&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;name&amp;gt;&lt;/span&gt;Nginx latency&lt;span class="nt"&gt;&amp;lt;/name&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;type&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/type&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmp_community/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;multiplier&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/multiplier&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmp_oid/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;key&amp;gt;&lt;/span&gt;nginx.ping[{HOST.HOST}]&lt;span class="nt"&gt;&amp;lt;/key&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;delay&amp;gt;&lt;/span&gt;60&lt;span class="nt"&gt;&amp;lt;/delay&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;history&amp;gt;&lt;/span&gt;90&lt;span class="nt"&gt;&amp;lt;/history&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;trends&amp;gt;&lt;/span&gt;365&lt;span class="nt"&gt;&amp;lt;/trends&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;status&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/status&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;value_type&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/value_type&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;allowed_hosts/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;units&amp;gt;&lt;/span&gt;s&lt;span class="nt"&gt;&amp;lt;/units&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;delta&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/delta&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_contextname/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_securityname/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_securitylevel&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/snmpv3_securitylevel&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_authprotocol&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/snmpv3_authprotocol&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_authpassphrase/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_privprotocol&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/snmpv3_privprotocol&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_privpassphrase/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;formula&amp;gt;&lt;/span&gt;1&lt;span class="nt"&gt;&amp;lt;/formula&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;delay_flex/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;params/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;ipmi_sensor/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;data_type&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/data_type&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;authtype&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/authtype&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;username/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;password/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;publickey/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;privatekey/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;port/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;description/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;inventory_link&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/inventory_link&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;applications&amp;gt;&lt;/span&gt;
                        &lt;span class="nt"&gt;&amp;lt;application&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;name&amp;gt;&lt;/span&gt;App nginx&lt;span class="nt"&gt;&amp;lt;/name&amp;gt;&lt;/span&gt;
                        &lt;span class="nt"&gt;&amp;lt;/application&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;/applications&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;valuemap/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;logtimefmt/&amp;gt;&lt;/span&gt;
                &lt;span class="nt"&gt;&amp;lt;/item&amp;gt;&lt;/span&gt;
                &lt;span class="nt"&gt;&amp;lt;item&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;name&amp;gt;&lt;/span&gt;Nginx memory allocated&lt;span class="nt"&gt;&amp;lt;/name&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;type&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/type&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmp_community/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;multiplier&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/multiplier&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmp_oid/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;key&amp;gt;&lt;/span&gt;proc.mem[nginx,nginx]&lt;span class="nt"&gt;&amp;lt;/key&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;delay&amp;gt;&lt;/span&gt;60&lt;span class="nt"&gt;&amp;lt;/delay&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;history&amp;gt;&lt;/span&gt;90&lt;span class="nt"&gt;&amp;lt;/history&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;trends&amp;gt;&lt;/span&gt;365&lt;span class="nt"&gt;&amp;lt;/trends&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;status&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/status&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;value_type&amp;gt;&lt;/span&gt;3&lt;span class="nt"&gt;&amp;lt;/value_type&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;allowed_hosts/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;units&amp;gt;&lt;/span&gt;B&lt;span class="nt"&gt;&amp;lt;/units&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;delta&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/delta&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_contextname/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_securityname/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_securitylevel&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/snmpv3_securitylevel&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_authprotocol&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/snmpv3_authprotocol&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_authpassphrase/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_privprotocol&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/snmpv3_privprotocol&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_privpassphrase/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;formula&amp;gt;&lt;/span&gt;1&lt;span class="nt"&gt;&amp;lt;/formula&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;delay_flex/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;params/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;ipmi_sensor/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;data_type&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/data_type&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;authtype&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/authtype&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;username/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;password/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;publickey/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;privatekey/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;port/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;description/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;inventory_link&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/inventory_link&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;applications&amp;gt;&lt;/span&gt;
                        &lt;span class="nt"&gt;&amp;lt;application&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;name&amp;gt;&lt;/span&gt;App nginx&lt;span class="nt"&gt;&amp;lt;/name&amp;gt;&lt;/span&gt;
                        &lt;span class="nt"&gt;&amp;lt;/application&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;/applications&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;valuemap/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;logtimefmt/&amp;gt;&lt;/span&gt;
                &lt;span class="nt"&gt;&amp;lt;/item&amp;gt;&lt;/span&gt;
                &lt;span class="nt"&gt;&amp;lt;item&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;name&amp;gt;&lt;/span&gt;Nginx process count&lt;span class="nt"&gt;&amp;lt;/name&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;type&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/type&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmp_community/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;multiplier&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/multiplier&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmp_oid/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;key&amp;gt;&lt;/span&gt;proc.num[nginx]&lt;span class="nt"&gt;&amp;lt;/key&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;delay&amp;gt;&lt;/span&gt;30&lt;span class="nt"&gt;&amp;lt;/delay&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;history&amp;gt;&lt;/span&gt;90&lt;span class="nt"&gt;&amp;lt;/history&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;trends&amp;gt;&lt;/span&gt;365&lt;span class="nt"&gt;&amp;lt;/trends&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;status&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/status&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;value_type&amp;gt;&lt;/span&gt;3&lt;span class="nt"&gt;&amp;lt;/value_type&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;allowed_hosts/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;units/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;delta&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/delta&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_contextname/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_securityname/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_securitylevel&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/snmpv3_securitylevel&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_authprotocol&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/snmpv3_authprotocol&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_authpassphrase/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_privprotocol&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/snmpv3_privprotocol&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_privpassphrase/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;formula&amp;gt;&lt;/span&gt;1&lt;span class="nt"&gt;&amp;lt;/formula&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;delay_flex/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;params/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;ipmi_sensor/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;data_type&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/data_type&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;authtype&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/authtype&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;username/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;password/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;publickey/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;privatekey/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;port/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;description/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;inventory_link&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/inventory_link&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;applications&amp;gt;&lt;/span&gt;
                        &lt;span class="nt"&gt;&amp;lt;application&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;name&amp;gt;&lt;/span&gt;App nginx&lt;span class="nt"&gt;&amp;lt;/name&amp;gt;&lt;/span&gt;
                        &lt;span class="nt"&gt;&amp;lt;/application&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;/applications&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;valuemap/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;logtimefmt/&amp;gt;&lt;/span&gt;
                &lt;span class="nt"&gt;&amp;lt;/item&amp;gt;&lt;/span&gt;
                &lt;span class="nt"&gt;&amp;lt;item&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;name&amp;gt;&lt;/span&gt;Nginx reading state connection count&lt;span class="nt"&gt;&amp;lt;/name&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;type&amp;gt;&lt;/span&gt;2&lt;span class="nt"&gt;&amp;lt;/type&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmp_community/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;multiplier&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/multiplier&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmp_oid/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;key&amp;gt;&lt;/span&gt;nginx.connections.reading&lt;span class="nt"&gt;&amp;lt;/key&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;delay&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/delay&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;history&amp;gt;&lt;/span&gt;90&lt;span class="nt"&gt;&amp;lt;/history&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;trends&amp;gt;&lt;/span&gt;365&lt;span class="nt"&gt;&amp;lt;/trends&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;status&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/status&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;value_type&amp;gt;&lt;/span&gt;3&lt;span class="nt"&gt;&amp;lt;/value_type&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;allowed_hosts/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;units/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;delta&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/delta&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_contextname/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_securityname/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_securitylevel&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/snmpv3_securitylevel&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_authprotocol&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/snmpv3_authprotocol&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_authpassphrase/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_privprotocol&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/snmpv3_privprotocol&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_privpassphrase/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;formula&amp;gt;&lt;/span&gt;1&lt;span class="nt"&gt;&amp;lt;/formula&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;delay_flex/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;params/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;ipmi_sensor/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;data_type&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/data_type&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;authtype&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/authtype&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;username/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;password/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;publickey/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;privatekey/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;port/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;description/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;inventory_link&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/inventory_link&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;applications&amp;gt;&lt;/span&gt;
                        &lt;span class="nt"&gt;&amp;lt;application&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;name&amp;gt;&lt;/span&gt;App nginx&lt;span class="nt"&gt;&amp;lt;/name&amp;gt;&lt;/span&gt;
                        &lt;span class="nt"&gt;&amp;lt;/application&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;/applications&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;valuemap/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;logtimefmt/&amp;gt;&lt;/span&gt;
                &lt;span class="nt"&gt;&amp;lt;/item&amp;gt;&lt;/span&gt;
                &lt;span class="nt"&gt;&amp;lt;item&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;name&amp;gt;&lt;/span&gt;Nginx requests per second&lt;span class="nt"&gt;&amp;lt;/name&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;type&amp;gt;&lt;/span&gt;2&lt;span class="nt"&gt;&amp;lt;/type&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmp_community/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;multiplier&amp;gt;&lt;/span&gt;1&lt;span class="nt"&gt;&amp;lt;/multiplier&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmp_oid/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;key&amp;gt;&lt;/span&gt;nginx.requests&lt;span class="nt"&gt;&amp;lt;/key&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;delay&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/delay&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;history&amp;gt;&lt;/span&gt;90&lt;span class="nt"&gt;&amp;lt;/history&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;trends&amp;gt;&lt;/span&gt;365&lt;span class="nt"&gt;&amp;lt;/trends&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;status&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/status&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;value_type&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/value_type&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;allowed_hosts/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;units&amp;gt;&lt;/span&gt;r/s&lt;span class="nt"&gt;&amp;lt;/units&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;delta&amp;gt;&lt;/span&gt;1&lt;span class="nt"&gt;&amp;lt;/delta&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_contextname/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_securityname/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_securitylevel&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/snmpv3_securitylevel&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_authprotocol&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/snmpv3_authprotocol&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_authpassphrase/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_privprotocol&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/snmpv3_privprotocol&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_privpassphrase/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;formula&amp;gt;&lt;/span&gt;1&lt;span class="nt"&gt;&amp;lt;/formula&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;delay_flex/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;params/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;ipmi_sensor/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;data_type&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/data_type&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;authtype&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/authtype&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;username/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;password/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;publickey/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;privatekey/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;port/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;description/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;inventory_link&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/inventory_link&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;applications&amp;gt;&lt;/span&gt;
                        &lt;span class="nt"&gt;&amp;lt;application&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;name&amp;gt;&lt;/span&gt;App nginx&lt;span class="nt"&gt;&amp;lt;/name&amp;gt;&lt;/span&gt;
                        &lt;span class="nt"&gt;&amp;lt;/application&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;/applications&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;valuemap/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;logtimefmt/&amp;gt;&lt;/span&gt;
                &lt;span class="nt"&gt;&amp;lt;/item&amp;gt;&lt;/span&gt;
                &lt;span class="nt"&gt;&amp;lt;item&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;name&amp;gt;&lt;/span&gt;Nginx waiting state connection count&lt;span class="nt"&gt;&amp;lt;/name&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;type&amp;gt;&lt;/span&gt;2&lt;span class="nt"&gt;&amp;lt;/type&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmp_community/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;multiplier&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/multiplier&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmp_oid/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;key&amp;gt;&lt;/span&gt;nginx.connections.waiting&lt;span class="nt"&gt;&amp;lt;/key&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;delay&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/delay&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;history&amp;gt;&lt;/span&gt;90&lt;span class="nt"&gt;&amp;lt;/history&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;trends&amp;gt;&lt;/span&gt;365&lt;span class="nt"&gt;&amp;lt;/trends&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;status&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/status&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;value_type&amp;gt;&lt;/span&gt;3&lt;span class="nt"&gt;&amp;lt;/value_type&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;allowed_hosts/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;units/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;delta&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/delta&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_contextname/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_securityname/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_securitylevel&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/snmpv3_securitylevel&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_authprotocol&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/snmpv3_authprotocol&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_authpassphrase/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_privprotocol&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/snmpv3_privprotocol&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_privpassphrase/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;formula&amp;gt;&lt;/span&gt;1&lt;span class="nt"&gt;&amp;lt;/formula&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;delay_flex/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;params/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;ipmi_sensor/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;data_type&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/data_type&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;authtype&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/authtype&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;username/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;password/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;publickey/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;privatekey/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;port/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;description/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;inventory_link&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/inventory_link&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;applications&amp;gt;&lt;/span&gt;
                        &lt;span class="nt"&gt;&amp;lt;application&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;name&amp;gt;&lt;/span&gt;App nginx&lt;span class="nt"&gt;&amp;lt;/name&amp;gt;&lt;/span&gt;
                        &lt;span class="nt"&gt;&amp;lt;/application&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;/applications&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;valuemap/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;logtimefmt/&amp;gt;&lt;/span&gt;
                &lt;span class="nt"&gt;&amp;lt;/item&amp;gt;&lt;/span&gt;
                &lt;span class="nt"&gt;&amp;lt;item&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;name&amp;gt;&lt;/span&gt;Nginx writing state connection count&lt;span class="nt"&gt;&amp;lt;/name&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;type&amp;gt;&lt;/span&gt;2&lt;span class="nt"&gt;&amp;lt;/type&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmp_community/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;multiplier&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/multiplier&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmp_oid/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;key&amp;gt;&lt;/span&gt;nginx.connections.writing&lt;span class="nt"&gt;&amp;lt;/key&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;delay&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/delay&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;history&amp;gt;&lt;/span&gt;90&lt;span class="nt"&gt;&amp;lt;/history&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;trends&amp;gt;&lt;/span&gt;365&lt;span class="nt"&gt;&amp;lt;/trends&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;status&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/status&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;value_type&amp;gt;&lt;/span&gt;3&lt;span class="nt"&gt;&amp;lt;/value_type&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;allowed_hosts/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;units/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;delta&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/delta&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_contextname/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_securityname/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_securitylevel&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/snmpv3_securitylevel&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_authprotocol&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/snmpv3_authprotocol&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_authpassphrase/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_privprotocol&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/snmpv3_privprotocol&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_privpassphrase/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;formula&amp;gt;&lt;/span&gt;1&lt;span class="nt"&gt;&amp;lt;/formula&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;delay_flex/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;params/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;ipmi_sensor/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;data_type&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/data_type&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;authtype&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/authtype&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;username/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;password/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;publickey/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;privatekey/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;port/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;description/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;inventory_link&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/inventory_link&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;applications&amp;gt;&lt;/span&gt;
                        &lt;span class="nt"&gt;&amp;lt;application&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;name&amp;gt;&lt;/span&gt;App nginx&lt;span class="nt"&gt;&amp;lt;/name&amp;gt;&lt;/span&gt;
                        &lt;span class="nt"&gt;&amp;lt;/application&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;/applications&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;valuemap/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;logtimefmt/&amp;gt;&lt;/span&gt;
                &lt;span class="nt"&gt;&amp;lt;/item&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;/items&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;discovery_rules/&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;macros/&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;templates/&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;screens/&amp;gt;&lt;/span&gt;
        &lt;span class="nt"&gt;&amp;lt;/template&amp;gt;&lt;/span&gt;
    &lt;span class="nt"&gt;&amp;lt;/templates&amp;gt;&lt;/span&gt;
    &lt;span class="nt"&gt;&amp;lt;triggers&amp;gt;&lt;/span&gt;
        &lt;span class="nt"&gt;&amp;lt;trigger&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;expression&amp;gt;&lt;/span&gt;{Template APP nginx:proc.num[nginx].last(0)}=0&lt;span class="nt"&gt;&amp;lt;/expression&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;name&amp;gt;&lt;/span&gt;Nginx is down on {HOST.NAME}&lt;span class="nt"&gt;&amp;lt;/name&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;url/&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;status&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/status&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;priority&amp;gt;&lt;/span&gt;4&lt;span class="nt"&gt;&amp;lt;/priority&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;description/&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;type&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/type&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;dependencies/&amp;gt;&lt;/span&gt;
        &lt;span class="nt"&gt;&amp;lt;/trigger&amp;gt;&lt;/span&gt;
        &lt;span class="nt"&gt;&amp;lt;trigger&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;expression&amp;gt;&lt;/span&gt;{Template APP nginx:nginx.ping[{HOST.HOST}].min(#10)}&lt;span class="ni"&gt;&amp;amp;gt;&lt;/span&gt;0.01&lt;span class="nt"&gt;&amp;lt;/expression&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;name&amp;gt;&lt;/span&gt;Nginx is slow to respond on {HOST.NAME}&lt;span class="nt"&gt;&amp;lt;/name&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;url/&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;status&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/status&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;priority&amp;gt;&lt;/span&gt;2&lt;span class="nt"&gt;&amp;lt;/priority&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;description/&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;type&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/type&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;dependencies/&amp;gt;&lt;/span&gt;
        &lt;span class="nt"&gt;&amp;lt;/trigger&amp;gt;&lt;/span&gt;
        &lt;span class="nt"&gt;&amp;lt;trigger&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;expression&amp;gt;&lt;/span&gt;{Template APP nginx:nginx.ping[{HOST.HOST}].last()}&lt;span class="ni"&gt;&amp;amp;lt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/expression&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;name&amp;gt;&lt;/span&gt;Nginx responce is invalid on {HOST.NAME}&lt;span class="nt"&gt;&amp;lt;/name&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;url/&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;status&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/status&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;priority&amp;gt;&lt;/span&gt;3&lt;span class="nt"&gt;&amp;lt;/priority&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;description&amp;gt;&lt;/span&gt;Nginx is not available via configured url&lt;span class="nt"&gt;&amp;lt;/description&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;type&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/type&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;dependencies/&amp;gt;&lt;/span&gt;
        &lt;span class="nt"&gt;&amp;lt;/trigger&amp;gt;&lt;/span&gt;
    &lt;span class="nt"&gt;&amp;lt;/triggers&amp;gt;&lt;/span&gt;
    &lt;span class="nt"&gt;&amp;lt;graphs&amp;gt;&lt;/span&gt;
        &lt;span class="nt"&gt;&amp;lt;graph&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;name&amp;gt;&lt;/span&gt;Nginx ping&lt;span class="nt"&gt;&amp;lt;/name&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;width&amp;gt;&lt;/span&gt;900&lt;span class="nt"&gt;&amp;lt;/width&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;height&amp;gt;&lt;/span&gt;200&lt;span class="nt"&gt;&amp;lt;/height&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;yaxismin&amp;gt;&lt;/span&gt;0.0000&lt;span class="nt"&gt;&amp;lt;/yaxismin&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;yaxismax&amp;gt;&lt;/span&gt;100.0000&lt;span class="nt"&gt;&amp;lt;/yaxismax&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;show_work_period&amp;gt;&lt;/span&gt;1&lt;span class="nt"&gt;&amp;lt;/show_work_period&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;show_triggers&amp;gt;&lt;/span&gt;1&lt;span class="nt"&gt;&amp;lt;/show_triggers&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;type&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/type&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;show_legend&amp;gt;&lt;/span&gt;1&lt;span class="nt"&gt;&amp;lt;/show_legend&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;show_3d&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/show_3d&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;percent_left&amp;gt;&lt;/span&gt;0.0000&lt;span class="nt"&gt;&amp;lt;/percent_left&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;percent_right&amp;gt;&lt;/span&gt;0.0000&lt;span class="nt"&gt;&amp;lt;/percent_right&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;ymin_type_1&amp;gt;&lt;/span&gt;1&lt;span class="nt"&gt;&amp;lt;/ymin_type_1&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;ymax_type_1&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/ymax_type_1&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;ymin_item_1&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/ymin_item_1&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;ymax_item_1&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/ymax_item_1&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;graph_items&amp;gt;&lt;/span&gt;
                &lt;span class="nt"&gt;&amp;lt;graph_item&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;sortorder&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/sortorder&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;drawtype&amp;gt;&lt;/span&gt;2&lt;span class="nt"&gt;&amp;lt;/drawtype&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;color&amp;gt;&lt;/span&gt;009900&lt;span class="nt"&gt;&amp;lt;/color&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;yaxisside&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/yaxisside&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;calc_fnc&amp;gt;&lt;/span&gt;2&lt;span class="nt"&gt;&amp;lt;/calc_fnc&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;type&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/type&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;item&amp;gt;&lt;/span&gt;
                        &lt;span class="nt"&gt;&amp;lt;host&amp;gt;&lt;/span&gt;Template APP nginx&lt;span class="nt"&gt;&amp;lt;/host&amp;gt;&lt;/span&gt;
                        &lt;span class="nt"&gt;&amp;lt;key&amp;gt;&lt;/span&gt;nginx.ping[{HOST.HOST}]&lt;span class="nt"&gt;&amp;lt;/key&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;/item&amp;gt;&lt;/span&gt;
                &lt;span class="nt"&gt;&amp;lt;/graph_item&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;/graph_items&amp;gt;&lt;/span&gt;
        &lt;span class="nt"&gt;&amp;lt;/graph&amp;gt;&lt;/span&gt;
        &lt;span class="nt"&gt;&amp;lt;graph&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;name&amp;gt;&lt;/span&gt;Nginx status&lt;span class="nt"&gt;&amp;lt;/name&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;width&amp;gt;&lt;/span&gt;900&lt;span class="nt"&gt;&amp;lt;/width&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;height&amp;gt;&lt;/span&gt;200&lt;span class="nt"&gt;&amp;lt;/height&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;yaxismin&amp;gt;&lt;/span&gt;0.0000&lt;span class="nt"&gt;&amp;lt;/yaxismin&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;yaxismax&amp;gt;&lt;/span&gt;100.0000&lt;span class="nt"&gt;&amp;lt;/yaxismax&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;show_work_period&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/show_work_period&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;show_triggers&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/show_triggers&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;type&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/type&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;show_legend&amp;gt;&lt;/span&gt;1&lt;span class="nt"&gt;&amp;lt;/show_legend&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;show_3d&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/show_3d&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;percent_left&amp;gt;&lt;/span&gt;0.0000&lt;span class="nt"&gt;&amp;lt;/percent_left&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;percent_right&amp;gt;&lt;/span&gt;0.0000&lt;span class="nt"&gt;&amp;lt;/percent_right&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;ymin_type_1&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/ymin_type_1&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;ymax_type_1&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/ymax_type_1&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;ymin_item_1&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/ymin_item_1&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;ymax_item_1&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/ymax_item_1&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;graph_items&amp;gt;&lt;/span&gt;
                &lt;span class="nt"&gt;&amp;lt;graph_item&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;sortorder&amp;gt;&lt;/span&gt;1&lt;span class="nt"&gt;&amp;lt;/sortorder&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;drawtype&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/drawtype&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;color&amp;gt;&lt;/span&gt;FF3333&lt;span class="nt"&gt;&amp;lt;/color&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;yaxisside&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/yaxisside&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;calc_fnc&amp;gt;&lt;/span&gt;2&lt;span class="nt"&gt;&amp;lt;/calc_fnc&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;type&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/type&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;item&amp;gt;&lt;/span&gt;
                        &lt;span class="nt"&gt;&amp;lt;host&amp;gt;&lt;/span&gt;Template APP nginx&lt;span class="nt"&gt;&amp;lt;/host&amp;gt;&lt;/span&gt;
                        &lt;span class="nt"&gt;&amp;lt;key&amp;gt;&lt;/span&gt;nginx.connections.writing&lt;span class="nt"&gt;&amp;lt;/key&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;/item&amp;gt;&lt;/span&gt;
                &lt;span class="nt"&gt;&amp;lt;/graph_item&amp;gt;&lt;/span&gt;
                &lt;span class="nt"&gt;&amp;lt;graph_item&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;sortorder&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/sortorder&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;drawtype&amp;gt;&lt;/span&gt;2&lt;span class="nt"&gt;&amp;lt;/drawtype&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;color&amp;gt;&lt;/span&gt;009900&lt;span class="nt"&gt;&amp;lt;/color&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;yaxisside&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/yaxisside&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;calc_fnc&amp;gt;&lt;/span&gt;2&lt;span class="nt"&gt;&amp;lt;/calc_fnc&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;type&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/type&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;item&amp;gt;&lt;/span&gt;
                        &lt;span class="nt"&gt;&amp;lt;host&amp;gt;&lt;/span&gt;Template APP nginx&lt;span class="nt"&gt;&amp;lt;/host&amp;gt;&lt;/span&gt;
                        &lt;span class="nt"&gt;&amp;lt;key&amp;gt;&lt;/span&gt;nginx.connections.active&lt;span class="nt"&gt;&amp;lt;/key&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;/item&amp;gt;&lt;/span&gt;
                &lt;span class="nt"&gt;&amp;lt;/graph_item&amp;gt;&lt;/span&gt;
                &lt;span class="nt"&gt;&amp;lt;graph_item&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;sortorder&amp;gt;&lt;/span&gt;2&lt;span class="nt"&gt;&amp;lt;/sortorder&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;drawtype&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/drawtype&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;color&amp;gt;&lt;/span&gt;FF33FF&lt;span class="nt"&gt;&amp;lt;/color&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;yaxisside&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/yaxisside&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;calc_fnc&amp;gt;&lt;/span&gt;2&lt;span class="nt"&gt;&amp;lt;/calc_fnc&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;type&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/type&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;item&amp;gt;&lt;/span&gt;
                        &lt;span class="nt"&gt;&amp;lt;host&amp;gt;&lt;/span&gt;Template APP nginx&lt;span class="nt"&gt;&amp;lt;/host&amp;gt;&lt;/span&gt;
                        &lt;span class="nt"&gt;&amp;lt;key&amp;gt;&lt;/span&gt;nginx.connections.waiting&lt;span class="nt"&gt;&amp;lt;/key&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;/item&amp;gt;&lt;/span&gt;
                &lt;span class="nt"&gt;&amp;lt;/graph_item&amp;gt;&lt;/span&gt;
                &lt;span class="nt"&gt;&amp;lt;graph_item&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;sortorder&amp;gt;&lt;/span&gt;3&lt;span class="nt"&gt;&amp;lt;/sortorder&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;drawtype&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/drawtype&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;color&amp;gt;&lt;/span&gt;0000FF&lt;span class="nt"&gt;&amp;lt;/color&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;yaxisside&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/yaxisside&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;calc_fnc&amp;gt;&lt;/span&gt;2&lt;span class="nt"&gt;&amp;lt;/calc_fnc&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;type&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/type&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;item&amp;gt;&lt;/span&gt;
                        &lt;span class="nt"&gt;&amp;lt;host&amp;gt;&lt;/span&gt;Template APP nginx&lt;span class="nt"&gt;&amp;lt;/host&amp;gt;&lt;/span&gt;
                        &lt;span class="nt"&gt;&amp;lt;key&amp;gt;&lt;/span&gt;nginx.connections.reading&lt;span class="nt"&gt;&amp;lt;/key&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;/item&amp;gt;&lt;/span&gt;
                &lt;span class="nt"&gt;&amp;lt;/graph_item&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;/graph_items&amp;gt;&lt;/span&gt;
        &lt;span class="nt"&gt;&amp;lt;/graph&amp;gt;&lt;/span&gt;
        &lt;span class="nt"&gt;&amp;lt;graph&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;name&amp;gt;&lt;/span&gt;Nginx workload&lt;span class="nt"&gt;&amp;lt;/name&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;width&amp;gt;&lt;/span&gt;900&lt;span class="nt"&gt;&amp;lt;/width&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;height&amp;gt;&lt;/span&gt;200&lt;span class="nt"&gt;&amp;lt;/height&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;yaxismin&amp;gt;&lt;/span&gt;0.0000&lt;span class="nt"&gt;&amp;lt;/yaxismin&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;yaxismax&amp;gt;&lt;/span&gt;100.0000&lt;span class="nt"&gt;&amp;lt;/yaxismax&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;show_work_period&amp;gt;&lt;/span&gt;1&lt;span class="nt"&gt;&amp;lt;/show_work_period&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;show_triggers&amp;gt;&lt;/span&gt;1&lt;span class="nt"&gt;&amp;lt;/show_triggers&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;type&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/type&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;show_legend&amp;gt;&lt;/span&gt;1&lt;span class="nt"&gt;&amp;lt;/show_legend&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;show_3d&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/show_3d&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;percent_left&amp;gt;&lt;/span&gt;0.0000&lt;span class="nt"&gt;&amp;lt;/percent_left&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;percent_right&amp;gt;&lt;/span&gt;0.0000&lt;span class="nt"&gt;&amp;lt;/percent_right&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;ymin_type_1&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/ymin_type_1&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;ymax_type_1&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/ymax_type_1&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;ymin_item_1&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/ymin_item_1&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;ymax_item_1&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/ymax_item_1&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;graph_items&amp;gt;&lt;/span&gt;
                &lt;span class="nt"&gt;&amp;lt;graph_item&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;sortorder&amp;gt;&lt;/span&gt;2&lt;span class="nt"&gt;&amp;lt;/sortorder&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;drawtype&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/drawtype&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;color&amp;gt;&lt;/span&gt;009900&lt;span class="nt"&gt;&amp;lt;/color&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;yaxisside&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/yaxisside&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;calc_fnc&amp;gt;&lt;/span&gt;2&lt;span class="nt"&gt;&amp;lt;/calc_fnc&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;type&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/type&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;item&amp;gt;&lt;/span&gt;
                        &lt;span class="nt"&gt;&amp;lt;host&amp;gt;&lt;/span&gt;Template APP nginx&lt;span class="nt"&gt;&amp;lt;/host&amp;gt;&lt;/span&gt;
                        &lt;span class="nt"&gt;&amp;lt;key&amp;gt;&lt;/span&gt;nginx.accepts&lt;span class="nt"&gt;&amp;lt;/key&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;/item&amp;gt;&lt;/span&gt;
                &lt;span class="nt"&gt;&amp;lt;/graph_item&amp;gt;&lt;/span&gt;
                &lt;span class="nt"&gt;&amp;lt;graph_item&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;sortorder&amp;gt;&lt;/span&gt;1&lt;span class="nt"&gt;&amp;lt;/sortorder&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;drawtype&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/drawtype&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;color&amp;gt;&lt;/span&gt;3333FF&lt;span class="nt"&gt;&amp;lt;/color&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;yaxisside&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/yaxisside&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;calc_fnc&amp;gt;&lt;/span&gt;2&lt;span class="nt"&gt;&amp;lt;/calc_fnc&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;type&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/type&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;item&amp;gt;&lt;/span&gt;
                        &lt;span class="nt"&gt;&amp;lt;host&amp;gt;&lt;/span&gt;Template APP nginx&lt;span class="nt"&gt;&amp;lt;/host&amp;gt;&lt;/span&gt;
                        &lt;span class="nt"&gt;&amp;lt;key&amp;gt;&lt;/span&gt;nginx.handled&lt;span class="nt"&gt;&amp;lt;/key&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;/item&amp;gt;&lt;/span&gt;
                &lt;span class="nt"&gt;&amp;lt;/graph_item&amp;gt;&lt;/span&gt;
                &lt;span class="nt"&gt;&amp;lt;graph_item&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;sortorder&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/sortorder&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;drawtype&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/drawtype&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;color&amp;gt;&lt;/span&gt;FF0000&lt;span class="nt"&gt;&amp;lt;/color&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;yaxisside&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/yaxisside&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;calc_fnc&amp;gt;&lt;/span&gt;2&lt;span class="nt"&gt;&amp;lt;/calc_fnc&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;type&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/type&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;item&amp;gt;&lt;/span&gt;
                        &lt;span class="nt"&gt;&amp;lt;host&amp;gt;&lt;/span&gt;Template APP nginx&lt;span class="nt"&gt;&amp;lt;/host&amp;gt;&lt;/span&gt;
                        &lt;span class="nt"&gt;&amp;lt;key&amp;gt;&lt;/span&gt;nginx.requests&lt;span class="nt"&gt;&amp;lt;/key&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;/item&amp;gt;&lt;/span&gt;
                &lt;span class="nt"&gt;&amp;lt;/graph_item&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;/graph_items&amp;gt;&lt;/span&gt;
        &lt;span class="nt"&gt;&amp;lt;/graph&amp;gt;&lt;/span&gt;
    &lt;span class="nt"&gt;&amp;lt;/graphs&amp;gt;&lt;/span&gt;
&lt;span class="nt"&gt;&amp;lt;/zabbix_export&amp;gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Для удобства установки различных нестандартных метрик для мониторинга я использую директиву &lt;code&gt;Include=/etc/zabbix/zabbix_agentd.conf.d/&lt;/code&gt; после чего можно добавлять отдельные файлы,
 в которых будут все опции, необходимые для работы необходимой метрики, в данном случае: &lt;code&gt;/etc/zabbix/zabbix_agentd.conf.d/nginx_status.conf&lt;/code&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nv"&gt;UserParameter&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;nginx.ping,sh /etc/zabbix/scripts/nginx_status.sh
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Конфигурация для &lt;strong&gt;Nginx&lt;/strong&gt; файл &lt;code&gt;nginx_status_http.conf&lt;/code&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;server&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="kn"&gt;listen&lt;/span&gt; &lt;span class="n"&gt;127.0.0.1&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;80&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="kn"&gt;server_name&lt;/span&gt; &lt;span class="s"&gt;localhost&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;

    &lt;span class="kn"&gt;keepalive_timeout&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="kn"&gt;location&lt;/span&gt; &lt;span class="p"&gt;=&lt;/span&gt; &lt;span class="s"&gt;/nginx_status&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
        &lt;span class="kn"&gt;stub_status&lt;/span&gt; &lt;span class="no"&gt;on&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
        &lt;span class="c1"&gt;#access_log off;&lt;/span&gt;

        &lt;span class="kn"&gt;allow&lt;/span&gt; &lt;span class="mi"&gt;127&lt;/span&gt;&lt;span class="s"&gt;.0.0.1&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
        &lt;span class="kn"&gt;deny&lt;/span&gt; &lt;span class="s"&gt;all&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="p"&gt;}&lt;/span&gt;

    &lt;span class="kn"&gt;access_log&lt;/span&gt; &lt;span class="s"&gt;/var/log/nginx/nginx_status_http.access.log&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="kn"&gt;error_log&lt;/span&gt; &lt;span class="s"&gt;/var/log/nginx/nginx_status_http.error.log&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Нужно положить этот конфигурационный файл nginx в &lt;code&gt;/etc/nginx/sites-available/nginx_status_http.conf&lt;/code&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;ln -s /etc/nginx/sites-available/nginx_status_http.conf /etc/nginx/sites-enabled/nginx_status_http.conf
service nginx reload
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Затем необходимо создать скрипт, который осуществляет доставку данных в &lt;strong&gt;Zabbix&lt;/strong&gt; - &lt;code&gt;/etc/zabbix/scripts/nginx_status.sh&lt;/code&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="ch"&gt;#!/bin/sh&lt;/span&gt;

&lt;span class="nv"&gt;URL&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;http://localhost/nginx_status&amp;#39;&lt;/span&gt;
&lt;span class="nv"&gt;TMP&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;/tmp/nginx-ping.tmp&amp;#39;&lt;/span&gt;
&lt;span class="nv"&gt;ZABBIX_SENDER&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;/usr/bin/env zabbix_sender&amp;#39;&lt;/span&gt;
&lt;span class="nv"&gt;CONFIG&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;/etc/zabbix/zabbix_agentd.conf&amp;#39;&lt;/span&gt;

&lt;span class="c1"&gt;# WARNING: Correctly setup &amp;#39;Hostname=&amp;#39; in config is REQUIRED!&lt;/span&gt;
&lt;span class="c1"&gt;# REQUIRED binaries: GNU time, wget, awk, zabbix_sender.&lt;/span&gt;

&lt;span class="o"&gt;(&lt;/span&gt;/usr/bin/env &lt;span class="nb"&gt;time&lt;/span&gt; -f %e /usr/bin/env wget --no-http-keep-alive --quiet --timeout &lt;span class="m"&gt;9&lt;/span&gt; -O - &lt;span class="nv"&gt;$URL&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="m"&gt;2&lt;/span&gt;&amp;gt;&lt;span class="nv"&gt;$TMP&lt;/span&gt; &lt;span class="p"&gt;|&lt;/span&gt; &lt;span class="se"&gt;\&lt;/span&gt;
awk &lt;span class="s1"&gt;&amp;#39;/Active connections/ {active=int($NF)}&lt;/span&gt;
&lt;span class="s1"&gt;    / ([0-9]+) ([0-9]+) ([0-9]+)/ {accepts=int($1); handled=int($2); requests=int($3)}&lt;/span&gt;
&lt;span class="s1"&gt;    /Reading:/ {reading=int($2); writing=int($4); waiting=int($6)}&lt;/span&gt;
&lt;span class="s1"&gt;    END {&lt;/span&gt;
&lt;span class="s1"&gt;        print &amp;quot;- nginx.connections.active&amp;quot;, active;&lt;/span&gt;
&lt;span class="s1"&gt;        print &amp;quot;- nginx.connections.reading&amp;quot;, reading;&lt;/span&gt;
&lt;span class="s1"&gt;        print &amp;quot;- nginx.connections.writing&amp;quot;, writing;&lt;/span&gt;
&lt;span class="s1"&gt;        print &amp;quot;- nginx.connections.waiting&amp;quot;, waiting;&lt;/span&gt;

&lt;span class="s1"&gt;        print &amp;quot;- nginx.accepts&amp;quot;, accepts;&lt;/span&gt;
&lt;span class="s1"&gt;        print &amp;quot;- nginx.handled&amp;quot;, handled;&lt;/span&gt;
&lt;span class="s1"&gt;        print &amp;quot;- nginx.requests&amp;quot;, requests;&lt;/span&gt;
&lt;span class="s1"&gt;    }&amp;#39;&lt;/span&gt; &lt;span class="p"&gt;|&lt;/span&gt; &lt;span class="nv"&gt;$ZABBIX_SENDER&lt;/span&gt; &lt;span class="se"&gt;\&lt;/span&gt;
        --config &lt;span class="nv"&gt;$CONFIG&lt;/span&gt; &lt;span class="se"&gt;\&lt;/span&gt;
        --input-file - &amp;gt;/dev/null &lt;span class="m"&gt;2&lt;/span&gt;&amp;gt;&lt;span class="p"&gt;&amp;amp;&lt;/span&gt;&lt;span class="m"&gt;1&lt;/span&gt;

&lt;span class="o"&gt;[&lt;/span&gt; -f &lt;span class="nv"&gt;$TMP&lt;/span&gt; &lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt; cat &lt;span class="nv"&gt;$TMP&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt; rm &lt;span class="nv"&gt;$TMP&lt;/span&gt;

&lt;span class="nb"&gt;exit&lt;/span&gt; &lt;span class="m"&gt;1&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;И сразу выставляем правильные права на скрипт:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;chmod &lt;span class="m"&gt;600&lt;/span&gt; /etc/zabbix/scripts/nginx_status.sh
chown zabbix:zabbix /etc/zabbix/scripts/nginx_status.sh
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Если каталога &lt;code&gt;/etc/zabbix/scripts&lt;/code&gt; у вас еще нет, то его нужно создать:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;mkdir /etc/zabbix/scripts
chmod &lt;span class="m"&gt;700&lt;/span&gt; /etc/zabbix/scripts
chown zabbix:zabbix /etc/zabbix/scripts
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Для корректной работы необходимо вызывать напрямую бинарный файл &lt;code&gt;/usr/bin/time&lt;/code&gt;, не путать со встроенной &lt;code&gt;bash&lt;/code&gt; функцией &lt;code&gt;time&lt;/code&gt;, в &lt;strong&gt;Linux&lt;/strong&gt; есть с этим большая,
 на мой взгляд, проблема, т.к. &lt;code&gt;bash time&lt;/code&gt; работает некорректно, в отличие от &lt;code&gt;/usr/bin/time&lt;/code&gt;, к тому же и формат ответа разный, установить можно:&lt;/p&gt;
&lt;p&gt;Для &lt;strong&gt;Ubuntu&lt;/strong&gt;, &lt;strong&gt;Debian&lt;/strong&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;apt-get install &lt;span class="nb"&gt;time&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Для CentoOS и подобных:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;yum install &lt;span class="nb"&gt;time&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Все почти готово, теперь можно зайти в панель &lt;strong&gt;Zabbix&lt;/strong&gt; и добавить нужному хосту новый шаблон &lt;strong&gt;Template APP nginx&lt;/strong&gt;.&lt;/p&gt;
&lt;hr&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href="https://github.com/METAJIJI/zabbix_nginx"&gt;Github repo:zabbix_nginx&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;</content><category term="Zabbix"></category><category term="nginx"></category><category term="status"></category><category term="stub_status"></category><category term="ngx_http_stub_status_module"></category></entry><entry><title>Просмотр Markdown в MidnightCommander</title><link href="https://metajiji.github.io/blog/markdown-midnight-commander/" rel="alternate"></link><published>2015-03-17T00:00:00+06:00</published><updated>2015-03-17T00:00:00+06:00</updated><author><name>Denis Kadyshev</name></author><id>tag:metajiji.github.io,2015-03-17:/blog/markdown-midnight-commander/</id><summary type="html">&lt;p&gt;Для просмотра &lt;strong&gt;MarkDown&lt;/strong&gt; файлов в &lt;strong&gt;Midnight Commander&lt;/strong&gt; необходимо добавить тип файлов &lt;code&gt;.md&lt;/code&gt;, для этого в файл &lt;code&gt;/etc/mc/mc.ext&lt;/code&gt; добавить следующий код:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="c1"&gt;# md&lt;/span&gt;
regex/&lt;span class="se"&gt;\.&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;Mm&lt;span class="o"&gt;][&lt;/span&gt;Dd&lt;span class="o"&gt;]&lt;/span&gt;$
    &lt;span class="nv"&gt;View&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;%view&lt;span class="o"&gt;{&lt;/span&gt;ascii,nroff&lt;span class="o"&gt;}&lt;/span&gt; iconv -t utf-8 %p &lt;span class="p"&gt;|&lt;/span&gt; pandoc -f markdown -t html &lt;span class="p"&gt;|&lt;/span&gt; iconv -f utf-8 &lt;span class="p"&gt;|&lt;/span&gt; &lt;span class="o"&gt;(&lt;/span&gt;w3m -dump -T text/html &lt;span class="m"&gt;2&lt;/span&gt;&amp;gt;/dev …&lt;/pre&gt;&lt;/div&gt;</summary><content type="html">&lt;p&gt;Для просмотра &lt;strong&gt;MarkDown&lt;/strong&gt; файлов в &lt;strong&gt;Midnight Commander&lt;/strong&gt; необходимо добавить тип файлов &lt;code&gt;.md&lt;/code&gt;, для этого в файл &lt;code&gt;/etc/mc/mc.ext&lt;/code&gt; добавить следующий код:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="c1"&gt;# md&lt;/span&gt;
regex/&lt;span class="se"&gt;\.&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;Mm&lt;span class="o"&gt;][&lt;/span&gt;Dd&lt;span class="o"&gt;]&lt;/span&gt;$
    &lt;span class="nv"&gt;View&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;%view&lt;span class="o"&gt;{&lt;/span&gt;ascii,nroff&lt;span class="o"&gt;}&lt;/span&gt; iconv -t utf-8 %p &lt;span class="p"&gt;|&lt;/span&gt; pandoc -f markdown -t html &lt;span class="p"&gt;|&lt;/span&gt; iconv -f utf-8 &lt;span class="p"&gt;|&lt;/span&gt; &lt;span class="o"&gt;(&lt;/span&gt;w3m -dump -T text/html &lt;span class="m"&gt;2&lt;/span&gt;&amp;gt;/dev/null &lt;span class="o"&gt;||&lt;/span&gt; lynx -force_html -stdin -dump -nolist &lt;span class="m"&gt;2&lt;/span&gt;&amp;gt;/dev/null&lt;span class="o"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Для конвертирования &lt;code&gt;md&lt;/code&gt; в &lt;code&gt;html&lt;/code&gt; используется утилита &lt;code&gt;pandoc&lt;/code&gt;, она мне показалась более предпочтительной, чем &lt;code&gt;markdown&lt;/code&gt;,
 т.к. последний не умел обрабатывать теги с подобным кодом &lt;code&gt;```bash&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;&lt;code&gt;pandoc&lt;/code&gt; необходимо установить, например для &lt;strong&gt;ubuntu&lt;/strong&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;apt-get install pandoc
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Если нет желания ставить &lt;code&gt;w3m&lt;/code&gt; или &lt;code&gt;lynx&lt;/code&gt; браузер, то можно воспользоваться форматом &lt;code&gt;man&lt;/code&gt; (&lt;code&gt;pandoc&lt;/code&gt; по прежнему необходим):&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="c1"&gt;# md&lt;/span&gt;
regex/&lt;span class="se"&gt;\.&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;Mm&lt;span class="o"&gt;][&lt;/span&gt;Dd&lt;span class="o"&gt;]&lt;/span&gt;$
    &lt;span class="nv"&gt;View&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;%view&lt;span class="o"&gt;{&lt;/span&gt;ascii,nroff&lt;span class="o"&gt;}&lt;/span&gt; iconv -t utf-8 %p &lt;span class="p"&gt;|&lt;/span&gt; pandoc -s -f markdown -t man &lt;span class="p"&gt;|&lt;/span&gt; iconv -f utf-8 &lt;span class="p"&gt;|&lt;/span&gt; man -l -
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;P.S. &lt;code&gt;iconv&lt;/code&gt; используется на всякий случай, если вдруг по какой-то причине у вас не &lt;strong&gt;UTF8&lt;/strong&gt; локаль, а &lt;code&gt;pandoc&lt;/code&gt; обрабатывает по умолчанию в &lt;strong&gt;UTF8&lt;/strong&gt; и результат отдает тоже в &lt;strong&gt;UTF8&lt;/strong&gt;,
 поэтому сперва конвертируем исходный текст из вашей локали в &lt;strong&gt;UTF8&lt;/strong&gt;, отдаем на обработку в &lt;code&gt;pandoc&lt;/code&gt; и конвертируем из &lt;strong&gt;UTF8&lt;/strong&gt; обратно в текущую локаль.&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;Ссылки по теме:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href="http://dillinger.io/"&gt;Online MarkDown Editor&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;</content><category term="Markdown"></category><category term="Midnight commander"></category></entry><entry><title>Zabbix: supervisord автообнаружение программ и мониторинг статуса.</title><link href="https://metajiji.github.io/blog/zabbix-supervisord/" rel="alternate"></link><published>2015-03-17T00:00:00+06:00</published><updated>2015-03-17T00:00:00+06:00</updated><author><name>Denis Kadyshev</name></author><id>tag:metajiji.github.io,2015-03-17:/blog/zabbix-supervisord/</id><summary type="html">&lt;p&gt;Скрипт поддерживает обнаружение (&lt;code&gt;discovery&lt;/code&gt;) всех программ, которые сконфигурированы для запуска.&lt;/p&gt;
&lt;p&gt;Отправка данных осуществляется через &lt;code&gt;zabbix_sender&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Установка довольно тривиальна:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;mkdir /etc/zabbix/scripts
chown root:zabbix -R /etc/zabbix/scripts
chmod &lt;span class="m"&gt;750&lt;/span&gt; /etc/zabbix/scripts
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Код скрипта &lt;code&gt;/etc/zabbix/scripts/lsimegaraid_discovery_trapper.sh&lt;/code&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="ch"&gt;#!/bin/sh&lt;/span&gt;

&lt;span class="nv"&gt;ZABBIX_SENDER&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;/usr/bin/env zabbix_sender&amp;#39;&lt;/span&gt;
&lt;span class="nv"&gt;ZBX_CONFIG&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;/etc …&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;</summary><content type="html">&lt;p&gt;Скрипт поддерживает обнаружение (&lt;code&gt;discovery&lt;/code&gt;) всех программ, которые сконфигурированы для запуска.&lt;/p&gt;
&lt;p&gt;Отправка данных осуществляется через &lt;code&gt;zabbix_sender&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Установка довольно тривиальна:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;mkdir /etc/zabbix/scripts
chown root:zabbix -R /etc/zabbix/scripts
chmod &lt;span class="m"&gt;750&lt;/span&gt; /etc/zabbix/scripts
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Код скрипта &lt;code&gt;/etc/zabbix/scripts/lsimegaraid_discovery_trapper.sh&lt;/code&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="ch"&gt;#!/bin/sh&lt;/span&gt;

&lt;span class="nv"&gt;ZABBIX_SENDER&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;/usr/bin/env zabbix_sender&amp;#39;&lt;/span&gt;
&lt;span class="nv"&gt;ZBX_CONFIG&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;/etc/zabbix/zabbix_agentd.conf&amp;#39;&lt;/span&gt;
&lt;span class="nv"&gt;ZBX_HOSTNAME&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="k"&gt;$(&lt;/span&gt;awk -F&lt;span class="s1"&gt;&amp;#39;=&amp;#39;&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;/^Hostname=/{ print $2 }&amp;#39;&lt;/span&gt; /etc/zabbix/zabbix_agentd.d/*.conf&lt;span class="k"&gt;)&lt;/span&gt;

supervisorctl status &lt;span class="p"&gt;|&lt;/span&gt; &lt;span class="se"&gt;\&lt;/span&gt;
    awk &lt;span class="s1"&gt;&amp;#39;match($0, /^([^:]+):[^[:blank:]]+[[:blank:]]+([^[:blank:]]+).*$/, line) {&lt;/span&gt;
&lt;span class="s1"&gt;        SUBSEP=&amp;quot;,&amp;quot;&lt;/span&gt;
&lt;span class="s1"&gt;        # Sadly, we can not initialize all the worker,status couples in the BEGIN section.&lt;/span&gt;
&lt;span class="s1"&gt;        # We have to run these almost useless lines during the input parsing&lt;/span&gt;
&lt;span class="s1"&gt;        if (status[line[1],&amp;quot;STOPPED&amp;quot;]  == 0) {status[line[1],&amp;quot;STOPPED&amp;quot;]  = 0}&lt;/span&gt;
&lt;span class="s1"&gt;        if (status[line[1],&amp;quot;STARTING&amp;quot;] == 0) {status[line[1],&amp;quot;STARTING&amp;quot;] = 0}&lt;/span&gt;
&lt;span class="s1"&gt;        if (status[line[1],&amp;quot;RUNNING&amp;quot;]  == 0) {status[line[1],&amp;quot;RUNNING&amp;quot;]  = 0}&lt;/span&gt;
&lt;span class="s1"&gt;        if (status[line[1],&amp;quot;BACKOFF&amp;quot;]  == 0) {status[line[1],&amp;quot;BACKOFF&amp;quot;]  = 0}&lt;/span&gt;
&lt;span class="s1"&gt;        if (status[line[1],&amp;quot;STOPPING&amp;quot;] == 0) {status[line[1],&amp;quot;STOPPING&amp;quot;] = 0}&lt;/span&gt;
&lt;span class="s1"&gt;        if (status[line[1],&amp;quot;EXITED&amp;quot;]   == 0) {status[line[1],&amp;quot;EXITED&amp;quot;]   = 0}&lt;/span&gt;
&lt;span class="s1"&gt;        if (status[line[1],&amp;quot;FATAL&amp;quot;]    == 0) {status[line[1],&amp;quot;FATAL&amp;quot;]    = 0}&lt;/span&gt;
&lt;span class="s1"&gt;        if (status[line[1],&amp;quot;UNKNOWN&amp;quot;]  == 0) {status[line[1],&amp;quot;UNKNOWN&amp;quot;]  = 0}&lt;/span&gt;
&lt;span class="s1"&gt;        status[line[1],line[2]]++&lt;/span&gt;
&lt;span class="s1"&gt;    }&lt;/span&gt;
&lt;span class="s1"&gt;    END {&lt;/span&gt;
&lt;span class="s1"&gt;        for(i in status) {&lt;/span&gt;
&lt;span class="s1"&gt;            print &amp;quot;- supervisord.workerState[&amp;quot; i &amp;quot;] &amp;quot; status[i]&lt;/span&gt;
&lt;span class="s1"&gt;        }&lt;/span&gt;
&lt;span class="s1"&gt;    }&amp;#39;&lt;/span&gt; &lt;span class="p"&gt;|&lt;/span&gt; /usr/bin/env zabbix_sender --config &lt;span class="nv"&gt;$ZBX_CONFIG&lt;/span&gt; &lt;span class="se"&gt;\&lt;/span&gt;
        --input-file - --host &lt;span class="nv"&gt;$ZBX_HOSTNAME&lt;/span&gt; &amp;gt;/dev/null &lt;span class="m"&gt;2&lt;/span&gt;&amp;gt;&lt;span class="p"&gt;&amp;amp;&lt;/span&gt;&lt;span class="m"&gt;1&lt;/span&gt;
&lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="nv"&gt;$?&lt;/span&gt;
&lt;span class="nb"&gt;exit&lt;/span&gt; &lt;span class="m"&gt;0&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Установка прав на скрипт:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;chown root:zabbix /etc/zabbix/scripts/supervisord_discovery_trapper.sh
chmod &lt;span class="m"&gt;750&lt;/span&gt; /etc/zabbix/scripts/supervisord_discovery_trapper.sh
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Не забываем про настройки в скрипте, где нужно указать полные пути до необходимых программ и конфигурационных файлов:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nv"&gt;ZABBIX_SENDER&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;/usr/bin/env zabbix_sender&amp;#39;&lt;/span&gt;
&lt;span class="nv"&gt;ZBX_CONFIG&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;/etc/zabbix/zabbix_agentd.conf&amp;#39;&lt;/span&gt;
&lt;span class="nv"&gt;ZBX_HOSTNAME&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="k"&gt;$(&lt;/span&gt;awk -F&lt;span class="s1"&gt;&amp;#39;=&amp;#39;&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;/^Hostname=/{ print $2 }&amp;#39;&lt;/span&gt; /etc/zabbix/zabbix_agentd.d/*.conf&lt;span class="k"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Конфигурационный файл: &lt;code&gt;/etc/zabbix/zabbix_agentd.conf.d/lsimegaraid.conf&lt;/code&gt;&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nv"&gt;AllowRoot&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;1&lt;/span&gt;
&lt;span class="nv"&gt;UserParameter&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;supervisord.discovery,supervisorctl status &lt;span class="p"&gt;|&lt;/span&gt; awk &lt;span class="s1"&gt;&amp;#39;BEGIN {out=&amp;quot;{\n\t\&amp;quot;data\&amp;quot;:[\n&amp;quot;; f=0;} {match($0, /^([^:]+):[^[:blank:]]+[[:blank:]]+([^[:blank:]]+).*$/, line);if (!seen[line[1]]++ &amp;amp;&amp;amp; line[1] != NULL) {if (f == 1) out=out&amp;quot;,\n&amp;quot;;out=out &amp;quot;\t\t{\&amp;quot;{#PROGRAMM}\&amp;quot;:\&amp;quot;&amp;quot;line[1]&amp;quot;\&amp;quot;}&amp;quot;;f=1}} END{ if(f == 0){print &amp;quot;{}&amp;quot;}else{print out&amp;quot;\n\t]\n}&amp;quot;}}&amp;#39;&lt;/span&gt;
&lt;span class="nv"&gt;UserParameter&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;supervisord.trapper,/etc/zabbix/scripts/supervisord_trapper.sh
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Шаблон для &lt;strong&gt;zabbix&lt;/strong&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="cp"&gt;&amp;lt;?xml version=&amp;quot;1.0&amp;quot; encoding=&amp;quot;UTF-8&amp;quot;?&amp;gt;&lt;/span&gt;
&lt;span class="nt"&gt;&amp;lt;zabbix_export&amp;gt;&lt;/span&gt;
    &lt;span class="nt"&gt;&amp;lt;version&amp;gt;&lt;/span&gt;2.0&lt;span class="nt"&gt;&amp;lt;/version&amp;gt;&lt;/span&gt;
    &lt;span class="nt"&gt;&amp;lt;date&amp;gt;&lt;/span&gt;2015-03-17T09:01:18Z&lt;span class="nt"&gt;&amp;lt;/date&amp;gt;&lt;/span&gt;
    &lt;span class="nt"&gt;&amp;lt;groups&amp;gt;&lt;/span&gt;
        &lt;span class="nt"&gt;&amp;lt;group&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;name&amp;gt;&lt;/span&gt;Templates&lt;span class="nt"&gt;&amp;lt;/name&amp;gt;&lt;/span&gt;
        &lt;span class="nt"&gt;&amp;lt;/group&amp;gt;&lt;/span&gt;
    &lt;span class="nt"&gt;&amp;lt;/groups&amp;gt;&lt;/span&gt;
    &lt;span class="nt"&gt;&amp;lt;templates&amp;gt;&lt;/span&gt;
        &lt;span class="nt"&gt;&amp;lt;template&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;template&amp;gt;&lt;/span&gt;Template_APP supervisor&lt;span class="nt"&gt;&amp;lt;/template&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;name&amp;gt;&lt;/span&gt;Template_APP supervisor&lt;span class="nt"&gt;&amp;lt;/name&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;description/&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;groups&amp;gt;&lt;/span&gt;
                &lt;span class="nt"&gt;&amp;lt;group&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;name&amp;gt;&lt;/span&gt;Templates&lt;span class="nt"&gt;&amp;lt;/name&amp;gt;&lt;/span&gt;
                &lt;span class="nt"&gt;&amp;lt;/group&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;/groups&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;applications&amp;gt;&lt;/span&gt;
                &lt;span class="nt"&gt;&amp;lt;application&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;name&amp;gt;&lt;/span&gt;App supervisord&lt;span class="nt"&gt;&amp;lt;/name&amp;gt;&lt;/span&gt;
                &lt;span class="nt"&gt;&amp;lt;/application&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;/applications&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;items&amp;gt;&lt;/span&gt;
                &lt;span class="nt"&gt;&amp;lt;item&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;name&amp;gt;&lt;/span&gt;Controller&lt;span class="nt"&gt;&amp;lt;/name&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;type&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/type&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmp_community/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;multiplier&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/multiplier&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmp_oid/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;key&amp;gt;&lt;/span&gt;supervisord.trapper&lt;span class="nt"&gt;&amp;lt;/key&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;delay&amp;gt;&lt;/span&gt;30&lt;span class="nt"&gt;&amp;lt;/delay&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;history&amp;gt;&lt;/span&gt;90&lt;span class="nt"&gt;&amp;lt;/history&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;trends&amp;gt;&lt;/span&gt;365&lt;span class="nt"&gt;&amp;lt;/trends&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;status&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/status&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;value_type&amp;gt;&lt;/span&gt;3&lt;span class="nt"&gt;&amp;lt;/value_type&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;allowed_hosts/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;units/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;delta&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/delta&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_contextname/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_securityname/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_securitylevel&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/snmpv3_securitylevel&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_authprotocol&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/snmpv3_authprotocol&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_authpassphrase/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_privprotocol&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/snmpv3_privprotocol&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_privpassphrase/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;formula&amp;gt;&lt;/span&gt;1&lt;span class="nt"&gt;&amp;lt;/formula&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;delay_flex/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;params/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;ipmi_sensor/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;data_type&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/data_type&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;authtype&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/authtype&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;username/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;password/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;publickey/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;privatekey/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;port/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;description/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;inventory_link&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/inventory_link&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;applications&amp;gt;&lt;/span&gt;
                        &lt;span class="nt"&gt;&amp;lt;application&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;name&amp;gt;&lt;/span&gt;App supervisord&lt;span class="nt"&gt;&amp;lt;/name&amp;gt;&lt;/span&gt;
                        &lt;span class="nt"&gt;&amp;lt;/application&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;/applications&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;valuemap/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;logtimefmt/&amp;gt;&lt;/span&gt;
                &lt;span class="nt"&gt;&amp;lt;/item&amp;gt;&lt;/span&gt;
                &lt;span class="nt"&gt;&amp;lt;item&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;name&amp;gt;&lt;/span&gt;Supervisord process count&lt;span class="nt"&gt;&amp;lt;/name&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;type&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/type&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmp_community/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;multiplier&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/multiplier&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmp_oid/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;key&amp;gt;&lt;/span&gt;proc.num[supervisord]&lt;span class="nt"&gt;&amp;lt;/key&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;delay&amp;gt;&lt;/span&gt;30&lt;span class="nt"&gt;&amp;lt;/delay&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;history&amp;gt;&lt;/span&gt;90&lt;span class="nt"&gt;&amp;lt;/history&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;trends&amp;gt;&lt;/span&gt;365&lt;span class="nt"&gt;&amp;lt;/trends&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;status&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/status&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;value_type&amp;gt;&lt;/span&gt;3&lt;span class="nt"&gt;&amp;lt;/value_type&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;allowed_hosts/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;units/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;delta&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/delta&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_contextname/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_securityname/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_securitylevel&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/snmpv3_securitylevel&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_authprotocol&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/snmpv3_authprotocol&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_authpassphrase/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_privprotocol&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/snmpv3_privprotocol&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_privpassphrase/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;formula&amp;gt;&lt;/span&gt;1&lt;span class="nt"&gt;&amp;lt;/formula&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;delay_flex/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;params/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;ipmi_sensor/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;data_type&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/data_type&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;authtype&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/authtype&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;username/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;password/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;publickey/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;privatekey/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;port/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;description/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;inventory_link&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/inventory_link&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;applications&amp;gt;&lt;/span&gt;
                        &lt;span class="nt"&gt;&amp;lt;application&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;name&amp;gt;&lt;/span&gt;App supervisord&lt;span class="nt"&gt;&amp;lt;/name&amp;gt;&lt;/span&gt;
                        &lt;span class="nt"&gt;&amp;lt;/application&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;/applications&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;valuemap/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;logtimefmt/&amp;gt;&lt;/span&gt;
                &lt;span class="nt"&gt;&amp;lt;/item&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;/items&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;discovery_rules&amp;gt;&lt;/span&gt;
                &lt;span class="nt"&gt;&amp;lt;discovery_rule&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;name&amp;gt;&lt;/span&gt;supervisord State discovery&lt;span class="nt"&gt;&amp;lt;/name&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;type&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/type&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmp_community/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmp_oid/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;key&amp;gt;&lt;/span&gt;supervisord.discovery&lt;span class="nt"&gt;&amp;lt;/key&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;delay&amp;gt;&lt;/span&gt;3600&lt;span class="nt"&gt;&amp;lt;/delay&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;status&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/status&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;allowed_hosts/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_contextname/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_securityname/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_securitylevel&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/snmpv3_securitylevel&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_authprotocol&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/snmpv3_authprotocol&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_authpassphrase/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_privprotocol&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/snmpv3_privprotocol&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_privpassphrase/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;delay_flex/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;params/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;ipmi_sensor/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;authtype&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/authtype&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;username/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;password/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;publickey/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;privatekey/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;port/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;filter&amp;gt;&lt;/span&gt;
                        &lt;span class="nt"&gt;&amp;lt;evaltype&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/evaltype&amp;gt;&lt;/span&gt;
                        &lt;span class="nt"&gt;&amp;lt;formula/&amp;gt;&lt;/span&gt;
                        &lt;span class="nt"&gt;&amp;lt;conditions/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;/filter&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;lifetime&amp;gt;&lt;/span&gt;30&lt;span class="nt"&gt;&amp;lt;/lifetime&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;description/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;item_prototypes&amp;gt;&lt;/span&gt;
                        &lt;span class="nt"&gt;&amp;lt;item_prototype&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;name&amp;gt;&lt;/span&gt;supervisord BACKOFF State of worker $1&lt;span class="nt"&gt;&amp;lt;/name&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;type&amp;gt;&lt;/span&gt;2&lt;span class="nt"&gt;&amp;lt;/type&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;snmp_community/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;multiplier&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/multiplier&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;snmp_oid/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;key&amp;gt;&lt;/span&gt;supervisord.workerState[{#PROGRAMM},BACKOFF]&lt;span class="nt"&gt;&amp;lt;/key&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;delay&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/delay&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;history&amp;gt;&lt;/span&gt;7&lt;span class="nt"&gt;&amp;lt;/history&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;trends&amp;gt;&lt;/span&gt;365&lt;span class="nt"&gt;&amp;lt;/trends&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;status&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/status&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;value_type&amp;gt;&lt;/span&gt;3&lt;span class="nt"&gt;&amp;lt;/value_type&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;allowed_hosts/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;units/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;delta&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/delta&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;snmpv3_contextname/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;snmpv3_securityname/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;snmpv3_securitylevel&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/snmpv3_securitylevel&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;snmpv3_authprotocol&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/snmpv3_authprotocol&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;snmpv3_authpassphrase/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;snmpv3_privprotocol&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/snmpv3_privprotocol&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;snmpv3_privpassphrase/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;formula&amp;gt;&lt;/span&gt;1&lt;span class="nt"&gt;&amp;lt;/formula&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;delay_flex/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;params/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;ipmi_sensor/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;data_type&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/data_type&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;authtype&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/authtype&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;username/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;password/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;publickey/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;privatekey/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;port/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;description/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;inventory_link&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/inventory_link&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;applications&amp;gt;&lt;/span&gt;
                                &lt;span class="nt"&gt;&amp;lt;application&amp;gt;&lt;/span&gt;
                                    &lt;span class="nt"&gt;&amp;lt;name&amp;gt;&lt;/span&gt;App supervisord&lt;span class="nt"&gt;&amp;lt;/name&amp;gt;&lt;/span&gt;
                                &lt;span class="nt"&gt;&amp;lt;/application&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;/applications&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;valuemap/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;logtimefmt/&amp;gt;&lt;/span&gt;
                        &lt;span class="nt"&gt;&amp;lt;/item_prototype&amp;gt;&lt;/span&gt;
                        &lt;span class="nt"&gt;&amp;lt;item_prototype&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;name&amp;gt;&lt;/span&gt;supervisord EXITED State of worker $1&lt;span class="nt"&gt;&amp;lt;/name&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;type&amp;gt;&lt;/span&gt;2&lt;span class="nt"&gt;&amp;lt;/type&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;snmp_community/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;multiplier&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/multiplier&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;snmp_oid/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;key&amp;gt;&lt;/span&gt;supervisord.workerState[{#PROGRAMM},EXITED]&lt;span class="nt"&gt;&amp;lt;/key&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;delay&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/delay&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;history&amp;gt;&lt;/span&gt;7&lt;span class="nt"&gt;&amp;lt;/history&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;trends&amp;gt;&lt;/span&gt;365&lt;span class="nt"&gt;&amp;lt;/trends&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;status&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/status&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;value_type&amp;gt;&lt;/span&gt;3&lt;span class="nt"&gt;&amp;lt;/value_type&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;allowed_hosts/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;units/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;delta&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/delta&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;snmpv3_contextname/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;snmpv3_securityname/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;snmpv3_securitylevel&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/snmpv3_securitylevel&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;snmpv3_authprotocol&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/snmpv3_authprotocol&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;snmpv3_authpassphrase/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;snmpv3_privprotocol&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/snmpv3_privprotocol&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;snmpv3_privpassphrase/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;formula&amp;gt;&lt;/span&gt;1&lt;span class="nt"&gt;&amp;lt;/formula&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;delay_flex/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;params/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;ipmi_sensor/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;data_type&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/data_type&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;authtype&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/authtype&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;username/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;password/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;publickey/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;privatekey/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;port/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;description/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;inventory_link&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/inventory_link&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;applications&amp;gt;&lt;/span&gt;
                                &lt;span class="nt"&gt;&amp;lt;application&amp;gt;&lt;/span&gt;
                                    &lt;span class="nt"&gt;&amp;lt;name&amp;gt;&lt;/span&gt;App supervisord&lt;span class="nt"&gt;&amp;lt;/name&amp;gt;&lt;/span&gt;
                                &lt;span class="nt"&gt;&amp;lt;/application&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;/applications&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;valuemap/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;logtimefmt/&amp;gt;&lt;/span&gt;
                        &lt;span class="nt"&gt;&amp;lt;/item_prototype&amp;gt;&lt;/span&gt;
                        &lt;span class="nt"&gt;&amp;lt;item_prototype&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;name&amp;gt;&lt;/span&gt;supervisord FATAL State of worker $1&lt;span class="nt"&gt;&amp;lt;/name&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;type&amp;gt;&lt;/span&gt;2&lt;span class="nt"&gt;&amp;lt;/type&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;snmp_community/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;multiplier&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/multiplier&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;snmp_oid/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;key&amp;gt;&lt;/span&gt;supervisord.workerState[{#PROGRAMM},FATAL]&lt;span class="nt"&gt;&amp;lt;/key&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;delay&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/delay&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;history&amp;gt;&lt;/span&gt;7&lt;span class="nt"&gt;&amp;lt;/history&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;trends&amp;gt;&lt;/span&gt;365&lt;span class="nt"&gt;&amp;lt;/trends&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;status&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/status&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;value_type&amp;gt;&lt;/span&gt;3&lt;span class="nt"&gt;&amp;lt;/value_type&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;allowed_hosts/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;units/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;delta&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/delta&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;snmpv3_contextname/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;snmpv3_securityname/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;snmpv3_securitylevel&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/snmpv3_securitylevel&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;snmpv3_authprotocol&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/snmpv3_authprotocol&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;snmpv3_authpassphrase/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;snmpv3_privprotocol&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/snmpv3_privprotocol&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;snmpv3_privpassphrase/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;formula&amp;gt;&lt;/span&gt;1&lt;span class="nt"&gt;&amp;lt;/formula&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;delay_flex/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;params/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;ipmi_sensor/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;data_type&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/data_type&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;authtype&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/authtype&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;username/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;password/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;publickey/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;privatekey/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;port/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;description/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;inventory_link&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/inventory_link&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;applications&amp;gt;&lt;/span&gt;
                                &lt;span class="nt"&gt;&amp;lt;application&amp;gt;&lt;/span&gt;
                                    &lt;span class="nt"&gt;&amp;lt;name&amp;gt;&lt;/span&gt;App supervisord&lt;span class="nt"&gt;&amp;lt;/name&amp;gt;&lt;/span&gt;
                                &lt;span class="nt"&gt;&amp;lt;/application&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;/applications&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;valuemap/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;logtimefmt/&amp;gt;&lt;/span&gt;
                        &lt;span class="nt"&gt;&amp;lt;/item_prototype&amp;gt;&lt;/span&gt;
                        &lt;span class="nt"&gt;&amp;lt;item_prototype&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;name&amp;gt;&lt;/span&gt;supervisord RUNNING State of worker $1&lt;span class="nt"&gt;&amp;lt;/name&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;type&amp;gt;&lt;/span&gt;2&lt;span class="nt"&gt;&amp;lt;/type&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;snmp_community/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;multiplier&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/multiplier&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;snmp_oid/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;key&amp;gt;&lt;/span&gt;supervisord.workerState[{#PROGRAMM},RUNNING]&lt;span class="nt"&gt;&amp;lt;/key&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;delay&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/delay&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;history&amp;gt;&lt;/span&gt;7&lt;span class="nt"&gt;&amp;lt;/history&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;trends&amp;gt;&lt;/span&gt;365&lt;span class="nt"&gt;&amp;lt;/trends&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;status&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/status&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;value_type&amp;gt;&lt;/span&gt;3&lt;span class="nt"&gt;&amp;lt;/value_type&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;allowed_hosts/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;units/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;delta&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/delta&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;snmpv3_contextname/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;snmpv3_securityname/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;snmpv3_securitylevel&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/snmpv3_securitylevel&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;snmpv3_authprotocol&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/snmpv3_authprotocol&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;snmpv3_authpassphrase/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;snmpv3_privprotocol&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/snmpv3_privprotocol&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;snmpv3_privpassphrase/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;formula&amp;gt;&lt;/span&gt;1&lt;span class="nt"&gt;&amp;lt;/formula&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;delay_flex/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;params/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;ipmi_sensor/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;data_type&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/data_type&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;authtype&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/authtype&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;username/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;password/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;publickey/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;privatekey/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;port/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;description/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;inventory_link&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/inventory_link&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;applications&amp;gt;&lt;/span&gt;
                                &lt;span class="nt"&gt;&amp;lt;application&amp;gt;&lt;/span&gt;
                                    &lt;span class="nt"&gt;&amp;lt;name&amp;gt;&lt;/span&gt;App supervisord&lt;span class="nt"&gt;&amp;lt;/name&amp;gt;&lt;/span&gt;
                                &lt;span class="nt"&gt;&amp;lt;/application&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;/applications&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;valuemap/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;logtimefmt/&amp;gt;&lt;/span&gt;
                        &lt;span class="nt"&gt;&amp;lt;/item_prototype&amp;gt;&lt;/span&gt;
                        &lt;span class="nt"&gt;&amp;lt;item_prototype&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;name&amp;gt;&lt;/span&gt;supervisord STARTING State of worker $1&lt;span class="nt"&gt;&amp;lt;/name&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;type&amp;gt;&lt;/span&gt;2&lt;span class="nt"&gt;&amp;lt;/type&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;snmp_community/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;multiplier&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/multiplier&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;snmp_oid/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;key&amp;gt;&lt;/span&gt;supervisord.workerState[{#PROGRAMM},STARTING]&lt;span class="nt"&gt;&amp;lt;/key&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;delay&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/delay&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;history&amp;gt;&lt;/span&gt;7&lt;span class="nt"&gt;&amp;lt;/history&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;trends&amp;gt;&lt;/span&gt;365&lt;span class="nt"&gt;&amp;lt;/trends&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;status&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/status&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;value_type&amp;gt;&lt;/span&gt;3&lt;span class="nt"&gt;&amp;lt;/value_type&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;allowed_hosts/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;units/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;delta&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/delta&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;snmpv3_contextname/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;snmpv3_securityname/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;snmpv3_securitylevel&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/snmpv3_securitylevel&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;snmpv3_authprotocol&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/snmpv3_authprotocol&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;snmpv3_authpassphrase/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;snmpv3_privprotocol&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/snmpv3_privprotocol&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;snmpv3_privpassphrase/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;formula&amp;gt;&lt;/span&gt;1&lt;span class="nt"&gt;&amp;lt;/formula&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;delay_flex/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;params/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;ipmi_sensor/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;data_type&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/data_type&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;authtype&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/authtype&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;username/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;password/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;publickey/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;privatekey/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;port/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;description/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;inventory_link&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/inventory_link&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;applications&amp;gt;&lt;/span&gt;
                                &lt;span class="nt"&gt;&amp;lt;application&amp;gt;&lt;/span&gt;
                                    &lt;span class="nt"&gt;&amp;lt;name&amp;gt;&lt;/span&gt;App supervisord&lt;span class="nt"&gt;&amp;lt;/name&amp;gt;&lt;/span&gt;
                                &lt;span class="nt"&gt;&amp;lt;/application&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;/applications&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;valuemap/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;logtimefmt/&amp;gt;&lt;/span&gt;
                        &lt;span class="nt"&gt;&amp;lt;/item_prototype&amp;gt;&lt;/span&gt;
                        &lt;span class="nt"&gt;&amp;lt;item_prototype&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;name&amp;gt;&lt;/span&gt;supervisord STOPPED State of worker $1&lt;span class="nt"&gt;&amp;lt;/name&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;type&amp;gt;&lt;/span&gt;2&lt;span class="nt"&gt;&amp;lt;/type&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;snmp_community/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;multiplier&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/multiplier&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;snmp_oid/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;key&amp;gt;&lt;/span&gt;supervisord.workerState[{#PROGRAMM},STOPPED]&lt;span class="nt"&gt;&amp;lt;/key&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;delay&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/delay&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;history&amp;gt;&lt;/span&gt;7&lt;span class="nt"&gt;&amp;lt;/history&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;trends&amp;gt;&lt;/span&gt;365&lt;span class="nt"&gt;&amp;lt;/trends&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;status&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/status&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;value_type&amp;gt;&lt;/span&gt;3&lt;span class="nt"&gt;&amp;lt;/value_type&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;allowed_hosts/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;units/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;delta&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/delta&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;snmpv3_contextname/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;snmpv3_securityname/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;snmpv3_securitylevel&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/snmpv3_securitylevel&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;snmpv3_authprotocol&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/snmpv3_authprotocol&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;snmpv3_authpassphrase/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;snmpv3_privprotocol&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/snmpv3_privprotocol&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;snmpv3_privpassphrase/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;formula&amp;gt;&lt;/span&gt;1&lt;span class="nt"&gt;&amp;lt;/formula&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;delay_flex/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;params/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;ipmi_sensor/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;data_type&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/data_type&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;authtype&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/authtype&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;username/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;password/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;publickey/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;privatekey/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;port/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;description/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;inventory_link&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/inventory_link&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;applications&amp;gt;&lt;/span&gt;
                                &lt;span class="nt"&gt;&amp;lt;application&amp;gt;&lt;/span&gt;
                                    &lt;span class="nt"&gt;&amp;lt;name&amp;gt;&lt;/span&gt;App supervisord&lt;span class="nt"&gt;&amp;lt;/name&amp;gt;&lt;/span&gt;
                                &lt;span class="nt"&gt;&amp;lt;/application&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;/applications&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;valuemap/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;logtimefmt/&amp;gt;&lt;/span&gt;
                        &lt;span class="nt"&gt;&amp;lt;/item_prototype&amp;gt;&lt;/span&gt;
                        &lt;span class="nt"&gt;&amp;lt;item_prototype&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;name&amp;gt;&lt;/span&gt;supervisord STOPPING State of worker $1&lt;span class="nt"&gt;&amp;lt;/name&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;type&amp;gt;&lt;/span&gt;2&lt;span class="nt"&gt;&amp;lt;/type&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;snmp_community/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;multiplier&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/multiplier&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;snmp_oid/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;key&amp;gt;&lt;/span&gt;supervisord.workerState[{#PROGRAMM},STOPPING]&lt;span class="nt"&gt;&amp;lt;/key&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;delay&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/delay&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;history&amp;gt;&lt;/span&gt;7&lt;span class="nt"&gt;&amp;lt;/history&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;trends&amp;gt;&lt;/span&gt;365&lt;span class="nt"&gt;&amp;lt;/trends&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;status&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/status&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;value_type&amp;gt;&lt;/span&gt;3&lt;span class="nt"&gt;&amp;lt;/value_type&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;allowed_hosts/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;units/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;delta&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/delta&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;snmpv3_contextname/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;snmpv3_securityname/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;snmpv3_securitylevel&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/snmpv3_securitylevel&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;snmpv3_authprotocol&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/snmpv3_authprotocol&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;snmpv3_authpassphrase/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;snmpv3_privprotocol&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/snmpv3_privprotocol&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;snmpv3_privpassphrase/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;formula&amp;gt;&lt;/span&gt;1&lt;span class="nt"&gt;&amp;lt;/formula&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;delay_flex/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;params/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;ipmi_sensor/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;data_type&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/data_type&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;authtype&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/authtype&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;username/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;password/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;publickey/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;privatekey/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;port/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;description/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;inventory_link&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/inventory_link&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;applications&amp;gt;&lt;/span&gt;
                                &lt;span class="nt"&gt;&amp;lt;application&amp;gt;&lt;/span&gt;
                                    &lt;span class="nt"&gt;&amp;lt;name&amp;gt;&lt;/span&gt;App supervisord&lt;span class="nt"&gt;&amp;lt;/name&amp;gt;&lt;/span&gt;
                                &lt;span class="nt"&gt;&amp;lt;/application&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;/applications&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;valuemap/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;logtimefmt/&amp;gt;&lt;/span&gt;
                        &lt;span class="nt"&gt;&amp;lt;/item_prototype&amp;gt;&lt;/span&gt;
                        &lt;span class="nt"&gt;&amp;lt;item_prototype&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;name&amp;gt;&lt;/span&gt;supervisord UNKNOWN State of worker $1&lt;span class="nt"&gt;&amp;lt;/name&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;type&amp;gt;&lt;/span&gt;2&lt;span class="nt"&gt;&amp;lt;/type&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;snmp_community/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;multiplier&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/multiplier&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;snmp_oid/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;key&amp;gt;&lt;/span&gt;supervisord.workerState[{#PROGRAMM},UNKNOWN]&lt;span class="nt"&gt;&amp;lt;/key&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;delay&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/delay&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;history&amp;gt;&lt;/span&gt;7&lt;span class="nt"&gt;&amp;lt;/history&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;trends&amp;gt;&lt;/span&gt;365&lt;span class="nt"&gt;&amp;lt;/trends&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;status&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/status&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;value_type&amp;gt;&lt;/span&gt;3&lt;span class="nt"&gt;&amp;lt;/value_type&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;allowed_hosts/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;units/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;delta&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/delta&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;snmpv3_contextname/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;snmpv3_securityname/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;snmpv3_securitylevel&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/snmpv3_securitylevel&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;snmpv3_authprotocol&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/snmpv3_authprotocol&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;snmpv3_authpassphrase/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;snmpv3_privprotocol&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/snmpv3_privprotocol&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;snmpv3_privpassphrase/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;formula&amp;gt;&lt;/span&gt;1&lt;span class="nt"&gt;&amp;lt;/formula&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;delay_flex/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;params/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;ipmi_sensor/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;data_type&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/data_type&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;authtype&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/authtype&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;username/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;password/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;publickey/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;privatekey/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;port/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;description/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;inventory_link&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/inventory_link&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;applications&amp;gt;&lt;/span&gt;
                                &lt;span class="nt"&gt;&amp;lt;application&amp;gt;&lt;/span&gt;
                                    &lt;span class="nt"&gt;&amp;lt;name&amp;gt;&lt;/span&gt;App supervisord&lt;span class="nt"&gt;&amp;lt;/name&amp;gt;&lt;/span&gt;
                                &lt;span class="nt"&gt;&amp;lt;/application&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;/applications&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;valuemap/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;logtimefmt/&amp;gt;&lt;/span&gt;
                        &lt;span class="nt"&gt;&amp;lt;/item_prototype&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;/item_prototypes&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;trigger_prototypes&amp;gt;&lt;/span&gt;
                        &lt;span class="nt"&gt;&amp;lt;trigger_prototype&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;expression&amp;gt;&lt;/span&gt;{Template_APP supervisor:supervisord.workerState[{#PROGRAMM},BACKOFF].last(0)}&lt;span class="ni"&gt;&amp;amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/expression&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;name&amp;gt;&lt;/span&gt;Supervisord BACKOFF State of worker {#PROGRAMM} on host {HOST.NAME}&lt;span class="nt"&gt;&amp;lt;/name&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;url/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;status&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/status&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;priority&amp;gt;&lt;/span&gt;4&lt;span class="nt"&gt;&amp;lt;/priority&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;description/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;type&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/type&amp;gt;&lt;/span&gt;
                        &lt;span class="nt"&gt;&amp;lt;/trigger_prototype&amp;gt;&lt;/span&gt;
                        &lt;span class="nt"&gt;&amp;lt;trigger_prototype&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;expression&amp;gt;&lt;/span&gt;{Template_APP supervisor:supervisord.workerState[{#PROGRAMM},EXITED].last(0)}&lt;span class="ni"&gt;&amp;amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/expression&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;name&amp;gt;&lt;/span&gt;Supervisord EXITED State of worker {#PROGRAMM} on host {HOST.NAME}&lt;span class="nt"&gt;&amp;lt;/name&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;url/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;status&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/status&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;priority&amp;gt;&lt;/span&gt;4&lt;span class="nt"&gt;&amp;lt;/priority&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;description/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;type&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/type&amp;gt;&lt;/span&gt;
                        &lt;span class="nt"&gt;&amp;lt;/trigger_prototype&amp;gt;&lt;/span&gt;
                        &lt;span class="nt"&gt;&amp;lt;trigger_prototype&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;expression&amp;gt;&lt;/span&gt;{Template_APP supervisor:supervisord.workerState[{#PROGRAMM},FATAL].last(0)}&lt;span class="ni"&gt;&amp;amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/expression&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;name&amp;gt;&lt;/span&gt;Supervisord FATAL State of worker {#PROGRAMM} on host {HOST.NAME}&lt;span class="nt"&gt;&amp;lt;/name&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;url/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;status&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/status&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;priority&amp;gt;&lt;/span&gt;4&lt;span class="nt"&gt;&amp;lt;/priority&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;description/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;type&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/type&amp;gt;&lt;/span&gt;
                        &lt;span class="nt"&gt;&amp;lt;/trigger_prototype&amp;gt;&lt;/span&gt;
                        &lt;span class="nt"&gt;&amp;lt;trigger_prototype&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;expression&amp;gt;&lt;/span&gt;{Template_APP supervisor:supervisord.workerState[{#PROGRAMM},RUNNING].last(0)}=0&lt;span class="nt"&gt;&amp;lt;/expression&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;name&amp;gt;&lt;/span&gt;Supervisord RUNNING State of worker {#PROGRAMM} on host {HOST.NAME}&lt;span class="nt"&gt;&amp;lt;/name&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;url/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;status&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/status&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;priority&amp;gt;&lt;/span&gt;4&lt;span class="nt"&gt;&amp;lt;/priority&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;description/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;type&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/type&amp;gt;&lt;/span&gt;
                        &lt;span class="nt"&gt;&amp;lt;/trigger_prototype&amp;gt;&lt;/span&gt;
                        &lt;span class="nt"&gt;&amp;lt;trigger_prototype&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;expression&amp;gt;&lt;/span&gt;{Template_APP supervisor:supervisord.workerState[{#PROGRAMM},STOPPED].last(0)}&lt;span class="ni"&gt;&amp;amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/expression&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;name&amp;gt;&lt;/span&gt;Supervisord STOPPED State of worker {#PROGRAMM} on host {HOST.NAME}&lt;span class="nt"&gt;&amp;lt;/name&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;url/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;status&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/status&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;priority&amp;gt;&lt;/span&gt;4&lt;span class="nt"&gt;&amp;lt;/priority&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;description/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;type&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/type&amp;gt;&lt;/span&gt;
                        &lt;span class="nt"&gt;&amp;lt;/trigger_prototype&amp;gt;&lt;/span&gt;
                        &lt;span class="nt"&gt;&amp;lt;trigger_prototype&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;expression&amp;gt;&lt;/span&gt;{Template_APP supervisor:supervisord.workerState[{#PROGRAMM},UNKNOWN].last(0)}&lt;span class="ni"&gt;&amp;amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/expression&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;name&amp;gt;&lt;/span&gt;Supervisord UNKNOWN State of worker {#PROGRAMM} on host {HOST.NAME}&lt;span class="nt"&gt;&amp;lt;/name&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;url/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;status&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/status&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;priority&amp;gt;&lt;/span&gt;4&lt;span class="nt"&gt;&amp;lt;/priority&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;description/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;type&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/type&amp;gt;&lt;/span&gt;
                        &lt;span class="nt"&gt;&amp;lt;/trigger_prototype&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;/trigger_prototypes&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;graph_prototypes/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;host_prototypes/&amp;gt;&lt;/span&gt;
                &lt;span class="nt"&gt;&amp;lt;/discovery_rule&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;/discovery_rules&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;macros/&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;templates/&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;screens/&amp;gt;&lt;/span&gt;
        &lt;span class="nt"&gt;&amp;lt;/template&amp;gt;&lt;/span&gt;
    &lt;span class="nt"&gt;&amp;lt;/templates&amp;gt;&lt;/span&gt;
    &lt;span class="nt"&gt;&amp;lt;triggers&amp;gt;&lt;/span&gt;
        &lt;span class="nt"&gt;&amp;lt;trigger&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;expression&amp;gt;&lt;/span&gt;{Template_APP supervisor:proc.num[supervisord].last(0)}=0&lt;span class="nt"&gt;&amp;lt;/expression&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;name&amp;gt;&lt;/span&gt;Supervisord is down on {HOST.NAME}&lt;span class="nt"&gt;&amp;lt;/name&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;url/&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;status&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/status&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;priority&amp;gt;&lt;/span&gt;4&lt;span class="nt"&gt;&amp;lt;/priority&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;description/&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;type&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/type&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;dependencies/&amp;gt;&lt;/span&gt;
        &lt;span class="nt"&gt;&amp;lt;/trigger&amp;gt;&lt;/span&gt;
    &lt;span class="nt"&gt;&amp;lt;/triggers&amp;gt;&lt;/span&gt;
&lt;span class="nt"&gt;&amp;lt;/zabbix_export&amp;gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Не забываем перезапустить агент, чтобы агент прочитал новый конфигурационный файл:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;service zabbix-agentd restart
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Проверка:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;zabbix_get -s HOST -k &lt;span class="s2"&gt;&amp;quot;supervisord.discovery&amp;quot;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;</content><category term="Zabbix"></category><category term="supervisord"></category><category term="supervisor"></category></entry><entry><title>Мониторинг LSI MegaRAID в Zabbix</title><link href="https://metajiji.github.io/blog/zabbix-lsi-megaraid/" rel="alternate"></link><published>2015-03-16T00:00:00+06:00</published><updated>2015-03-16T00:00:00+06:00</updated><author><name>Denis Kadyshev</name></author><id>tag:metajiji.github.io,2015-03-16:/blog/zabbix-lsi-megaraid/</id><summary type="html">&lt;p&gt;Скрипт мониторит по-умолчанию адаптер &lt;code&gt;0&lt;/code&gt;, т.е. когда в системе только одна плата &lt;strong&gt;Raid&lt;/strong&gt; контроллера (опция &lt;code&gt;-a0&lt;/code&gt;), но можно указать конкретный номер адаптера, если это необходимо.&lt;/p&gt;
&lt;p&gt;Скрипт имеет встроенную справку:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="c1"&gt;# ./lsimegaraid_discovery_trapper.sh help&lt;/span&gt;
WARNING: Correctly setup &lt;span class="s1"&gt;&amp;#39;Hostname=&amp;#39;&lt;/span&gt; in config is REQUIRED!

INFO: Number of array is default &lt;span class="m"&gt;0&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
 Examples:
    Discovery …&lt;/pre&gt;&lt;/div&gt;</summary><content type="html">&lt;p&gt;Скрипт мониторит по-умолчанию адаптер &lt;code&gt;0&lt;/code&gt;, т.е. когда в системе только одна плата &lt;strong&gt;Raid&lt;/strong&gt; контроллера (опция &lt;code&gt;-a0&lt;/code&gt;), но можно указать конкретный номер адаптера, если это необходимо.&lt;/p&gt;
&lt;p&gt;Скрипт имеет встроенную справку:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="c1"&gt;# ./lsimegaraid_discovery_trapper.sh help&lt;/span&gt;
WARNING: Correctly setup &lt;span class="s1"&gt;&amp;#39;Hostname=&amp;#39;&lt;/span&gt; in config is REQUIRED!

INFO: Number of array is default &lt;span class="m"&gt;0&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
 Examples:
    Discovery is default action:
        ./lsimegaraid_discovery_trapper.sh                            - physdiscovery disks &lt;span class="k"&gt;for&lt;/span&gt; default array &lt;span class="m"&gt;0&lt;/span&gt;.
        ./lsimegaraid_discovery_trapper.sh discovery                  - physdiscovery disks &lt;span class="k"&gt;for&lt;/span&gt; default array &lt;span class="m"&gt;0&lt;/span&gt;.
        ./lsimegaraid_discovery_trapper.sh discovery virtdiscovery    - virtdiscovery disks &lt;span class="k"&gt;for&lt;/span&gt; custom array &lt;span class="m"&gt;0&lt;/span&gt;.
        ./lsimegaraid_discovery_trapper.sh discovery virtdiscovery &lt;span class="m"&gt;1&lt;/span&gt;  - virtdiscovery disks &lt;span class="k"&gt;for&lt;/span&gt; custom array &lt;span class="m"&gt;1&lt;/span&gt;.
        ./lsimegaraid_discovery_trapper.sh discovery physdiscovery &lt;span class="m"&gt;1&lt;/span&gt;  - physdiscovery disks &lt;span class="k"&gt;for&lt;/span&gt; custom array &lt;span class="m"&gt;1&lt;/span&gt;.
    Data sending to zabbix-server:
        ./lsimegaraid_discovery_trapper.sh trapper    - send data to zabbix &lt;span class="k"&gt;for&lt;/span&gt; default array &lt;span class="m"&gt;0&lt;/span&gt;.
        ./lsimegaraid_discovery_trapper.sh trapper &lt;span class="m"&gt;1&lt;/span&gt;  - send data to zabbix &lt;span class="k"&gt;for&lt;/span&gt; custom array &lt;span class="m"&gt;1&lt;/span&gt;.

&lt;span class="m"&gt;03&lt;/span&gt;.2015 - metajiji@gmail.com
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Скрипт поддерживает обнаружение (&lt;code&gt;discovery&lt;/code&gt;) виртуальных и физических дисков в слотах. Отправка данных осуществляется через &lt;code&gt;zabbix_sender&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Установка довольно тривиальна:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;mkdir /etc/zabbix/scripts
chown root:zabbix -R /etc/zabbix/scripts
chmod &lt;span class="m"&gt;750&lt;/span&gt; /etc/zabbix/scripts
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Код скрипта &lt;code&gt;/etc/zabbix/scripts/lsimegaraid_discovery_trapper.sh&lt;/code&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="ch"&gt;#!/bin/sh&lt;/span&gt;

&lt;span class="nv"&gt;MEGACLI&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;/usr/local/sbin/MegaCli&amp;#39;&lt;/span&gt;
&lt;span class="nv"&gt;ZABBIX_SENDER&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;/usr/local/bin/zabbix_sender&amp;#39;&lt;/span&gt;
&lt;span class="nv"&gt;CONFIG&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;/etc/zabbix/zabbix_agentd.conf&amp;#39;&lt;/span&gt;

usage&lt;span class="o"&gt;()&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt;
    cat &lt;span class="s"&gt;&amp;lt;&amp;lt;-_EOF&lt;/span&gt;
&lt;span class="s"&gt;    WARNING: Correctly setup &amp;#39;Hostname=&amp;#39; in config is REQUIRED!&lt;/span&gt;

&lt;span class="s"&gt;    INFO: Number of array is default 0;&lt;/span&gt;
&lt;span class="s"&gt;    Examples:&lt;/span&gt;

&lt;span class="s"&gt;    Discovery is default action:&lt;/span&gt;
&lt;span class="s"&gt;        ./$(basename $0)                            - physdiscovery disks for default array 0.&lt;/span&gt;
&lt;span class="s"&gt;        ./$(basename $0) discovery                  - physdiscovery disks for default array 0.&lt;/span&gt;
&lt;span class="s"&gt;        ./$(basename $0) discovery virtdiscovery    - virtdiscovery disks for custom array 0.&lt;/span&gt;
&lt;span class="s"&gt;        ./$(basename $0) discovery virtdiscovery 1  - virtdiscovery disks for custom array 1.&lt;/span&gt;
&lt;span class="s"&gt;        ./$(basename $0) discovery physdiscovery 1  - physdiscovery disks for custom array 1.&lt;/span&gt;

&lt;span class="s"&gt;    Data sending to zabbix-server:&lt;/span&gt;
&lt;span class="s"&gt;        ./$(basename $0) trapper    - send data to zabbix for default array 0.&lt;/span&gt;
&lt;span class="s"&gt;        ./$(basename $0) trapper 1  - send data to zabbix for custom array 1.&lt;/span&gt;

&lt;span class="s"&gt;    03.2015 - metajiji@gmail.com&lt;/span&gt;
&lt;span class="s"&gt;_EOF&lt;/span&gt;
&lt;span class="o"&gt;}&lt;/span&gt;

&lt;span class="nv"&gt;LC_ALL&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&amp;quot;&lt;/span&gt;
&lt;span class="nv"&gt;LANG&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;en_US.UTF-8&amp;quot;&lt;/span&gt;

discovery&lt;span class="o"&gt;()&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt;
    &lt;span class="nb"&gt;local&lt;/span&gt; &lt;span class="nv"&gt;TYPE&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="si"&gt;${&lt;/span&gt;&lt;span class="nv"&gt;1&lt;/span&gt;&lt;span class="k"&gt;:-&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;physdiscovery&amp;#39;&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;  &lt;span class="c1"&gt;# Set Default value to physdiscovery.&lt;/span&gt;
    &lt;span class="nb"&gt;local&lt;/span&gt; &lt;span class="nv"&gt;ARRAY_NUM&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="si"&gt;${&lt;/span&gt;&lt;span class="nv"&gt;2&lt;/span&gt;&lt;span class="k"&gt;:-&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;0&amp;#39;&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;  &lt;span class="c1"&gt;# Default value of array number is 0.&lt;/span&gt;
    &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="o"&gt;[&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;$TYPE&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;virtdiscovery&amp;quot;&lt;/span&gt; &lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="k"&gt;then&lt;/span&gt;
        &lt;span class="nv"&gt;$MEGACLI&lt;/span&gt; -LDInfo -LAll -a&lt;span class="nv"&gt;$ARRAY_NUM&lt;/span&gt; -NoLog &lt;span class="p"&gt;|&lt;/span&gt; awk &lt;span class="s1"&gt;&amp;#39;&lt;/span&gt;
&lt;span class="s1"&gt;            BEGIN {&lt;/span&gt;
&lt;span class="s1"&gt;                out = &amp;quot;{\n\t\&amp;quot;data\&amp;quot;:[\n&amp;quot;&lt;/span&gt;
&lt;span class="s1"&gt;                f = 0&lt;/span&gt;
&lt;span class="s1"&gt;            }&lt;/span&gt;
&lt;span class="s1"&gt;            /Virtual Drive:/ {&lt;/span&gt;
&lt;span class="s1"&gt;                if (f == 1) out = out&amp;quot;,\n&amp;quot;&lt;/span&gt;
&lt;span class="s1"&gt;                out=out &amp;quot;\t\t{\&amp;quot;{#VIRTNUM}\&amp;quot;:\&amp;quot;VirtualDrive&amp;quot;$3&amp;quot;\&amp;quot;}&amp;quot;&lt;/span&gt;
&lt;span class="s1"&gt;                f = 1&lt;/span&gt;
&lt;span class="s1"&gt;            }&lt;/span&gt;
&lt;span class="s1"&gt;            END {&lt;/span&gt;
&lt;span class="s1"&gt;                if (f == 0) {&lt;/span&gt;
&lt;span class="s1"&gt;                print &amp;quot;{}&amp;quot;&lt;/span&gt;
&lt;span class="s1"&gt;            } else {&lt;/span&gt;
&lt;span class="s1"&gt;                print out&amp;quot;\n\t]\n}&amp;quot;&lt;/span&gt;
&lt;span class="s1"&gt;            }&lt;/span&gt;
&lt;span class="s1"&gt;        }&amp;#39;&lt;/span&gt;
    &lt;span class="k"&gt;elif&lt;/span&gt; &lt;span class="o"&gt;[&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;$TYPE&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;physdiscovery&amp;#39;&lt;/span&gt; &lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="k"&gt;then&lt;/span&gt;
        &lt;span class="nv"&gt;$MEGACLI&lt;/span&gt; -PDlist -a&lt;span class="nv"&gt;$ARRAY_NUM&lt;/span&gt; -NoLog &lt;span class="p"&gt;|&lt;/span&gt; awk -F &lt;span class="s1"&gt;&amp;#39;: &amp;#39;&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;&lt;/span&gt;
&lt;span class="s1"&gt;            BEGIN {&lt;/span&gt;
&lt;span class="s1"&gt;                out = &amp;quot;{\n\t\&amp;quot;data\&amp;quot;:[\n&amp;quot;&lt;/span&gt;
&lt;span class="s1"&gt;                f = 0&lt;/span&gt;
&lt;span class="s1"&gt;            }&lt;/span&gt;
&lt;span class="s1"&gt;            /Slot Number:/ {&lt;/span&gt;
&lt;span class="s1"&gt;                if (f == 1) out = out&amp;quot;,\n&amp;quot;&lt;/span&gt;
&lt;span class="s1"&gt;                out=out &amp;quot;\t\t{\&amp;quot;{#PHYSNUM}\&amp;quot;:\&amp;quot;DriveSlot&amp;quot;$2&amp;quot;\&amp;quot;}&amp;quot;&lt;/span&gt;
&lt;span class="s1"&gt;                f = 1&lt;/span&gt;
&lt;span class="s1"&gt;            }&lt;/span&gt;
&lt;span class="s1"&gt;            END {&lt;/span&gt;
&lt;span class="s1"&gt;                if (f == 0) {&lt;/span&gt;
&lt;span class="s1"&gt;                print &amp;quot;{}&amp;quot;&lt;/span&gt;
&lt;span class="s1"&gt;            } else {&lt;/span&gt;
&lt;span class="s1"&gt;                print out&amp;quot;\n\t]\n}&amp;quot;&lt;/span&gt;
&lt;span class="s1"&gt;            }&lt;/span&gt;
&lt;span class="s1"&gt;        }&amp;#39;&lt;/span&gt;
    &lt;span class="k"&gt;else&lt;/span&gt;
        &amp;gt;&lt;span class="p"&gt;&amp;amp;&lt;/span&gt;&lt;span class="m"&gt;2&lt;/span&gt; &lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;ERROR  : Discovery TYPE &amp;quot;&amp;#39;&lt;/span&gt;&lt;span class="nv"&gt;$TYPE&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;&amp;quot; is not correct!&amp;#39;&lt;/span&gt;
        &lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;{}&amp;#39;&lt;/span&gt;  &lt;span class="c1"&gt;# Return empty json, if TYPE is not correct.&lt;/span&gt;
    &lt;span class="k"&gt;fi&lt;/span&gt;
&lt;span class="o"&gt;}&lt;/span&gt;

trapper&lt;span class="o"&gt;()&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt;
    &lt;span class="nb"&gt;local&lt;/span&gt; &lt;span class="nv"&gt;ARRAY_NUM&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="si"&gt;${&lt;/span&gt;&lt;span class="nv"&gt;1&lt;/span&gt;&lt;span class="k"&gt;:-&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;0&amp;#39;&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;  &lt;span class="c1"&gt;# Default value of array number is 0.&lt;/span&gt;
    &lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;$MEGACLI&lt;/span&gt; -PDlist -a&lt;span class="nv"&gt;$ARRAY_NUM&lt;/span&gt; -NoLog &lt;span class="p"&gt;|&lt;/span&gt; awk -F&lt;span class="s1"&gt;&amp;#39;:&amp;#39;&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;&lt;/span&gt;
&lt;span class="s1"&gt;        function ltrim(s) {sub(/^[ \t]+/, &amp;quot;&amp;quot;, s);return s}&lt;/span&gt;
&lt;span class="s1"&gt;        function rtrim(s) {sub(/[ \t]+$/, &amp;quot;&amp;quot;, s);return s}&lt;/span&gt;
&lt;span class="s1"&gt;        function trim(s)  {return rtrim(ltrim(s))}&lt;/span&gt;
&lt;span class="s1"&gt;        /Slot Number/              {slotcounter += 1; slot[slotcounter] = trim($2)}&lt;/span&gt;
&lt;span class="s1"&gt;        /Firmware state/           {state[slotcounter]        = trim($2)}&lt;/span&gt;
&lt;span class="s1"&gt;        /S.M.A.R.T/                {smart[slotcounter]        = trim($2)}&lt;/span&gt;
&lt;span class="s1"&gt;        /Inquiry Data/             {inquiry[slotcounter]      = trim($2)}&lt;/span&gt;
&lt;span class="s1"&gt;        /Media Error Count/        {mediaerror[slotcounter]   = trim($2)}&lt;/span&gt;
&lt;span class="s1"&gt;        /Other Error Count/        {othererror[slotcounter]   = trim($2)}&lt;/span&gt;
&lt;span class="s1"&gt;        /Drive Temperature/        {temperature[slotcounter]  = trim($2)}&lt;/span&gt;
&lt;span class="s1"&gt;        /Predictive Failure Count/ {failurecount[slotcounter] = trim($2)}&lt;/span&gt;
&lt;span class="s1"&gt;        END {&lt;/span&gt;
&lt;span class="s1"&gt;            for (i = 1; i &amp;lt;= slotcounter; i += 1) {&lt;/span&gt;
&lt;span class="s1"&gt;                printf (&amp;quot;- lsimegaraid.data[DriveSlot%d,state] %s\n&amp;quot;,        slot[i], state[i])&lt;/span&gt;
&lt;span class="s1"&gt;                printf (&amp;quot;- lsimegaraid.data[DriveSlot%d,smart] %s\n&amp;quot;,        slot[i], smart[i])&lt;/span&gt;
&lt;span class="s1"&gt;                printf (&amp;quot;- lsimegaraid.data[DriveSlot%d,inquiry] %s\n&amp;quot;,      slot[i], inquiry[i])&lt;/span&gt;
&lt;span class="s1"&gt;                printf (&amp;quot;- lsimegaraid.data[DriveSlot%d,mediaerror] %d\n&amp;quot;,   slot[i], mediaerror[i])&lt;/span&gt;
&lt;span class="s1"&gt;                printf (&amp;quot;- lsimegaraid.data[DriveSlot%d,othererror] %d\n&amp;quot;,   slot[i], othererror[i])&lt;/span&gt;
&lt;span class="s1"&gt;                printf (&amp;quot;- lsimegaraid.data[DriveSlot%d,temperature] %d\n&amp;quot;,  slot[i], temperature[i])&lt;/span&gt;
&lt;span class="s1"&gt;                printf (&amp;quot;- lsimegaraid.data[DriveSlot%d,failurecount] %d\n&amp;quot;, slot[i], failurecount[i])&lt;/span&gt;
&lt;span class="s1"&gt;            }&lt;/span&gt;
&lt;span class="s1"&gt;        }&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="o"&gt;[&lt;/span&gt; &lt;span class="nv"&gt;$?&lt;/span&gt; -gt &lt;span class="m"&gt;1&lt;/span&gt; &lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;ERROR  : MegaCli failed while getting phusical drives data!&amp;#39;&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class="nb"&gt;exit&lt;/span&gt; &lt;span class="m"&gt;1&lt;/span&gt;

    &lt;span class="si"&gt;${&lt;/span&gt;&lt;span class="nv"&gt;MEGACLI&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt; -LDInfo -LAll -a&lt;span class="nv"&gt;$ARRAY_NUM&lt;/span&gt; -NoLog &lt;span class="p"&gt;|&lt;/span&gt; awk -F&lt;span class="s1"&gt;&amp;#39;:&amp;#39;&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;&lt;/span&gt;
&lt;span class="s1"&gt;        function ltrim(s) {sub(/^[ \t]+/, &amp;quot;&amp;quot;, s);return s}&lt;/span&gt;
&lt;span class="s1"&gt;        function rtrim(s) {sub(/[ \t]+$/, &amp;quot;&amp;quot;, s);return s}&lt;/span&gt;
&lt;span class="s1"&gt;        function trim(s)  {return rtrim(ltrim(s))}&lt;/span&gt;
&lt;span class="s1"&gt;        /Virtual Drive:/  {drivecounter += 1; slot[drivecounter] = trim($2)}&lt;/span&gt;
&lt;span class="s1"&gt;        /State/           {state[drivecounter]    = trim($2)}&lt;/span&gt;
&lt;span class="s1"&gt;        /Bad Blocks/      {badblock[drivecounter] = trim($2)}&lt;/span&gt;
&lt;span class="s1"&gt;        END {&lt;/span&gt;
&lt;span class="s1"&gt;            for (i = 1; i &amp;lt;= drivecounter; i += 1) {&lt;/span&gt;
&lt;span class="s1"&gt;                printf (&amp;quot;- lsimegaraid.data[VirtualDrive%d,state] %s\n&amp;quot;, slot[i], state[i])&lt;/span&gt;
&lt;span class="s1"&gt;                printf (&amp;quot;- lsimegaraid.data[VirtualDrive%d,badblock] %s\n&amp;quot;, slot[i], badblock[i]?badblock[i]:&amp;quot;Unknown&amp;quot;)&lt;/span&gt;
&lt;span class="s1"&gt;            }&lt;/span&gt;
&lt;span class="s1"&gt;        }&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="o"&gt;[&lt;/span&gt; &lt;span class="nv"&gt;$?&lt;/span&gt; -gt &lt;span class="m"&gt;1&lt;/span&gt; &lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;ERROR  : MegaCli failed while getting virtual drives data!&amp;#39;&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class="nb"&gt;exit&lt;/span&gt; &lt;span class="m"&gt;1&lt;/span&gt;
    &lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="p"&gt;|&lt;/span&gt; &lt;span class="nv"&gt;$ZABBIX_SENDER&lt;/span&gt; --config &lt;span class="nv"&gt;$CONFIG&lt;/span&gt; -vv --input-file - &amp;gt;/dev/null &lt;span class="m"&gt;2&lt;/span&gt;&amp;gt;&lt;span class="p"&gt;&amp;amp;&lt;/span&gt;&lt;span class="m"&gt;1&lt;/span&gt;
    &lt;span class="o"&gt;[&lt;/span&gt; &lt;span class="nv"&gt;$?&lt;/span&gt; -gt &lt;span class="m"&gt;1&lt;/span&gt; &lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="m"&gt;0&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class="nb"&gt;exit&lt;/span&gt; &lt;span class="m"&gt;1&lt;/span&gt;
    &lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="m"&gt;1&lt;/span&gt; &lt;span class="c1"&gt;# 1 - Ok | 0 - Fail&lt;/span&gt;
&lt;span class="o"&gt;}&lt;/span&gt;

&lt;span class="k"&gt;case&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;$1&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt; in
    help&lt;span class="p"&gt;|&lt;/span&gt;usage&lt;span class="p"&gt;|&lt;/span&gt;-h&lt;span class="p"&gt;|&lt;/span&gt;--help&lt;span class="o"&gt;)&lt;/span&gt; usage &lt;span class="p"&gt;;;&lt;/span&gt;
    discovery&lt;span class="o"&gt;)&lt;/span&gt; discovery &lt;span class="nv"&gt;$2&lt;/span&gt; &lt;span class="nv"&gt;$3&lt;/span&gt; &lt;span class="p"&gt;;;&lt;/span&gt;
    trapper&lt;span class="o"&gt;)&lt;/span&gt; trapper &lt;span class="nv"&gt;$2&lt;/span&gt; &lt;span class="p"&gt;;;&lt;/span&gt;
    *&lt;span class="o"&gt;)&lt;/span&gt; discovery &lt;span class="p"&gt;;;&lt;/span&gt;
&lt;span class="k"&gt;esac&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Установка прав на скрипт:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;chown root:zabbix /etc/zabbix/scripts/lsimegaraid_discovery_trapper.sh
chmod &lt;span class="m"&gt;750&lt;/span&gt; /etc/zabbix/scripts/lsimegaraid_discovery_trapper.sh
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Не забываем про настройки в скрипте, где нужно указать полные пути до необходимых программ и конфигурационных файлов:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nv"&gt;MEGACLI&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;/usr/local/sbin/MegaCli&amp;#39;&lt;/span&gt;
&lt;span class="nv"&gt;ZABBIX_SENDER&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;/usr/local/bin/zabbix_sender&amp;#39;&lt;/span&gt;
&lt;span class="nv"&gt;CONFIG&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;/etc/zabbix/zabbix_agentd.conf&amp;#39;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Конфигурационный файл &lt;code&gt;/etc/zabbix/zabbix_agentd.conf.d/lsimegaraid.conf&lt;/code&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nv"&gt;UserParameter&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;lsimegaraid.discovery&lt;span class="o"&gt;[&lt;/span&gt;*&lt;span class="o"&gt;]&lt;/span&gt;,/usr/local/etc/zabbix24/scripts/lsimegaraid_discovery_trapper.sh &lt;span class="s2"&gt;&amp;quot;discovery&amp;quot;&lt;/span&gt; &lt;span class="nv"&gt;$1&lt;/span&gt; &lt;span class="nv"&gt;$2&lt;/span&gt;
&lt;span class="nv"&gt;UserParameter&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;lsimegaraid.trapper&lt;span class="o"&gt;[&lt;/span&gt;*&lt;span class="o"&gt;]&lt;/span&gt;,/usr/local/etc/zabbix24/scripts/lsimegaraid_discovery_trapper.sh &lt;span class="s2"&gt;&amp;quot;trapper&amp;quot;&lt;/span&gt; &lt;span class="nv"&gt;$1&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Шаблон для &lt;strong&gt;zabbix&lt;/strong&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nt"&gt;&amp;lt;zabbix_export&amp;gt;&lt;/span&gt;
    &lt;span class="nt"&gt;&amp;lt;version&amp;gt;&lt;/span&gt;2.0&lt;span class="nt"&gt;&amp;lt;/version&amp;gt;&lt;/span&gt;
    &lt;span class="nt"&gt;&amp;lt;date&amp;gt;&lt;/span&gt;2015-03-16T07:54:05Z&lt;span class="nt"&gt;&amp;lt;/date&amp;gt;&lt;/span&gt;
    &lt;span class="nt"&gt;&amp;lt;groups&amp;gt;&lt;/span&gt;
        &lt;span class="nt"&gt;&amp;lt;group&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;name&amp;gt;&lt;/span&gt;MyTemplates&lt;span class="nt"&gt;&amp;lt;/name&amp;gt;&lt;/span&gt;
        &lt;span class="nt"&gt;&amp;lt;/group&amp;gt;&lt;/span&gt;
    &lt;span class="nt"&gt;&amp;lt;/groups&amp;gt;&lt;/span&gt;
    &lt;span class="nt"&gt;&amp;lt;templates&amp;gt;&lt;/span&gt;
        &lt;span class="nt"&gt;&amp;lt;template&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;template&amp;gt;&lt;/span&gt;Template LSIMegaRaid_trapper&lt;span class="nt"&gt;&amp;lt;/template&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;name&amp;gt;&lt;/span&gt;Template LSIMegaRaid_trapper&lt;span class="nt"&gt;&amp;lt;/name&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;description/&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;groups&amp;gt;&lt;/span&gt;
                &lt;span class="nt"&gt;&amp;lt;group&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;name&amp;gt;&lt;/span&gt;MyTemplates&lt;span class="nt"&gt;&amp;lt;/name&amp;gt;&lt;/span&gt;
                &lt;span class="nt"&gt;&amp;lt;/group&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;/groups&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;applications&amp;gt;&lt;/span&gt;
                &lt;span class="nt"&gt;&amp;lt;application&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;name&amp;gt;&lt;/span&gt;LSI MegaRaid&lt;span class="nt"&gt;&amp;lt;/name&amp;gt;&lt;/span&gt;
                &lt;span class="nt"&gt;&amp;lt;/application&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;/applications&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;items&amp;gt;&lt;/span&gt;
                &lt;span class="nt"&gt;&amp;lt;item&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;name&amp;gt;&lt;/span&gt;Trapper&lt;span class="nt"&gt;&amp;lt;/name&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;type&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/type&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmp_community/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;multiplier&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/multiplier&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmp_oid/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;key&amp;gt;&lt;/span&gt;lsimegaraid.trapper[0]&lt;span class="nt"&gt;&amp;lt;/key&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;delay&amp;gt;&lt;/span&gt;30&lt;span class="nt"&gt;&amp;lt;/delay&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;history&amp;gt;&lt;/span&gt;90&lt;span class="nt"&gt;&amp;lt;/history&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;trends&amp;gt;&lt;/span&gt;365&lt;span class="nt"&gt;&amp;lt;/trends&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;status&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/status&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;value_type&amp;gt;&lt;/span&gt;3&lt;span class="nt"&gt;&amp;lt;/value_type&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;allowed_hosts/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;units/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;delta&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/delta&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_contextname/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_securityname/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_securitylevel&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/snmpv3_securitylevel&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_authprotocol&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/snmpv3_authprotocol&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_authpassphrase/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_privprotocol&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/snmpv3_privprotocol&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_privpassphrase/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;formula&amp;gt;&lt;/span&gt;1&lt;span class="nt"&gt;&amp;lt;/formula&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;delay_flex/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;params/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;ipmi_sensor/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;data_type&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/data_type&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;authtype&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/authtype&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;username/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;password/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;publickey/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;privatekey/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;port/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;description/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;inventory_link&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/inventory_link&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;applications&amp;gt;&lt;/span&gt;
                        &lt;span class="nt"&gt;&amp;lt;application&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;name&amp;gt;&lt;/span&gt;LSI MegaRaid&lt;span class="nt"&gt;&amp;lt;/name&amp;gt;&lt;/span&gt;
                        &lt;span class="nt"&gt;&amp;lt;/application&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;/applications&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;valuemap/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;logtimefmt/&amp;gt;&lt;/span&gt;
                &lt;span class="nt"&gt;&amp;lt;/item&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;/items&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;discovery_rules&amp;gt;&lt;/span&gt;
                &lt;span class="nt"&gt;&amp;lt;discovery_rule&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;name&amp;gt;&lt;/span&gt;LSIMegaRaid: Physical disks slot discovery&lt;span class="nt"&gt;&amp;lt;/name&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;type&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/type&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmp_community/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmp_oid/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;key&amp;gt;&lt;/span&gt;lsimegaraid.discovery[physdiscovery,0]&lt;span class="nt"&gt;&amp;lt;/key&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;delay&amp;gt;&lt;/span&gt;3600&lt;span class="nt"&gt;&amp;lt;/delay&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;status&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/status&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;allowed_hosts/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_contextname/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_securityname/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_securitylevel&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/snmpv3_securitylevel&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_authprotocol&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/snmpv3_authprotocol&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_authpassphrase/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_privprotocol&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/snmpv3_privprotocol&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_privpassphrase/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;delay_flex/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;params/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;ipmi_sensor/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;authtype&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/authtype&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;username/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;password/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;publickey/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;privatekey/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;port/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;filter&amp;gt;&lt;/span&gt;
                        &lt;span class="nt"&gt;&amp;lt;evaltype&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/evaltype&amp;gt;&lt;/span&gt;
                        &lt;span class="nt"&gt;&amp;lt;formula/&amp;gt;&lt;/span&gt;
                        &lt;span class="nt"&gt;&amp;lt;conditions/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;/filter&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;lifetime&amp;gt;&lt;/span&gt;30&lt;span class="nt"&gt;&amp;lt;/lifetime&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;description/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;item_prototypes&amp;gt;&lt;/span&gt;
                        &lt;span class="nt"&gt;&amp;lt;item_prototype&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;name&amp;gt;&lt;/span&gt;LSIMegaRaid: $1 Firmware State&lt;span class="nt"&gt;&amp;lt;/name&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;type&amp;gt;&lt;/span&gt;2&lt;span class="nt"&gt;&amp;lt;/type&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;snmp_community/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;multiplier&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/multiplier&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;snmp_oid/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;key&amp;gt;&lt;/span&gt;lsimegaraid.data[{#PHYSNUM},state]&lt;span class="nt"&gt;&amp;lt;/key&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;delay&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/delay&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;history&amp;gt;&lt;/span&gt;365&lt;span class="nt"&gt;&amp;lt;/history&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;trends&amp;gt;&lt;/span&gt;365&lt;span class="nt"&gt;&amp;lt;/trends&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;status&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/status&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;value_type&amp;gt;&lt;/span&gt;4&lt;span class="nt"&gt;&amp;lt;/value_type&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;allowed_hosts/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;units/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;delta&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/delta&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;snmpv3_contextname/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;snmpv3_securityname/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;snmpv3_securitylevel&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/snmpv3_securitylevel&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;snmpv3_authprotocol&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/snmpv3_authprotocol&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;snmpv3_authpassphrase/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;snmpv3_privprotocol&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/snmpv3_privprotocol&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;snmpv3_privpassphrase/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;formula&amp;gt;&lt;/span&gt;1&lt;span class="nt"&gt;&amp;lt;/formula&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;delay_flex/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;params/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;ipmi_sensor/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;data_type&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/data_type&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;authtype&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/authtype&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;username/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;password/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;publickey/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;privatekey/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;port/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;description/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;inventory_link&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/inventory_link&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;applications&amp;gt;&lt;/span&gt;
                                &lt;span class="nt"&gt;&amp;lt;application&amp;gt;&lt;/span&gt;
                                    &lt;span class="nt"&gt;&amp;lt;name&amp;gt;&lt;/span&gt;LSI MegaRaid&lt;span class="nt"&gt;&amp;lt;/name&amp;gt;&lt;/span&gt;
                                &lt;span class="nt"&gt;&amp;lt;/application&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;/applications&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;valuemap/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;logtimefmt/&amp;gt;&lt;/span&gt;
                        &lt;span class="nt"&gt;&amp;lt;/item_prototype&amp;gt;&lt;/span&gt;
                        &lt;span class="nt"&gt;&amp;lt;item_prototype&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;name&amp;gt;&lt;/span&gt;LSIMegaRaid: $1 has flagged a S.M.A.R.T alert&lt;span class="nt"&gt;&amp;lt;/name&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;type&amp;gt;&lt;/span&gt;2&lt;span class="nt"&gt;&amp;lt;/type&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;snmp_community/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;multiplier&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/multiplier&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;snmp_oid/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;key&amp;gt;&lt;/span&gt;lsimegaraid.data[{#PHYSNUM},smart]&lt;span class="nt"&gt;&amp;lt;/key&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;delay&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/delay&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;history&amp;gt;&lt;/span&gt;365&lt;span class="nt"&gt;&amp;lt;/history&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;trends&amp;gt;&lt;/span&gt;365&lt;span class="nt"&gt;&amp;lt;/trends&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;status&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/status&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;value_type&amp;gt;&lt;/span&gt;4&lt;span class="nt"&gt;&amp;lt;/value_type&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;allowed_hosts/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;units/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;delta&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/delta&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;snmpv3_contextname/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;snmpv3_securityname/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;snmpv3_securitylevel&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/snmpv3_securitylevel&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;snmpv3_authprotocol&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/snmpv3_authprotocol&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;snmpv3_authpassphrase/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;snmpv3_privprotocol&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/snmpv3_privprotocol&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;snmpv3_privpassphrase/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;formula&amp;gt;&lt;/span&gt;1&lt;span class="nt"&gt;&amp;lt;/formula&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;delay_flex/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;params/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;ipmi_sensor/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;data_type&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/data_type&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;authtype&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/authtype&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;username/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;password/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;publickey/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;privatekey/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;port/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;description/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;inventory_link&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/inventory_link&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;applications&amp;gt;&lt;/span&gt;
                                &lt;span class="nt"&gt;&amp;lt;application&amp;gt;&lt;/span&gt;
                                    &lt;span class="nt"&gt;&amp;lt;name&amp;gt;&lt;/span&gt;LSI MegaRaid&lt;span class="nt"&gt;&amp;lt;/name&amp;gt;&lt;/span&gt;
                                &lt;span class="nt"&gt;&amp;lt;/application&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;/applications&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;valuemap/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;logtimefmt/&amp;gt;&lt;/span&gt;
                        &lt;span class="nt"&gt;&amp;lt;/item_prototype&amp;gt;&lt;/span&gt;
                        &lt;span class="nt"&gt;&amp;lt;item_prototype&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;name&amp;gt;&lt;/span&gt;LSIMegaRaid: $1 Inquiry Data&lt;span class="nt"&gt;&amp;lt;/name&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;type&amp;gt;&lt;/span&gt;2&lt;span class="nt"&gt;&amp;lt;/type&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;snmp_community/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;multiplier&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/multiplier&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;snmp_oid/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;key&amp;gt;&lt;/span&gt;lsimegaraid.data[{#PHYSNUM},inquiry]&lt;span class="nt"&gt;&amp;lt;/key&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;delay&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/delay&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;history&amp;gt;&lt;/span&gt;365&lt;span class="nt"&gt;&amp;lt;/history&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;trends&amp;gt;&lt;/span&gt;365&lt;span class="nt"&gt;&amp;lt;/trends&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;status&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/status&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;value_type&amp;gt;&lt;/span&gt;4&lt;span class="nt"&gt;&amp;lt;/value_type&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;allowed_hosts/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;units/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;delta&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/delta&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;snmpv3_contextname/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;snmpv3_securityname/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;snmpv3_securitylevel&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/snmpv3_securitylevel&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;snmpv3_authprotocol&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/snmpv3_authprotocol&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;snmpv3_authpassphrase/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;snmpv3_privprotocol&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/snmpv3_privprotocol&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;snmpv3_privpassphrase/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;formula&amp;gt;&lt;/span&gt;1&lt;span class="nt"&gt;&amp;lt;/formula&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;delay_flex/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;params/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;ipmi_sensor/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;data_type&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/data_type&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;authtype&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/authtype&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;username/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;password/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;publickey/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;privatekey/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;port/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;description/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;inventory_link&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/inventory_link&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;applications&amp;gt;&lt;/span&gt;
                                &lt;span class="nt"&gt;&amp;lt;application&amp;gt;&lt;/span&gt;
                                    &lt;span class="nt"&gt;&amp;lt;name&amp;gt;&lt;/span&gt;LSI MegaRaid&lt;span class="nt"&gt;&amp;lt;/name&amp;gt;&lt;/span&gt;
                                &lt;span class="nt"&gt;&amp;lt;/application&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;/applications&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;valuemap/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;logtimefmt/&amp;gt;&lt;/span&gt;
                        &lt;span class="nt"&gt;&amp;lt;/item_prototype&amp;gt;&lt;/span&gt;
                        &lt;span class="nt"&gt;&amp;lt;item_prototype&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;name&amp;gt;&lt;/span&gt;LSIMegaRaid: $1 Media Error Count&lt;span class="nt"&gt;&amp;lt;/name&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;type&amp;gt;&lt;/span&gt;2&lt;span class="nt"&gt;&amp;lt;/type&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;snmp_community/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;multiplier&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/multiplier&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;snmp_oid/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;key&amp;gt;&lt;/span&gt;lsimegaraid.data[{#PHYSNUM},mediaerror]&lt;span class="nt"&gt;&amp;lt;/key&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;delay&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/delay&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;history&amp;gt;&lt;/span&gt;7&lt;span class="nt"&gt;&amp;lt;/history&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;trends&amp;gt;&lt;/span&gt;365&lt;span class="nt"&gt;&amp;lt;/trends&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;status&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/status&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;value_type&amp;gt;&lt;/span&gt;3&lt;span class="nt"&gt;&amp;lt;/value_type&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;allowed_hosts/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;units/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;delta&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/delta&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;snmpv3_contextname/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;snmpv3_securityname/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;snmpv3_securitylevel&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/snmpv3_securitylevel&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;snmpv3_authprotocol&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/snmpv3_authprotocol&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;snmpv3_authpassphrase/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;snmpv3_privprotocol&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/snmpv3_privprotocol&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;snmpv3_privpassphrase/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;formula&amp;gt;&lt;/span&gt;1&lt;span class="nt"&gt;&amp;lt;/formula&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;delay_flex/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;params/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;ipmi_sensor/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;data_type&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/data_type&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;authtype&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/authtype&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;username/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;password/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;publickey/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;privatekey/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;port/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;description/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;inventory_link&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/inventory_link&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;applications&amp;gt;&lt;/span&gt;
                                &lt;span class="nt"&gt;&amp;lt;application&amp;gt;&lt;/span&gt;
                                    &lt;span class="nt"&gt;&amp;lt;name&amp;gt;&lt;/span&gt;LSI MegaRaid&lt;span class="nt"&gt;&amp;lt;/name&amp;gt;&lt;/span&gt;
                                &lt;span class="nt"&gt;&amp;lt;/application&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;/applications&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;valuemap/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;logtimefmt/&amp;gt;&lt;/span&gt;
                        &lt;span class="nt"&gt;&amp;lt;/item_prototype&amp;gt;&lt;/span&gt;
                        &lt;span class="nt"&gt;&amp;lt;item_prototype&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;name&amp;gt;&lt;/span&gt;LSIMegaRaid: $1 Other Error Count&lt;span class="nt"&gt;&amp;lt;/name&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;type&amp;gt;&lt;/span&gt;2&lt;span class="nt"&gt;&amp;lt;/type&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;snmp_community/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;multiplier&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/multiplier&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;snmp_oid/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;key&amp;gt;&lt;/span&gt;lsimegaraid.data[{#PHYSNUM},othererror]&lt;span class="nt"&gt;&amp;lt;/key&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;delay&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/delay&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;history&amp;gt;&lt;/span&gt;7&lt;span class="nt"&gt;&amp;lt;/history&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;trends&amp;gt;&lt;/span&gt;365&lt;span class="nt"&gt;&amp;lt;/trends&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;status&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/status&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;value_type&amp;gt;&lt;/span&gt;3&lt;span class="nt"&gt;&amp;lt;/value_type&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;allowed_hosts/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;units/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;delta&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/delta&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;snmpv3_contextname/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;snmpv3_securityname/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;snmpv3_securitylevel&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/snmpv3_securitylevel&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;snmpv3_authprotocol&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/snmpv3_authprotocol&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;snmpv3_authpassphrase/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;snmpv3_privprotocol&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/snmpv3_privprotocol&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;snmpv3_privpassphrase/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;formula&amp;gt;&lt;/span&gt;1&lt;span class="nt"&gt;&amp;lt;/formula&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;delay_flex/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;params/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;ipmi_sensor/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;data_type&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/data_type&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;authtype&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/authtype&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;username/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;password/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;publickey/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;privatekey/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;port/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;description/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;inventory_link&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/inventory_link&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;applications&amp;gt;&lt;/span&gt;
                                &lt;span class="nt"&gt;&amp;lt;application&amp;gt;&lt;/span&gt;
                                    &lt;span class="nt"&gt;&amp;lt;name&amp;gt;&lt;/span&gt;LSI MegaRaid&lt;span class="nt"&gt;&amp;lt;/name&amp;gt;&lt;/span&gt;
                                &lt;span class="nt"&gt;&amp;lt;/application&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;/applications&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;valuemap/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;logtimefmt/&amp;gt;&lt;/span&gt;
                        &lt;span class="nt"&gt;&amp;lt;/item_prototype&amp;gt;&lt;/span&gt;
                        &lt;span class="nt"&gt;&amp;lt;item_prototype&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;name&amp;gt;&lt;/span&gt;LSIMegaRaid: $1 Predictive Failure Count&lt;span class="nt"&gt;&amp;lt;/name&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;type&amp;gt;&lt;/span&gt;2&lt;span class="nt"&gt;&amp;lt;/type&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;snmp_community/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;multiplier&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/multiplier&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;snmp_oid/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;key&amp;gt;&lt;/span&gt;lsimegaraid.data[{#PHYSNUM},failurecount]&lt;span class="nt"&gt;&amp;lt;/key&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;delay&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/delay&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;history&amp;gt;&lt;/span&gt;7&lt;span class="nt"&gt;&amp;lt;/history&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;trends&amp;gt;&lt;/span&gt;365&lt;span class="nt"&gt;&amp;lt;/trends&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;status&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/status&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;value_type&amp;gt;&lt;/span&gt;3&lt;span class="nt"&gt;&amp;lt;/value_type&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;allowed_hosts/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;units/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;delta&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/delta&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;snmpv3_contextname/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;snmpv3_securityname/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;snmpv3_securitylevel&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/snmpv3_securitylevel&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;snmpv3_authprotocol&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/snmpv3_authprotocol&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;snmpv3_authpassphrase/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;snmpv3_privprotocol&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/snmpv3_privprotocol&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;snmpv3_privpassphrase/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;formula&amp;gt;&lt;/span&gt;1&lt;span class="nt"&gt;&amp;lt;/formula&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;delay_flex/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;params/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;ipmi_sensor/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;data_type&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/data_type&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;authtype&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/authtype&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;username/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;password/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;publickey/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;privatekey/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;port/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;description/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;inventory_link&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/inventory_link&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;applications&amp;gt;&lt;/span&gt;
                                &lt;span class="nt"&gt;&amp;lt;application&amp;gt;&lt;/span&gt;
                                    &lt;span class="nt"&gt;&amp;lt;name&amp;gt;&lt;/span&gt;LSI MegaRaid&lt;span class="nt"&gt;&amp;lt;/name&amp;gt;&lt;/span&gt;
                                &lt;span class="nt"&gt;&amp;lt;/application&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;/applications&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;valuemap/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;logtimefmt/&amp;gt;&lt;/span&gt;
                        &lt;span class="nt"&gt;&amp;lt;/item_prototype&amp;gt;&lt;/span&gt;
                        &lt;span class="nt"&gt;&amp;lt;item_prototype&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;name&amp;gt;&lt;/span&gt;LSIMegaRaid: $1 Temperature&lt;span class="nt"&gt;&amp;lt;/name&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;type&amp;gt;&lt;/span&gt;2&lt;span class="nt"&gt;&amp;lt;/type&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;snmp_community/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;multiplier&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/multiplier&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;snmp_oid/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;key&amp;gt;&lt;/span&gt;lsimegaraid.data[{#PHYSNUM},temperature]&lt;span class="nt"&gt;&amp;lt;/key&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;delay&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/delay&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;history&amp;gt;&lt;/span&gt;7&lt;span class="nt"&gt;&amp;lt;/history&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;trends&amp;gt;&lt;/span&gt;365&lt;span class="nt"&gt;&amp;lt;/trends&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;status&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/status&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;value_type&amp;gt;&lt;/span&gt;3&lt;span class="nt"&gt;&amp;lt;/value_type&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;allowed_hosts/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;units&amp;gt;&lt;/span&gt;C&lt;span class="nt"&gt;&amp;lt;/units&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;delta&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/delta&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;snmpv3_contextname/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;snmpv3_securityname/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;snmpv3_securitylevel&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/snmpv3_securitylevel&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;snmpv3_authprotocol&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/snmpv3_authprotocol&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;snmpv3_authpassphrase/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;snmpv3_privprotocol&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/snmpv3_privprotocol&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;snmpv3_privpassphrase/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;formula&amp;gt;&lt;/span&gt;1&lt;span class="nt"&gt;&amp;lt;/formula&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;delay_flex/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;params/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;ipmi_sensor/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;data_type&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/data_type&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;authtype&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/authtype&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;username/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;password/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;publickey/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;privatekey/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;port/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;description/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;inventory_link&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/inventory_link&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;applications&amp;gt;&lt;/span&gt;
                                &lt;span class="nt"&gt;&amp;lt;application&amp;gt;&lt;/span&gt;
                                    &lt;span class="nt"&gt;&amp;lt;name&amp;gt;&lt;/span&gt;LSI MegaRaid&lt;span class="nt"&gt;&amp;lt;/name&amp;gt;&lt;/span&gt;
                                &lt;span class="nt"&gt;&amp;lt;/application&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;/applications&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;valuemap/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;logtimefmt/&amp;gt;&lt;/span&gt;
                        &lt;span class="nt"&gt;&amp;lt;/item_prototype&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;/item_prototypes&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;trigger_prototypes&amp;gt;&lt;/span&gt;
                        &lt;span class="nt"&gt;&amp;lt;trigger_prototype&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;expression&amp;gt;&lt;/span&gt;{Template LSIMegaRaid_trapper:lsimegaraid.data[{#PHYSNUM},smart].str(No)}=0&lt;span class="nt"&gt;&amp;lt;/expression&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;name&amp;gt;&lt;/span&gt;LSIMegaRaid: {#PHYSNUM} has flagged a S.M.A.R.T alert on {HOST.NAME}&lt;span class="nt"&gt;&amp;lt;/name&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;url/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;status&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/status&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;priority&amp;gt;&lt;/span&gt;5&lt;span class="nt"&gt;&amp;lt;/priority&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;description/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;type&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/type&amp;gt;&lt;/span&gt;
                        &lt;span class="nt"&gt;&amp;lt;/trigger_prototype&amp;gt;&lt;/span&gt;
                        &lt;span class="nt"&gt;&amp;lt;trigger_prototype&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;expression&amp;gt;&lt;/span&gt;{Template LSIMegaRaid_trapper:lsimegaraid.data[{#PHYSNUM},inquiry].diff(0)}&lt;span class="ni"&gt;&amp;amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/expression&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;name&amp;gt;&lt;/span&gt;LSIMegaRaid: {#PHYSNUM} inquiry data changed on {HOST.NAME}&lt;span class="nt"&gt;&amp;lt;/name&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;url/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;status&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/status&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;priority&amp;gt;&lt;/span&gt;1&lt;span class="nt"&gt;&amp;lt;/priority&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;description/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;type&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/type&amp;gt;&lt;/span&gt;
                        &lt;span class="nt"&gt;&amp;lt;/trigger_prototype&amp;gt;&lt;/span&gt;
                        &lt;span class="nt"&gt;&amp;lt;trigger_prototype&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;expression&amp;gt;&lt;/span&gt;{Template LSIMegaRaid_trapper:lsimegaraid.data[{#PHYSNUM},mediaerror].last(0)}&lt;span class="ni"&gt;&amp;amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/expression&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;name&amp;gt;&lt;/span&gt;LSIMegaRaid: {#PHYSNUM} Media Error Count on {HOST.NAME}&lt;span class="nt"&gt;&amp;lt;/name&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;url/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;status&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/status&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;priority&amp;gt;&lt;/span&gt;5&lt;span class="nt"&gt;&amp;lt;/priority&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;description/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;type&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/type&amp;gt;&lt;/span&gt;
                        &lt;span class="nt"&gt;&amp;lt;/trigger_prototype&amp;gt;&lt;/span&gt;
                        &lt;span class="nt"&gt;&amp;lt;trigger_prototype&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;expression&amp;gt;&lt;/span&gt;{Template LSIMegaRaid_trapper:lsimegaraid.data[{#PHYSNUM},othererror].last(0)}&lt;span class="ni"&gt;&amp;amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/expression&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;name&amp;gt;&lt;/span&gt;LSIMegaRaid: {#PHYSNUM} Other Error Count on {HOST.NAME}&lt;span class="nt"&gt;&amp;lt;/name&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;url/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;status&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/status&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;priority&amp;gt;&lt;/span&gt;5&lt;span class="nt"&gt;&amp;lt;/priority&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;description/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;type&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/type&amp;gt;&lt;/span&gt;
                        &lt;span class="nt"&gt;&amp;lt;/trigger_prototype&amp;gt;&lt;/span&gt;
                        &lt;span class="nt"&gt;&amp;lt;trigger_prototype&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;expression&amp;gt;&lt;/span&gt;{Template LSIMegaRaid_trapper:lsimegaraid.data[{#PHYSNUM},failurecount].last(0)}&lt;span class="ni"&gt;&amp;amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/expression&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;name&amp;gt;&lt;/span&gt;LSIMegaRaid: {#PHYSNUM} Predictive Failure Count on {HOST.NAME}&lt;span class="nt"&gt;&amp;lt;/name&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;url/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;status&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/status&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;priority&amp;gt;&lt;/span&gt;5&lt;span class="nt"&gt;&amp;lt;/priority&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;description/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;type&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/type&amp;gt;&lt;/span&gt;
                        &lt;span class="nt"&gt;&amp;lt;/trigger_prototype&amp;gt;&lt;/span&gt;
                        &lt;span class="nt"&gt;&amp;lt;trigger_prototype&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;expression&amp;gt;&lt;/span&gt;{Template LSIMegaRaid_trapper:lsimegaraid.data[{#PHYSNUM},state].str(Online)}=0&lt;span class="nt"&gt;&amp;lt;/expression&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;name&amp;gt;&lt;/span&gt;LSIMegaRaid: {#PHYSNUM} state is not online on {HOST.NAME}&lt;span class="nt"&gt;&amp;lt;/name&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;url/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;status&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/status&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;priority&amp;gt;&lt;/span&gt;5&lt;span class="nt"&gt;&amp;lt;/priority&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;description/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;type&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/type&amp;gt;&lt;/span&gt;
                        &lt;span class="nt"&gt;&amp;lt;/trigger_prototype&amp;gt;&lt;/span&gt;
                        &lt;span class="nt"&gt;&amp;lt;trigger_prototype&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;expression&amp;gt;&lt;/span&gt;{Template LSIMegaRaid_trapper:lsimegaraid.data[{#PHYSNUM},temperature].last(0)}&lt;span class="ni"&gt;&amp;amp;gt;&lt;/span&gt;45&lt;span class="nt"&gt;&amp;lt;/expression&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;name&amp;gt;&lt;/span&gt;LSIMegaRaid: {#PHYSNUM} temperature is high on {HOST.NAME}&lt;span class="nt"&gt;&amp;lt;/name&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;url/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;status&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/status&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;priority&amp;gt;&lt;/span&gt;4&lt;span class="nt"&gt;&amp;lt;/priority&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;description/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;type&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/type&amp;gt;&lt;/span&gt;
                        &lt;span class="nt"&gt;&amp;lt;/trigger_prototype&amp;gt;&lt;/span&gt;
                        &lt;span class="nt"&gt;&amp;lt;trigger_prototype&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;expression&amp;gt;&lt;/span&gt;{Template LSIMegaRaid_trapper:lsimegaraid.data[{#PHYSNUM},temperature].last(0)}&lt;span class="ni"&gt;&amp;amp;gt;&lt;/span&gt;49&lt;span class="nt"&gt;&amp;lt;/expression&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;name&amp;gt;&lt;/span&gt;LSIMegaRaid: {#PHYSNUM} temperature is very high on {HOST.NAME}&lt;span class="nt"&gt;&amp;lt;/name&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;url/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;status&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/status&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;priority&amp;gt;&lt;/span&gt;5&lt;span class="nt"&gt;&amp;lt;/priority&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;description/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;type&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/type&amp;gt;&lt;/span&gt;
                        &lt;span class="nt"&gt;&amp;lt;/trigger_prototype&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;/trigger_prototypes&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;graph_prototypes/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;host_prototypes/&amp;gt;&lt;/span&gt;
                &lt;span class="nt"&gt;&amp;lt;/discovery_rule&amp;gt;&lt;/span&gt;
                &lt;span class="nt"&gt;&amp;lt;discovery_rule&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;name&amp;gt;&lt;/span&gt;LSIMegaRaid: Virtual disks discovery&lt;span class="nt"&gt;&amp;lt;/name&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;type&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/type&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmp_community/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmp_oid/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;key&amp;gt;&lt;/span&gt;lsimegaraid.discovery[virtdiscovery,0]&lt;span class="nt"&gt;&amp;lt;/key&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;delay&amp;gt;&lt;/span&gt;3600&lt;span class="nt"&gt;&amp;lt;/delay&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;status&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/status&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;allowed_hosts/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_contextname/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_securityname/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_securitylevel&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/snmpv3_securitylevel&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_authprotocol&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/snmpv3_authprotocol&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_authpassphrase/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_privprotocol&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/snmpv3_privprotocol&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_privpassphrase/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;delay_flex/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;params/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;ipmi_sensor/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;authtype&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/authtype&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;username/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;password/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;publickey/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;privatekey/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;port/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;filter&amp;gt;&lt;/span&gt;
                        &lt;span class="nt"&gt;&amp;lt;evaltype&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/evaltype&amp;gt;&lt;/span&gt;
                        &lt;span class="nt"&gt;&amp;lt;formula/&amp;gt;&lt;/span&gt;
                        &lt;span class="nt"&gt;&amp;lt;conditions/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;/filter&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;lifetime&amp;gt;&lt;/span&gt;30&lt;span class="nt"&gt;&amp;lt;/lifetime&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;description/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;item_prototypes&amp;gt;&lt;/span&gt;
                        &lt;span class="nt"&gt;&amp;lt;item_prototype&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;name&amp;gt;&lt;/span&gt;LSIMegaRaid: $1 Bad Blocks Exist&lt;span class="nt"&gt;&amp;lt;/name&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;type&amp;gt;&lt;/span&gt;2&lt;span class="nt"&gt;&amp;lt;/type&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;snmp_community/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;multiplier&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/multiplier&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;snmp_oid/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;key&amp;gt;&lt;/span&gt;lsimegaraid.data[{#VIRTNUM},badblock]&lt;span class="nt"&gt;&amp;lt;/key&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;delay&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/delay&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;history&amp;gt;&lt;/span&gt;365&lt;span class="nt"&gt;&amp;lt;/history&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;trends&amp;gt;&lt;/span&gt;365&lt;span class="nt"&gt;&amp;lt;/trends&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;status&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/status&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;value_type&amp;gt;&lt;/span&gt;1&lt;span class="nt"&gt;&amp;lt;/value_type&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;allowed_hosts/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;units/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;delta&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/delta&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;snmpv3_contextname/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;snmpv3_securityname/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;snmpv3_securitylevel&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/snmpv3_securitylevel&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;snmpv3_authprotocol&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/snmpv3_authprotocol&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;snmpv3_authpassphrase/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;snmpv3_privprotocol&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/snmpv3_privprotocol&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;snmpv3_privpassphrase/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;formula&amp;gt;&lt;/span&gt;1&lt;span class="nt"&gt;&amp;lt;/formula&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;delay_flex/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;params/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;ipmi_sensor/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;data_type&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/data_type&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;authtype&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/authtype&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;username/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;password/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;publickey/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;privatekey/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;port/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;description/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;inventory_link&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/inventory_link&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;applications&amp;gt;&lt;/span&gt;
                                &lt;span class="nt"&gt;&amp;lt;application&amp;gt;&lt;/span&gt;
                                    &lt;span class="nt"&gt;&amp;lt;name&amp;gt;&lt;/span&gt;LSI MegaRaid&lt;span class="nt"&gt;&amp;lt;/name&amp;gt;&lt;/span&gt;
                                &lt;span class="nt"&gt;&amp;lt;/application&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;/applications&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;valuemap/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;logtimefmt/&amp;gt;&lt;/span&gt;
                        &lt;span class="nt"&gt;&amp;lt;/item_prototype&amp;gt;&lt;/span&gt;
                        &lt;span class="nt"&gt;&amp;lt;item_prototype&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;name&amp;gt;&lt;/span&gt;LSIMegaRaid: $1 State&lt;span class="nt"&gt;&amp;lt;/name&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;type&amp;gt;&lt;/span&gt;2&lt;span class="nt"&gt;&amp;lt;/type&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;snmp_community/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;multiplier&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/multiplier&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;snmp_oid/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;key&amp;gt;&lt;/span&gt;lsimegaraid.data[{#VIRTNUM},state]&lt;span class="nt"&gt;&amp;lt;/key&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;delay&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/delay&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;history&amp;gt;&lt;/span&gt;365&lt;span class="nt"&gt;&amp;lt;/history&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;trends&amp;gt;&lt;/span&gt;365&lt;span class="nt"&gt;&amp;lt;/trends&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;status&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/status&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;value_type&amp;gt;&lt;/span&gt;1&lt;span class="nt"&gt;&amp;lt;/value_type&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;allowed_hosts/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;units/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;delta&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/delta&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;snmpv3_contextname/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;snmpv3_securityname/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;snmpv3_securitylevel&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/snmpv3_securitylevel&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;snmpv3_authprotocol&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/snmpv3_authprotocol&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;snmpv3_authpassphrase/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;snmpv3_privprotocol&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/snmpv3_privprotocol&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;snmpv3_privpassphrase/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;formula&amp;gt;&lt;/span&gt;1&lt;span class="nt"&gt;&amp;lt;/formula&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;delay_flex/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;params/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;ipmi_sensor/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;data_type&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/data_type&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;authtype&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/authtype&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;username/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;password/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;publickey/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;privatekey/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;port/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;description/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;inventory_link&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/inventory_link&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;applications&amp;gt;&lt;/span&gt;
                                &lt;span class="nt"&gt;&amp;lt;application&amp;gt;&lt;/span&gt;
                                    &lt;span class="nt"&gt;&amp;lt;name&amp;gt;&lt;/span&gt;LSI MegaRaid&lt;span class="nt"&gt;&amp;lt;/name&amp;gt;&lt;/span&gt;
                                &lt;span class="nt"&gt;&amp;lt;/application&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;/applications&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;valuemap/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;logtimefmt/&amp;gt;&lt;/span&gt;
                        &lt;span class="nt"&gt;&amp;lt;/item_prototype&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;/item_prototypes&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;trigger_prototypes&amp;gt;&lt;/span&gt;
                        &lt;span class="nt"&gt;&amp;lt;trigger_prototype&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;expression&amp;gt;&lt;/span&gt;{Template LSIMegaRaid_trapper:lsimegaraid.data[{#VIRTNUM},badblock].str(No)}=0&lt;span class="nt"&gt;&amp;lt;/expression&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;name&amp;gt;&lt;/span&gt;LSIMegaRaid: {#VIRTNUM} Bad Blocks Exist on {HOST.NAME}&lt;span class="nt"&gt;&amp;lt;/name&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;url/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;status&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/status&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;priority&amp;gt;&lt;/span&gt;5&lt;span class="nt"&gt;&amp;lt;/priority&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;description/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;type&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/type&amp;gt;&lt;/span&gt;
                        &lt;span class="nt"&gt;&amp;lt;/trigger_prototype&amp;gt;&lt;/span&gt;
                        &lt;span class="nt"&gt;&amp;lt;trigger_prototype&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;expression&amp;gt;&lt;/span&gt;{Template LSIMegaRaid_trapper:lsimegaraid.data[{#VIRTNUM},state].str(Optimal)}=0&lt;span class="nt"&gt;&amp;lt;/expression&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;name&amp;gt;&lt;/span&gt;LSIMegaRaid: {#VIRTNUM} state is not optimal on {HOST.NAME}&lt;span class="nt"&gt;&amp;lt;/name&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;url/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;status&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/status&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;priority&amp;gt;&lt;/span&gt;5&lt;span class="nt"&gt;&amp;lt;/priority&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;description/&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;type&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/type&amp;gt;&lt;/span&gt;
                        &lt;span class="nt"&gt;&amp;lt;/trigger_prototype&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;/trigger_prototypes&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;graph_prototypes/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;host_prototypes/&amp;gt;&lt;/span&gt;
                &lt;span class="nt"&gt;&amp;lt;/discovery_rule&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;/discovery_rules&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;macros/&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;templates/&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;screens/&amp;gt;&lt;/span&gt;
        &lt;span class="nt"&gt;&amp;lt;/template&amp;gt;&lt;/span&gt;
    &lt;span class="nt"&gt;&amp;lt;/templates&amp;gt;&lt;/span&gt;
&lt;span class="nt"&gt;&amp;lt;/zabbix_export&amp;gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;hr&gt;
&lt;p&gt;Ссылки по теме:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href="http://wiki.enchtex.info/howto/zabbix/zabbix_megaraid_monitoring"&gt;Мониторинг LSI MegaRAID в Zabbix&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://ru.intel.com/business/community/?automodule=blog&amp;amp;blogid=44433&amp;amp;showentry=2452"&gt;Мониторинг состояния HDD в RAID контроллере LSI MegaRAID под Linux, средствами Nagios.&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://odesk.by/archives/1922"&gt;Intel Raid Controller RS2BL040 Slow Performance – BBU problems.&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://twiki.cern.ch/twiki/bin/view/FIOgroup/DiskRefPerc"&gt;Perc RAID Controllers&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://community.mcafee.com/docs/DOC-5318"&gt;Adding a Hard Drive back into RAID on a Web Gateway 5000 or 5500 Intel based Appliance&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;</content><category term="Zabbix"></category><category term="LSI"></category><category term="Megaraid"></category><category term="Monitoring"></category></entry><entry><title>Найти все хардлинки(hardlinks) файла</title><link href="https://metajiji.github.io/blog/find-all-hardlinks/" rel="alternate"></link><published>2015-01-16T00:00:00+06:00</published><updated>2015-01-16T00:00:00+06:00</updated><author><name>Denis Kadyshev</name></author><id>tag:metajiji.github.io,2015-01-16:/blog/find-all-hardlinks/</id><summary type="html">&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="ch"&gt;#!/bin/sh&lt;/span&gt;

&lt;span class="o"&gt;[&lt;/span&gt; -z &lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;$1&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt; &lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt; cat &lt;span class="s"&gt;&amp;lt;&amp;lt;-_EOF_ &amp;amp;&amp;amp; exit 1&lt;/span&gt;
&lt;span class="s"&gt;    Usage: ./$(basename $0) filename&lt;/span&gt;
&lt;span class="s"&gt;_EOF_&lt;/span&gt;

&lt;span class="nv"&gt;FILE&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nv"&gt;$1&lt;/span&gt;

&lt;span class="o"&gt;[&lt;/span&gt; ! -f &lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;$FILE&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt; &lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;File &lt;/span&gt;&lt;span class="nv"&gt;$FILE&lt;/span&gt;&lt;span class="s2"&gt; not exists! Exiting...&amp;quot;&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class="nb"&gt;exit&lt;/span&gt; &lt;span class="m"&gt;1&lt;/span&gt;
&lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="o"&gt;[&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="k"&gt;$(&lt;/span&gt;ls -ld &lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;$FILE&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt; &lt;span class="p"&gt;|&lt;/span&gt; awk &lt;span class="s1"&gt;&amp;#39;{print $2}&amp;#39;&lt;/span&gt;&lt;span class="k"&gt;)&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt; -ne &lt;span class="m"&gt;1&lt;/span&gt; &lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="k"&gt;then&lt;/span&gt;
    find &lt;span class="sb"&gt;`&lt;/span&gt;df &lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;$FILE&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt; &lt;span class="p"&gt;|&lt;/span&gt; tail -n+2 &lt;span class="p"&gt;|&lt;/span&gt; awk &lt;span class="s1"&gt;&amp;#39;{print $6}&amp;#39;&lt;/span&gt;&lt;span class="sb"&gt;`&lt;/span&gt; -xdev -inum &lt;span class="sb"&gt;`&lt;/span&gt;ls -i &lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;$FILE&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt; &lt;span class="p"&gt;|&lt;/span&gt; awk …&lt;/pre&gt;&lt;/div&gt;</summary><content type="html">&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="ch"&gt;#!/bin/sh&lt;/span&gt;

&lt;span class="o"&gt;[&lt;/span&gt; -z &lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;$1&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt; &lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt; cat &lt;span class="s"&gt;&amp;lt;&amp;lt;-_EOF_ &amp;amp;&amp;amp; exit 1&lt;/span&gt;
&lt;span class="s"&gt;    Usage: ./$(basename $0) filename&lt;/span&gt;
&lt;span class="s"&gt;_EOF_&lt;/span&gt;

&lt;span class="nv"&gt;FILE&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nv"&gt;$1&lt;/span&gt;

&lt;span class="o"&gt;[&lt;/span&gt; ! -f &lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;$FILE&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt; &lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;File &lt;/span&gt;&lt;span class="nv"&gt;$FILE&lt;/span&gt;&lt;span class="s2"&gt; not exists! Exiting...&amp;quot;&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class="nb"&gt;exit&lt;/span&gt; &lt;span class="m"&gt;1&lt;/span&gt;
&lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="o"&gt;[&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="k"&gt;$(&lt;/span&gt;ls -ld &lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;$FILE&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt; &lt;span class="p"&gt;|&lt;/span&gt; awk &lt;span class="s1"&gt;&amp;#39;{print $2}&amp;#39;&lt;/span&gt;&lt;span class="k"&gt;)&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt; -ne &lt;span class="m"&gt;1&lt;/span&gt; &lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="k"&gt;then&lt;/span&gt;
    find &lt;span class="sb"&gt;`&lt;/span&gt;df &lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;$FILE&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt; &lt;span class="p"&gt;|&lt;/span&gt; tail -n+2 &lt;span class="p"&gt;|&lt;/span&gt; awk &lt;span class="s1"&gt;&amp;#39;{print $6}&amp;#39;&lt;/span&gt;&lt;span class="sb"&gt;`&lt;/span&gt; -xdev -inum &lt;span class="sb"&gt;`&lt;/span&gt;ls -i &lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;$FILE&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt; &lt;span class="p"&gt;|&lt;/span&gt; awk &lt;span class="s1"&gt;&amp;#39;{print $1}&amp;#39;&lt;/span&gt;&lt;span class="sb"&gt;`&lt;/span&gt;
&lt;span class="k"&gt;else&lt;/span&gt;
    &lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;File &lt;/span&gt;&lt;span class="nv"&gt;$FILE&lt;/span&gt;&lt;span class="s2"&gt; is got only 1(one) link on filesystem...&amp;quot;&lt;/span&gt;
    &lt;span class="nb"&gt;exit&lt;/span&gt; &lt;span class="m"&gt;1&lt;/span&gt;
&lt;span class="k"&gt;fi&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;hr&gt;
&lt;p&gt;Ссылки по теме:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href="http://superuser.com/questions/12972/how-can-you-see-the-actual-hard-link-by-ls"&gt;How can you see the actual hard link by ls?&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;</content><category term="FreeBSD"></category><category term="Linux"></category><category term="Bash"></category><category term="hardlinks"></category></entry><entry><title>Zabbix: TCP connections</title><link href="https://metajiji.github.io/blog/zabbix-tcp-connections/" rel="alternate"></link><published>2015-01-06T00:00:00+06:00</published><updated>2015-01-06T00:00:00+06:00</updated><author><name>Denis Kadyshev</name></author><id>tag:metajiji.github.io,2015-01-06:/blog/zabbix-tcp-connections/</id><summary type="html">&lt;p&gt;Скрипты и файлы конфигурации для мониторинга состояния TCP соединений.&lt;/p&gt;
&lt;p&gt;Шаблон для &lt;strong&gt;zabbix&lt;/strong&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="cp"&gt;&amp;lt;?xml version=&amp;quot;1.0&amp;quot; encoding=&amp;quot;UTF-8&amp;quot;?&amp;gt;&lt;/span&gt;
&lt;span class="nt"&gt;&amp;lt;zabbix_export&amp;gt;&lt;/span&gt;
    &lt;span class="nt"&gt;&amp;lt;version&amp;gt;&lt;/span&gt;2.0&lt;span class="nt"&gt;&amp;lt;/version&amp;gt;&lt;/span&gt;
    &lt;span class="nt"&gt;&amp;lt;date&amp;gt;&lt;/span&gt;2015-05-31T06:58:27Z&lt;span class="nt"&gt;&amp;lt;/date&amp;gt;&lt;/span&gt;
    &lt;span class="nt"&gt;&amp;lt;groups&amp;gt;&lt;/span&gt;
        &lt;span class="nt"&gt;&amp;lt;group&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;name&amp;gt;&lt;/span&gt;Linux servers&lt;span class="nt"&gt;&amp;lt;/name&amp;gt;&lt;/span&gt;
        &lt;span class="nt"&gt;&amp;lt;/group&amp;gt;&lt;/span&gt;
    &lt;span class="nt"&gt;&amp;lt;/groups&amp;gt;&lt;/span&gt;
    &lt;span class="nt"&gt;&amp;lt;templates&amp;gt;&lt;/span&gt;
        &lt;span class="nt"&gt;&amp;lt;template&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;template&amp;gt;&lt;/span&gt;Template UnixTcp&lt;span class="nt"&gt;&amp;lt;/template&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;name&amp;gt;&lt;/span&gt;Template UnixTcp&lt;span class="nt"&gt;&amp;lt;/name&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;groups&amp;gt;&lt;/span&gt;
                &lt;span class="nt"&gt;&amp;lt;group&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;name&amp;gt;&lt;/span&gt;Linux …&lt;/pre&gt;&lt;/div&gt;</summary><content type="html">&lt;p&gt;Скрипты и файлы конфигурации для мониторинга состояния TCP соединений.&lt;/p&gt;
&lt;p&gt;Шаблон для &lt;strong&gt;zabbix&lt;/strong&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="cp"&gt;&amp;lt;?xml version=&amp;quot;1.0&amp;quot; encoding=&amp;quot;UTF-8&amp;quot;?&amp;gt;&lt;/span&gt;
&lt;span class="nt"&gt;&amp;lt;zabbix_export&amp;gt;&lt;/span&gt;
    &lt;span class="nt"&gt;&amp;lt;version&amp;gt;&lt;/span&gt;2.0&lt;span class="nt"&gt;&amp;lt;/version&amp;gt;&lt;/span&gt;
    &lt;span class="nt"&gt;&amp;lt;date&amp;gt;&lt;/span&gt;2015-05-31T06:58:27Z&lt;span class="nt"&gt;&amp;lt;/date&amp;gt;&lt;/span&gt;
    &lt;span class="nt"&gt;&amp;lt;groups&amp;gt;&lt;/span&gt;
        &lt;span class="nt"&gt;&amp;lt;group&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;name&amp;gt;&lt;/span&gt;Linux servers&lt;span class="nt"&gt;&amp;lt;/name&amp;gt;&lt;/span&gt;
        &lt;span class="nt"&gt;&amp;lt;/group&amp;gt;&lt;/span&gt;
    &lt;span class="nt"&gt;&amp;lt;/groups&amp;gt;&lt;/span&gt;
    &lt;span class="nt"&gt;&amp;lt;templates&amp;gt;&lt;/span&gt;
        &lt;span class="nt"&gt;&amp;lt;template&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;template&amp;gt;&lt;/span&gt;Template UnixTcp&lt;span class="nt"&gt;&amp;lt;/template&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;name&amp;gt;&lt;/span&gt;Template UnixTcp&lt;span class="nt"&gt;&amp;lt;/name&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;groups&amp;gt;&lt;/span&gt;
                &lt;span class="nt"&gt;&amp;lt;group&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;name&amp;gt;&lt;/span&gt;Linux servers&lt;span class="nt"&gt;&amp;lt;/name&amp;gt;&lt;/span&gt;
                &lt;span class="nt"&gt;&amp;lt;/group&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;/groups&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;applications&amp;gt;&lt;/span&gt;
                &lt;span class="nt"&gt;&amp;lt;application&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;name&amp;gt;&lt;/span&gt;TCP&lt;span class="nt"&gt;&amp;lt;/name&amp;gt;&lt;/span&gt;
                &lt;span class="nt"&gt;&amp;lt;/application&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;/applications&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;items&amp;gt;&lt;/span&gt;
                &lt;span class="nt"&gt;&amp;lt;item&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;name&amp;gt;&lt;/span&gt;CLOSE_WAIT&lt;span class="nt"&gt;&amp;lt;/name&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;type&amp;gt;&lt;/span&gt;2&lt;span class="nt"&gt;&amp;lt;/type&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmp_community/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;multiplier&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/multiplier&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmp_oid/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;key&amp;gt;&lt;/span&gt;tcp.closew&lt;span class="nt"&gt;&amp;lt;/key&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;delay&amp;gt;&lt;/span&gt;60&lt;span class="nt"&gt;&amp;lt;/delay&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;history&amp;gt;&lt;/span&gt;7&lt;span class="nt"&gt;&amp;lt;/history&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;trends&amp;gt;&lt;/span&gt;365&lt;span class="nt"&gt;&amp;lt;/trends&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;status&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/status&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;value_type&amp;gt;&lt;/span&gt;3&lt;span class="nt"&gt;&amp;lt;/value_type&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;allowed_hosts/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;units/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;delta&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/delta&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_contextname/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_securityname/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_securitylevel&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/snmpv3_securitylevel&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_authprotocol&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/snmpv3_authprotocol&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_authpassphrase/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_privprotocol&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/snmpv3_privprotocol&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_privpassphrase/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;formula&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/formula&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;delay_flex/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;params/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;ipmi_sensor/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;data_type&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/data_type&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;authtype&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/authtype&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;username/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;password/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;publickey/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;privatekey/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;port/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;description/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;inventory_link&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/inventory_link&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;applications&amp;gt;&lt;/span&gt;
                        &lt;span class="nt"&gt;&amp;lt;application&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;name&amp;gt;&lt;/span&gt;TCP&lt;span class="nt"&gt;&amp;lt;/name&amp;gt;&lt;/span&gt;
                        &lt;span class="nt"&gt;&amp;lt;/application&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;/applications&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;valuemap/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;logtimefmt/&amp;gt;&lt;/span&gt;
                &lt;span class="nt"&gt;&amp;lt;/item&amp;gt;&lt;/span&gt;
                &lt;span class="nt"&gt;&amp;lt;item&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;name&amp;gt;&lt;/span&gt;ESTABLISHED&lt;span class="nt"&gt;&amp;lt;/name&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;type&amp;gt;&lt;/span&gt;2&lt;span class="nt"&gt;&amp;lt;/type&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmp_community/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;multiplier&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/multiplier&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmp_oid/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;key&amp;gt;&lt;/span&gt;tcp.establ&lt;span class="nt"&gt;&amp;lt;/key&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;delay&amp;gt;&lt;/span&gt;60&lt;span class="nt"&gt;&amp;lt;/delay&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;history&amp;gt;&lt;/span&gt;7&lt;span class="nt"&gt;&amp;lt;/history&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;trends&amp;gt;&lt;/span&gt;365&lt;span class="nt"&gt;&amp;lt;/trends&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;status&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/status&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;value_type&amp;gt;&lt;/span&gt;3&lt;span class="nt"&gt;&amp;lt;/value_type&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;allowed_hosts/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;units/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;delta&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/delta&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_contextname/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_securityname/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_securitylevel&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/snmpv3_securitylevel&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_authprotocol&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/snmpv3_authprotocol&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_authpassphrase/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_privprotocol&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/snmpv3_privprotocol&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_privpassphrase/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;formula&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/formula&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;delay_flex/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;params/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;ipmi_sensor/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;data_type&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/data_type&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;authtype&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/authtype&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;username/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;password/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;publickey/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;privatekey/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;port/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;description/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;inventory_link&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/inventory_link&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;applications&amp;gt;&lt;/span&gt;
                        &lt;span class="nt"&gt;&amp;lt;application&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;name&amp;gt;&lt;/span&gt;TCP&lt;span class="nt"&gt;&amp;lt;/name&amp;gt;&lt;/span&gt;
                        &lt;span class="nt"&gt;&amp;lt;/application&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;/applications&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;valuemap/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;logtimefmt/&amp;gt;&lt;/span&gt;
                &lt;span class="nt"&gt;&amp;lt;/item&amp;gt;&lt;/span&gt;
                &lt;span class="nt"&gt;&amp;lt;item&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;name&amp;gt;&lt;/span&gt;FIN_WAIT1&lt;span class="nt"&gt;&amp;lt;/name&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;type&amp;gt;&lt;/span&gt;2&lt;span class="nt"&gt;&amp;lt;/type&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmp_community/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;multiplier&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/multiplier&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmp_oid/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;key&amp;gt;&lt;/span&gt;tcp.finw1&lt;span class="nt"&gt;&amp;lt;/key&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;delay&amp;gt;&lt;/span&gt;60&lt;span class="nt"&gt;&amp;lt;/delay&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;history&amp;gt;&lt;/span&gt;7&lt;span class="nt"&gt;&amp;lt;/history&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;trends&amp;gt;&lt;/span&gt;365&lt;span class="nt"&gt;&amp;lt;/trends&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;status&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/status&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;value_type&amp;gt;&lt;/span&gt;3&lt;span class="nt"&gt;&amp;lt;/value_type&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;allowed_hosts/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;units/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;delta&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/delta&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_contextname/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_securityname/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_securitylevel&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/snmpv3_securitylevel&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_authprotocol&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/snmpv3_authprotocol&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_authpassphrase/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_privprotocol&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/snmpv3_privprotocol&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_privpassphrase/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;formula&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/formula&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;delay_flex/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;params/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;ipmi_sensor/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;data_type&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/data_type&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;authtype&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/authtype&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;username/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;password/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;publickey/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;privatekey/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;port/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;description/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;inventory_link&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/inventory_link&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;applications&amp;gt;&lt;/span&gt;
                        &lt;span class="nt"&gt;&amp;lt;application&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;name&amp;gt;&lt;/span&gt;TCP&lt;span class="nt"&gt;&amp;lt;/name&amp;gt;&lt;/span&gt;
                        &lt;span class="nt"&gt;&amp;lt;/application&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;/applications&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;valuemap/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;logtimefmt/&amp;gt;&lt;/span&gt;
                &lt;span class="nt"&gt;&amp;lt;/item&amp;gt;&lt;/span&gt;
                &lt;span class="nt"&gt;&amp;lt;item&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;name&amp;gt;&lt;/span&gt;FIN_WAIT2&lt;span class="nt"&gt;&amp;lt;/name&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;type&amp;gt;&lt;/span&gt;2&lt;span class="nt"&gt;&amp;lt;/type&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmp_community/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;multiplier&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/multiplier&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmp_oid/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;key&amp;gt;&lt;/span&gt;tcp.finw2&lt;span class="nt"&gt;&amp;lt;/key&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;delay&amp;gt;&lt;/span&gt;60&lt;span class="nt"&gt;&amp;lt;/delay&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;history&amp;gt;&lt;/span&gt;7&lt;span class="nt"&gt;&amp;lt;/history&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;trends&amp;gt;&lt;/span&gt;365&lt;span class="nt"&gt;&amp;lt;/trends&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;status&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/status&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;value_type&amp;gt;&lt;/span&gt;3&lt;span class="nt"&gt;&amp;lt;/value_type&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;allowed_hosts/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;units/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;delta&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/delta&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_contextname/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_securityname/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_securitylevel&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/snmpv3_securitylevel&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_authprotocol&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/snmpv3_authprotocol&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_authpassphrase/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_privprotocol&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/snmpv3_privprotocol&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_privpassphrase/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;formula&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/formula&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;delay_flex/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;params/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;ipmi_sensor/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;data_type&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/data_type&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;authtype&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/authtype&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;username/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;password/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;publickey/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;privatekey/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;port/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;description/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;inventory_link&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/inventory_link&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;applications&amp;gt;&lt;/span&gt;
                        &lt;span class="nt"&gt;&amp;lt;application&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;name&amp;gt;&lt;/span&gt;TCP&lt;span class="nt"&gt;&amp;lt;/name&amp;gt;&lt;/span&gt;
                        &lt;span class="nt"&gt;&amp;lt;/application&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;/applications&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;valuemap/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;logtimefmt/&amp;gt;&lt;/span&gt;
                &lt;span class="nt"&gt;&amp;lt;/item&amp;gt;&lt;/span&gt;
                &lt;span class="nt"&gt;&amp;lt;item&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;name&amp;gt;&lt;/span&gt;LISTEN&lt;span class="nt"&gt;&amp;lt;/name&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;type&amp;gt;&lt;/span&gt;2&lt;span class="nt"&gt;&amp;lt;/type&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmp_community/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;multiplier&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/multiplier&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmp_oid/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;key&amp;gt;&lt;/span&gt;tcp.listen&lt;span class="nt"&gt;&amp;lt;/key&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;delay&amp;gt;&lt;/span&gt;60&lt;span class="nt"&gt;&amp;lt;/delay&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;history&amp;gt;&lt;/span&gt;7&lt;span class="nt"&gt;&amp;lt;/history&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;trends&amp;gt;&lt;/span&gt;365&lt;span class="nt"&gt;&amp;lt;/trends&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;status&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/status&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;value_type&amp;gt;&lt;/span&gt;3&lt;span class="nt"&gt;&amp;lt;/value_type&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;allowed_hosts/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;units/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;delta&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/delta&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_contextname/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_securityname/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_securitylevel&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/snmpv3_securitylevel&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_authprotocol&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/snmpv3_authprotocol&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_authpassphrase/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_privprotocol&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/snmpv3_privprotocol&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_privpassphrase/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;formula&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/formula&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;delay_flex/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;params/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;ipmi_sensor/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;data_type&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/data_type&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;authtype&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/authtype&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;username/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;password/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;publickey/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;privatekey/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;port/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;description/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;inventory_link&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/inventory_link&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;applications&amp;gt;&lt;/span&gt;
                        &lt;span class="nt"&gt;&amp;lt;application&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;name&amp;gt;&lt;/span&gt;TCP&lt;span class="nt"&gt;&amp;lt;/name&amp;gt;&lt;/span&gt;
                        &lt;span class="nt"&gt;&amp;lt;/application&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;/applications&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;valuemap/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;logtimefmt/&amp;gt;&lt;/span&gt;
                &lt;span class="nt"&gt;&amp;lt;/item&amp;gt;&lt;/span&gt;
                &lt;span class="nt"&gt;&amp;lt;item&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;name&amp;gt;&lt;/span&gt;SYN_RECV&lt;span class="nt"&gt;&amp;lt;/name&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;type&amp;gt;&lt;/span&gt;2&lt;span class="nt"&gt;&amp;lt;/type&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmp_community/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;multiplier&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/multiplier&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmp_oid/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;key&amp;gt;&lt;/span&gt;tcp.synrecv&lt;span class="nt"&gt;&amp;lt;/key&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;delay&amp;gt;&lt;/span&gt;60&lt;span class="nt"&gt;&amp;lt;/delay&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;history&amp;gt;&lt;/span&gt;7&lt;span class="nt"&gt;&amp;lt;/history&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;trends&amp;gt;&lt;/span&gt;365&lt;span class="nt"&gt;&amp;lt;/trends&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;status&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/status&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;value_type&amp;gt;&lt;/span&gt;3&lt;span class="nt"&gt;&amp;lt;/value_type&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;allowed_hosts/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;units/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;delta&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/delta&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_contextname/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_securityname/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_securitylevel&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/snmpv3_securitylevel&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_authprotocol&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/snmpv3_authprotocol&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_authpassphrase/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_privprotocol&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/snmpv3_privprotocol&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_privpassphrase/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;formula&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/formula&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;delay_flex/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;params/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;ipmi_sensor/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;data_type&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/data_type&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;authtype&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/authtype&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;username/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;password/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;publickey/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;privatekey/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;port/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;description/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;inventory_link&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/inventory_link&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;applications&amp;gt;&lt;/span&gt;
                        &lt;span class="nt"&gt;&amp;lt;application&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;name&amp;gt;&lt;/span&gt;TCP&lt;span class="nt"&gt;&amp;lt;/name&amp;gt;&lt;/span&gt;
                        &lt;span class="nt"&gt;&amp;lt;/application&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;/applications&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;valuemap/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;logtimefmt/&amp;gt;&lt;/span&gt;
                &lt;span class="nt"&gt;&amp;lt;/item&amp;gt;&lt;/span&gt;
                &lt;span class="nt"&gt;&amp;lt;item&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;name&amp;gt;&lt;/span&gt;SYN_SENT&lt;span class="nt"&gt;&amp;lt;/name&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;type&amp;gt;&lt;/span&gt;2&lt;span class="nt"&gt;&amp;lt;/type&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmp_community/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;multiplier&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/multiplier&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmp_oid/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;key&amp;gt;&lt;/span&gt;tcp.synsent&lt;span class="nt"&gt;&amp;lt;/key&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;delay&amp;gt;&lt;/span&gt;60&lt;span class="nt"&gt;&amp;lt;/delay&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;history&amp;gt;&lt;/span&gt;7&lt;span class="nt"&gt;&amp;lt;/history&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;trends&amp;gt;&lt;/span&gt;365&lt;span class="nt"&gt;&amp;lt;/trends&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;status&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/status&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;value_type&amp;gt;&lt;/span&gt;3&lt;span class="nt"&gt;&amp;lt;/value_type&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;allowed_hosts/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;units/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;delta&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/delta&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_contextname/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_securityname/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_securitylevel&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/snmpv3_securitylevel&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_authprotocol&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/snmpv3_authprotocol&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_authpassphrase/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_privprotocol&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/snmpv3_privprotocol&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_privpassphrase/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;formula&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/formula&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;delay_flex/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;params/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;ipmi_sensor/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;data_type&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/data_type&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;authtype&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/authtype&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;username/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;password/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;publickey/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;privatekey/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;port/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;description/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;inventory_link&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/inventory_link&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;applications&amp;gt;&lt;/span&gt;
                        &lt;span class="nt"&gt;&amp;lt;application&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;name&amp;gt;&lt;/span&gt;TCP&lt;span class="nt"&gt;&amp;lt;/name&amp;gt;&lt;/span&gt;
                        &lt;span class="nt"&gt;&amp;lt;/application&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;/applications&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;valuemap/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;logtimefmt/&amp;gt;&lt;/span&gt;
                &lt;span class="nt"&gt;&amp;lt;/item&amp;gt;&lt;/span&gt;
                &lt;span class="nt"&gt;&amp;lt;item&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;name&amp;gt;&lt;/span&gt;TIME_WAIT&lt;span class="nt"&gt;&amp;lt;/name&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;type&amp;gt;&lt;/span&gt;2&lt;span class="nt"&gt;&amp;lt;/type&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmp_community/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;multiplier&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/multiplier&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmp_oid/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;key&amp;gt;&lt;/span&gt;tcp.timew&lt;span class="nt"&gt;&amp;lt;/key&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;delay&amp;gt;&lt;/span&gt;60&lt;span class="nt"&gt;&amp;lt;/delay&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;history&amp;gt;&lt;/span&gt;7&lt;span class="nt"&gt;&amp;lt;/history&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;trends&amp;gt;&lt;/span&gt;365&lt;span class="nt"&gt;&amp;lt;/trends&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;status&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/status&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;value_type&amp;gt;&lt;/span&gt;3&lt;span class="nt"&gt;&amp;lt;/value_type&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;allowed_hosts/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;units/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;delta&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/delta&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_contextname/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_securityname/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_securitylevel&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/snmpv3_securitylevel&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_authprotocol&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/snmpv3_authprotocol&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_authpassphrase/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_privprotocol&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/snmpv3_privprotocol&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_privpassphrase/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;formula&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/formula&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;delay_flex/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;params/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;ipmi_sensor/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;data_type&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/data_type&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;authtype&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/authtype&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;username/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;password/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;publickey/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;privatekey/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;port/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;description/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;inventory_link&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/inventory_link&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;applications&amp;gt;&lt;/span&gt;
                        &lt;span class="nt"&gt;&amp;lt;application&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;name&amp;gt;&lt;/span&gt;TCP&lt;span class="nt"&gt;&amp;lt;/name&amp;gt;&lt;/span&gt;
                        &lt;span class="nt"&gt;&amp;lt;/application&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;/applications&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;valuemap/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;logtimefmt/&amp;gt;&lt;/span&gt;
                &lt;span class="nt"&gt;&amp;lt;/item&amp;gt;&lt;/span&gt;
                &lt;span class="nt"&gt;&amp;lt;item&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;name&amp;gt;&lt;/span&gt;Trapper&lt;span class="nt"&gt;&amp;lt;/name&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;type&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/type&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmp_community/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;multiplier&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/multiplier&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmp_oid/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;key&amp;gt;&lt;/span&gt;tcp.all&lt;span class="nt"&gt;&amp;lt;/key&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;delay&amp;gt;&lt;/span&gt;30&lt;span class="nt"&gt;&amp;lt;/delay&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;history&amp;gt;&lt;/span&gt;7&lt;span class="nt"&gt;&amp;lt;/history&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;trends&amp;gt;&lt;/span&gt;365&lt;span class="nt"&gt;&amp;lt;/trends&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;status&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/status&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;value_type&amp;gt;&lt;/span&gt;3&lt;span class="nt"&gt;&amp;lt;/value_type&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;allowed_hosts/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;units/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;delta&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/delta&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_contextname/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_securityname/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_securitylevel&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/snmpv3_securitylevel&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_authprotocol&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/snmpv3_authprotocol&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_authpassphrase/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_privprotocol&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/snmpv3_privprotocol&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;snmpv3_privpassphrase/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;formula&amp;gt;&lt;/span&gt;1&lt;span class="nt"&gt;&amp;lt;/formula&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;delay_flex/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;params/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;ipmi_sensor/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;data_type&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/data_type&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;authtype&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/authtype&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;username/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;password/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;publickey/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;privatekey/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;port/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;description/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;inventory_link&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/inventory_link&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;applications&amp;gt;&lt;/span&gt;
                        &lt;span class="nt"&gt;&amp;lt;application&amp;gt;&lt;/span&gt;
                            &lt;span class="nt"&gt;&amp;lt;name&amp;gt;&lt;/span&gt;TCP&lt;span class="nt"&gt;&amp;lt;/name&amp;gt;&lt;/span&gt;
                        &lt;span class="nt"&gt;&amp;lt;/application&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;/applications&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;valuemap/&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;logtimefmt/&amp;gt;&lt;/span&gt;
                &lt;span class="nt"&gt;&amp;lt;/item&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;/items&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;discovery_rules/&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;macros/&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;templates/&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;screens/&amp;gt;&lt;/span&gt;
        &lt;span class="nt"&gt;&amp;lt;/template&amp;gt;&lt;/span&gt;
    &lt;span class="nt"&gt;&amp;lt;/templates&amp;gt;&lt;/span&gt;
    &lt;span class="nt"&gt;&amp;lt;triggers&amp;gt;&lt;/span&gt;
        &lt;span class="nt"&gt;&amp;lt;trigger&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;expression&amp;gt;&lt;/span&gt;{Template UnixTcp:tcp.establ.last(0)}&lt;span class="ni"&gt;&amp;amp;gt;&lt;/span&gt;10000&lt;span class="nt"&gt;&amp;lt;/expression&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;name&amp;gt;&lt;/span&gt;Too many ESTABLISHED connections on {HOST.NAME}&lt;span class="nt"&gt;&amp;lt;/name&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;url/&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;status&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/status&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;priority&amp;gt;&lt;/span&gt;3&lt;span class="nt"&gt;&amp;lt;/priority&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;description/&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;type&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/type&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;dependencies/&amp;gt;&lt;/span&gt;
        &lt;span class="nt"&gt;&amp;lt;/trigger&amp;gt;&lt;/span&gt;
        &lt;span class="nt"&gt;&amp;lt;trigger&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;expression&amp;gt;&lt;/span&gt;{Template UnixTcp:tcp.timew.last(0)}&lt;span class="ni"&gt;&amp;amp;gt;&lt;/span&gt;30000&lt;span class="nt"&gt;&amp;lt;/expression&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;name&amp;gt;&lt;/span&gt;Too many TIME_WAIT connections on {HOST.NAME}&lt;span class="nt"&gt;&amp;lt;/name&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;url/&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;status&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/status&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;priority&amp;gt;&lt;/span&gt;3&lt;span class="nt"&gt;&amp;lt;/priority&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;description/&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;type&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/type&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;dependencies/&amp;gt;&lt;/span&gt;
        &lt;span class="nt"&gt;&amp;lt;/trigger&amp;gt;&lt;/span&gt;
    &lt;span class="nt"&gt;&amp;lt;/triggers&amp;gt;&lt;/span&gt;
    &lt;span class="nt"&gt;&amp;lt;graphs&amp;gt;&lt;/span&gt;
        &lt;span class="nt"&gt;&amp;lt;graph&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;name&amp;gt;&lt;/span&gt;TCP Connections&lt;span class="nt"&gt;&amp;lt;/name&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;width&amp;gt;&lt;/span&gt;900&lt;span class="nt"&gt;&amp;lt;/width&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;height&amp;gt;&lt;/span&gt;200&lt;span class="nt"&gt;&amp;lt;/height&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;yaxismin&amp;gt;&lt;/span&gt;0.0000&lt;span class="nt"&gt;&amp;lt;/yaxismin&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;yaxismax&amp;gt;&lt;/span&gt;100.0000&lt;span class="nt"&gt;&amp;lt;/yaxismax&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;show_work_period&amp;gt;&lt;/span&gt;1&lt;span class="nt"&gt;&amp;lt;/show_work_period&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;show_triggers&amp;gt;&lt;/span&gt;1&lt;span class="nt"&gt;&amp;lt;/show_triggers&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;type&amp;gt;&lt;/span&gt;1&lt;span class="nt"&gt;&amp;lt;/type&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;show_legend&amp;gt;&lt;/span&gt;1&lt;span class="nt"&gt;&amp;lt;/show_legend&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;show_3d&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/show_3d&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;percent_left&amp;gt;&lt;/span&gt;0.0000&lt;span class="nt"&gt;&amp;lt;/percent_left&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;percent_right&amp;gt;&lt;/span&gt;0.0000&lt;span class="nt"&gt;&amp;lt;/percent_right&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;ymin_type_1&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/ymin_type_1&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;ymax_type_1&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/ymax_type_1&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;ymin_item_1&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/ymin_item_1&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;ymax_item_1&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/ymax_item_1&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;graph_items&amp;gt;&lt;/span&gt;
                &lt;span class="nt"&gt;&amp;lt;graph_item&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;sortorder&amp;gt;&lt;/span&gt;6&lt;span class="nt"&gt;&amp;lt;/sortorder&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;drawtype&amp;gt;&lt;/span&gt;1&lt;span class="nt"&gt;&amp;lt;/drawtype&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;color&amp;gt;&lt;/span&gt;009900&lt;span class="nt"&gt;&amp;lt;/color&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;yaxisside&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/yaxisside&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;calc_fnc&amp;gt;&lt;/span&gt;2&lt;span class="nt"&gt;&amp;lt;/calc_fnc&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;type&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/type&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;item&amp;gt;&lt;/span&gt;
                        &lt;span class="nt"&gt;&amp;lt;host&amp;gt;&lt;/span&gt;Template UnixTcp&lt;span class="nt"&gt;&amp;lt;/host&amp;gt;&lt;/span&gt;
                        &lt;span class="nt"&gt;&amp;lt;key&amp;gt;&lt;/span&gt;tcp.establ&lt;span class="nt"&gt;&amp;lt;/key&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;/item&amp;gt;&lt;/span&gt;
                &lt;span class="nt"&gt;&amp;lt;/graph_item&amp;gt;&lt;/span&gt;
                &lt;span class="nt"&gt;&amp;lt;graph_item&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;sortorder&amp;gt;&lt;/span&gt;3&lt;span class="nt"&gt;&amp;lt;/sortorder&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;drawtype&amp;gt;&lt;/span&gt;1&lt;span class="nt"&gt;&amp;lt;/drawtype&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;color&amp;gt;&lt;/span&gt;9999FF&lt;span class="nt"&gt;&amp;lt;/color&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;yaxisside&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/yaxisside&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;calc_fnc&amp;gt;&lt;/span&gt;2&lt;span class="nt"&gt;&amp;lt;/calc_fnc&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;type&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/type&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;item&amp;gt;&lt;/span&gt;
                        &lt;span class="nt"&gt;&amp;lt;host&amp;gt;&lt;/span&gt;Template UnixTcp&lt;span class="nt"&gt;&amp;lt;/host&amp;gt;&lt;/span&gt;
                        &lt;span class="nt"&gt;&amp;lt;key&amp;gt;&lt;/span&gt;tcp.closew&lt;span class="nt"&gt;&amp;lt;/key&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;/item&amp;gt;&lt;/span&gt;
                &lt;span class="nt"&gt;&amp;lt;/graph_item&amp;gt;&lt;/span&gt;
                &lt;span class="nt"&gt;&amp;lt;graph_item&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;sortorder&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/sortorder&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;drawtype&amp;gt;&lt;/span&gt;1&lt;span class="nt"&gt;&amp;lt;/drawtype&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;color&amp;gt;&lt;/span&gt;3333FF&lt;span class="nt"&gt;&amp;lt;/color&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;yaxisside&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/yaxisside&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;calc_fnc&amp;gt;&lt;/span&gt;2&lt;span class="nt"&gt;&amp;lt;/calc_fnc&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;type&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/type&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;item&amp;gt;&lt;/span&gt;
                        &lt;span class="nt"&gt;&amp;lt;host&amp;gt;&lt;/span&gt;Template UnixTcp&lt;span class="nt"&gt;&amp;lt;/host&amp;gt;&lt;/span&gt;
                        &lt;span class="nt"&gt;&amp;lt;key&amp;gt;&lt;/span&gt;tcp.timew&lt;span class="nt"&gt;&amp;lt;/key&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;/item&amp;gt;&lt;/span&gt;
                &lt;span class="nt"&gt;&amp;lt;/graph_item&amp;gt;&lt;/span&gt;
                &lt;span class="nt"&gt;&amp;lt;graph_item&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;sortorder&amp;gt;&lt;/span&gt;5&lt;span class="nt"&gt;&amp;lt;/sortorder&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;drawtype&amp;gt;&lt;/span&gt;1&lt;span class="nt"&gt;&amp;lt;/drawtype&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;color&amp;gt;&lt;/span&gt;DDDD00&lt;span class="nt"&gt;&amp;lt;/color&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;yaxisside&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/yaxisside&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;calc_fnc&amp;gt;&lt;/span&gt;2&lt;span class="nt"&gt;&amp;lt;/calc_fnc&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;type&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/type&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;item&amp;gt;&lt;/span&gt;
                        &lt;span class="nt"&gt;&amp;lt;host&amp;gt;&lt;/span&gt;Template UnixTcp&lt;span class="nt"&gt;&amp;lt;/host&amp;gt;&lt;/span&gt;
                        &lt;span class="nt"&gt;&amp;lt;key&amp;gt;&lt;/span&gt;tcp.synrecv&lt;span class="nt"&gt;&amp;lt;/key&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;/item&amp;gt;&lt;/span&gt;
                &lt;span class="nt"&gt;&amp;lt;/graph_item&amp;gt;&lt;/span&gt;
                &lt;span class="nt"&gt;&amp;lt;graph_item&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;sortorder&amp;gt;&lt;/span&gt;1&lt;span class="nt"&gt;&amp;lt;/sortorder&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;drawtype&amp;gt;&lt;/span&gt;1&lt;span class="nt"&gt;&amp;lt;/drawtype&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;color&amp;gt;&lt;/span&gt;FFFF66&lt;span class="nt"&gt;&amp;lt;/color&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;yaxisside&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/yaxisside&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;calc_fnc&amp;gt;&lt;/span&gt;2&lt;span class="nt"&gt;&amp;lt;/calc_fnc&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;type&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/type&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;item&amp;gt;&lt;/span&gt;
                        &lt;span class="nt"&gt;&amp;lt;host&amp;gt;&lt;/span&gt;Template UnixTcp&lt;span class="nt"&gt;&amp;lt;/host&amp;gt;&lt;/span&gt;
                        &lt;span class="nt"&gt;&amp;lt;key&amp;gt;&lt;/span&gt;tcp.listen&lt;span class="nt"&gt;&amp;lt;/key&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;/item&amp;gt;&lt;/span&gt;
                &lt;span class="nt"&gt;&amp;lt;/graph_item&amp;gt;&lt;/span&gt;
                &lt;span class="nt"&gt;&amp;lt;graph_item&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;sortorder&amp;gt;&lt;/span&gt;4&lt;span class="nt"&gt;&amp;lt;/sortorder&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;drawtype&amp;gt;&lt;/span&gt;1&lt;span class="nt"&gt;&amp;lt;/drawtype&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;color&amp;gt;&lt;/span&gt;BBBB00&lt;span class="nt"&gt;&amp;lt;/color&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;yaxisside&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/yaxisside&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;calc_fnc&amp;gt;&lt;/span&gt;2&lt;span class="nt"&gt;&amp;lt;/calc_fnc&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;type&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/type&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;item&amp;gt;&lt;/span&gt;
                        &lt;span class="nt"&gt;&amp;lt;host&amp;gt;&lt;/span&gt;Template UnixTcp&lt;span class="nt"&gt;&amp;lt;/host&amp;gt;&lt;/span&gt;
                        &lt;span class="nt"&gt;&amp;lt;key&amp;gt;&lt;/span&gt;tcp.synsent&lt;span class="nt"&gt;&amp;lt;/key&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;/item&amp;gt;&lt;/span&gt;
                &lt;span class="nt"&gt;&amp;lt;/graph_item&amp;gt;&lt;/span&gt;
                &lt;span class="nt"&gt;&amp;lt;graph_item&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;sortorder&amp;gt;&lt;/span&gt;2&lt;span class="nt"&gt;&amp;lt;/sortorder&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;drawtype&amp;gt;&lt;/span&gt;1&lt;span class="nt"&gt;&amp;lt;/drawtype&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;color&amp;gt;&lt;/span&gt;DDDDDD&lt;span class="nt"&gt;&amp;lt;/color&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;yaxisside&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/yaxisside&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;calc_fnc&amp;gt;&lt;/span&gt;2&lt;span class="nt"&gt;&amp;lt;/calc_fnc&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;type&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/type&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;item&amp;gt;&lt;/span&gt;
                        &lt;span class="nt"&gt;&amp;lt;host&amp;gt;&lt;/span&gt;Template UnixTcp&lt;span class="nt"&gt;&amp;lt;/host&amp;gt;&lt;/span&gt;
                        &lt;span class="nt"&gt;&amp;lt;key&amp;gt;&lt;/span&gt;tcp.finw1&lt;span class="nt"&gt;&amp;lt;/key&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;/item&amp;gt;&lt;/span&gt;
                &lt;span class="nt"&gt;&amp;lt;/graph_item&amp;gt;&lt;/span&gt;
                &lt;span class="nt"&gt;&amp;lt;graph_item&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;sortorder&amp;gt;&lt;/span&gt;1&lt;span class="nt"&gt;&amp;lt;/sortorder&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;drawtype&amp;gt;&lt;/span&gt;1&lt;span class="nt"&gt;&amp;lt;/drawtype&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;color&amp;gt;&lt;/span&gt;CCCCCC&lt;span class="nt"&gt;&amp;lt;/color&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;yaxisside&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/yaxisside&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;calc_fnc&amp;gt;&lt;/span&gt;2&lt;span class="nt"&gt;&amp;lt;/calc_fnc&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;type&amp;gt;&lt;/span&gt;0&lt;span class="nt"&gt;&amp;lt;/type&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;item&amp;gt;&lt;/span&gt;
                        &lt;span class="nt"&gt;&amp;lt;host&amp;gt;&lt;/span&gt;Template UnixTcp&lt;span class="nt"&gt;&amp;lt;/host&amp;gt;&lt;/span&gt;
                        &lt;span class="nt"&gt;&amp;lt;key&amp;gt;&lt;/span&gt;tcp.finw2&lt;span class="nt"&gt;&amp;lt;/key&amp;gt;&lt;/span&gt;
                    &lt;span class="nt"&gt;&amp;lt;/item&amp;gt;&lt;/span&gt;
                &lt;span class="nt"&gt;&amp;lt;/graph_item&amp;gt;&lt;/span&gt;
            &lt;span class="nt"&gt;&amp;lt;/graph_items&amp;gt;&lt;/span&gt;
        &lt;span class="nt"&gt;&amp;lt;/graph&amp;gt;&lt;/span&gt;
    &lt;span class="nt"&gt;&amp;lt;/graphs&amp;gt;&lt;/span&gt;
&lt;span class="nt"&gt;&amp;lt;/zabbix_export&amp;gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Для удобства установки различных нестандартных метрик для мониторинга я использую директиву &lt;code&gt;Include=/etc/zabbix/zabbix_agentd.conf.d/&lt;/code&gt; после чего можно добавлять отдельные файлы, в которых будут все опции,
 необходимые для работы необходимой метрики, в данном случае: &lt;code&gt;/etc/zabbix/zabbix_agentd.conf.d/tcp_status.conf&lt;/code&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nv"&gt;UserParameter&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;tcp.all,/etc/zabbix/scripts/tcp_status.sh
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Теперь создадим скрипт, который осуществляет доставку данных в &lt;strong&gt;Zabbix&lt;/strong&gt; - &lt;code&gt;/etc/zabbix/scripts/tcp_status.sh&lt;/code&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="ch"&gt;#!/bin/sh&lt;/span&gt;

&lt;span class="c1"&gt;# WARNING: Correctly setup &amp;#39;Hostname=&amp;#39; in config is REQUIRED!&lt;/span&gt;

/usr/bin/env ss -ant &lt;span class="p"&gt;|&lt;/span&gt; &lt;span class="se"&gt;\&lt;/span&gt;
    awk &lt;span class="s1"&gt;&amp;#39;{&lt;/span&gt;
&lt;span class="s1"&gt;        if (NR&amp;gt;1) state[$1]++;&lt;/span&gt;
&lt;span class="s1"&gt;    }&lt;/span&gt;
&lt;span class="s1"&gt;    END {&lt;/span&gt;
&lt;span class="s1"&gt;        split(&amp;quot;establ,listen,synsent,synrecv,finw1,finw2,closew,timew&amp;quot;,list,&amp;quot;,&amp;quot;)&lt;/span&gt;
&lt;span class="s1"&gt;        for (i in list) {array[list[i]]=0}&lt;/span&gt;
&lt;span class="s1"&gt;        for (i in state) {&lt;/span&gt;
&lt;span class="s1"&gt;            s=i;&lt;/span&gt;
&lt;span class="s1"&gt;            sub(/ESTAB/, &amp;quot;establ&amp;quot;, s);&lt;/span&gt;
&lt;span class="s1"&gt;            sub(/LISTEN/, &amp;quot;listen&amp;quot;, s);&lt;/span&gt;
&lt;span class="s1"&gt;            sub(/SYN-SENT/, &amp;quot;synsent&amp;quot;, s);&lt;/span&gt;
&lt;span class="s1"&gt;            sub(/SYN-RECV/, &amp;quot;synrecv&amp;quot;, s);&lt;/span&gt;
&lt;span class="s1"&gt;            sub(/FIN-WAIT-1/, &amp;quot;finw1&amp;quot;, s);&lt;/span&gt;
&lt;span class="s1"&gt;            sub(/FIN-WAIT-2/, &amp;quot;finw2&amp;quot;, s);&lt;/span&gt;
&lt;span class="s1"&gt;            sub(/CLOSE-WAIT/, &amp;quot;closew&amp;quot;, s);&lt;/span&gt;
&lt;span class="s1"&gt;            sub(/TIME-WAIT/, &amp;quot;timew&amp;quot;, s);&lt;/span&gt;
&lt;span class="s1"&gt;            array[s]=state[i]&lt;/span&gt;
&lt;span class="s1"&gt;        }&lt;/span&gt;
&lt;span class="s1"&gt;        for (i in array){print &amp;quot;- tcp.&amp;quot;i, array[i]}&lt;/span&gt;
&lt;span class="s1"&gt;    }&amp;#39;&lt;/span&gt; &lt;span class="p"&gt;|&lt;/span&gt; /usr/bin/env zabbix_sender &lt;span class="se"&gt;\&lt;/span&gt;
        --config /etc/zabbix/zabbix_agentd.conf &lt;span class="se"&gt;\&lt;/span&gt;
        --input-file - &amp;gt;/dev/null &lt;span class="m"&gt;2&lt;/span&gt;&amp;gt;&lt;span class="p"&gt;&amp;amp;&lt;/span&gt;&lt;span class="m"&gt;1&lt;/span&gt;
&lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="nv"&gt;$?&lt;/span&gt;
&lt;span class="nb"&gt;exit&lt;/span&gt; &lt;span class="m"&gt;0&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;И сразу выставляем правильные права на скрипт:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;chmod &lt;span class="m"&gt;755&lt;/span&gt; /etc/zabbix/scripts/tcp_status.sh
chown zabbix:zabbix /etc/zabbix/scripts/tcp_status.sh
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Если каталога &lt;code&gt;/etc/zabbix/scripts&lt;/code&gt; у вас еще нет, то его нужно создать:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;mkdir /etc/zabbix/scripts
chmod &lt;span class="m"&gt;755&lt;/span&gt; /etc/zabbix/scripts
chown zabbix:zabbix /etc/zabbix/scripts
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Стоит отметить тот факт, что в скрипте используется &lt;code&gt;ss&lt;/code&gt; (из пакета &lt;code&gt;iproute2&lt;/code&gt;), вместо &lt;code&gt;netstat&lt;/code&gt;, замеры и опыт использования показал, что &lt;code&gt;ss&lt;/code&gt; быстрее.&lt;/p&gt;
&lt;p&gt;Все почти готово, теперь можно зайти в панель &lt;strong&gt;Zabbix&lt;/strong&gt; и добавить нужному хосту новый шаблон &lt;strong&gt;Template UnixTcp&lt;/strong&gt;.&lt;/p&gt;</content><category term="Zabbix"></category><category term="Linux"></category><category term="tcp"></category><category term="connections"></category><category term="tcp connections"></category></entry><entry><title>taskhost.exe "Thread exit" CPU high usage</title><link href="https://metajiji.github.io/blog/taskhost-exe-thread-exit-cpu-high-usage/" rel="alternate"></link><published>2014-12-23T00:00:00+06:00</published><updated>2014-12-23T00:00:00+06:00</updated><author><name>Denis Kadyshev</name></author><id>tag:metajiji.github.io,2014-12-23:/blog/taskhost-exe-thread-exit-cpu-high-usage/</id><summary type="html">&lt;p&gt;Обнаружил, что &lt;strong&gt;Windows 8.1&lt;/strong&gt;, установленная в &lt;strong&gt;Linux KVM&lt;/strong&gt; со всеми необходимыми &lt;strong&gt;kvm драйверами&lt;/strong&gt; после небольшого простоя начинает необоснованно потреблять процессор - &lt;code&gt;100%&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Решение было не сложным - проблема в одной из штатных запланированных задач &lt;strong&gt;Windows&lt;/strong&gt;:&lt;/p&gt;
&lt;p&gt;Go to &lt;code&gt;Task Scheduler&lt;/code&gt; -&amp;gt; &lt;code&gt;Microsoft&lt;/code&gt; -&amp;gt; &lt;code&gt;Windows&lt;/code&gt; -&amp;gt; &lt;code&gt;DiskFootPrint&lt;/code&gt; and &lt;strong&gt;disable&lt;/strong&gt; the &lt;code&gt;Diagnostics&lt;/code&gt; Task.&lt;/p&gt;
&lt;hr&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href="http://answers.microsoft.com/en-us/windows/forum/windows8_1-performance/taskhostexe-dfpcommondll-thread-high-cpu/c16ce12f-5bc4-4f59-9e08-7404c554a8e5"&gt;&lt;code&gt;taskhost.exe&lt;/code&gt; &lt;code&gt;DfpCommon.dll …&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;&lt;/ol&gt;</summary><content type="html">&lt;p&gt;Обнаружил, что &lt;strong&gt;Windows 8.1&lt;/strong&gt;, установленная в &lt;strong&gt;Linux KVM&lt;/strong&gt; со всеми необходимыми &lt;strong&gt;kvm драйверами&lt;/strong&gt; после небольшого простоя начинает необоснованно потреблять процессор - &lt;code&gt;100%&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Решение было не сложным - проблема в одной из штатных запланированных задач &lt;strong&gt;Windows&lt;/strong&gt;:&lt;/p&gt;
&lt;p&gt;Go to &lt;code&gt;Task Scheduler&lt;/code&gt; -&amp;gt; &lt;code&gt;Microsoft&lt;/code&gt; -&amp;gt; &lt;code&gt;Windows&lt;/code&gt; -&amp;gt; &lt;code&gt;DiskFootPrint&lt;/code&gt; and &lt;strong&gt;disable&lt;/strong&gt; the &lt;code&gt;Diagnostics&lt;/code&gt; Task.&lt;/p&gt;
&lt;hr&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href="http://answers.microsoft.com/en-us/windows/forum/windows8_1-performance/taskhostexe-dfpcommondll-thread-high-cpu/c16ce12f-5bc4-4f59-9e08-7404c554a8e5"&gt;&lt;code&gt;taskhost.exe&lt;/code&gt; &lt;code&gt;DfpCommon.dll&lt;/code&gt; thread high CPU utilization&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;</content><category term="Windows"></category><category term="taskhost"></category><category term="tasknost.exe"></category><category term="threat"></category><category term="high cpu usage"></category></entry><entry><title>MAC OS Hardware compatible table</title><link href="https://metajiji.github.io/blog/mac-os-hardware-compatible-table/" rel="alternate"></link><published>2014-11-18T00:00:00+06:00</published><updated>2014-11-18T00:00:00+06:00</updated><author><name>Denis Kadyshev</name></author><id>tag:metajiji.github.io,2014-11-18:/blog/mac-os-hardware-compatible-table/</id><summary type="html">&lt;table class="table table-striped table-bordered table-condensed table-hover"&gt;
&lt;tr&gt;
        &lt;th&gt;MB Model&lt;/th&gt;
        &lt;th&gt;Driver&lt;/th&gt;
        &lt;th&gt;Chip&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
        &lt;td&gt;P8B75mle&lt;/td&gt;
        &lt;td&gt;VoodoHDA VT1708s&lt;/td&gt;
        &lt;td&gt;VT1708s&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
        &lt;td&gt;P7BH55D-M&lt;/td&gt;
        &lt;td&gt;ALC892&lt;/td&gt;
        &lt;td&gt;ALC892&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
        &lt;td&gt;P8Z77-V&lt;/td&gt;
        &lt;td&gt;ALC887&lt;/td&gt;
        &lt;td&gt;ALC887&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
        &lt;td&gt;P8H67&lt;/td&gt;
        &lt;td&gt;ALC887&lt;/td&gt;
        &lt;td&gt;ALC887&lt;/td&gt;
&lt;/tr&gt;
&lt;/table&gt;</summary><content type="html">&lt;table class="table table-striped table-bordered table-condensed table-hover"&gt;
&lt;tr&gt;
        &lt;th&gt;MB Model&lt;/th&gt;
        &lt;th&gt;Driver&lt;/th&gt;
        &lt;th&gt;Chip&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
        &lt;td&gt;P8B75mle&lt;/td&gt;
        &lt;td&gt;VoodoHDA VT1708s&lt;/td&gt;
        &lt;td&gt;VT1708s&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
        &lt;td&gt;P7BH55D-M&lt;/td&gt;
        &lt;td&gt;ALC892&lt;/td&gt;
        &lt;td&gt;ALC892&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
        &lt;td&gt;P8Z77-V&lt;/td&gt;
        &lt;td&gt;ALC887&lt;/td&gt;
        &lt;td&gt;ALC887&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
        &lt;td&gt;P8H67&lt;/td&gt;
        &lt;td&gt;ALC887&lt;/td&gt;
        &lt;td&gt;ALC887&lt;/td&gt;
&lt;/tr&gt;
&lt;/table&gt;</content><category term="hardware"></category><category term="mac os"></category><category term="os x"></category></entry><entry><title>PostgreSQL. Создать базу данных и пользователя для нее.</title><link href="https://metajiji.github.io/blog/postgresql-create-database-and-user/" rel="alternate"></link><published>2014-10-07T00:00:00+07:00</published><updated>2014-10-07T00:00:00+07:00</updated><author><name>Denis Kadyshev</name></author><id>tag:metajiji.github.io,2014-10-07:/blog/postgresql-create-database-and-user/</id><summary type="html">&lt;p&gt;Запускаем &lt;code&gt;psql&lt;/code&gt; под пользователем &lt;code&gt;postgres&lt;/code&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;su postgres -c psql
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Теперь в консоли &lt;strong&gt;PostgreSQL&lt;/strong&gt; вводим следующие команды:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;create database dbname with &lt;span class="nv"&gt;encoding&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;UNICODE&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
create user dbuser with password &lt;span class="s1"&gt;&amp;#39;dbpass&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
grant all privileges on database dbname to dbuser&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;А также не забываем дать доступ новому пользователю к серверу, для этого в файле …&lt;/p&gt;</summary><content type="html">&lt;p&gt;Запускаем &lt;code&gt;psql&lt;/code&gt; под пользователем &lt;code&gt;postgres&lt;/code&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;su postgres -c psql
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Теперь в консоли &lt;strong&gt;PostgreSQL&lt;/strong&gt; вводим следующие команды:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;create database dbname with &lt;span class="nv"&gt;encoding&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;UNICODE&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
create user dbuser with password &lt;span class="s1"&gt;&amp;#39;dbpass&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
grant all privileges on database dbname to dbuser&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;А также не забываем дать доступ новому пользователю к серверу, для этого в файле &lt;code&gt;/var/lib/pgsql/data/pg_hba.conf&lt;/code&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="c1"&gt;# For dbuser:&lt;/span&gt;
host    dbname dbuser   &lt;span class="m"&gt;127&lt;/span&gt;.0.0.1/32           md5
&lt;span class="nb"&gt;local&lt;/span&gt;   dbname dbuser                          md5
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Где:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;dbname&lt;/code&gt; – имя базы данных&lt;/li&gt;
&lt;li&gt;&lt;code&gt;dbuser&lt;/code&gt; – имя пользователя&lt;/li&gt;
&lt;li&gt;&lt;code&gt;dbpass&lt;/code&gt; – пароль пользователя &lt;code&gt;dbuser&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;И говорим серверу PostgreSQL перечитать измененный конфиг &lt;code&gt;pg_hba.conf&lt;/code&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;root@Linux# service postgresql reload
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Скрипт для удобства:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="ch"&gt;#!/bin/sh&lt;/span&gt;

&lt;span class="nv"&gt;PGPORT&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;

&lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;Input dbname: &amp;#39;&lt;/span&gt;
&lt;span class="nb"&gt;read&lt;/span&gt; dbname

&lt;span class="nv"&gt;dbuser&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="si"&gt;${&lt;/span&gt;&lt;span class="nv"&gt;dbuser&lt;/span&gt;&lt;span class="k"&gt;:-&lt;/span&gt;&lt;span class="nv"&gt;$dbname&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;
&lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Input dbuser: [&lt;/span&gt;&lt;span class="nv"&gt;$dbuser&lt;/span&gt;&lt;span class="s2"&gt;]&amp;quot;&lt;/span&gt;  &lt;span class="c1"&gt;# Generate by dbname.&lt;/span&gt;

&lt;span class="nv"&gt;randpass&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="k"&gt;$(&lt;/span&gt;tr -cd A-Za-z &amp;lt; /dev/urandom &lt;span class="p"&gt;|&lt;/span&gt; head -c8&lt;span class="k"&gt;)&lt;/span&gt;
&lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Input dbpass [&lt;/span&gt;&lt;span class="nv"&gt;$randpass&lt;/span&gt;&lt;span class="s2"&gt;]:&amp;quot;&lt;/span&gt;  &lt;span class="c1"&gt;# Generate random.&lt;/span&gt;
&lt;span class="nb"&gt;read&lt;/span&gt; dbpass
&lt;span class="nv"&gt;dbpass&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="si"&gt;${&lt;/span&gt;&lt;span class="nv"&gt;dbpass&lt;/span&gt;&lt;span class="k"&gt;:-&lt;/span&gt;&lt;span class="nv"&gt;$randpass&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;

&lt;span class="c1"&gt;# Facepalm centos... Need fill path to binary psql: /usr/pgsql-9.3/bin/psql&lt;/span&gt;
su - postgres -c &lt;span class="s2"&gt;&amp;quot;/usr/pgsql-9.3/bin/psql --dbname=&lt;/span&gt;&lt;span class="nv"&gt;$DB&lt;/span&gt;&lt;span class="s2"&gt; --port=&lt;/span&gt;&lt;span class="nv"&gt;$PGPORT&lt;/span&gt;&lt;span class="s2"&gt; &amp;lt;&amp;lt;_EOF&lt;/span&gt;
&lt;span class="s2"&gt;\x&lt;/span&gt;
&lt;span class="s2"&gt;CREATE DATABASE &lt;/span&gt;&lt;span class="nv"&gt;$dbname&lt;/span&gt;&lt;span class="s2"&gt; WITH ENCODING=&amp;#39;UNICODE&amp;#39;;&lt;/span&gt;
&lt;span class="s2"&gt;CREATE USER &lt;/span&gt;&lt;span class="nv"&gt;$dbuser&lt;/span&gt;&lt;span class="s2"&gt; WITH PASSWORD &amp;#39;&lt;/span&gt;&lt;span class="nv"&gt;$dbpass&lt;/span&gt;&lt;span class="s2"&gt;&amp;#39;;&lt;/span&gt;
&lt;span class="s2"&gt;GRANT ALL PRIVILEGES ON DATABASE &lt;/span&gt;&lt;span class="nv"&gt;$dbname&lt;/span&gt;&lt;span class="s2"&gt; TO &lt;/span&gt;&lt;span class="nv"&gt;$dbuser&lt;/span&gt;&lt;span class="s2"&gt;;&lt;/span&gt;
&lt;span class="s2"&gt;_EOF&lt;/span&gt;
&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;
&lt;span class="c1"&gt;# TODO: check error code here.&lt;/span&gt;

&lt;span class="c1"&gt;# Do backup modified cfg files.&lt;/span&gt;
cp /var/lib/pgsql/data/pg_hba.conf /var/lib/pgsql/data/pg_hba.conf_&lt;span class="sb"&gt;`&lt;/span&gt;date +%s&lt;span class="sb"&gt;`&lt;/span&gt;

&lt;span class="nv"&gt;PGPORT&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="si"&gt;${&lt;/span&gt;&lt;span class="nv"&gt;PGPORT&lt;/span&gt;&lt;span class="k"&gt;:-&lt;/span&gt;&lt;span class="nv"&gt;5432&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;
&lt;span class="o"&gt;[&lt;/span&gt; -n &lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;$dbname&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt; -a -n &lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;$dbuser&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt; &lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt; cat &lt;span class="s"&gt;&amp;lt;&amp;lt;-_EOF &amp;gt;&amp;gt;/var/lib/pgsql/data/pg_hba.conf&lt;/span&gt;

&lt;span class="s"&gt; # For $dbuser, generated at `date`:&lt;/span&gt;
&lt;span class="s"&gt; host    $dbname $dbuser   127.0.0.1/32           md5&lt;/span&gt;
&lt;span class="s"&gt; local   $dbname $dbuser                          md5&lt;/span&gt;
&lt;span class="s"&gt;_EOF&lt;/span&gt;

&lt;span class="c1"&gt;# Do reload.&lt;/span&gt;
service postgresql-9.3 reload
&lt;/pre&gt;&lt;/div&gt;


&lt;hr&gt;
&lt;p&gt;Ссылки по теме:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href="http://michael-borisov.com/2012/11/02/postgresql-create-database-and-user/"&gt;PostgreSQL. Как создать базу данных и пользователя для нее.&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;</content><category term="PostgreSQL"></category></entry><entry><title>Приводим документ к одному типу indent - expand, unexpand и немного про alignment.</title><link href="https://metajiji.github.io/blog/indent-expand-unexpand-alignment/" rel="alternate"></link><published>2014-08-28T00:00:00+07:00</published><updated>2014-08-28T00:00:00+07:00</updated><author><name>Denis Kadyshev</name></author><id>tag:metajiji.github.io,2014-08-28:/blog/indent-expand-unexpand-alignment/</id><summary type="html">&lt;p&gt;Создадим файл с табуляцией:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nb"&gt;echo&lt;/span&gt; -e &lt;span class="s2"&gt;&amp;quot;\t1\n         2&amp;quot;&lt;/span&gt; &lt;span class="p"&gt;|&lt;/span&gt; unexpand -t8 &amp;gt; &lt;span class="m"&gt;1&lt;/span&gt;.txt
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Получим в &lt;code&gt;1.txt&lt;/code&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&amp;lt;------&amp;gt;1
&amp;lt;------&amp;gt; 2
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Где &lt;code&gt;&amp;lt;------&amp;gt;&lt;/code&gt; - 1 таб.&lt;/p&gt;
&lt;p&gt;Приведем &lt;code&gt;indent&lt;/code&gt; к одному виду - пробелам, где 1 таб равен 8 пробелам:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;expand -t8 &lt;span class="m"&gt;1&lt;/span&gt;.txt &amp;gt; &lt;span class="m"&gt;2&lt;/span&gt;.txt
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Получим в &lt;code&gt;2.txt&lt;/code&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;        1
         2
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Получаем некий аналог &lt;code&gt;dos2unix …&lt;/code&gt;&lt;/p&gt;</summary><content type="html">&lt;p&gt;Создадим файл с табуляцией:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nb"&gt;echo&lt;/span&gt; -e &lt;span class="s2"&gt;&amp;quot;\t1\n         2&amp;quot;&lt;/span&gt; &lt;span class="p"&gt;|&lt;/span&gt; unexpand -t8 &amp;gt; &lt;span class="m"&gt;1&lt;/span&gt;.txt
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Получим в &lt;code&gt;1.txt&lt;/code&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&amp;lt;------&amp;gt;1
&amp;lt;------&amp;gt; 2
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Где &lt;code&gt;&amp;lt;------&amp;gt;&lt;/code&gt; - 1 таб.&lt;/p&gt;
&lt;p&gt;Приведем &lt;code&gt;indent&lt;/code&gt; к одному виду - пробелам, где 1 таб равен 8 пробелам:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;expand -t8 &lt;span class="m"&gt;1&lt;/span&gt;.txt &amp;gt; &lt;span class="m"&gt;2&lt;/span&gt;.txt
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Получим в &lt;code&gt;2.txt&lt;/code&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;        1
         2
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Получаем некий аналог &lt;code&gt;dos2unix&lt;/code&gt; и &lt;code&gt;unix2dos&lt;/code&gt;, только для табов и пробелов.&lt;/p&gt;
&lt;p&gt;Теперь о применении такого на практике, до недавнего времени я тоже не знал разницу между &lt;code&gt;indentation&lt;/code&gt; и &lt;code&gt;alignment&lt;/code&gt;. Приведу примеры о чем идет речь.&lt;/p&gt;
&lt;p&gt;Это — &lt;code&gt;indentation&lt;/code&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kt"&gt;int&lt;/span&gt; &lt;span class="n"&gt;i&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="n"&gt;i&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt; &lt;span class="mi"&gt;10&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="o"&gt;++&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;a&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
        &lt;span class="n"&gt;do_something&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
    &lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;А вот это — &lt;code&gt;alignment&lt;/code&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="kt"&gt;int&lt;/span&gt; &lt;span class="n"&gt;some_variable&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="kt"&gt;int&lt;/span&gt; &lt;span class="n"&gt;v1&lt;/span&gt;            &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Соль в том, что &lt;code&gt;indentation&lt;/code&gt; не поплывет в разных редакторах, с разными размерами таба, а вот &lt;code&gt;alignment&lt;/code&gt; с табами поплывет 100%.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Следовательно, если хотим использовать табы, используем только в &lt;code&gt;indentation&lt;/code&gt;, но &lt;code&gt;alignment&lt;/code&gt; делаем исключительно пробелами.
В таком случае использовать &lt;code&gt;expand&lt;/code&gt; и &lt;code&gt;unexpand&lt;/code&gt; нужно с особой осторожностью, чтобы не задеть &lt;code&gt;aligement&lt;/code&gt;.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;hr&gt;
&lt;p&gt;Ссылки по теме:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href="http://habrahabr.ru/post/118208/"&gt;Пора завязывать использовать пробелы вместо табуляции в коде&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://habrahabr.ru/post/118924/"&gt;Примиряем любителей пробелов и табов&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;</content><category term="bash"></category><category term="indent"></category><category term="alignment"></category><category term="expand"></category><category term="unexpand"></category></entry><entry><title>Инвертируем поведение tail и head</title><link href="https://metajiji.github.io/blog/inverted-tail-head/" rel="alternate"></link><published>2014-08-28T00:00:00+07:00</published><updated>2014-08-28T00:00:00+07:00</updated><author><name>Denis Kadyshev</name></author><id>tag:metajiji.github.io,2014-08-28:/blog/inverted-tail-head/</id><summary type="html">&lt;p&gt;Очень короткая заметка про &lt;code&gt;tail&lt;/code&gt; и &lt;code&gt;head&lt;/code&gt;. Как известно &lt;code&gt;head&lt;/code&gt; и &lt;code&gt;tail&lt;/code&gt; работают с 10 первыми или последними строками соответственно.
 Но бывает необходимость получить все строки, кроме, например первых трех, или наоборот кроме последних 3.&lt;/p&gt;
&lt;p&gt;Приведу пример работы, вот простой файл:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;user@Ubuntu:~$ cat /etc/lsb-release
&lt;span class="nv"&gt;DISTRIB_ID&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;Ubuntu
&lt;span class="nv"&gt;DISTRIB_RELEASE&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;14 …&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;</summary><content type="html">&lt;p&gt;Очень короткая заметка про &lt;code&gt;tail&lt;/code&gt; и &lt;code&gt;head&lt;/code&gt;. Как известно &lt;code&gt;head&lt;/code&gt; и &lt;code&gt;tail&lt;/code&gt; работают с 10 первыми или последними строками соответственно.
 Но бывает необходимость получить все строки, кроме, например первых трех, или наоборот кроме последних 3.&lt;/p&gt;
&lt;p&gt;Приведу пример работы, вот простой файл:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;user@Ubuntu:~$ cat /etc/lsb-release
&lt;span class="nv"&gt;DISTRIB_ID&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;Ubuntu
&lt;span class="nv"&gt;DISTRIB_RELEASE&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;14&lt;/span&gt;.04
&lt;span class="nv"&gt;DISTRIB_CODENAME&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;trusty
&lt;span class="nv"&gt;DISTRIB_DESCRIPTION&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;Ubuntu 14.04.1 LTS&amp;quot;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Получим из него все строки, кроме первой:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;user@Ubuntu:~$ tail -n+2 /etc/lsb-release
&lt;span class="nv"&gt;DISTRIB_ID&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;Ubuntu
&lt;span class="nv"&gt;DISTRIB_RELEASE&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;14&lt;/span&gt;.04
&lt;span class="nv"&gt;DISTRIB_CODENAME&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;trusty
&lt;span class="nv"&gt;DISTRIB_DESCRIPTION&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;Ubuntu 14.04.1 LTS&amp;quot;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;А теперь все кроме последних двух:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;bash
user@Ubuntu:~$ head -n+3 /etc/lsb-release
DISTRIB_ID=Ubuntu
DISTRIB_RELEASE=14.04
DISTRIB_CODENAME=trusty
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;И живой пример использования, нужно получить из &lt;code&gt;netstat&lt;/code&gt; количество соединений сгруппированных по типу, исключив первые 2 строки заголовка:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;user@Ubuntu:~$ netstat -ant &lt;span class="p"&gt;|&lt;/span&gt; tail -n +3 &lt;span class="p"&gt;|&lt;/span&gt; awk &lt;span class="s1"&gt;&amp;#39;{print $6}&amp;#39;&lt;/span&gt; &lt;span class="p"&gt;|&lt;/span&gt; sort &lt;span class="p"&gt;|&lt;/span&gt; uniq -c
      &lt;span class="m"&gt;1&lt;/span&gt; CLOSE_WAIT
     &lt;span class="m"&gt;34&lt;/span&gt; ESTABLISHED
      &lt;span class="m"&gt;8&lt;/span&gt; LISTEN
      &lt;span class="m"&gt;2&lt;/span&gt; SYN_SENT
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Или для удобства в цикле:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;user@Ubuntu:~$ &lt;span class="k"&gt;while&lt;/span&gt; true&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt; netstat -ant &lt;span class="p"&gt;|&lt;/span&gt; tail -n +3 &lt;span class="p"&gt;|&lt;/span&gt; awk &lt;span class="s1"&gt;&amp;#39;{print $6}&amp;#39;&lt;/span&gt; &lt;span class="p"&gt;|&lt;/span&gt; sort &lt;span class="p"&gt;|&lt;/span&gt; uniq -c&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="nb"&gt;echo&lt;/span&gt; -----------&lt;span class="p"&gt;;&lt;/span&gt; sleep &lt;span class="m"&gt;1&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="k"&gt;done&lt;/span&gt;
      &lt;span class="m"&gt;1&lt;/span&gt; CLOSE_WAIT
     &lt;span class="m"&gt;32&lt;/span&gt; ESTABLISHED
      &lt;span class="m"&gt;8&lt;/span&gt; LISTEN
-----------
      &lt;span class="m"&gt;1&lt;/span&gt; CLOSE_WAIT
     &lt;span class="m"&gt;32&lt;/span&gt; ESTABLISHED
      &lt;span class="m"&gt;8&lt;/span&gt; LISTEN
-----------
^C
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Остановить цикл можно клавишами &lt;kbd&gt;Ctrl+c&lt;/kbd&gt;.&lt;/p&gt;</content><category term="Bash"></category><category term="tail"></category><category term="head"></category><category term="inverted"></category><category term="inverse"></category></entry><entry><title>Wireshark не видит сетевой интерфейс в Ubuntu</title><link href="https://metajiji.github.io/blog/wireshark-ubuntu/" rel="alternate"></link><published>2014-07-30T00:00:00+07:00</published><updated>2014-07-30T00:00:00+07:00</updated><author><name>Denis Kadyshev</name></author><id>tag:metajiji.github.io,2014-07-30:/blog/wireshark-ubuntu/</id><summary type="html">&lt;p&gt;По умолчанию &lt;code&gt;wireshark&lt;/code&gt; запускается с правами пользователя и не видит сетевые интерфейсы, использование данной возможности влияет на безопасность, поэтому приходится запускать от &lt;code&gt;root&lt;/code&gt;.
 Если сомневаетесь, то используйте запуск &lt;code&gt;wireshark&lt;/code&gt; от &lt;code&gt;root&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;&lt;code&gt;Dumpcap&lt;/code&gt; можно установить таким образом, что члены группы &lt;code&gt;wireshark&lt;/code&gt; смогут захватывать пакеты - это более рекомендуемый способ захвата пакетов с …&lt;/p&gt;</summary><content type="html">&lt;p&gt;По умолчанию &lt;code&gt;wireshark&lt;/code&gt; запускается с правами пользователя и не видит сетевые интерфейсы, использование данной возможности влияет на безопасность, поэтому приходится запускать от &lt;code&gt;root&lt;/code&gt;.
 Если сомневаетесь, то используйте запуск &lt;code&gt;wireshark&lt;/code&gt; от &lt;code&gt;root&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;&lt;code&gt;Dumpcap&lt;/code&gt; можно установить таким образом, что члены группы &lt;code&gt;wireshark&lt;/code&gt; смогут захватывать пакеты - это более рекомендуемый способ захвата пакетов с помощью &lt;strong&gt;Wireshark&lt;/strong&gt;/&lt;strong&gt;Tshark&lt;/strong&gt;,
 чем запуск самого &lt;strong&gt;Wireshark&lt;/strong&gt;/&lt;strong&gt;Tshark&lt;/strong&gt; с правами &lt;code&gt;root&lt;/code&gt;, так как это позволяет выполнять почти весь код с меньшими правами.&lt;/p&gt;
&lt;p&gt;Чтобы &lt;strong&gt;Wireshark&lt;/strong&gt; начал видеть интерфейсы нужно разрешить группе &lt;code&gt;wireshark&lt;/code&gt; использовать &lt;code&gt;Dumpcap&lt;/code&gt;,
 для этого настраиваем пакет &lt;code&gt;wireshark-common&lt;/code&gt; и добавляем своего пользователя в группу &lt;code&gt;wireshark&lt;/code&gt;.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;dpkg-reconfigure wireshark-common
usermod -aG wireshark &lt;span class="nv"&gt;$USER&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;hr&gt;
&lt;p&gt;Ссылки по теме:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href="http://toster.ru/q/111581"&gt;Toster: Wireshark не видит сетевой интерфейс в Ubuntu 14.04, что делать?&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;</content><category term="Linux"></category><category term="Ubuntu"></category><category term="Wireshark"></category><category term="dumpcap"></category><category term="usermod"></category></entry><entry><title>Mikrotik WPA2-EAP WDS MESH</title><link href="https://metajiji.github.io/blog/mikrotik-wpa2-eap-wds-mesh/" rel="alternate"></link><published>2014-07-11T00:00:00+07:00</published><updated>2014-07-11T00:00:00+07:00</updated><author><name>Denis Kadyshev</name></author><id>tag:metajiji.github.io,2014-07-11:/blog/mikrotik-wpa2-eap-wds-mesh/</id><summary type="html">&lt;p&gt;Постановка задачи, реализовать &lt;strong&gt;Wi-Fi&lt;/strong&gt; сеть &lt;strong&gt;WPA2-EAP&lt;/strong&gt; с авторизацией через &lt;strong&gt;LDAP&lt;/strong&gt; учетки или сертификаты с бесшовным роумингом,
 используя &lt;strong&gt;WDS-MESH&lt;/strong&gt;.
При этом трафик &lt;strong&gt;Wi-Fi&lt;/strong&gt; клиентов завернуть во &lt;code&gt;vlan&lt;/code&gt; (&lt;strong&gt;tagged&lt;/strong&gt;), а трафик самого роутера оставить без тега (&lt;strong&gt;untagged&lt;/strong&gt;).&lt;/p&gt;
&lt;h1&gt;Подготовка&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;Сброс кнопкой &lt;code&gt;Reset&lt;/code&gt; на корпусе.&lt;/li&gt;
&lt;li&gt;Подключаемся через &lt;code&gt;Windox&lt;/code&gt; по кабелю 2-5 порты или &lt;strong&gt;Wifi …&lt;/strong&gt;&lt;/li&gt;&lt;/ul&gt;</summary><content type="html">&lt;p&gt;Постановка задачи, реализовать &lt;strong&gt;Wi-Fi&lt;/strong&gt; сеть &lt;strong&gt;WPA2-EAP&lt;/strong&gt; с авторизацией через &lt;strong&gt;LDAP&lt;/strong&gt; учетки или сертификаты с бесшовным роумингом,
 используя &lt;strong&gt;WDS-MESH&lt;/strong&gt;.
При этом трафик &lt;strong&gt;Wi-Fi&lt;/strong&gt; клиентов завернуть во &lt;code&gt;vlan&lt;/code&gt; (&lt;strong&gt;tagged&lt;/strong&gt;), а трафик самого роутера оставить без тега (&lt;strong&gt;untagged&lt;/strong&gt;).&lt;/p&gt;
&lt;h1&gt;Подготовка&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;Сброс кнопкой &lt;code&gt;Reset&lt;/code&gt; на корпусе.&lt;/li&gt;
&lt;li&gt;Подключаемся через &lt;code&gt;Windox&lt;/code&gt; по кабелю 2-5 порты или &lt;strong&gt;Wifi&lt;/strong&gt;, в открывшемся диалоговом окне сброс пока не нажимаем!&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Прописываем статический &lt;code&gt;ip&lt;/code&gt; на &lt;code&gt;ether1&lt;/code&gt;, основной шлюз, &lt;strong&gt;DNS сервер&lt;/strong&gt;.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;/ip address add address=10.10.0.101/24 interface=ether1 network=10.10.0.0
/ip dns set servers=10.10.10.254
/ip route add distance=1 gateway=10.10.0.1
&lt;/pre&gt;&lt;/div&gt;


&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Жмем сброс настроек в диалоговом окне (та самая кнопка, которую не нажимали в начале).&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;Роутер произведет сброс заводских настроек, но оставит пользовательские.&lt;/li&gt;
&lt;li&gt;Если роутер, спустя минуту не ушол в ребут - делаем вручную.&lt;/li&gt;
&lt;li&gt;Подключаемся по статическому &lt;code&gt;ip&lt;/code&gt; и делаем остальные настройки, &lt;code&gt;Identity&lt;/code&gt; (я выбрал простой нейминг точек &lt;code&gt;ap1&lt;/code&gt;, &lt;code&gt;ap2&lt;/code&gt;...), &lt;code&gt;clock&lt;/code&gt;, &lt;code&gt;SNTP&lt;/code&gt;,
 отключаем ненужные сервисы (&lt;code&gt;telnet&lt;/code&gt;, &lt;code&gt;api&lt;/code&gt;) и т.д...&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;/system ntp client set enabled=yes primary-ntp=10.10.10.254
/system clock set time-zone-name=Asia/Novosibirsk
/system identity set name=ap1
/ip service set telnet disabled=yes
/ip service set ftp disabled=yes
/ip service set api disabled=yes
/ip service set api-ssl disabled=yes
&lt;/pre&gt;&lt;/div&gt;


&lt;/li&gt;
&lt;/ul&gt;
&lt;h1&gt;Добавляем интерфейс &lt;code&gt;vlan5&lt;/code&gt; от &lt;code&gt;ether1&lt;/code&gt;.&lt;/h1&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;/interface vlan add interface=ether1 l2mtu=1594 name=vlan5 vlan-id=5
&lt;/pre&gt;&lt;/div&gt;


&lt;h1&gt;Создаем &lt;strong&gt;Bridge&lt;/strong&gt; интерфейс&lt;/h1&gt;
&lt;p&gt;Называем его например &lt;code&gt;br-vlan5&lt;/code&gt;, добавляем в него порты &lt;code&gt;wlan1&lt;/code&gt;, &lt;code&gt;vlan5&lt;/code&gt;.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;/interface bridge add name=br-vlan5
/interface bridge port add bridge=br-vlan5 interface=wlan1
/interface bridge port add bridge=br-vlan5 interface=vlan5
&lt;/pre&gt;&lt;/div&gt;


&lt;h1&gt;Создаем &lt;strong&gt;Mesh&lt;/strong&gt; интерфейс&lt;/h1&gt;
&lt;p&gt;Называем его например &lt;code&gt;Mesh-Interface&lt;/code&gt;, добавляем в него порт &lt;code&gt;br-vlan5&lt;/code&gt;.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;/interface mesh add hwmp-rann-propagation-delay=5 name=Mesh-Interface
/interface mesh port add interface=br-vlan5 mesh=Mesh-Interfacee
&lt;/pre&gt;&lt;/div&gt;


&lt;h1&gt;Создаем &lt;strong&gt;Security Profle&lt;/strong&gt;:&lt;/h1&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;/interface wireless security-profiles add authentication-types=wpa2-eap management-protection=allowed mode=dynamic-keys name=WPA2-EAP-MESH
&lt;/pre&gt;&lt;/div&gt;


&lt;ul&gt;
&lt;li&gt;Name: &lt;code&gt;WPA2-EAP-MESH&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Mode: &lt;code&gt;dynamic keys&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Authentication Types: [v] &lt;code&gt;WPA2 EAP&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Unicast &amp;amp; Group Ciphers: &lt;code&gt;aes ccm&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Supplicant Identity: &lt;code&gt;ap1&lt;/code&gt; (для каждой точки свой, на всякий случай, если вдруг точка начнет авторизовываться в RADIUS, будет легче найти проблемную).&lt;/li&gt;
&lt;li&gt;Management Protection: &lt;code&gt;Disabled&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;EAP Methods: &lt;code&gt;passthrough&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;TLS Mode: &lt;code&gt;no certificates&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;TLS Certificate: &lt;code&gt;none&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h1&gt;Настраиваем &lt;code&gt;wlan1&lt;/code&gt; интерфейс:&lt;/h1&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;/interface wireless set [ find default-name=wlan1 ] band=2ghz-b/g/n disabled=no l2mtu=2290 mode=ap-bridge radio-name=AP1 security-profile=WPA2-EAP-MESH ssid=YOUR_SSID wds-default-bridge=Mesh-Interface wds-mode=dynamic-mesh wireless-protocol=802.11
&lt;/pre&gt;&lt;/div&gt;


&lt;h1&gt;Выбираем канал&lt;/h1&gt;
&lt;p&gt;Частоту &lt;s&gt;канал&lt;/s&gt;, я выбрал &lt;code&gt;2412&lt;/code&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;ВАЖНО&lt;/strong&gt;, для работы WDS необходимо, чтобы канал на ВСЕХ роутерах был один.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;ul&gt;
&lt;li&gt;Mode: ap bridge&lt;/li&gt;
&lt;li&gt;Band: 2GHz-B/G/N&lt;/li&gt;
&lt;/ul&gt;
&lt;h1&gt;Настройка &lt;strong&gt;SSID&lt;/strong&gt; сети&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;Wireless Protocol: &lt;code&gt;802.11&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Security Profile: &lt;code&gt;WPA2-EAP-MESH&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Bridge Mode: &lt;code&gt;Enabled&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;WDS Mode: &lt;code&gt;Dynamic-Mesh&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;WDS Default Bridge: &lt;code&gt;Mesh-Interface&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h1&gt;Настройка &lt;strong&gt;WDS&lt;/strong&gt;:&lt;/h1&gt;
&lt;p&gt;Создаем &lt;strong&gt;Security-Profile&lt;/strong&gt;, чтобы роутеры могли авторизовывать друг друга:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;/interface wireless security-profiles add authentication-types=wpa2-psk eap-methods=&amp;quot;&amp;quot; mode=dynamic-keys name=4WDS supplicant-identity=&amp;quot;&amp;quot; wpa2-pre-shared-key=wpa2password4wds
&lt;/pre&gt;&lt;/div&gt;


&lt;ul&gt;
&lt;li&gt;Name: &lt;code&gt;4WDS&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Mode: &lt;code&gt;dynamic keys&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Authentication Types: [v] &lt;code&gt;WPA2 PSK&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Unicast &amp;amp; Group Ciphers: &lt;code&gt;aes ccm&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;WPA2 Pre-Shared Key: &lt;code&gt;ОдинаковыйПарольНаВсехРоутерах&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Management Protection: &lt;code&gt;Disabled&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h1&gt;Создаем &lt;strong&gt;Connect-List&lt;/strong&gt;&lt;/h1&gt;
&lt;p&gt;Добавляем в него &lt;strong&gt;MAC&lt;/strong&gt;-адреса каждого роутера.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;/interface wireless connect-list add interface=wlan1 security-profile=4WDS wireless-protocol=802.11 mac-address=4C:5E:0C:XX:XX:01 comment=ap2
/interface wireless connect-list add interface=wlan1 security-profile=4WDS wireless-protocol=802.11 mac-address=4C:5E:0C:XX:XX:10 comment=ap3
&lt;/pre&gt;&lt;/div&gt;


&lt;ul&gt;
&lt;li&gt;Interface: &lt;code&gt;Wlan1&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Mac Address: &lt;code&gt;XX:XX:XX:XX:XX:XX&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;[V] Connect&lt;/li&gt;
&lt;li&gt;Wireless Protocol: &lt;code&gt;802.11&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Security Profile: &lt;code&gt;4WDS&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h1&gt;Добавляем информацию о RADIUS сервере:&lt;/h1&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;/radius add address=10.10.10.254 secret=supersecretpwd service=wireless
&lt;/pre&gt;&lt;/div&gt;


&lt;ul&gt;
&lt;li&gt;Service: [v] &lt;code&gt;wireless&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Address: &lt;code&gt;10.10.10.254&lt;/code&gt; (у меня RADIUS на этом сервере).&lt;/li&gt;
&lt;li&gt;Secret: &lt;code&gt;*****&lt;/code&gt; (Пароль от радиус сервера).&lt;/li&gt;
&lt;li&gt;Authentication Port: &lt;code&gt;1812&lt;/code&gt; (стандартный)&lt;/li&gt;
&lt;li&gt;Accounting Port: &lt;code&gt;1813&lt;/code&gt; (стандартный)&lt;/li&gt;
&lt;/ul&gt;
&lt;h1&gt;Настройка RADIUS сервера:&lt;/h1&gt;
&lt;blockquote&gt;
&lt;p&gt;Продолжение следует...&lt;/p&gt;
&lt;p&gt;Технология надежд не оправдала, возможно я неправильно что-то сделал, спустя какое-то время вернули обратно в обычный режим WPA2-EAP с разными частотами &lt;s&gt;каналами&lt;/s&gt;
и заниженой мощьностью передатчика (исходили из расчета ~10-20 активных клиентов на 1 точку доступа).&lt;/p&gt;
&lt;/blockquote&gt;
&lt;hr&gt;
&lt;p&gt;Ссылки по теме:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href="http://wiki.mikrotik.com/wiki/Manual:Interface/Wireless#RADIUS_EAP_pass-through_authentication"&gt;Manual:Interface/Wireless&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://wiki.mikrotik.com/wiki/Wireless_WDS_Mesh"&gt;Wireless WDS Mesh&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://habrahabr.ru/post/217657/"&gt;Контроллер Wi-Fi точек доступа на Mikrotik&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;</content><category term="Mikrotik"></category><category term="WDS"></category><category term="MESH"></category><category term="WPA2-EAP"></category></entry><entry><title>Запуск и адаптация МАРК-SQL 1.5.4 для MySQL 5.x</title><link href="https://metajiji.github.io/blog/marc-sql-1.5.4-mysql-5.x/" rel="alternate"></link><published>2014-07-04T00:00:00+07:00</published><updated>2014-07-04T00:00:00+07:00</updated><author><name>Denis Kadyshev</name></author><id>tag:metajiji.github.io,2014-07-04:/blog/marc-sql-1.5.4-mysql-5.x/</id><summary type="html">&lt;p&gt;Столкнулся с проблемой, &lt;strong&gt;АИБС "МАРК-SQL" для школьных библиотек 1.5.4&lt;/strong&gt; не работала с &lt;strong&gt;MySQL&lt;/strong&gt;, а разработчики заверяли, что программа не совместима с &lt;strong&gt;MySQL&lt;/strong&gt;.&lt;/p&gt;
&lt;p&gt;Решил проанализировать запросы, которые ходят между программой и сервером при помощи &lt;a href="http://dev.mysql.com/downloads/mysql-proxy/" title="Download MySQL Proxy"&gt;MySQL-Proxy [2]&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;И сразу увидел некорректный запрос с использованием зарезервированного слова &lt;code&gt;SEPARATOR&lt;/code&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;SELECT&lt;/span&gt; &lt;span class="n"&gt;TAG&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="n"&gt;SUBTAG …&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;</summary><content type="html">&lt;p&gt;Столкнулся с проблемой, &lt;strong&gt;АИБС "МАРК-SQL" для школьных библиотек 1.5.4&lt;/strong&gt; не работала с &lt;strong&gt;MySQL&lt;/strong&gt;, а разработчики заверяли, что программа не совместима с &lt;strong&gt;MySQL&lt;/strong&gt;.&lt;/p&gt;
&lt;p&gt;Решил проанализировать запросы, которые ходят между программой и сервером при помощи &lt;a href="http://dev.mysql.com/downloads/mysql-proxy/" title="Download MySQL Proxy"&gt;MySQL-Proxy [2]&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;И сразу увидел некорректный запрос с использованием зарезервированного слова &lt;code&gt;SEPARATOR&lt;/code&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;SELECT&lt;/span&gt; &lt;span class="n"&gt;TAG&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="n"&gt;SUBTAG&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="n"&gt;FLAGS&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="n"&gt;SEPARATOR&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="n"&gt;CAPTION&lt;/span&gt; &lt;span class="k"&gt;FROM&lt;/span&gt; &lt;span class="n"&gt;TAG&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;После добавления обратных кавычек к &lt;a href="http://dev.mysql.com/doc/mysqld-version-reference/en/mysqld-version-reference-reservedwords-5-0.html" title="Reserved Words in MySQL 5.0"&gt;зарезервированному слову &lt;code&gt;SEPARATOR&lt;/code&gt; [1]&lt;/a&gt; запрос выполнился в &lt;strong&gt;MySQL&lt;/strong&gt; без проблем:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;SELECT&lt;/span&gt; &lt;span class="n"&gt;TAG&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="n"&gt;SUBTAG&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="n"&gt;FLAGS&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="o"&gt;`&lt;/span&gt;&lt;span class="n"&gt;SEPARATOR&lt;/span&gt;&lt;span class="o"&gt;`&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="n"&gt;CAPTION&lt;/span&gt; &lt;span class="k"&gt;FROM&lt;/span&gt; &lt;span class="n"&gt;TAG&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Значит для нормальной работы программы &lt;strong&gt;АИБС "МАРК-SQL" для школьных библиотек 1.5.4&lt;/strong&gt; нужно ловить каждый запрос, и если требуется, экранировать зарезервированные слова &lt;strong&gt;MySQL&lt;/strong&gt; на лету. С этой задачей вполне успешно справится &lt;a href="http://dev.mysql.com/downloads/mysql-proxy/" title="Download MySQL Proxy"&gt;MySQL-Proxy [2]&lt;/a&gt; с поддержкой &lt;a href="http://www.lua.org/pil/20.1.html" title="Programming in Lua"&gt;lua скриптов [4]&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;После установки, запуска &lt;strong&gt;MySQL-Proxy&lt;/strong&gt; и подключения &lt;code&gt;lua&lt;/code&gt; скрипта:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="kr"&gt;function&lt;/span&gt; &lt;span class="nf"&gt;MyDebug&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;str&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
        &lt;span class="c1"&gt;-- enable\disable debug messages print to stdout.&lt;/span&gt;
        &lt;span class="kd"&gt;local&lt;/span&gt; &lt;span class="n"&gt;dbg&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;
        &lt;span class="kr"&gt;if&lt;/span&gt; &lt;span class="n"&gt;dbg&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt; &lt;span class="kr"&gt;then&lt;/span&gt;
                &lt;span class="nb"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;[DEBUG] &amp;#39;&lt;/span&gt; &lt;span class="o"&gt;..&lt;/span&gt; &lt;span class="n"&gt;str&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
        &lt;span class="kr"&gt;end&lt;/span&gt;
&lt;span class="kr"&gt;end&lt;/span&gt;

&lt;span class="kr"&gt;function&lt;/span&gt; &lt;span class="nf"&gt;read_query&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;packet&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
        &lt;span class="kd"&gt;local&lt;/span&gt; &lt;span class="n"&gt;file&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;io.open&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;/var/log/mysql-proxy.log&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;a&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
        &lt;span class="kd"&gt;local&lt;/span&gt; &lt;span class="n"&gt;q&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;string.sub&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;packet&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

        &lt;span class="n"&gt;MyDebug&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;Orig. Query: &amp;#39;&lt;/span&gt; &lt;span class="o"&gt;..&lt;/span&gt; &lt;span class="n"&gt;q&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
        &lt;span class="n"&gt;file&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="n"&gt;write&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;Orig. Query: &amp;#39;&lt;/span&gt; &lt;span class="o"&gt;..&lt;/span&gt; &lt;span class="n"&gt;q&lt;/span&gt; &lt;span class="o"&gt;..&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;&lt;/span&gt;&lt;span class="se"&gt;\n&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

        &lt;span class="c1"&gt;-- Таблица зарезервированных слов MySQL.&lt;/span&gt;
        &lt;span class="c1"&gt;-- http://dev.mysql.com/doc/mysqld-version-reference/en/mysqld-version-reference-reservedwords-5-7.html&lt;/span&gt;

        &lt;span class="n"&gt;q&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;string.gsub&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;q&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;(SEPARATOR)&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;`%1`&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
        &lt;span class="n"&gt;q&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;string.gsub&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;q&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;(INT%d)&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;`%1`&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

        &lt;span class="c1"&gt;-- Исправление поискового запроса (захардкоженного в marcp.exe) и регистронезависимый поиск.&lt;/span&gt;
        &lt;span class="kd"&gt;local&lt;/span&gt; &lt;span class="n"&gt;_&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="n"&gt;_&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="n"&gt;str1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="n"&gt;str2&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="n"&gt;str3&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;string.find&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;q&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;SELECT TERM,CNT FROM (.-) WHERE TERM%s*&amp;gt;=%s*(&amp;#39;.-&amp;#39;)%s(.*)&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="c1"&gt;-- TODO: проверить всегда ли передаются кавычки в поле WHERE TERM &amp;gt;= &amp;#39;&amp;#39;.&lt;/span&gt;
        &lt;span class="kr"&gt;if&lt;/span&gt; &lt;span class="n"&gt;str1&lt;/span&gt; &lt;span class="o"&gt;~=&lt;/span&gt; &lt;span class="kc"&gt;nil&lt;/span&gt; &lt;span class="ow"&gt;and&lt;/span&gt; &lt;span class="n"&gt;str2&lt;/span&gt; &lt;span class="o"&gt;~=&lt;/span&gt; &lt;span class="kc"&gt;nil&lt;/span&gt; &lt;span class="ow"&gt;and&lt;/span&gt; &lt;span class="n"&gt;str3&lt;/span&gt; &lt;span class="o"&gt;~=&lt;/span&gt; &lt;span class="kc"&gt;nil&lt;/span&gt; &lt;span class="kr"&gt;then&lt;/span&gt;
                &lt;span class="n"&gt;MyDebug&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;str1: &amp;#39;&lt;/span&gt; &lt;span class="o"&gt;..&lt;/span&gt; &lt;span class="n"&gt;str1&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt; &lt;span class="n"&gt;MyDebug&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;str2: &amp;#39;&lt;/span&gt; &lt;span class="o"&gt;..&lt;/span&gt; &lt;span class="n"&gt;str2&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt; &lt;span class="n"&gt;MyDebug&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;str3: &amp;#39;&lt;/span&gt; &lt;span class="o"&gt;..&lt;/span&gt; &lt;span class="n"&gt;str3&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
                &lt;span class="n"&gt;str2&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;string.gsub&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;str2&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;^&amp;#39;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="c1"&gt;-- Delete start &amp;#39;.&lt;/span&gt;
                &lt;span class="n"&gt;str2&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;string.gsub&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;str2&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;&amp;#39;$&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="c1"&gt;-- Delete end &amp;#39;.&lt;/span&gt;
                &lt;span class="n"&gt;MyDebug&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;Fixed str2: &amp;#39;&lt;/span&gt; &lt;span class="o"&gt;..&lt;/span&gt; &lt;span class="n"&gt;str2&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
                &lt;span class="n"&gt;q&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;string.format&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;SELECT TERM,CNT FROM %s WHERE LOWER(TERM) LIKE LOWER(&amp;#39;%s%%&amp;#39;) %s&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="n"&gt;str1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="n"&gt;str2&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="n"&gt;str3&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
        &lt;span class="kr"&gt;end&lt;/span&gt;

        &lt;span class="c1"&gt;-- Исправляем кавычки в запросе.&lt;/span&gt;
        &lt;span class="n"&gt;q&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;string.gsub&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;q&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;SELECT CODE,NAME FROM%s+&amp;quot;(.+)&amp;quot;%s*(.*)&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;SELECT CODE,NAME FROM `%1` %2&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="c1"&gt;-- Del start &amp;#39;.&lt;/span&gt;

        &lt;span class="n"&gt;MyDebug&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;Fixed query: &amp;#39;&lt;/span&gt; &lt;span class="o"&gt;..&lt;/span&gt; &lt;span class="n"&gt;q&lt;/span&gt; &lt;span class="o"&gt;..&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;&lt;/span&gt;&lt;span class="se"&gt;\n&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
        &lt;span class="n"&gt;file&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="n"&gt;write&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;Fixed query: &amp;#39;&lt;/span&gt; &lt;span class="o"&gt;..&lt;/span&gt; &lt;span class="n"&gt;q&lt;/span&gt; &lt;span class="o"&gt;..&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;&lt;/span&gt;&lt;span class="se"&gt;\n&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
        &lt;span class="n"&gt;file&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="n"&gt;close&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;

        &lt;span class="n"&gt;proxy&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;queries&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="n"&gt;append&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nb"&gt;string.char&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;proxy&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;COM_QUERY&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;..&lt;/span&gt; &lt;span class="n"&gt;q&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="n"&gt;resultset_is_needed&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="kc"&gt;true&lt;/span&gt;&lt;span class="p"&gt;})&lt;/span&gt;

        &lt;span class="kr"&gt;return&lt;/span&gt; &lt;span class="n"&gt;proxy&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;PROXY_SEND_QUERY&lt;/span&gt;
&lt;span class="kr"&gt;end&lt;/span&gt;

&lt;span class="kr"&gt;function&lt;/span&gt; &lt;span class="nf"&gt;read_query_result&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;inj&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
        &lt;span class="kr"&gt;if&lt;/span&gt; &lt;span class="n"&gt;inj&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt; &lt;span class="ow"&gt;and&lt;/span&gt; &lt;span class="n"&gt;inj&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;resultset&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;rows&lt;/span&gt; &lt;span class="o"&gt;~=&lt;/span&gt; &lt;span class="kc"&gt;nil&lt;/span&gt; &lt;span class="kr"&gt;then&lt;/span&gt;
                &lt;span class="kd"&gt;local&lt;/span&gt; &lt;span class="n"&gt;file&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;io.open&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;/var/log/mysql-proxy.log&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;a&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
                &lt;span class="kr"&gt;for&lt;/span&gt; &lt;span class="n"&gt;row&lt;/span&gt; &lt;span class="kr"&gt;in&lt;/span&gt; &lt;span class="n"&gt;inj&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;resultset&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;rows&lt;/span&gt; &lt;span class="kr"&gt;do&lt;/span&gt;
                &lt;span class="kd"&gt;local&lt;/span&gt; &lt;span class="n"&gt;i&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;
                &lt;span class="kd"&gt;local&lt;/span&gt; &lt;span class="n"&gt;fields&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;{}&lt;/span&gt;
                &lt;span class="kr"&gt;while&lt;/span&gt; &lt;span class="n"&gt;row&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="kr"&gt;do&lt;/span&gt;
                        &lt;span class="kr"&gt;if&lt;/span&gt; &lt;span class="n"&gt;row&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="n"&gt;row&lt;/span&gt; &lt;span class="kr"&gt;then&lt;/span&gt; &lt;span class="kr"&gt;break&lt;/span&gt; &lt;span class="kr"&gt;end&lt;/span&gt;
                                &lt;span class="n"&gt;file&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="n"&gt;write&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;Response field: &amp;#39;&lt;/span&gt; &lt;span class="o"&gt;..&lt;/span&gt; &lt;span class="n"&gt;inj&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;resultset&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;fields&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="p"&gt;].&lt;/span&gt;&lt;span class="n"&gt;name&lt;/span&gt; &lt;span class="o"&gt;..&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39; =&amp;gt; &amp;#39;&lt;/span&gt; &lt;span class="o"&gt;..&lt;/span&gt; &lt;span class="n"&gt;row&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;..&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;&lt;/span&gt;&lt;span class="se"&gt;\n&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
                                &lt;span class="n"&gt;i&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;i&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;
                        &lt;span class="kr"&gt;end&lt;/span&gt;
                &lt;span class="kr"&gt;end&lt;/span&gt;
                &lt;span class="n"&gt;file&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="n"&gt;close&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
                &lt;span class="kr"&gt;return&lt;/span&gt; &lt;span class="n"&gt;proxy&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;PROXY_IGNORE_RESULT&lt;/span&gt;
        &lt;span class="kr"&gt;end&lt;/span&gt;
&lt;span class="kr"&gt;end&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;В ходе экспериментов для подключения к БД был получен такой конфиг &lt;code&gt;dns.ini&lt;/code&gt; для работы с &lt;strong&gt;MySQL&lt;/strong&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="na"&gt;Универс|DRIVER&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;MySQL ODBC 5.2 Unicode Driver;NO_SSPS=1;MULTI_STATEMENTS=1;AUTO_RECONNECT=1;LOG_QUERY=0;IGNORE_SPACE=1;COMPRESSED_PROTO=1;NO_PROMPT=1;CHARSET=cp1251;DATABASE=marcsql;SERVER=192.168.4.26;PORT=4040;UID=marcsql;PASSWORD=password;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Описание некоторых опций:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;NO_SSPS=1;&lt;/code&gt; - Включение подстановок на стороне клиента, а не сервера (т.е. запросы в которых есть знаки "?").&lt;/li&gt;
&lt;li&gt;&lt;code&gt;COMPRESSED_PROTO=1;&lt;/code&gt; - Включение сжатия (немного повышается скорость работы с большими результатами запросов).&lt;/li&gt;
&lt;li&gt;&lt;code&gt;NO_PROMPT=1;&lt;/code&gt; - Отключение окна запроса, при переподключении к БД.&lt;/li&gt;
&lt;li&gt;&lt;code&gt;CHARSET=cp1251;&lt;/code&gt; - Кодировка в которой будет идти обмен между сервером и клиентом (программа для &lt;strong&gt;Windows&lt;/strong&gt; и работает в &lt;code&gt;cp1251&lt;/code&gt;).&lt;/li&gt;
&lt;li&gt;&lt;code&gt;BASE=marcsql;&lt;/code&gt; - Имя базы.&lt;/li&gt;
&lt;li&gt;&lt;code&gt;SERVER=192.168.4.26;&lt;/code&gt; - Адрес сервера &lt;strong&gt;MySQL-Proxy&lt;/strong&gt;.&lt;/li&gt;
&lt;li&gt;&lt;code&gt;PORT=4040;&lt;/code&gt; - Порт на котором работает &lt;strong&gt;MySQL-Proxy&lt;/strong&gt;.&lt;/li&gt;
&lt;li&gt;&lt;code&gt;UID=marcsql;&lt;/code&gt; - Логин, для подключения к БД.&lt;/li&gt;
&lt;li&gt;&lt;code&gt;PASSWORD=password;&lt;/code&gt; - Пароль, для подключения к БД.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Но на этом рано останавливаться, нужно еще привести в порядок запросы в файлах программы да и самой программе объяснить, что мы будем использовать &lt;strong&gt;MySQL&lt;/strong&gt;, а не &lt;strong&gt;MS Access&lt;/strong&gt;:
Добавляем в конец информацию о &lt;code&gt;MySQL&lt;/code&gt; в &lt;code&gt;bin/db.ini&lt;/code&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;[Mysql]&lt;/span&gt;

&lt;span class="na"&gt;ScriptPath&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;..\sql\Mysql&lt;/span&gt;
&lt;span class="na"&gt;CreateTempTable&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;CREATE TABLE &amp;amp;Table&amp;amp;TabSuf(DOC_ID INTEGER PRIMARY KEY)&lt;/span&gt;
&lt;span class="na"&gt;DictQuery&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;SELECT TERM,CNT FROM &amp;amp;Table&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;В файле &lt;code&gt;DbmsParams.ini&lt;/code&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;[Mysql]&lt;/span&gt;

&lt;span class="na"&gt;$VARCHAR&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;VARCHAR&lt;/span&gt;
&lt;span class="na"&gt;$COUNTER&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;INT AUTO_INCREMENT&lt;/span&gt;
&lt;span class="na"&gt;$DOUBLE&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;FLOAT&lt;/span&gt;
&lt;span class="na"&gt;$LONGTEXT&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;TEXT&lt;/span&gt;
&lt;span class="na"&gt;$LONGBINARY&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;TEXT&lt;/span&gt;
&lt;span class="na"&gt;$MIDTEXT&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;TEXT&lt;/span&gt;
&lt;span class="na"&gt;$TEXT&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;TEXT&lt;/span&gt;
&lt;span class="na"&gt;$DBPREF_&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;marcsql.&lt;/span&gt;
&lt;span class="na"&gt;$COLUMN&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;
&lt;span class="na"&gt;$TOP1000&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;
&lt;span class="na"&gt;$ALTERCOLUMN&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;ALTER COLUMN&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Добавляем информацию о возрастном маркере в &lt;code&gt;EditMap.ini&lt;/code&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;[333a]&lt;/span&gt;
&lt;span class="na"&gt;EditForm&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;TECombo&lt;/span&gt;
&lt;span class="na"&gt;ComboValues&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;0+  Для дошкольного возраста,6+  Для младшего школьного возраста,12+ Для среднего школьного возраста,16+ Для старшего школьного возраста,18+ Для взрослых&lt;/span&gt;
&lt;span class="na"&gt;TagValues&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;Для дошкольного возраста,Для младшего школьного возраста,Для среднего школьного возраста,Для старшего школьного возраста,Для взрослых&lt;/span&gt;
&lt;span class="na"&gt;Separator&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;,&lt;/span&gt;
&lt;span class="na"&gt;OnlyFormEdit&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;Yes&lt;/span&gt;
&lt;span class="na"&gt;DefaultMenu&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;NO&lt;/span&gt;

&lt;span class="k"&gt;[200e]&lt;/span&gt;
&lt;span class="na"&gt;EditForm&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;TECombo&lt;/span&gt;
&lt;span class="na"&gt;ComboValues&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;[0+],[6+],[12+],[16+],[18+]&lt;/span&gt;
&lt;span class="na"&gt;TagValues&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;[0+],[6+],[12+],[16+],[18+]&lt;/span&gt;
&lt;span class="na"&gt;Separator&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;,&lt;/span&gt;
&lt;span class="na"&gt;OnlyFormEdit&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;Yes&lt;/span&gt;
&lt;span class="na"&gt;DefaultMenu&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;NO&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Добавляем редактор &lt;strong&gt;LibreOffice&lt;/strong&gt; в файле &lt;code&gt;marc.ini&lt;/code&gt; в секцию &lt;code&gt;[Editors]&lt;/code&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;[Editors]&lt;/span&gt;

&lt;span class="na"&gt;LibreOffice&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;swriter.exe&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Изменяем файл &lt;code&gt;phase.ini&lt;/code&gt; под потребности нашей школы:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;[Книги]&lt;/span&gt;

&lt;span class="na"&gt;CreateTags&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;245anpbco,100ae,700ae,653a,520a,020ac,090ax,084a,110a,260abc,440a,650a,200e,300ab,333a,952be,526cde,250a,998а,773b,773d,773t,773g,013ddee&lt;/span&gt;
&lt;span class="na"&gt;EditTags&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;245,100,700,653,520,020,090,084,110,200,260,440,650,300,333,952,526,250,998,773&lt;/span&gt;
&lt;span class="na"&gt;ViewTags&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;100a,100e,700a,700e,245a,245b,245o,245p,245n,260a,260b,260c,300a,300b,333a,440a,020a,020c,650a,090a,090x,084a&lt;/span&gt;
&lt;span class="na"&gt;ShowAllTags&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;YES&lt;/span&gt;
&lt;span class="na"&gt;RecType&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;a&lt;/span&gt;
&lt;span class="na"&gt;BibLevel&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;m&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;В файле &lt;code&gt;RdrData.ini&lt;/code&gt;, в секции &lt;code&gt;[Common]&lt;/code&gt; исправляем запрос &lt;code&gt;LastReaderQuery&lt;/code&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="na"&gt;LastReaderQuery&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;SELECT RDR_ID FROM &amp;amp;ReadersPrefREADERS ORDER BY LEN(RDR_ID) DESC, RDR_ID DESC LIMIT 1&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Теперь &lt;strong&gt;SQL файлы&lt;/strong&gt;, заходим в каталог &lt;code&gt;sql&lt;/code&gt;:
Была проблема при удалении записей из таблиц словарей, исправляется в файле &lt;code&gt;delidx.sql&lt;/code&gt;:
Ищем строку:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;DELETE&lt;/span&gt; &lt;span class="k"&gt;FROM&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&lt;/span&gt;&lt;span class="k"&gt;Table&lt;/span&gt; &lt;span class="k"&gt;WHERE&lt;/span&gt; &lt;span class="n"&gt;CNT&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Заменяем её на:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;DELETE&lt;/span&gt; &lt;span class="k"&gt;FROM&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&lt;/span&gt;&lt;span class="k"&gt;Table&lt;/span&gt; &lt;span class="k"&gt;WHERE&lt;/span&gt; &lt;span class="n"&gt;CNT&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;=&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Исправляем проблему с удалением данных из таблицы &lt;code&gt;METAIDX&lt;/code&gt; ищем в файле &lt;code&gt;dropdict.sql&lt;/code&gt; строку:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;DELETE&lt;/span&gt; &lt;span class="k"&gt;FROM&lt;/span&gt; &lt;span class="n"&gt;METAIDX&lt;/span&gt; &lt;span class="k"&gt;WHERE&lt;/span&gt; &lt;span class="n"&gt;NAME&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;&amp;amp;Table.TERM&amp;#39;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Заменяем её на:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;DELETE&lt;/span&gt; &lt;span class="k"&gt;FROM&lt;/span&gt; &lt;span class="o"&gt;`&lt;/span&gt;&lt;span class="n"&gt;METAIDX&lt;/span&gt;&lt;span class="o"&gt;`&lt;/span&gt; &lt;span class="k"&gt;WHERE&lt;/span&gt; &lt;span class="o"&gt;`&lt;/span&gt;&lt;span class="n"&gt;NAME&lt;/span&gt;&lt;span class="o"&gt;`&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;&amp;amp;Table.`TERM`&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="k"&gt;DELETE&lt;/span&gt; &lt;span class="k"&gt;FROM&lt;/span&gt; &lt;span class="o"&gt;`&lt;/span&gt;&lt;span class="n"&gt;METAIDX&lt;/span&gt;&lt;span class="o"&gt;`&lt;/span&gt; &lt;span class="k"&gt;WHERE&lt;/span&gt; &lt;span class="o"&gt;`&lt;/span&gt;&lt;span class="n"&gt;NAME&lt;/span&gt;&lt;span class="o"&gt;`&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;&amp;amp;Table.TERM&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Теперь создаем каталог &lt;code&gt;Mysql&lt;/code&gt; и копируем все файлы из каталога &lt;code&gt;Access&lt;/code&gt; в созданный каталог &lt;code&gt;Mysql&lt;/code&gt; (напоминаю, мы должны быть в каталоге &lt;code&gt;sql&lt;/code&gt;). Другими словами мы должны получить копию папки &lt;code&gt;sql/Acess&lt;/code&gt;, но по адресу &lt;code&gt;sql/Mysql&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;И приводим в порядок файлы в каталоге &lt;code&gt;sql/Mysql&lt;/code&gt;:
Файл &lt;code&gt;crdict.sql&lt;/code&gt; приводим к такому виду:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;INSERT&lt;/span&gt; &lt;span class="k"&gt;INTO&lt;/span&gt; &lt;span class="n"&gt;METAIDX&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;`&lt;/span&gt;&lt;span class="n"&gt;NAME&lt;/span&gt;&lt;span class="o"&gt;`&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="o"&gt;`&lt;/span&gt;&lt;span class="k"&gt;TYPE&lt;/span&gt;&lt;span class="o"&gt;`&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="o"&gt;`&lt;/span&gt;&lt;span class="n"&gt;MAXLEN&lt;/span&gt;&lt;span class="o"&gt;`&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="o"&gt;`&lt;/span&gt;&lt;span class="n"&gt;TAGS&lt;/span&gt;&lt;span class="o"&gt;`&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="o"&gt;`&lt;/span&gt;&lt;span class="n"&gt;CAPTION&lt;/span&gt;&lt;span class="o"&gt;`&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="o"&gt;`&lt;/span&gt;&lt;span class="n"&gt;SEP&lt;/span&gt;&lt;span class="o"&gt;`&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="k"&gt;VALUES&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;&amp;amp;Table.`TERM`&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;&amp;amp;Type&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="o"&gt;&amp;amp;&lt;/span&gt;&lt;span class="n"&gt;MaxLen&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;&amp;amp;Taglist&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;&amp;amp;Caption&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;&amp;amp;Sep&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;

&lt;span class="k"&gt;CREATE&lt;/span&gt; &lt;span class="k"&gt;TABLE&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&lt;/span&gt;&lt;span class="k"&gt;Table&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;
 &lt;span class="o"&gt;`&lt;/span&gt;&lt;span class="n"&gt;IDX_ID&lt;/span&gt;&lt;span class="o"&gt;`&lt;/span&gt; &lt;span class="nb"&gt;INT&lt;/span&gt; &lt;span class="n"&gt;AUTO_INCREMENT&lt;/span&gt; &lt;span class="k"&gt;NOT&lt;/span&gt; &lt;span class="k"&gt;NULL&lt;/span&gt; &lt;span class="k"&gt;PRIMARY&lt;/span&gt; &lt;span class="k"&gt;KEY&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
 &lt;span class="o"&gt;`&lt;/span&gt;&lt;span class="n"&gt;TERM&lt;/span&gt;&lt;span class="o"&gt;`&lt;/span&gt; &lt;span class="nb"&gt;VARCHAR&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;&amp;amp;&lt;/span&gt;&lt;span class="n"&gt;MaxLen&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;
 &lt;span class="o"&gt;`&lt;/span&gt;&lt;span class="n"&gt;CNT&lt;/span&gt;&lt;span class="o"&gt;`&lt;/span&gt; &lt;span class="nb"&gt;INTEGER&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;

&lt;span class="k"&gt;CREATE&lt;/span&gt; &lt;span class="k"&gt;TABLE&lt;/span&gt; &lt;span class="o"&gt;`&amp;amp;&lt;/span&gt;&lt;span class="n"&gt;TableX&lt;/span&gt;&lt;span class="o"&gt;`&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;
 &lt;span class="o"&gt;`&lt;/span&gt;&lt;span class="n"&gt;IDX_ID&lt;/span&gt;&lt;span class="o"&gt;`&lt;/span&gt; &lt;span class="nb"&gt;INTEGER&lt;/span&gt; &lt;span class="k"&gt;NOT&lt;/span&gt; &lt;span class="k"&gt;NULL&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
 &lt;span class="o"&gt;`&lt;/span&gt;&lt;span class="n"&gt;DOC_ID&lt;/span&gt;&lt;span class="o"&gt;`&lt;/span&gt; &lt;span class="nb"&gt;INTEGER&lt;/span&gt; &lt;span class="k"&gt;NOT&lt;/span&gt; &lt;span class="k"&gt;NULL&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
 &lt;span class="k"&gt;FOREIGN&lt;/span&gt; &lt;span class="k"&gt;KEY&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;`&lt;/span&gt;&lt;span class="n"&gt;IDX_ID&lt;/span&gt;&lt;span class="o"&gt;`&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="k"&gt;REFERENCES&lt;/span&gt; &lt;span class="o"&gt;`&amp;amp;&lt;/span&gt;&lt;span class="k"&gt;Table&lt;/span&gt;&lt;span class="o"&gt;`&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;`&lt;/span&gt;&lt;span class="n"&gt;IDX_ID&lt;/span&gt;&lt;span class="o"&gt;`&lt;/span&gt;&lt;span class="p"&gt;));&lt;/span&gt;

&lt;span class="k"&gt;CREATE&lt;/span&gt; &lt;span class="k"&gt;INDEX&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&lt;/span&gt;&lt;span class="n"&gt;TableXB&lt;/span&gt; &lt;span class="k"&gt;ON&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&lt;/span&gt;&lt;span class="n"&gt;TableX&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;`&lt;/span&gt;&lt;span class="n"&gt;DOC_ID&lt;/span&gt;&lt;span class="o"&gt;`&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;span class="k"&gt;CREATE&lt;/span&gt; &lt;span class="k"&gt;INDEX&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&lt;/span&gt;&lt;span class="n"&gt;TableXC&lt;/span&gt; &lt;span class="k"&gt;ON&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&lt;/span&gt;&lt;span class="n"&gt;TableX&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;`&lt;/span&gt;&lt;span class="n"&gt;IDX_ID&lt;/span&gt;&lt;span class="o"&gt;`&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Файл &lt;code&gt;rebuild.sql&lt;/code&gt; приводим к такому виду:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;DROP&lt;/span&gt; &lt;span class="k"&gt;TABLE&lt;/span&gt; &lt;span class="k"&gt;IF&lt;/span&gt; &lt;span class="k"&gt;EXISTS&lt;/span&gt; &lt;span class="o"&gt;`&lt;/span&gt;&lt;span class="n"&gt;IDXTEMP&lt;/span&gt;&lt;span class="o"&gt;`&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;

&lt;span class="k"&gt;CREATE&lt;/span&gt; &lt;span class="k"&gt;TABLE&lt;/span&gt; &lt;span class="o"&gt;`&lt;/span&gt;&lt;span class="n"&gt;IDXTEMP&lt;/span&gt;&lt;span class="o"&gt;`&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;`&lt;/span&gt;&lt;span class="n"&gt;DOC_ID&lt;/span&gt;&lt;span class="o"&gt;`&lt;/span&gt; &lt;span class="nb"&gt;INTEGER&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&lt;/span&gt;&lt;span class="n"&gt;Term&lt;/span&gt; &lt;span class="nb"&gt;Text&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;span class="err"&gt;$&lt;/span&gt;&lt;span class="n"&gt;BUILD&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="err"&gt;$Инициализация&lt;/span&gt; &lt;span class="err"&gt;таблицы&lt;/span&gt; &lt;span class="err"&gt;индексов&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="k"&gt;DELETE&lt;/span&gt; &lt;span class="k"&gt;FROM&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&lt;/span&gt;&lt;span class="n"&gt;TableX&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="k"&gt;DELETE&lt;/span&gt; &lt;span class="k"&gt;FROM&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&lt;/span&gt;&lt;span class="k"&gt;Table&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="err"&gt;$Заполнение&lt;/span&gt; &lt;span class="err"&gt;таблицы&lt;/span&gt; &lt;span class="err"&gt;индексов&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="k"&gt;INSERT&lt;/span&gt; &lt;span class="k"&gt;INTO&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&lt;/span&gt;&lt;span class="k"&gt;Table&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;&amp;amp;&lt;/span&gt;&lt;span class="n"&gt;Term&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="n"&gt;CNT&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="k"&gt;SELECT&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&lt;/span&gt;&lt;span class="n"&gt;Term&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="k"&gt;Count&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;&amp;amp;&lt;/span&gt;&lt;span class="n"&gt;Term&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="k"&gt;FROM&lt;/span&gt; &lt;span class="n"&gt;IDXTEMP&lt;/span&gt; &lt;span class="k"&gt;GROUP&lt;/span&gt; &lt;span class="k"&gt;BY&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&lt;/span&gt;&lt;span class="n"&gt;Term&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="err"&gt;$Заполнение&lt;/span&gt; &lt;span class="err"&gt;таблицы&lt;/span&gt; &lt;span class="err"&gt;перекрестных&lt;/span&gt; &lt;span class="err"&gt;ссылок&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="k"&gt;INSERT&lt;/span&gt; &lt;span class="k"&gt;INTO&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&lt;/span&gt;&lt;span class="n"&gt;TableX&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;IDX_ID&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="n"&gt;DOC_ID&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="k"&gt;SELECT&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&lt;/span&gt;&lt;span class="k"&gt;Table&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;IDX_ID&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="n"&gt;IDXTEMP&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;DOC_ID&lt;/span&gt; &lt;span class="k"&gt;FROM&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&lt;/span&gt;&lt;span class="k"&gt;Table&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="n"&gt;IDXTEMP&lt;/span&gt;
&lt;span class="k"&gt;WHERE&lt;/span&gt; &lt;span class="n"&gt;IDXTEMP&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="o"&gt;&amp;amp;&lt;/span&gt;&lt;span class="n"&gt;Term&lt;/span&gt;&lt;span class="o"&gt;=&amp;amp;&lt;/span&gt;&lt;span class="k"&gt;Table&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="o"&gt;&amp;amp;&lt;/span&gt;&lt;span class="n"&gt;Term&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="err"&gt;$Удаление&lt;/span&gt; &lt;span class="err"&gt;временной&lt;/span&gt; &lt;span class="err"&gt;таблицы&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="k"&gt;DROP&lt;/span&gt; &lt;span class="k"&gt;TABLE&lt;/span&gt; &lt;span class="n"&gt;IDXTEMP&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;На этом изменения в файлах программы окончены. Пришло время конвертировать базу, я конвертировал при помощи &lt;a href="http://www.bullzip.com/products/a2m/info.php" title="BullZip Access To MySQL"&gt;BullZip Access To MySQL [6]&lt;/a&gt;, на выходе получил &lt;code&gt;.sql&lt;/code&gt; файл, который был скопирован на сервер и залит в БД. На этом все.&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;Ссылки по теме:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href="http://dev.mysql.com/doc/mysqld-version-reference/en/mysqld-version-reference-reservedwords-5-0.html" title="Reserved Words in MySQL 5.0"&gt;Reserved Words in MySQL 5.0&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://dev.mysql.com/downloads/mysql-proxy/" title="Download MySQL Proxy"&gt;Download MySQL Proxy&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://dev.mysql.com/downloads/connector/odbc/"&gt;Download Connector/ODBC&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://www.lua.org/pil/20.1.html" title="Programming in Lua"&gt;20.1 – Pattern-Matching Functions&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://habrahabr.ru/post/177057/"&gt;MySQL On air. Мониторим SQL запросы&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://www.bullzip.com/products/a2m/info.php" title="BullZip Access To MySQL"&gt;BullZip Access To MySQL&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://forum.informsystema.ru/viewtopic.php?f=2&amp;amp;t=52"&gt;MySQL и MarcSQL&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://informsystema.ru/Software.aspx?id=14"&gt;Версия АИБС "МАРК-SQL" для школьных библиотек находится в свободном доступе для российских школ.&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;</content><category term="FreeBSD"></category><category term="Linux"></category><category term="MySQL"></category><category term="marc sql"></category><category term="МАРК-SQL"></category><category term="АИБС"></category></entry><entry><title>Настройка NTP клиента в Windows из cmd, cli, bat</title><link href="https://metajiji.github.io/blog/windows-cli-ntp-cmd-bat/" rel="alternate"></link><published>2014-06-27T00:00:00+07:00</published><updated>2014-06-27T00:00:00+07:00</updated><author><name>Denis Kadyshev</name></author><id>tag:metajiji.github.io,2014-06-27:/blog/windows-cli-ntp-cmd-bat/</id><summary type="html">&lt;p&gt;Короткая заметка про настройку &lt;strong&gt;NTP&lt;/strong&gt; клиента в &lt;strong&gt;Windows&lt;/strong&gt;.&lt;/p&gt;
&lt;p&gt;Для настройки вручную из &lt;code&gt;cmd&lt;/code&gt; можно воспользоваться командами:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;C&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="nl"&gt;\&lt;/span&gt;&lt;span class="c1"&gt;&amp;gt;net time /setsntp:&amp;lt;IP-адрес или FQDN-имя NTP-сервера локальной сети&amp;gt;&lt;/span&gt;
The command completed successfully.
C&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="nl"&gt;\&lt;/span&gt;&lt;span class="c1"&gt;&amp;gt;net stop w32time&lt;/span&gt;
The Windows Time service is stopping.
The Windows Time service was stopped successfully.
C&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="nl"&gt;\&lt;/span&gt;&lt;span class="c1"&gt;&amp;gt;net start …&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;</summary><content type="html">&lt;p&gt;Короткая заметка про настройку &lt;strong&gt;NTP&lt;/strong&gt; клиента в &lt;strong&gt;Windows&lt;/strong&gt;.&lt;/p&gt;
&lt;p&gt;Для настройки вручную из &lt;code&gt;cmd&lt;/code&gt; можно воспользоваться командами:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;C&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="nl"&gt;\&lt;/span&gt;&lt;span class="c1"&gt;&amp;gt;net time /setsntp:&amp;lt;IP-адрес или FQDN-имя NTP-сервера локальной сети&amp;gt;&lt;/span&gt;
The command completed successfully.
C&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="nl"&gt;\&lt;/span&gt;&lt;span class="c1"&gt;&amp;gt;net stop w32time&lt;/span&gt;
The Windows Time service is stopping.
The Windows Time service was stopped successfully.
C&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="nl"&gt;\&lt;/span&gt;&lt;span class="c1"&gt;&amp;gt;net start w32time&lt;/span&gt;
The Windows Time service is starting.
The Windows Time service was started successfully.
C&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="nl"&gt;\&lt;/span&gt;&lt;span class="c1"&gt;&amp;gt;net time /querysntp&lt;/span&gt;
The current SNTP value is: &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;IP-адрес или FQDN-имя NTP-сервера локальной сети&amp;gt;
The command completed successfully.
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Или объединить их в &lt;code&gt;bat&lt;/code&gt; или &lt;code&gt;cmd&lt;/code&gt; скрипт:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="p"&gt;@&lt;/span&gt;&lt;span class="k"&gt;ECHO&lt;/span&gt; OFF

&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="c1"&gt;: IP-адрес или FQDN-имя NTP-сервера локальной сети.&lt;/span&gt;
&lt;span class="k"&gt;SET&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;NTP_SRV=ntp.domain.ltd&amp;quot;&lt;/span&gt;

net time /setsntp:&lt;span class="nv"&gt;%NTP_SRV%&lt;/span&gt;
net stop w32time
net start w32time
net time /querysntp
&lt;/pre&gt;&lt;/div&gt;


&lt;hr&gt;
&lt;p&gt;Ссылки по теме:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href="http://www.k-max.name/linux/ntp-server-na-linux/"&gt;NTP Server на Linux (ntpd)&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;</content><category term="Windows"></category><category term="NTP"></category><category term="cmd"></category><category term="bat"></category></entry><entry><title>Ubuntu 14.04 и Windows zip архивы - исправляем проблему с кодировками.</title><link href="https://metajiji.github.io/blog/ubuntu-1404-windows-zip-fix-codepage/" rel="alternate"></link><published>2014-06-20T00:00:00+07:00</published><updated>2014-06-20T00:00:00+07:00</updated><author><name>Denis Kadyshev</name></author><id>tag:metajiji.github.io,2014-06-20:/blog/ubuntu-1404-windows-zip-fix-codepage/</id><summary type="html">&lt;p&gt;Исправляем проблему с &lt;code&gt;zip&lt;/code&gt; архивами между &lt;strong&gt;Ubuntu 14.04&lt;/strong&gt; и &lt;strong&gt;Windows&lt;/strong&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;sudo add-apt-repository ppa:frol/zip-i18n
sudo sed -i&lt;span class="s1"&gt;&amp;#39;&amp;#39;&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;s/trusty/precise/g&amp;#39;&lt;/span&gt; /etc/apt/sources.list.d/frol-zip-i18n-trusty.list
sudo apt-get update
sudo apt-get install zip unzip p7zip-full
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;В добавляемом репозитории пока нет пакетов для &lt;strong&gt;Ubuntu 14.04&lt;/strong&gt; (&lt;strong&gt;trusty …&lt;/strong&gt;&lt;/p&gt;</summary><content type="html">&lt;p&gt;Исправляем проблему с &lt;code&gt;zip&lt;/code&gt; архивами между &lt;strong&gt;Ubuntu 14.04&lt;/strong&gt; и &lt;strong&gt;Windows&lt;/strong&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;sudo add-apt-repository ppa:frol/zip-i18n
sudo sed -i&lt;span class="s1"&gt;&amp;#39;&amp;#39;&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;s/trusty/precise/g&amp;#39;&lt;/span&gt; /etc/apt/sources.list.d/frol-zip-i18n-trusty.list
sudo apt-get update
sudo apt-get install zip unzip p7zip-full
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;В добавляемом репозитории пока нет пакетов для &lt;strong&gt;Ubuntu 14.04&lt;/strong&gt; (&lt;strong&gt;trusty&lt;/strong&gt;), но есть для &lt;strong&gt;Ubuntu 12.04&lt;/strong&gt; (&lt;strong&gt;precise&lt;/strong&gt;).&lt;/p&gt;
&lt;p&gt;&lt;code&gt;sed&lt;/code&gt;'ом вручную переключаемся на ветку &lt;strong&gt;precise&lt;/strong&gt; - пакеты совместимы с &lt;strong&gt;trusty&lt;/strong&gt;.&lt;/p&gt;
&lt;p&gt;Должны будут установиться пакеты &lt;code&gt;libnatspec0&lt;/code&gt; и &lt;code&gt;p7zip-full&lt;/code&gt;.&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;Ссылки по теме:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href="https://launchpad.net/~frol/+archive/ubuntu/zip-i18n"&gt;Zip/unzip internationalization PPA&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;</content><category term="Ubuntu"></category><category term="Linux"></category><category term="zip"></category><category term="codepage"></category><category term="cp866"></category><category term="dos-866"></category><category term="1251"></category><category term="cp1251"></category><category term="windows-1251"></category><category term="utf-8"></category><category term="utf8"></category></entry><entry><title>Zimbra: Отправка от списка рассылки</title><link href="https://metajiji.github.io/blog/zimbra-sendasdistlist/" rel="alternate"></link><published>2014-06-11T00:00:00+07:00</published><updated>2014-06-11T00:00:00+07:00</updated><author><name>Denis Kadyshev</name></author><id>tag:metajiji.github.io,2014-06-11:/blog/zimbra-sendasdistlist/</id><summary type="html">&lt;p&gt;Для начала необходимо переключиться на учетную запись &lt;code&gt;zimbra&lt;/code&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;sudo su zimbra
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Для выдачи пользователю права на отправку от списка рассылки:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;zmprov grr dl list@example.tld usr user@example.tld sendAsDistList
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Для отзыва, соответственно:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;zmprov rvr dl list@example.tld usr user@example.tld sendAsDistList
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Есть еще вариант, который не …&lt;/p&gt;</summary><content type="html">&lt;p&gt;Для начала необходимо переключиться на учетную запись &lt;code&gt;zimbra&lt;/code&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;sudo su zimbra
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Для выдачи пользователю права на отправку от списка рассылки:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;zmprov grr dl list@example.tld usr user@example.tld sendAsDistList
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Для отзыва, соответственно:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;zmprov rvr dl list@example.tld usr user@example.tld sendAsDistList
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Есть еще вариант, который не пробовал:&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Preferences&lt;/strong&gt; - &lt;strong&gt;Accounts&lt;/strong&gt; - &lt;strong&gt;Add Persona&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Persona Name: ListName&lt;/li&gt;
&lt;li&gt;Settings for Sent Messages _From: ListName &lt;code&gt;list@example.ltd&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Reply-to [v]: ListName &lt;code&gt;list@example.ltd&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Use this persona: [v] &lt;code&gt;list@example.ltd&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Письмо будет уходить от его учетки, но в имя будет вписано то, что указано в поле &lt;code&gt;From&lt;/code&gt;, ответ клиенты будут отправлять на адрес и имя, которое указано в &lt;code&gt;Reply-to&lt;/code&gt;.
 Так же, будет выбираться автоматически отправитель, при ответе на письма, пришедшие на адрес &lt;code&gt;list@example.ltd&lt;/code&gt;
 (на самом деле это список рассылки и скорей всего у клиента будут указаны все участники списка рассылки).&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;Ссылки по теме:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href="http://www.ossportal.ru/forum/zimbra/703"&gt;Отправка от списка рассылки&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;</content><category term="Zimbra"></category><category term="sendasdistlist"></category><category term="distlist"></category><category term="list"></category><category term="send as dist list"></category></entry><entry><title>Remmina - ошибка "Невозможно подключиться к серверу RDP" при подключении к windows</title><link href="https://metajiji.github.io/blog/remmina-rdp-windows/" rel="alternate"></link><published>2014-06-08T00:00:00+07:00</published><updated>2014-06-08T00:00:00+07:00</updated><author><name>Denis Kadyshev</name></author><id>tag:metajiji.github.io,2014-06-08:/blog/remmina-rdp-windows/</id><summary type="html">&lt;p&gt;Перестала подключатся &lt;strong&gt;Remmina&lt;/strong&gt; по &lt;strong&gt;RDP&lt;/strong&gt;, пишет &lt;code&gt;Невозможно подключиться к серверу RDP&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Решилось все просто, &lt;strong&gt;Remmina&lt;/strong&gt; использует &lt;code&gt;freerdp&lt;/code&gt; для работы по протоколу &lt;strong&gt;RDP&lt;/strong&gt;, и все хосты добавляются в файл &lt;code&gt;~/.freerdp/known_hosts&lt;/code&gt;,
 наподобие как в &lt;code&gt;ssh&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Проблема аналогичная как и в &lt;code&gt;ssh&lt;/code&gt; - если сменился ключ/сертификат - значит невозможно подключиться к серверу - в …&lt;/p&gt;</summary><content type="html">&lt;p&gt;Перестала подключатся &lt;strong&gt;Remmina&lt;/strong&gt; по &lt;strong&gt;RDP&lt;/strong&gt;, пишет &lt;code&gt;Невозможно подключиться к серверу RDP&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Решилось все просто, &lt;strong&gt;Remmina&lt;/strong&gt; использует &lt;code&gt;freerdp&lt;/code&gt; для работы по протоколу &lt;strong&gt;RDP&lt;/strong&gt;, и все хосты добавляются в файл &lt;code&gt;~/.freerdp/known_hosts&lt;/code&gt;,
 наподобие как в &lt;code&gt;ssh&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Проблема аналогичная как и в &lt;code&gt;ssh&lt;/code&gt; - если сменился ключ/сертификат - значит невозможно подключиться к серверу - в &lt;code&gt;ssh&lt;/code&gt; нам рекомендуют удалить
 запись о сервере куда подключаемся из файла &lt;code&gt;known_hosts&lt;/code&gt;, аналогично делаем и с &lt;code&gt;freerdp&lt;/code&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;mcedit ~/.freerdp/known_hosts
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Формат записей аналогичный - 1 строка - 1 сервер. Удаляем нужную нам запись, сохраняем файл и подключаемся.&lt;/p&gt;</content><category term="Linux"></category><category term="Ubuntu"></category><category term="Remmina"></category><category term="RDP"></category></entry><entry><title>Автоматическое создание директории /var/run/php5-fpm после перезагрузки</title><link href="https://metajiji.github.io/blog/auto-create-dir-var-run-php5-fpm/" rel="alternate"></link><published>2014-05-21T00:00:00+07:00</published><updated>2014-10-15T00:00:00+07:00</updated><author><name>Denis Kadyshev</name></author><id>tag:metajiji.github.io,2014-05-21:/blog/auto-create-dir-var-run-php5-fpm/</id><summary type="html">&lt;p&gt;После установки &lt;code&gt;php-fpm&lt;/code&gt;, иногда бывает удобно хранить все его сокеты в отдельной папке, например &lt;code&gt;/var/run/php5-fpm&lt;/code&gt;,
 но если вручную создать такую папку, то после перезагрузки система ее удаляет, а в логе можно увидеть типа:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;ERROR: unable to &lt;span class="nb"&gt;bind&lt;/span&gt; listening socket &lt;span class="k"&gt;for&lt;/span&gt; address &lt;span class="s1"&gt;&amp;#39;/var/run/php5-fpm/default.sock&amp;#39;&lt;/span&gt;: No such …&lt;/pre&gt;&lt;/div&gt;</summary><content type="html">&lt;p&gt;После установки &lt;code&gt;php-fpm&lt;/code&gt;, иногда бывает удобно хранить все его сокеты в отдельной папке, например &lt;code&gt;/var/run/php5-fpm&lt;/code&gt;,
 но если вручную создать такую папку, то после перезагрузки система ее удаляет, а в логе можно увидеть типа:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;ERROR: unable to &lt;span class="nb"&gt;bind&lt;/span&gt; listening socket &lt;span class="k"&gt;for&lt;/span&gt; address &lt;span class="s1"&gt;&amp;#39;/var/run/php5-fpm/default.sock&amp;#39;&lt;/span&gt;: No such file or directory.
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Это связано с тем, что &lt;code&gt;/var/run&lt;/code&gt; монтируется с опцией &lt;code&gt;--bind&lt;/code&gt; из &lt;a href="http://www.opennet.ru/opennews/art.shtml?num=30080" title="30.03.2011 18:55  В Fedora и других Linux-дистрибутивах появится директория /run"&gt;&lt;code&gt;/run&lt;/code&gt; [1]&lt;/a&gt;, где файловая система &lt;code&gt;tmpfs&lt;/code&gt;, логично, что после перезагрузки все, что создавал пользователь - удаляется!
 Но не проблема, значит перед запуском демона, нужно проверять, существует ли каталог, если нет, то создавать.&lt;/p&gt;
&lt;p&gt;Для решения данной проблемы нужно отредактировать &lt;strong&gt;init-скрипт&lt;/strong&gt; &lt;code&gt;/etc/init.d/php5-fpm&lt;/code&gt;, добавив вверху, после переменной &lt;code&gt;SCRIPTNAME&lt;/code&gt; строчку:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nv"&gt;SOCKETDIR&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;/var/run/&lt;span class="nv"&gt;$NAME&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;А затем, под &lt;code&gt;do_start() {&lt;/code&gt; добавить еще одну строчку:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt; -d &lt;span class="nv"&gt;$SOCKETDIR&lt;/span&gt; &lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;||&lt;/span&gt; install -m &lt;span class="m"&gt;777&lt;/span&gt; -o www-data -g root -d &lt;span class="nv"&gt;$SOCKETDIR&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;&lt;code&gt;-m 777&lt;/code&gt; я указал намеренно, т.к. у меня &lt;code&gt;fpm пулы&lt;/code&gt; запускаются от разных &lt;code&gt;uid:gid&lt;/code&gt;, если у вас все пулы работают от 1 пользователя, то можете указать &lt;code&gt;-m 755&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Теперь, при запуске &lt;code&gt;php-fpm&lt;/code&gt; демона, каталог с сокетами в &lt;code&gt;/var/run&lt;/code&gt; будет создаваться автоматически.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;UPDATE:&lt;/strong&gt; 15.10.2014&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Для тех кто пользуется &lt;code&gt;upstart&lt;/code&gt;, приводим файл &lt;code&gt;/etc/init/php5-fpm.conf&lt;/code&gt; к такому виду:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="c1"&gt;# php5-fpm - The PHP FastCGI Process Manager&lt;/span&gt;

description &lt;span class="s2"&gt;&amp;quot;The PHP FastCGI Process Manager&amp;quot;&lt;/span&gt;
author &lt;span class="s2"&gt;&amp;quot;Ondřej Surý &amp;lt;ondrej@debian.org&amp;gt;&amp;quot;&lt;/span&gt;

start on runlevel &lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="m"&gt;2345&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;
stop on runlevel &lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="m"&gt;016&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;

&lt;span class="c1"&gt;# Precise upstart does not support reload signal, and thus rejects the&lt;/span&gt;
&lt;span class="c1"&gt;# job. We&amp;#39;d rather start the daemon, instead of forcing users to&lt;/span&gt;
&lt;span class="c1"&gt;# reboot https://bugs.launchpad.net/ubuntu/+source/php5/+bug/1272788&lt;/span&gt;
&lt;span class="c1"&gt;#&lt;/span&gt;
&lt;span class="c1"&gt;# reload signal USR2&lt;/span&gt;

pre-start script
    &lt;span class="o"&gt;[&lt;/span&gt; -d /var/run/php5-fpm &lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;||&lt;/span&gt; install -m &lt;span class="m"&gt;777&lt;/span&gt; -o www-data -g root -d /var/run/php5-fpm
    /usr/lib/php5/php5-fpm-checkconf
end script

respawn
&lt;span class="nb"&gt;exec&lt;/span&gt; /usr/sbin/php5-fpm --nodaemonize --fpm-config /etc/php5/fpm/php-fpm.conf
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Изменился блок &lt;code&gt;pre-start&lt;/code&gt;, теперь там &lt;code&gt;script&lt;/code&gt;, в котором собственно и стоит проверка каталога &lt;code&gt;/var/run/php5-fpm&lt;/code&gt;, идея подсмотрена в &lt;code&gt;/etc/init/mysql.conf&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Для применения изменений в &lt;code&gt;upstart&lt;/code&gt; скрипты, необходимо выполнить команды:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;root@Ubuntu# initctl reload-configuration
root@Ubuntu# initctl stop php5-fpm
initctl: Unknown instance: 
root@Ubuntu# initctl start php5-fpm
php5-fpm start/running, process &lt;span class="m"&gt;18467&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Обязательно &lt;code&gt;stop&lt;/code&gt; (если был запущен демон &lt;code&gt;php5-fpm&lt;/code&gt;), а затем &lt;code&gt;start&lt;/code&gt;. Если демон &lt;code&gt;php-fpm&lt;/code&gt; не был запущен, то &lt;code&gt;restart&lt;/code&gt; скажет вам &lt;code&gt;initctl: Unknown instance:&lt;/code&gt;" и не запустит демона.
 Так что лучше сперва &lt;code&gt;stop&lt;/code&gt; и затем &lt;code&gt;start&lt;/code&gt; - это избавит от лишних раздумий, как устроена система &lt;code&gt;upstart&lt;/code&gt; и почему &lt;code&gt;restart&lt;/code&gt; не запускает демона.&lt;/p&gt;
&lt;p&gt;Логи запуска через &lt;code&gt;upstart&lt;/code&gt; можно подглядеть в &lt;code&gt;dmesg&lt;/code&gt;, &lt;code&gt;/var/log/upstart/php5-fpm.log&lt;/code&gt;.
P.S. команды &lt;code&gt;service php5-fpm start&lt;/code&gt; будут обработаны &lt;code&gt;upstart&lt;/code&gt;, а &lt;code&gt;init.d&lt;/code&gt; скрипты проигнорированы, так вот запутано все в &lt;strong&gt;Ubuntu&lt;/strong&gt;.&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;Ссылки по теме:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href="http://www.opennet.ru/opennews/art.shtml?num=30080" title="30.03.2011 18:55  В Fedora и других Linux-дистрибутивах появится директория /run"&gt;Opennet.ru: В Fedora и других Linux-дистрибутивах появится директория /run&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://aione.ru/sozdanie-direktorii-var-run-php5-fpm-posle-perezagruzki/"&gt;Создание директории /var/run/php5-fpm после перезагрузки&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;</content><category term="Linux"></category><category term="Ubuntu"></category><category term="upstart"></category><category term="php-fpm"></category><category term="php5-fpm"></category></entry><entry><title>Скрипт для исправления проблем в Ubuntu GRUB в 1 клик.</title><link href="https://metajiji.github.io/blog/ubuntu-fix-all-grub-bugs-in-one-script/" rel="alternate"></link><published>2014-05-09T00:00:00+07:00</published><updated>2014-05-09T00:00:00+07:00</updated><author><name>Denis Kadyshev</name></author><id>tag:metajiji.github.io,2014-05-09:/blog/ubuntu-fix-all-grub-bugs-in-one-script/</id><summary type="html">&lt;p&gt;Скрипт для исправления проблем в &lt;strong&gt;GRUB&lt;/strong&gt; в 1 клик. Возможно применение в автоматизированных скриптах.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="ch"&gt;#!/bin/sh&lt;/span&gt;

load_default_grub&lt;span class="o"&gt;()&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt;
    . /etc/default/grub
&lt;span class="o"&gt;}&lt;/span&gt;

get_yes_no&lt;span class="o"&gt;()&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt;
    &lt;span class="k"&gt;while&lt;/span&gt; &lt;span class="o"&gt;[&lt;/span&gt; &lt;span class="nb"&gt;true&lt;/span&gt; &lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;
        &lt;span class="nb"&gt;echo&lt;/span&gt; -n &lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;$1&lt;/span&gt;&lt;span class="s2"&gt; (Y/N) ? &amp;quot;&lt;/span&gt;
        &lt;span class="nb"&gt;read&lt;/span&gt; a
        &lt;span class="nb"&gt;echo&lt;/span&gt;
        &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="o"&gt;[&lt;/span&gt; &lt;span class="nv"&gt;$?&lt;/span&gt; !&lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="m"&gt;0&lt;/span&gt; &lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="k"&gt;then&lt;/span&gt;
            &lt;span class="nv"&gt;a&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;No&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
        &lt;span class="k"&gt;fi&lt;/span&gt;
        &lt;span class="k"&gt;case&lt;/span&gt; &lt;span class="nv"&gt;$a&lt;/span&gt; in
            &lt;span class="o"&gt;[&lt;/span&gt;Yy&lt;span class="o"&gt;][&lt;/span&gt;Ee&lt;span class="o"&gt;][&lt;/span&gt;Ss&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="p"&gt;|&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;Yy&lt;span class="o"&gt;])&lt;/span&gt; &lt;span class="nv"&gt;a&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;Yes&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="p"&gt;;;&lt;/span&gt;
            &lt;span class="o"&gt;[&lt;/span&gt;Nn …&lt;/pre&gt;&lt;/div&gt;</summary><content type="html">&lt;p&gt;Скрипт для исправления проблем в &lt;strong&gt;GRUB&lt;/strong&gt; в 1 клик. Возможно применение в автоматизированных скриптах.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="ch"&gt;#!/bin/sh&lt;/span&gt;

load_default_grub&lt;span class="o"&gt;()&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt;
    . /etc/default/grub
&lt;span class="o"&gt;}&lt;/span&gt;

get_yes_no&lt;span class="o"&gt;()&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt;
    &lt;span class="k"&gt;while&lt;/span&gt; &lt;span class="o"&gt;[&lt;/span&gt; &lt;span class="nb"&gt;true&lt;/span&gt; &lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;
        &lt;span class="nb"&gt;echo&lt;/span&gt; -n &lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;$1&lt;/span&gt;&lt;span class="s2"&gt; (Y/N) ? &amp;quot;&lt;/span&gt;
        &lt;span class="nb"&gt;read&lt;/span&gt; a
        &lt;span class="nb"&gt;echo&lt;/span&gt;
        &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="o"&gt;[&lt;/span&gt; &lt;span class="nv"&gt;$?&lt;/span&gt; !&lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="m"&gt;0&lt;/span&gt; &lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="k"&gt;then&lt;/span&gt;
            &lt;span class="nv"&gt;a&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;No&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
        &lt;span class="k"&gt;fi&lt;/span&gt;
        &lt;span class="k"&gt;case&lt;/span&gt; &lt;span class="nv"&gt;$a&lt;/span&gt; in
            &lt;span class="o"&gt;[&lt;/span&gt;Yy&lt;span class="o"&gt;][&lt;/span&gt;Ee&lt;span class="o"&gt;][&lt;/span&gt;Ss&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="p"&gt;|&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;Yy&lt;span class="o"&gt;])&lt;/span&gt; &lt;span class="nv"&gt;a&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;Yes&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="p"&gt;;;&lt;/span&gt;
            &lt;span class="o"&gt;[&lt;/span&gt;Nn&lt;span class="o"&gt;][&lt;/span&gt;Oo&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="p"&gt;|&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;Nn&lt;span class="o"&gt;])&lt;/span&gt; &lt;span class="nv"&gt;a&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;No&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="p"&gt;;;&lt;/span&gt;
            *&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="p"&gt;;;&lt;/span&gt;
        &lt;span class="k"&gt;esac&lt;/span&gt;
    &lt;span class="k"&gt;done&lt;/span&gt;
&lt;span class="o"&gt;}&lt;/span&gt;

&lt;span class="c1"&gt;# Load config and uncomment variable.&lt;/span&gt;
load_default_grub
&lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="o"&gt;(&lt;/span&gt;grep -qwai &lt;span class="s1"&gt;&amp;#39;^#GRUB_DISABLE_RECOVERY=&amp;#39;&lt;/span&gt; /etc/default/grub &amp;gt;/dev/null&lt;span class="o"&gt;)&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="k"&gt;then&lt;/span&gt;
    &lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;INFO: Uncomment the GRUB_DISABLE_RECOVERY variable.&amp;#39;&lt;/span&gt;
    sed -i &lt;span class="s1"&gt;&amp;#39;s/^#GRUB_DISABLE_RECOVERY=\(.*\)/GRUB_DISABLE_RECOVERY=\1/&amp;#39;&lt;/span&gt; /etc/default/grub
&lt;span class="k"&gt;fi&lt;/span&gt;
&lt;span class="c1"&gt;# Load config again, check value and set if need.&lt;/span&gt;
load_default_grub
&lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="o"&gt;[&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;$GRUB_DISABLE_RECOVERY&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt; !&lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;true&amp;#39;&lt;/span&gt; &lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="k"&gt;then&lt;/span&gt;
    &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="o"&gt;[&lt;/span&gt; -z &lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;$GRUB_DISABLE_RECOVERY&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt; &lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="k"&gt;then&lt;/span&gt;
        &lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;INFO: Add GRUB_DISABLE_RECOVERY=&amp;quot;true&amp;quot;&amp;#39;&lt;/span&gt;
        &lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;GRUB_DISABLE_RECOVERY=&amp;quot;true&amp;quot;&amp;#39;&lt;/span&gt; &amp;gt;&amp;gt; /etc/default/grub
    &lt;span class="k"&gt;else&lt;/span&gt;
        &lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;INFO: Set GRUB_DISABLE_RECOVERY to &amp;quot;true&amp;quot;&amp;#39;&lt;/span&gt;
        sed -i &lt;span class="s1"&gt;&amp;#39;s/^GRUB_DISABLE_RECOVERY=.*/GRUB_DISABLE_RECOVERY=&amp;quot;true&amp;quot;/&amp;#39;&lt;/span&gt; /etc/default/grub
    &lt;span class="k"&gt;fi&lt;/span&gt;
&lt;span class="k"&gt;fi&lt;/span&gt;

&lt;span class="c1"&gt;# Delete deprecated options GRUB_HIDDEN_TIMEOUT*.&lt;/span&gt;
&lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="o"&gt;(&lt;/span&gt;grep -qwai &lt;span class="s1"&gt;&amp;#39;^GRUB_HIDDEN_TIMEOUT.*&amp;#39;&lt;/span&gt; /etc/default/grub &amp;gt;/dev/null&lt;span class="o"&gt;)&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="k"&gt;then&lt;/span&gt;
    &lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;INFO: Delete deprecated options GRUB_HIDDEN_TIMEOUT*&amp;#39;&lt;/span&gt;
    sed -i &lt;span class="s1"&gt;&amp;#39;/^GRUB_HIDDEN_TIMEOUT.*/d&amp;#39;&lt;/span&gt; /etc/default/grub
&lt;span class="k"&gt;fi&lt;/span&gt;

&lt;span class="c1"&gt;# Add option GRUB_RECORDFAIL_TIMEOUT=15 for automatic boot on fail.&lt;/span&gt;
&lt;span class="k"&gt;if&lt;/span&gt; ! &lt;span class="o"&gt;(&lt;/span&gt;grep -qwai &lt;span class="s1"&gt;&amp;#39;^GRUB_RECORDFAIL_TIMEOUT=.*&amp;#39;&lt;/span&gt; /etc/default/grub &amp;gt;/dev/null&lt;span class="o"&gt;)&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="k"&gt;then&lt;/span&gt;
    &lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;INFO: Add option GRUB_RECORDFAIL_TIMEOUT=15 for automatic boot on fail.&amp;#39;&lt;/span&gt;
    &lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;GRUB_RECORDFAIL_TIMEOUT=15&amp;#39;&lt;/span&gt; &amp;gt;&amp;gt; /etc/default/grub
&lt;span class="k"&gt;fi&lt;/span&gt;


&lt;span class="c1"&gt;# GRUB_CMDLINE_LINUX_DEFAULT=&amp;quot;quiet splash&amp;quot;&lt;/span&gt;
&lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="o"&gt;(&lt;/span&gt;grep -qwai &lt;span class="s1"&gt;&amp;#39;^GRUB_CMDLINE_LINUX_DEFAULT=.*&amp;#39;&lt;/span&gt; /etc/default/grub &amp;gt;/dev/null&lt;span class="o"&gt;)&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="k"&gt;then&lt;/span&gt;
    &lt;span class="c1"&gt;# Load config again, check value and set if need.&lt;/span&gt;
    load_default_grub
    &lt;span class="k"&gt;for&lt;/span&gt; i in &lt;span class="nv"&gt;$GRUB_CMDLINE_LINUX_DEFAULT&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;
        &lt;span class="k"&gt;case&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;$i&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt; in
            &lt;span class="s1"&gt;&amp;#39;splash&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="nv"&gt;i&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;nosplash&amp;#39;&lt;/span&gt; &lt;span class="p"&gt;;;&lt;/span&gt;
            &lt;span class="s1"&gt;&amp;#39;quiet&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="nv"&gt;i&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;noquiet&amp;#39;&lt;/span&gt; &lt;span class="p"&gt;;;&lt;/span&gt;
        &lt;span class="k"&gt;esac&lt;/span&gt;
        &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="o"&gt;[&lt;/span&gt; -n &lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;$GRUB_CMDLINE_LINUX_DEFAULT_OUT&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt; -a -n &lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;$i&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt; &lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="k"&gt;then&lt;/span&gt;
            &lt;span class="nv"&gt;GRUB_CMDLINE_LINUX_DEFAULT_OUT&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;$GRUB_CMDLINE_LINUX_DEFAULT_OUT&lt;/span&gt;&lt;span class="s2"&gt; &lt;/span&gt;&lt;span class="nv"&gt;$i&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;
        &lt;span class="k"&gt;else&lt;/span&gt;
            &lt;span class="nv"&gt;GRUB_CMDLINE_LINUX_DEFAULT_OUT&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;$i&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;
        &lt;span class="k"&gt;fi&lt;/span&gt;
    &lt;span class="k"&gt;done&lt;/span&gt;
    sed -i -e &lt;span class="s2"&gt;&amp;quot;s/^GRUB_CMDLINE_LINUX_DEFAULT=.*/GRUB_CMDLINE_LINUX_DEFAULT=\&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;$GRUB_CMDLINE_LINUX_DEFAULT_OUT&lt;/span&gt;&lt;span class="s2"&gt;\&amp;quot;/&amp;quot;&lt;/span&gt; /etc/default/grub
&lt;span class="k"&gt;fi&lt;/span&gt;

&lt;span class="c1"&gt;# Finnaly re-generate grub.cfg.&lt;/span&gt;
get_yes_no &lt;span class="s2"&gt;&amp;quot;Do you want to run update-grub&amp;quot;&lt;/span&gt;
&lt;span class="o"&gt;[&lt;/span&gt; &lt;span class="nv"&gt;$a&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;Yes&amp;#39;&lt;/span&gt; &lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt; update-grub
&lt;/pre&gt;&lt;/div&gt;</content><category term="Linux"></category><category term="Ubuntu"></category><category term="Grub"></category></entry><entry><title>Ubuntu 12.04 не запускается автоматически samba на bridge интерфейсе.</title><link href="https://metajiji.github.io/blog/ubuntu-1204-samba-bridge/" rel="alternate"></link><published>2014-05-05T00:00:00+07:00</published><updated>2014-05-05T00:00:00+07:00</updated><author><name>Denis Kadyshev</name></author><id>tag:metajiji.github.io,2014-05-05:/blog/ubuntu-1204-samba-bridge/</id><summary type="html">&lt;p&gt;При старте системы демон &lt;strong&gt;Samba&lt;/strong&gt; не запускался самостоятельно, точнее он запускался, но был недоступен,
 а если вручную перезапустить его, то все ок. Сетевые интерфейсы у меня объединены в &lt;strong&gt;Bridge&lt;/strong&gt; &lt;code&gt;br0&lt;/code&gt; из &lt;code&gt;wlan0&lt;/code&gt; и &lt;code&gt;eth0&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;После недолгих расследований логов загрузки, стало ясно, демон &lt;code&gt;smbd&lt;/code&gt; успевает запуститься, до того, как &lt;strong&gt;bridge&lt;/strong&gt; сконфигурируется …&lt;/p&gt;</summary><content type="html">&lt;p&gt;При старте системы демон &lt;strong&gt;Samba&lt;/strong&gt; не запускался самостоятельно, точнее он запускался, но был недоступен,
 а если вручную перезапустить его, то все ок. Сетевые интерфейсы у меня объединены в &lt;strong&gt;Bridge&lt;/strong&gt; &lt;code&gt;br0&lt;/code&gt; из &lt;code&gt;wlan0&lt;/code&gt; и &lt;code&gt;eth0&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;После недолгих расследований логов загрузки, стало ясно, демон &lt;code&gt;smbd&lt;/code&gt; успевает запуститься, до того, как &lt;strong&gt;bridge&lt;/strong&gt; сконфигурируется, отсюда и проблема.&lt;/p&gt;
&lt;p&gt;Конфигурационный &lt;code&gt;upstart&lt;/code&gt; файл &lt;code&gt;/etc/init/smbd.conf&lt;/code&gt; привел к такому виду:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;description &lt;span class="s2"&gt;&amp;quot;SMB/CIFS File Server&amp;quot;&lt;/span&gt;
author      &lt;span class="s2"&gt;&amp;quot;Steve Langasek &amp;lt;steve.langasek@ubuntu.com&amp;gt;&amp;quot;&lt;/span&gt;

start on &lt;span class="o"&gt;(&lt;/span&gt;local-filesystems and net-device-up IFACE!&lt;span class="o"&gt;=&lt;/span&gt;lo&lt;span class="o"&gt;)&lt;/span&gt;
start on &lt;span class="o"&gt;(&lt;/span&gt;local-filesystems and net-device-up &lt;span class="nv"&gt;IFACE&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;br0&lt;span class="o"&gt;)&lt;/span&gt;
stop on runlevel &lt;span class="o"&gt;[&lt;/span&gt;!2345&lt;span class="o"&gt;]&lt;/span&gt;

respawn

pre-start script
 &lt;span class="nv"&gt;RUN_MODE&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;daemons&amp;quot;&lt;/span&gt;

 &lt;span class="o"&gt;[&lt;/span&gt; -r /etc/default/samba &lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt; . /etc/default/samba

 &lt;span class="o"&gt;[&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;$RUN_MODE&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; inetd &lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt; stop&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="nb"&gt;exit&lt;/span&gt; &lt;span class="m"&gt;0&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="o"&gt;}&lt;/span&gt;

 install -o root -g root -m &lt;span class="m"&gt;755&lt;/span&gt; -d /var/run/samba
end script

&lt;span class="nb"&gt;exec&lt;/span&gt; smbd -F
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;А именно, добавил опцию &lt;code&gt;IFACE=br0&lt;/code&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;start on &lt;span class="o"&gt;(&lt;/span&gt;local-filesystems and net-device-up &lt;span class="nv"&gt;IFACE&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;br0&lt;span class="o"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Теперь, при загрузке сервера, демон &lt;code&gt;smbd&lt;/code&gt; запускается самостоятельно.&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;Ссылки по теме:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href="http://www.ashep.org/2009/linux-upstart/#.U2awRN-K89U"&gt;Что такое UpStart&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;</content><category term="Linux"></category><category term="Ubuntu"></category><category term="samba"></category><category term="bridge"></category><category term="upstart"></category></entry><entry><title>GRUB_HIDDEN_TIMEOUT no longer supported, (deprecated).</title><link href="https://metajiji.github.io/blog/grub_hidden_timeout-no-longer-supported/" rel="alternate"></link><published>2014-04-30T00:00:00+07:00</published><updated>2014-04-30T00:00:00+07:00</updated><author><name>Denis Kadyshev</name></author><id>tag:metajiji.github.io,2014-04-30:/blog/grub_hidden_timeout-no-longer-supported/</id><summary type="html">&lt;p&gt;Столкнулся с проблемой после обновления системы &lt;strong&gt;Ubuntu 12.04&lt;/strong&gt;, а так же &lt;strong&gt;Ubuntu 14.04&lt;/strong&gt; и &lt;strong&gt;Ubuntu 16.04&lt;/strong&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;root@Ubuntu:/# update-grub
Generating grub configuration file ...
Найден фон: /home/metall/Изображения/grub/about_1600px.png
Предупреждение: Setting GRUB_TIMEOUT to a non-zero value when GRUB_HIDDEN_TIMEOUT is &lt;span class="nb"&gt;set&lt;/span&gt; is no longer supported.
Found …&lt;/pre&gt;&lt;/div&gt;</summary><content type="html">&lt;p&gt;Столкнулся с проблемой после обновления системы &lt;strong&gt;Ubuntu 12.04&lt;/strong&gt;, а так же &lt;strong&gt;Ubuntu 14.04&lt;/strong&gt; и &lt;strong&gt;Ubuntu 16.04&lt;/strong&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;root@Ubuntu:/# update-grub
Generating grub configuration file ...
Найден фон: /home/metall/Изображения/grub/about_1600px.png
Предупреждение: Setting GRUB_TIMEOUT to a non-zero value when GRUB_HIDDEN_TIMEOUT is &lt;span class="nb"&gt;set&lt;/span&gt; is no longer supported.
Found background image: /home/metall/Изображения/grub/about_1600px.png
Найден образ linux: /boot/vmlinuz-3.13.0-24-generic
Найден образ initrd: /boot/initrd.img-3.13.0-24-generic
Найден Windows &lt;span class="m"&gt;7&lt;/span&gt; &lt;span class="o"&gt;(&lt;/span&gt;loader&lt;span class="o"&gt;)&lt;/span&gt; на /dev/sda1
завершено
root@Ubuntu:/#
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;При генерации &lt;code&gt;grub.cfg&lt;/code&gt; появляется сообщение о том, что &lt;code&gt;GRUB_HIDDEN_TIMEOUT&lt;/code&gt; больше не поддерживается:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;Предупреждение: Setting GRUB_TIMEOUT to a non-zero value when GRUB_HIDDEN_TIMEOUT is &lt;span class="nb"&gt;set&lt;/span&gt; is no longer supported.
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Как выяснилось в установщике &lt;strong&gt;Ubuntu&lt;/strong&gt; имеется &lt;a href="https://bugs.launchpad.net/ubuntu/+source/grub2/+bug/1258597" title="Warning: Setting GRUB_TIMEOUT to a non-zero value when GRUB_HIDDEN_TIMEOUT is set is no longer supported"&gt;баг [1]&lt;/a&gt; исправить ситуацию легко, просто закоментируем эту опцию в файле &lt;code&gt;/etc/default/grub&lt;/code&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="c1"&gt;#GRUB_HIDDEN_TIMEOUT=0&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;И обновим конфигурацию &lt;code&gt;grub&lt;/code&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;root@Ubuntu:/# update-grub
Generating grub configuration file ...
Найден фон: /home/metall/Изображения/grub/about_1600px.png
Found background image: /home/metall/Изображения/grub/about_1600px.png
Найден образ linux: /boot/vmlinuz-3.13.0-24-generic
Найден образ initrd: /boot/initrd.img-3.13.0-24-generic
Найден Windows &lt;span class="m"&gt;7&lt;/span&gt; &lt;span class="o"&gt;(&lt;/span&gt;loader&lt;span class="o"&gt;)&lt;/span&gt; на /dev/sda1
завершено
root@Ubuntu:/#
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Как видим проблема ушла. Кстати, если установить конфиг из пакета, то эта опция там закоментирована:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;dpkg-reconfigure grub-pc
&lt;/pre&gt;&lt;/div&gt;


&lt;hr&gt;
&lt;p&gt;Ссылки по теме:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href="https://bugs.launchpad.net/ubuntu/+source/grub2/+bug/1258597" title="Warning: Setting GRUB_TIMEOUT to a non-zero value when GRUB_HIDDEN_TIMEOUT is set is no longer supported"&gt;Warning: Setting GRUB_TIMEOUT to a non-zero value when GRUB_HIDDEN_TIMEOUT is set is no longer supported.&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;</content><category term="Ubuntu"></category><category term="Linux"></category><category term="Grub"></category></entry><entry><title>Ubuntu GRUB2 отключить подтверждение при перезагрузке</title><link href="https://metajiji.github.io/blog/ubuntu-grub2-recordfail/" rel="alternate"></link><published>2014-04-08T00:00:00+07:00</published><updated>2014-04-08T00:00:00+07:00</updated><author><name>Denis Kadyshev</name></author><id>tag:metajiji.github.io,2014-04-08:/blog/ubuntu-grub2-recordfail/</id><summary type="html">&lt;p&gt;В &lt;strong&gt;Ubuntu&lt;/strong&gt; есть проблема - в случае нештатного отключения компьютера (вырубили свет, потом включили) &lt;strong&gt;GRUB2&lt;/strong&gt; доходит до меню и ждет выбора.
 Хотелось, чтобы компьютер рестартовал сам при включении света. Как оказалось за это отвечает переменная &lt;code&gt;recordfail&lt;/code&gt;, которая по умолчанию выставляется &lt;code&gt;recordfail=1&lt;/code&gt;,
 а после успешной загрузки системы она обнуляется через &lt;code&gt;init …&lt;/code&gt;&lt;/p&gt;</summary><content type="html">&lt;p&gt;В &lt;strong&gt;Ubuntu&lt;/strong&gt; есть проблема - в случае нештатного отключения компьютера (вырубили свет, потом включили) &lt;strong&gt;GRUB2&lt;/strong&gt; доходит до меню и ждет выбора.
 Хотелось, чтобы компьютер рестартовал сам при включении света. Как оказалось за это отвечает переменная &lt;code&gt;recordfail&lt;/code&gt;, которая по умолчанию выставляется &lt;code&gt;recordfail=1&lt;/code&gt;,
 а после успешной загрузки системы она обнуляется через &lt;code&gt;init.d&lt;/code&gt; скрипт &lt;code&gt;/etc/init.d/grub-common&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;При загрузке &lt;strong&gt;GRUB2&lt;/strong&gt; в файле &lt;code&gt;/boot/grub/grub.cfg&lt;/code&gt; идет проверка:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="o"&gt;[&lt;/span&gt; &lt;span class="si"&gt;${&lt;/span&gt;&lt;span class="nv"&gt;recordfail&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="m"&gt;1&lt;/span&gt; &lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="k"&gt;then&lt;/span&gt;
  &lt;span class="nb"&gt;set&lt;/span&gt; &lt;span class="nv"&gt;timeout&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;-1
&lt;span class="k"&gt;else&lt;/span&gt;
  &lt;span class="nb"&gt;set&lt;/span&gt; &lt;span class="nv"&gt;timeout&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;0&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Таким образом &lt;strong&gt;GRUB2&lt;/strong&gt; в случае если система была выключена не штатно принудительно выводит меню загрузки и ждет пока администратор в ручную выберет что грузить.
 Это делается для предотвращения зацикливания загрузки системы, если там что-то серьезно навернулось.&lt;/p&gt;
&lt;p&gt;Прямое редактирование &lt;code&gt;/boot/grub/grub.cfg&lt;/code&gt; смысла не имеет, т.к. все изменения затрутся, при запуске команды &lt;code&gt;update-grub&lt;/code&gt;, поиск по скриптам &lt;strong&gt;GRUB2&lt;/strong&gt; показал,
 что в файле &lt;code&gt;/etc/grub.d/00_header&lt;/code&gt; есть описание функции &lt;code&gt;recordfail&lt;/code&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;function&lt;/span&gt; recordfail &lt;span class="o"&gt;{&lt;/span&gt;
  &lt;span class="nb"&gt;set&lt;/span&gt; &lt;span class="nv"&gt;recordfail&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;1&lt;/span&gt;
EOF
    &lt;span class="nv"&gt;FS&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="k"&gt;$(&lt;/span&gt;grub-probe --target&lt;span class="o"&gt;=&lt;/span&gt;fs &lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="si"&gt;${&lt;/span&gt;&lt;span class="nv"&gt;grubdir&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="k"&gt;)&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;
    &lt;span class="k"&gt;case&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;$FS&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt; in
      btrfs &lt;span class="p"&gt;|&lt;/span&gt; cpiofs &lt;span class="p"&gt;|&lt;/span&gt; newc &lt;span class="p"&gt;|&lt;/span&gt; odc &lt;span class="p"&gt;|&lt;/span&gt; romfs &lt;span class="p"&gt;|&lt;/span&gt; squash4 &lt;span class="p"&gt;|&lt;/span&gt; tarfs &lt;span class="p"&gt;|&lt;/span&gt; zfs&lt;span class="o"&gt;)&lt;/span&gt;
 cat &lt;span class="s"&gt;&amp;lt;&amp;lt;EOF&lt;/span&gt;
&lt;span class="s"&gt;  # GRUB lacks write support for $FS, so recordfail support is disabled.&lt;/span&gt;
&lt;span class="s"&gt;EOF&lt;/span&gt;
 &lt;span class="p"&gt;;;&lt;/span&gt;
      *&lt;span class="o"&gt;)&lt;/span&gt;
 cat &lt;span class="s"&gt;&amp;lt;&amp;lt;EOF&lt;/span&gt;
&lt;span class="s"&gt;  if [ -n &amp;quot;\${have_grubenv}&amp;quot; ]; then if [ -z &amp;quot;\${boot_once}&amp;quot; ]; then save_env recordfail; fi; fi&lt;/span&gt;
&lt;span class="s"&gt;EOF&lt;/span&gt;
    &lt;span class="k"&gt;esac&lt;/span&gt;
    cat &amp;lt;&amp;lt;EOF
&lt;span class="o"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Затем ниже проверка значения переменной &lt;code&gt;recordfail&lt;/code&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;make_timeout &lt;span class="o"&gt;()&lt;/span&gt;
&lt;span class="o"&gt;{&lt;/span&gt;
    cat &lt;span class="s"&gt;&amp;lt;&amp;lt; EOF&lt;/span&gt;
&lt;span class="s"&gt;if [ &amp;quot;\${recordfail}&amp;quot; = 1 ] ; then&lt;/span&gt;
&lt;span class="s"&gt;  set timeout=${GRUB_RECORDFAIL_TIMEOUT:--1}&lt;/span&gt;
&lt;span class="s"&gt;else&lt;/span&gt;
&lt;span class="s"&gt;EOF&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Решение проблемы напрашивается сам собой - установить переменную &lt;code&gt;GRUB_RECORDFAIL_TIMEOUT&lt;/code&gt; (таймаут при срабатывании &lt;code&gt;recordfail&lt;/code&gt;) в конфигурационном файле &lt;strong&gt;GRUB2&lt;/strong&gt; &lt;code&gt;/etc/default/grub&lt;/code&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nv"&gt;GRUB_RECORDFAIL_TIMEOUT&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;15&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;После чего выполнить обновление конфигурации командой:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;update-grub
&lt;/pre&gt;&lt;/div&gt;


&lt;hr&gt;
&lt;p&gt;Ссылки по теме:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href="http://www.linux.org.ru/forum/general/7755404"&gt;правильное выключение + GRUB2 отключить подтверждение при перезагрузке&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://forum.ubuntu.ru/index.php?topic=78389.0"&gt;recordfail в grub2 [РЕШЕНО]&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;</content><category term="Linux"></category><category term="Ubuntu"></category><category term="grub"></category><category term="grub2"></category><category term="recordfail"></category></entry><entry><title>flock - предотвращение повторного запуска программы/скрипта из crontab.</title><link href="https://metajiji.github.io/blog/flock-crontab/" rel="alternate"></link><published>2014-04-05T00:00:00+07:00</published><updated>2014-04-05T00:00:00+07:00</updated><author><name>Denis Kadyshev</name></author><id>tag:metajiji.github.io,2014-04-05:/blog/flock-crontab/</id><summary type="html">&lt;p&gt;Столкнулся с проблемой, написанный мною бот для сайта запускался раз в минуту и однажды на сервере, где работал бот интернет канал сильно просел,
 как результат за минуту бот не успел завершить свою работу.&lt;/p&gt;
&lt;p&gt;&lt;code&gt;crontab&lt;/code&gt; запустил его еще раз, бот снова не успел, а &lt;code&gt;crontab&lt;/code&gt; продолжал беспощадно запускать копии бота - последствия …&lt;/p&gt;</summary><content type="html">&lt;p&gt;Столкнулся с проблемой, написанный мною бот для сайта запускался раз в минуту и однажды на сервере, где работал бот интернет канал сильно просел,
 как результат за минуту бот не успел завершить свою работу.&lt;/p&gt;
&lt;p&gt;&lt;code&gt;crontab&lt;/code&gt; запустил его еще раз, бот снова не успел, а &lt;code&gt;crontab&lt;/code&gt; продолжал беспощадно запускать копии бота - последствия были не очень приятными.&lt;/p&gt;
&lt;p&gt;Но проблема решилась очень просто, через &lt;code&gt;flock&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Теперь скрипт не запускается до тех пор, пока предыдущий запуск не закончит работу!&lt;/p&gt;
&lt;p&gt;Например, запуск произвольного скрипта из &lt;code&gt;crontab&lt;/code&gt; раз в минуту:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;* * * * * root flock -n /tmp/script.lock -c /path/to/script.sh
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Рассмотрим опции:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;-n /tmp/script.lock&lt;/code&gt; - путь до &lt;code&gt;lock&lt;/code&gt; файла.&lt;/li&gt;
&lt;li&gt;&lt;code&gt;-c /path/to/script.sh&lt;/code&gt; - путь до скрипта или программы, которую нужно запустить.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Эта утилита имеется штатно на &lt;strong&gt;FreeBSD&lt;/strong&gt; и &lt;strong&gt;Linux&lt;/strong&gt;.&lt;/p&gt;</content><category term="Linux"></category><category term="FreeBSD"></category><category term="flock"></category><category term="crontab"></category><category term="bash"></category></entry><entry><title>Putty и непечатаемые символы табуляции() и поробела(.)</title><link href="https://metajiji.github.io/blog/putty-non-printable-tab-and-space/" rel="alternate"></link><published>2014-03-23T00:00:00+07:00</published><updated>2014-03-23T00:00:00+07:00</updated><author><name>Denis Kadyshev</name></author><id>tag:metajiji.github.io,2014-03-23:/blog/putty-non-printable-tab-and-space/</id><summary type="html">&lt;p&gt;После обновления &lt;strong&gt;Putty&lt;/strong&gt; до &lt;code&gt;0.63&lt;/code&gt; столкнулся с проблемой, не отображались непечатаемые символы (табуляция &lt;code&gt;&amp;lt;----&amp;gt;&lt;/code&gt; и пробел &lt;code&gt;.&lt;/code&gt;),
 исправляется установкой опции &lt;strong&gt;Change Settings&lt;/strong&gt;-&amp;gt;&lt;strong&gt;Window&lt;/strong&gt;-&amp;gt;&lt;strong&gt;Colours&lt;/strong&gt; &lt;strong&gt;Indicate bolded text by changing&lt;/strong&gt;: в "&lt;strong&gt;True Color&lt;/strong&gt;".
 Не забываем сохранить настройки в стандартную сессию (&lt;strong&gt;Default Session&lt;/strong&gt;).&lt;/p&gt;
&lt;p&gt;&lt;img alt="Optional title" class="mfp-image center-block" src="https://metajiji.github.io/blog/putty-non-printable-tab-and-space/23-03-2014_putty-non-printable-tab-and-space/Putty_Fix_font.png" title="Optional title"&gt;&lt;/p&gt;
&lt;p&gt;Результат:&lt;/p&gt;
&lt;p&gt;&lt;img alt="Fixed putty options" class="mfp-image center-block" src="https://metajiji.github.io/blog/putty-non-printable-tab-and-space/23-03-2014_putty-non-printable-tab-and-space/Putty_tab_fixed.png" title="Fixed putty options"&gt;&lt;/p&gt;
&lt;p&gt;А вот так выглядит тот же файл, с проблемными …&lt;/p&gt;</summary><content type="html">&lt;p&gt;После обновления &lt;strong&gt;Putty&lt;/strong&gt; до &lt;code&gt;0.63&lt;/code&gt; столкнулся с проблемой, не отображались непечатаемые символы (табуляция &lt;code&gt;&amp;lt;----&amp;gt;&lt;/code&gt; и пробел &lt;code&gt;.&lt;/code&gt;),
 исправляется установкой опции &lt;strong&gt;Change Settings&lt;/strong&gt;-&amp;gt;&lt;strong&gt;Window&lt;/strong&gt;-&amp;gt;&lt;strong&gt;Colours&lt;/strong&gt; &lt;strong&gt;Indicate bolded text by changing&lt;/strong&gt;: в "&lt;strong&gt;True Color&lt;/strong&gt;".
 Не забываем сохранить настройки в стандартную сессию (&lt;strong&gt;Default Session&lt;/strong&gt;).&lt;/p&gt;
&lt;p&gt;&lt;img alt="Optional title" class="mfp-image center-block" src="https://metajiji.github.io/blog/putty-non-printable-tab-and-space/23-03-2014_putty-non-printable-tab-and-space/Putty_Fix_font.png" title="Optional title"&gt;&lt;/p&gt;
&lt;p&gt;Результат:&lt;/p&gt;
&lt;p&gt;&lt;img alt="Fixed putty options" class="mfp-image center-block" src="https://metajiji.github.io/blog/putty-non-printable-tab-and-space/23-03-2014_putty-non-printable-tab-and-space/Putty_tab_fixed.png" title="Fixed putty options"&gt;&lt;/p&gt;
&lt;p&gt;А вот так выглядит тот же файл, с проблемными, стандартными настройками &lt;strong&gt;Putty&lt;/strong&gt;:&lt;/p&gt;
&lt;p&gt;&lt;img alt="Default putty options" class="mfp-image center-block" src="https://metajiji.github.io/blog/putty-non-printable-tab-and-space/23-03-2014_putty-non-printable-tab-and-space/Putty_tab_notfixed.png" title="Default putty options"&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Q: При копировании из редактора в буфер обмена тект вставляется с точками &lt;code&gt;.&lt;/code&gt; и &lt;code&gt;&amp;lt;----&amp;gt;&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;A: Убрать подсветку пробелов и табуляции в &lt;code&gt;mc&lt;/code&gt; можно, нажав &lt;kbd&gt;Alt+Shift+-&lt;/kbd&gt;.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;hr&gt;
&lt;p&gt;Ссылки по теме:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href="http://www.midnight-commander.org/wiki/ru/faq"&gt;Ответы на часто задаваемые вопросы&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;</content><category term="Putty"></category><category term="Windows"></category><category term="non printable characters"></category><category term="tab"></category><category term="space"></category></entry><entry><title>Скрипт генерации сертификатов SSL для nginx.</title><link href="https://metajiji.github.io/blog/generate-ssl-certificates/" rel="alternate"></link><published>2013-10-09T00:00:00+07:00</published><updated>2013-10-09T00:00:00+07:00</updated><author><name>Denis Kadyshev</name></author><id>tag:metajiji.github.io,2013-10-09:/blog/generate-ssl-certificates/</id><summary type="html">&lt;p&gt;Скрипт генерации &lt;code&gt;ssl&lt;/code&gt; сертификатов и ключей для &lt;code&gt;nginx&lt;/code&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="ch"&gt;#!/bin/sh&lt;/span&gt;

error&lt;span class="o"&gt;()&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt;
    &lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;ERROR detected! Exiting...&amp;#39;&lt;/span&gt;
    &lt;span class="nb"&gt;exit&lt;/span&gt; &lt;span class="m"&gt;1&lt;/span&gt;
&lt;span class="o"&gt;}&lt;/span&gt;

&lt;span class="c1"&gt;#################################################&lt;/span&gt;
&lt;span class="nv"&gt;DOMAIN&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;domain.com&amp;#39;&lt;/span&gt;
&lt;span class="nv"&gt;EMAIL&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;admin@domain.com&amp;#39;&lt;/span&gt;
&lt;span class="nv"&gt;ORGANISATION&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;Organisation&amp;#39;&lt;/span&gt;
&lt;span class="nv"&gt;CITY&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;you city&amp;#39;&lt;/span&gt;
&lt;span class="nv"&gt;RSA_BIT&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;2048&lt;/span&gt;
&lt;span class="nv"&gt;DAYS&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;99365&lt;/span&gt;
&lt;span class="c1"&gt;#################################################&lt;/span&gt;

&lt;span class="c1"&gt;# Генерируем пароль для ключей.&lt;/span&gt;
&lt;span class="nv"&gt;PASS&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="k"&gt;$(&lt;/span&gt;tr -cd A-Za-z &amp;lt; /dev/urandom &lt;span class="p"&gt;|&lt;/span&gt; head -c8&lt;span class="k"&gt;)&lt;/span&gt;
&lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;Generated Password: &amp;#39;&lt;/span&gt;&lt;span class="si"&gt;${&lt;/span&gt;&lt;span class="nv"&gt;PASS&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;

&lt;span class="c1"&gt;# Проверим …&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;</summary><content type="html">&lt;p&gt;Скрипт генерации &lt;code&gt;ssl&lt;/code&gt; сертификатов и ключей для &lt;code&gt;nginx&lt;/code&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="ch"&gt;#!/bin/sh&lt;/span&gt;

error&lt;span class="o"&gt;()&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt;
    &lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;ERROR detected! Exiting...&amp;#39;&lt;/span&gt;
    &lt;span class="nb"&gt;exit&lt;/span&gt; &lt;span class="m"&gt;1&lt;/span&gt;
&lt;span class="o"&gt;}&lt;/span&gt;

&lt;span class="c1"&gt;#################################################&lt;/span&gt;
&lt;span class="nv"&gt;DOMAIN&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;domain.com&amp;#39;&lt;/span&gt;
&lt;span class="nv"&gt;EMAIL&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;admin@domain.com&amp;#39;&lt;/span&gt;
&lt;span class="nv"&gt;ORGANISATION&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;Organisation&amp;#39;&lt;/span&gt;
&lt;span class="nv"&gt;CITY&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;you city&amp;#39;&lt;/span&gt;
&lt;span class="nv"&gt;RSA_BIT&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;2048&lt;/span&gt;
&lt;span class="nv"&gt;DAYS&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;99365&lt;/span&gt;
&lt;span class="c1"&gt;#################################################&lt;/span&gt;

&lt;span class="c1"&gt;# Генерируем пароль для ключей.&lt;/span&gt;
&lt;span class="nv"&gt;PASS&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="k"&gt;$(&lt;/span&gt;tr -cd A-Za-z &amp;lt; /dev/urandom &lt;span class="p"&gt;|&lt;/span&gt; head -c8&lt;span class="k"&gt;)&lt;/span&gt;
&lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;Generated Password: &amp;#39;&lt;/span&gt;&lt;span class="si"&gt;${&lt;/span&gt;&lt;span class="nv"&gt;PASS&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;

&lt;span class="c1"&gt;# Проверим, если не существует каталог для домена, то создаем его.&lt;/span&gt;
&lt;span class="o"&gt;[&lt;/span&gt; ! -d &lt;span class="si"&gt;${&lt;/span&gt;&lt;span class="nv"&gt;DOMAIN&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt; &lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt; mkdir &lt;span class="si"&gt;${&lt;/span&gt;&lt;span class="nv"&gt;DOMAIN&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;Create directory: &amp;#39;&lt;/span&gt;&lt;span class="si"&gt;${&lt;/span&gt;&lt;span class="nv"&gt;DOMAIN&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;

&lt;span class="c1"&gt;# http://linuxcmd.ru/openssl-genrsa-sozdanie-fayla-klyuchey&lt;/span&gt;
&lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Now create the server private key, you&amp;#39;ll be asked for a passphrase:&amp;quot;&lt;/span&gt;
openssl genrsa -des3 -out &lt;span class="si"&gt;${&lt;/span&gt;&lt;span class="nv"&gt;DOMAIN&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;/&lt;span class="si"&gt;${&lt;/span&gt;&lt;span class="nv"&gt;DOMAIN&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;.key -passout pass:&lt;span class="si"&gt;${&lt;/span&gt;&lt;span class="nv"&gt;PASS&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt; &lt;span class="si"&gt;${&lt;/span&gt;&lt;span class="nv"&gt;RSA_BIT&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;
&lt;span class="o"&gt;[&lt;/span&gt; &lt;span class="nv"&gt;$?&lt;/span&gt; -eq &lt;span class="m"&gt;1&lt;/span&gt; &lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt; error

&lt;span class="c1"&gt;# http://linuxcmd.ru/openssl-req-sozdanie-csr-zaprosa&lt;/span&gt;
&lt;span class="c1"&gt;# В пункте Common Name (eg, YOUR name) []: надо указать именно имя домена (без http, https, /): имя.домена&lt;/span&gt;
&lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;Create the Certificate Signing Request (CSR):&amp;#39;&lt;/span&gt;
openssl req -out &lt;span class="si"&gt;${&lt;/span&gt;&lt;span class="nv"&gt;DOMAIN&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;/&lt;span class="si"&gt;${&lt;/span&gt;&lt;span class="nv"&gt;DOMAIN&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;.csr -new -newkey rsa:&lt;span class="si"&gt;${&lt;/span&gt;&lt;span class="nv"&gt;RSA_BIT&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt; &lt;span class="se"&gt;\&lt;/span&gt;
    -subj /C&lt;span class="o"&gt;=&lt;/span&gt;RU/ST&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="si"&gt;${&lt;/span&gt;&lt;span class="nv"&gt;CITY&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;/L&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="si"&gt;${&lt;/span&gt;&lt;span class="nv"&gt;CITY&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;/O&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="si"&gt;${&lt;/span&gt;&lt;span class="nv"&gt;ORGANISATION&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;/OU&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="si"&gt;${&lt;/span&gt;&lt;span class="nv"&gt;ORGANISATION&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;/CN&lt;span class="o"&gt;=&lt;/span&gt;*.&lt;span class="si"&gt;${&lt;/span&gt;&lt;span class="nv"&gt;DOMAIN&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;/emailAddress&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="si"&gt;${&lt;/span&gt;&lt;span class="nv"&gt;EMAIL&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt; &lt;span class="se"&gt;\&lt;/span&gt;
    -nodes -keyout &lt;span class="si"&gt;${&lt;/span&gt;&lt;span class="nv"&gt;DOMAIN&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;/&lt;span class="si"&gt;${&lt;/span&gt;&lt;span class="nv"&gt;DOMAIN&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;.key -passout pass:&lt;span class="si"&gt;${&lt;/span&gt;&lt;span class="nv"&gt;PASS&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;
&lt;span class="o"&gt;[&lt;/span&gt; &lt;span class="nv"&gt;$?&lt;/span&gt; -eq &lt;span class="m"&gt;1&lt;/span&gt; &lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt; error

&lt;span class="c1"&gt;# Starting up nginx with SSL using the above private key:&lt;/span&gt;
&lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;Remove the necessity of entering a passphrase for:&amp;#39;&lt;/span&gt;
cp &lt;span class="si"&gt;${&lt;/span&gt;&lt;span class="nv"&gt;DOMAIN&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;/&lt;span class="si"&gt;${&lt;/span&gt;&lt;span class="nv"&gt;DOMAIN&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;.key &lt;span class="si"&gt;${&lt;/span&gt;&lt;span class="nv"&gt;DOMAIN&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;/&lt;span class="si"&gt;${&lt;/span&gt;&lt;span class="nv"&gt;DOMAIN&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;.key.org
openssl rsa -in &lt;span class="si"&gt;${&lt;/span&gt;&lt;span class="nv"&gt;DOMAIN&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;/&lt;span class="si"&gt;${&lt;/span&gt;&lt;span class="nv"&gt;DOMAIN&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;.key.org -out &lt;span class="si"&gt;${&lt;/span&gt;&lt;span class="nv"&gt;DOMAIN&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;/&lt;span class="si"&gt;${&lt;/span&gt;&lt;span class="nv"&gt;DOMAIN&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;.key
&lt;span class="o"&gt;[&lt;/span&gt; &lt;span class="nv"&gt;$?&lt;/span&gt; -eq &lt;span class="m"&gt;1&lt;/span&gt; &lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt; error

&lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;Finally sign the certificate using the above private key and CSR:&amp;#39;&lt;/span&gt;
openssl x509 -req -days &lt;span class="si"&gt;${&lt;/span&gt;&lt;span class="nv"&gt;DAYS&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt; -in &lt;span class="si"&gt;${&lt;/span&gt;&lt;span class="nv"&gt;DOMAIN&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;/&lt;span class="si"&gt;${&lt;/span&gt;&lt;span class="nv"&gt;DOMAIN&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;.csr -signkey &lt;span class="si"&gt;${&lt;/span&gt;&lt;span class="nv"&gt;DOMAIN&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;/&lt;span class="si"&gt;${&lt;/span&gt;&lt;span class="nv"&gt;DOMAIN&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;.key -out &lt;span class="si"&gt;${&lt;/span&gt;&lt;span class="nv"&gt;DOMAIN&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;/&lt;span class="si"&gt;${&lt;/span&gt;&lt;span class="nv"&gt;DOMAIN&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;.crt
&lt;span class="o"&gt;[&lt;/span&gt; &lt;span class="nv"&gt;$?&lt;/span&gt; -eq &lt;span class="m"&gt;1&lt;/span&gt; &lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt; error


&lt;span class="c1"&gt;# http://wiki.nginx.org/HttpSslModule&lt;/span&gt;
cat &lt;span class="s"&gt;&amp;lt;&amp;lt;_EOF&lt;/span&gt;
&lt;span class="s"&gt;# Update Nginx configuration by including the newly signed certificate and private key:&lt;/span&gt;
&lt;span class="s"&gt;server {&lt;/span&gt;
&lt;span class="s"&gt;    listen 443;&lt;/span&gt;
&lt;span class="s"&gt;    server_name YOUR_DOMAINNAME_HERE;&lt;/span&gt;

&lt;span class="s"&gt;    ssl on;&lt;/span&gt;
&lt;span class="s"&gt;    ssl_certificate /usr/local/nginx/conf/server.crt;&lt;/span&gt;
&lt;span class="s"&gt;    ssl_certificate_key /usr/local/nginx/conf/server.key;&lt;/span&gt;
&lt;span class="s"&gt;}&lt;/span&gt;
&lt;span class="s"&gt;_EOF&lt;/span&gt;

&lt;span class="c1"&gt;#Убедиться в том, что сервер присылает полную цепочку сертификатов,&lt;/span&gt;
&lt;span class="c1"&gt;#можно при помощи утилиты командной строки openssl, например:&lt;/span&gt;
&lt;span class="c1"&gt;#openssl s_client -connect www.godaddy.com:443&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;hr&gt;
&lt;p&gt;Ссылки по теме:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href="http://linuxcmd.ru/openssl-req-sozdanie-csr-zaprosa"&gt;openssl req - создание CSR-запроса&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://linuxcmd.ru/openssl-genrsa-sozdanie-fayla-klyuchey"&gt;openssl genrsa - создание файла ключей&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;</content><category term="Bash"></category><category term="SSL"></category><category term="certificate"></category><category term="nginx"></category></entry><entry><title>Решение проблем во FreeBSD &lt; 9.x c bsd tar.</title><link href="https://metajiji.github.io/blog/freebsd-9x-fix-bsd-tar/" rel="alternate"></link><published>2013-09-17T00:00:00+07:00</published><updated>2013-09-17T00:00:00+07:00</updated><author><name>Denis Kadyshev</name></author><id>tag:metajiji.github.io,2013-09-17:/blog/freebsd-9x-fix-bsd-tar/</id><summary type="html">&lt;p&gt;При обновлении портов на &lt;strong&gt;FreeBSD&lt;/strong&gt; ниже &lt;strong&gt;9.x&lt;/strong&gt; возникают подобные проблемы с &lt;code&gt;xz&lt;/code&gt; архивами:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="c1"&gt;# cd usr/ports/misc/mc&lt;/span&gt;
&lt;span class="c1"&gt;# make&lt;/span&gt;
&lt;span class="o"&gt;===&lt;/span&gt;&amp;gt;  License GPLv3 accepted by the &lt;span class="nv"&gt;user&lt;/span&gt;
&lt;span class="o"&gt;===&lt;/span&gt;&amp;gt;  Found saved configuration &lt;span class="k"&gt;for&lt;/span&gt; mc-4.8.1.6
&lt;span class="o"&gt;===&lt;/span&gt;&amp;gt; Fetching all distfiles required by mc-4.8.1.7 &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="nv"&gt;building&lt;/span&gt;
&lt;span class="o"&gt;===&lt;/span&gt;&amp;gt;  Extracting &lt;span class="k"&gt;for&lt;/span&gt; mc-4.8.1 …&lt;/pre&gt;&lt;/div&gt;</summary><content type="html">&lt;p&gt;При обновлении портов на &lt;strong&gt;FreeBSD&lt;/strong&gt; ниже &lt;strong&gt;9.x&lt;/strong&gt; возникают подобные проблемы с &lt;code&gt;xz&lt;/code&gt; архивами:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="c1"&gt;# cd usr/ports/misc/mc&lt;/span&gt;
&lt;span class="c1"&gt;# make&lt;/span&gt;
&lt;span class="o"&gt;===&lt;/span&gt;&amp;gt;  License GPLv3 accepted by the &lt;span class="nv"&gt;user&lt;/span&gt;
&lt;span class="o"&gt;===&lt;/span&gt;&amp;gt;  Found saved configuration &lt;span class="k"&gt;for&lt;/span&gt; mc-4.8.1.6
&lt;span class="o"&gt;===&lt;/span&gt;&amp;gt; Fetching all distfiles required by mc-4.8.1.7 &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="nv"&gt;building&lt;/span&gt;
&lt;span class="o"&gt;===&lt;/span&gt;&amp;gt;  Extracting &lt;span class="k"&gt;for&lt;/span&gt; mc-4.8.1.7
&lt;span class="o"&gt;=&lt;/span&gt;&amp;gt; SHA256 Checksum OK &lt;span class="k"&gt;for&lt;/span&gt; mc-4.8.1.7.tar.xz.
&lt;span class="o"&gt;===&lt;/span&gt;&amp;gt;   mc-4.8.1.7 depends on file: /usr/local/bin/xz - &lt;span class="nv"&gt;found&lt;/span&gt;
&lt;span class="o"&gt;===&lt;/span&gt;&amp;gt;   mc-4.8.1.7 depends on file: /usr/local/bin/perl5.14.2 - found
tar: Unrecognized archive format: Inappropriate file &lt;span class="nb"&gt;type&lt;/span&gt; or format
tar: Error &lt;span class="nb"&gt;exit&lt;/span&gt; delayed from previous errors.
*** Error code &lt;span class="m"&gt;1&lt;/span&gt;

Stop in /usr/ports/misc/mc.
*** Error code &lt;span class="m"&gt;1&lt;/span&gt;

Stop in /usr/ports/misc/mc.
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Лечится довольно просто, установкой &lt;code&gt;libarchive&lt;/code&gt; и 1 строчкой в &lt;code&gt;/etc/make.conf&lt;/code&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nb"&gt;cd&lt;/span&gt; /usr/ports/archivers/libarchive
make install clean
&lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;TAR=/usr/local/bin/bsdtar&amp;#39;&lt;/span&gt; &amp;gt;&amp;gt; /etc/make.conf
&lt;/pre&gt;&lt;/div&gt;


&lt;hr&gt;
&lt;p&gt;Ссылки по теме:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href="http://forum.lissyara.su/viewtopic.php?p=348488#p348488"&gt;tar: Unrecognized archive format&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://sysadmins.ru/post11006037.html"&gt;Обновление портов и tar.Xz&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://likeunix.ru/tar-xz-error-compiling/"&gt;Исправление ошибки во freebsd tar xz.&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;</content><category term="FreeBSD"></category><category term="BSD tar"></category><category term="tar"></category></entry><entry><title>Чтение файлов журнала .jnl bind, named named-journalprint</title><link href="https://metajiji.github.io/blog/jnl-bind-named-named-journalprint/" rel="alternate"></link><published>2013-09-17T00:00:00+07:00</published><updated>2013-09-17T00:00:00+07:00</updated><author><name>Denis Kadyshev</name></author><id>tag:metajiji.github.io,2013-09-17:/blog/jnl-bind-named-named-journalprint/</id><summary type="html">&lt;p&gt;Для чтения файлов журнала &lt;code&gt;.jnl&lt;/code&gt; &lt;strong&gt;DNS&lt;/strong&gt; сервера &lt;strong&gt;Named&lt;/strong&gt; (&lt;strong&gt;bind&lt;/strong&gt;), существует утилита &lt;code&gt;named-journalprint&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Пример использования:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;named-journalprint zone.local.jnl
&lt;/pre&gt;&lt;/div&gt;


&lt;hr&gt;
&lt;p&gt;Ссылки по теме:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href="http://master-zone.net/tag/bind-dynamic-update"&gt;Working with a journal-ized bind zone&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;</summary><content type="html">&lt;p&gt;Для чтения файлов журнала &lt;code&gt;.jnl&lt;/code&gt; &lt;strong&gt;DNS&lt;/strong&gt; сервера &lt;strong&gt;Named&lt;/strong&gt; (&lt;strong&gt;bind&lt;/strong&gt;), существует утилита &lt;code&gt;named-journalprint&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Пример использования:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;named-journalprint zone.local.jnl
&lt;/pre&gt;&lt;/div&gt;


&lt;hr&gt;
&lt;p&gt;Ссылки по теме:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href="http://master-zone.net/tag/bind-dynamic-update"&gt;Working with a journal-ized bind zone&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;</content><category term="Bind"></category><category term="named"></category><category term="jnl"></category><category term="journalprint"></category><category term="Linux"></category><category term="FreeBSD"></category></entry><entry><title>Ubuntu 12.04 - transmission и samba</title><link href="https://metajiji.github.io/blog/ubuntu-1204-transmission-samba/" rel="alternate"></link><published>2013-09-16T00:00:00+07:00</published><updated>2013-09-16T00:00:00+07:00</updated><author><name>Denis Kadyshev</name></author><id>tag:metajiji.github.io,2013-09-16:/blog/ubuntu-1204-transmission-samba/</id><summary type="html">&lt;p&gt;Для успешной с файлами по &lt;code&gt;samba&lt;/code&gt;, скаченными при помощи свежеустановленного &lt;code&gt;transmission&lt;/code&gt; нужно изменить &lt;code&gt;umask&lt;/code&gt; для вновь создаваемых файлов и каталогов демоном &lt;code&gt;transmission&lt;/code&gt; и для этого первым делом останавливаем демона:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;Ubuntu$ sudo service transmission-daemon stop
 * Stopping bittorrent daemon transmission-daemon      &lt;span class="o"&gt;[&lt;/span&gt; OK &lt;span class="o"&gt;]&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Если демона не остановить, то все изменения в конфиге не сохранятся …&lt;/p&gt;</summary><content type="html">&lt;p&gt;Для успешной с файлами по &lt;code&gt;samba&lt;/code&gt;, скаченными при помощи свежеустановленного &lt;code&gt;transmission&lt;/code&gt; нужно изменить &lt;code&gt;umask&lt;/code&gt; для вновь создаваемых файлов и каталогов демоном &lt;code&gt;transmission&lt;/code&gt; и для этого первым делом останавливаем демона:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;Ubuntu$ sudo service transmission-daemon stop
 * Stopping bittorrent daemon transmission-daemon      &lt;span class="o"&gt;[&lt;/span&gt; OK &lt;span class="o"&gt;]&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Если демона не остановить, то все изменения в конфиге не сохранятся, т.к. при перезапуске &lt;code&gt;transmission&lt;/code&gt; перезапишет свой файл из памяти и все изменения пропадут.&lt;/p&gt;
&lt;p&gt;Убедившись, что демон &lt;code&gt;transmission&lt;/code&gt; не запущен - открываем файл настроек:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;sudo nano /etc/transmission-daemon/settings.json
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Находим там параметр &lt;code&gt;"umask": 18,&lt;/code&gt; и изменяем значение на &lt;code&gt;"umask": 2,&lt;/code&gt;, затем сохраняем файл.&lt;/p&gt;
&lt;p&gt;С таким значением &lt;code&gt;umask&lt;/code&gt; демон &lt;code&gt;transmission&lt;/code&gt; будет создавать:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Каталоги с маской &lt;code&gt;775&lt;/code&gt; - читать, писать, исполнять (заходить в каталог) владельцу и группе, остальным только читать и исполнять(заходить в каталог).&lt;/li&gt;
&lt;li&gt;Файлы с маской &lt;code&gt;664&lt;/code&gt; - читать, писать владельцу и группе, остальным только читать.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Теперь добавляем пользователя, под которым подключаемся к &lt;code&gt;samba&lt;/code&gt; шарам, в группу &lt;code&gt;debian-transmission&lt;/code&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;Ubuntu$ id metajiji
&lt;span class="nv"&gt;uid&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;1000&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;metajiji&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="nv"&gt;gid&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;1000&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;metajiji&lt;span class="o"&gt;)&lt;/span&gt; группы&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;1000&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;metajiji&lt;span class="o"&gt;)&lt;/span&gt;,4&lt;span class="o"&gt;(&lt;/span&gt;adm&lt;span class="o"&gt;)&lt;/span&gt;,27&lt;span class="o"&gt;(&lt;/span&gt;sudo&lt;span class="o"&gt;)&lt;/span&gt;,109&lt;span class="o"&gt;(&lt;/span&gt;sambashare&lt;span class="o"&gt;)&lt;/span&gt;
Ubuntu$ sudo usermod metajiji -aG debian-transmission
Ubuntu$ id metajiji
&lt;span class="nv"&gt;uid&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;1000&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;metajiji&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="nv"&gt;gid&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;1000&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;metajiji&lt;span class="o"&gt;)&lt;/span&gt; группы&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;1000&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;metajiji&lt;span class="o"&gt;)&lt;/span&gt;,4&lt;span class="o"&gt;(&lt;/span&gt;adm&lt;span class="o"&gt;)&lt;/span&gt;,27&lt;span class="o"&gt;(&lt;/span&gt;sudo&lt;span class="o"&gt;)&lt;/span&gt;,109&lt;span class="o"&gt;(&lt;/span&gt;sambashare&lt;span class="o"&gt;)&lt;/span&gt;,111&lt;span class="o"&gt;(&lt;/span&gt;debian-transmission&lt;span class="o"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Как видим, командой &lt;code&gt;id&lt;/code&gt; можно проверить список групп, а так же увидеть &lt;code&gt;uid/gid&lt;/code&gt; в которых состоит пользователь.&lt;/p&gt;
&lt;p&gt;Запускаем демона &lt;code&gt;transmission&lt;/code&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;sudo service transmission-daemon start
 * Starting bittorrent daemon transmission-daemon      &lt;span class="o"&gt;[&lt;/span&gt; OK &lt;span class="o"&gt;]&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;P.S. Если все сделано правильно, то &lt;code&gt;transmission&lt;/code&gt; будет скачивать файлы с правильными правами, так, что их можно будет удалять, перемещать, редактировать через &lt;code&gt;samba&lt;/code&gt;,
 не прибегая к редактированию системных файлов(&lt;code&gt;/etc/init.d/transmission-daemon&lt;/code&gt;) и т.п. ухищрений - так делать не нужно, ведь после обновления есть большая вероятность,
 что этот файл обновится и вам придется заново редактировать его вручную, в то время, как можно было сделать все менее радикально :)&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;Ссылки по теме:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href="http://ru.wikipedia.org/wiki/Umask"&gt;Wiki - Umask&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://forum.ubuntu.ru/index.php?PHPSESSID=inpalst5qltu2ks7ar4l0gd756&amp;amp;topic=211438.0"&gt;Ubuntu server 12.04 Transmission-daemon error: Permission denied...&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;</content><category term="Ubuntu"></category><category term="Linux"></category><category term="transmission"></category><category term="samba"></category></entry><entry><title>sh скрипт для поиска и удаления одинаковых файлов по md5. (script for delete duplicates files by md5 hash).</title><link href="https://metajiji.github.io/blog/sh-md5-script-for-delete-duplicates/" rel="alternate"></link><published>2013-08-26T00:00:00+07:00</published><updated>2013-08-26T00:00:00+07:00</updated><author><name>Denis Kadyshev</name></author><id>tag:metajiji.github.io,2013-08-26:/blog/sh-md5-script-for-delete-duplicates/</id><summary type="html">&lt;p&gt;Скрипт для поиска и удаления одинаковых файлов по &lt;code&gt;md5&lt;/code&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="ch"&gt;#!/bin/sh&lt;/span&gt;

&lt;span class="c1"&gt;#TODO - проверить наличие необходимых утилит&lt;/span&gt;
&lt;span class="c1"&gt;#md5&lt;/span&gt;
&lt;span class="c1"&gt;#find&lt;/span&gt;
&lt;span class="c1"&gt;#getopts&lt;/span&gt;
&lt;span class="c1"&gt;#grep&lt;/span&gt;

get_yes_no&lt;span class="o"&gt;()&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt;
    &lt;span class="k"&gt;while&lt;/span&gt; &lt;span class="o"&gt;[&lt;/span&gt; &lt;span class="nb"&gt;true&lt;/span&gt; &lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;
        &lt;span class="nb"&gt;echo&lt;/span&gt; -n &lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;$1&lt;/span&gt;&lt;span class="s2"&gt; (Y/N) ? &amp;quot;&lt;/span&gt;
        &lt;span class="nb"&gt;read&lt;/span&gt; a
        &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="o"&gt;[&lt;/span&gt; &lt;span class="nv"&gt;$?&lt;/span&gt; !&lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="m"&gt;0&lt;/span&gt; &lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="k"&gt;then&lt;/span&gt;
            &lt;span class="nv"&gt;a&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;No&amp;#39;&lt;/span&gt;
            &lt;span class="k"&gt;return&lt;/span&gt;
        &lt;span class="k"&gt;fi&lt;/span&gt;
        &lt;span class="k"&gt;case&lt;/span&gt; &lt;span class="nv"&gt;$a&lt;/span&gt; in
            &lt;span class="o"&gt;[&lt;/span&gt;Yy&lt;span class="o"&gt;])&lt;/span&gt; &lt;span class="nv"&gt;a&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;Yes&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="p"&gt;;;&lt;/span&gt;
            &lt;span class="o"&gt;[&lt;/span&gt;Nn&lt;span class="o"&gt;])&lt;/span&gt; &lt;span class="nv"&gt;a&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;No&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="p"&gt;;;&lt;/span&gt;
            *&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="p"&gt;;;&lt;/span&gt;
        &lt;span class="k"&gt;esac …&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;</summary><content type="html">&lt;p&gt;Скрипт для поиска и удаления одинаковых файлов по &lt;code&gt;md5&lt;/code&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="ch"&gt;#!/bin/sh&lt;/span&gt;

&lt;span class="c1"&gt;#TODO - проверить наличие необходимых утилит&lt;/span&gt;
&lt;span class="c1"&gt;#md5&lt;/span&gt;
&lt;span class="c1"&gt;#find&lt;/span&gt;
&lt;span class="c1"&gt;#getopts&lt;/span&gt;
&lt;span class="c1"&gt;#grep&lt;/span&gt;

get_yes_no&lt;span class="o"&gt;()&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt;
    &lt;span class="k"&gt;while&lt;/span&gt; &lt;span class="o"&gt;[&lt;/span&gt; &lt;span class="nb"&gt;true&lt;/span&gt; &lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;
        &lt;span class="nb"&gt;echo&lt;/span&gt; -n &lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;$1&lt;/span&gt;&lt;span class="s2"&gt; (Y/N) ? &amp;quot;&lt;/span&gt;
        &lt;span class="nb"&gt;read&lt;/span&gt; a
        &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="o"&gt;[&lt;/span&gt; &lt;span class="nv"&gt;$?&lt;/span&gt; !&lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="m"&gt;0&lt;/span&gt; &lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="k"&gt;then&lt;/span&gt;
            &lt;span class="nv"&gt;a&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;No&amp;#39;&lt;/span&gt;
            &lt;span class="k"&gt;return&lt;/span&gt;
        &lt;span class="k"&gt;fi&lt;/span&gt;
        &lt;span class="k"&gt;case&lt;/span&gt; &lt;span class="nv"&gt;$a&lt;/span&gt; in
            &lt;span class="o"&gt;[&lt;/span&gt;Yy&lt;span class="o"&gt;])&lt;/span&gt; &lt;span class="nv"&gt;a&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;Yes&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="p"&gt;;;&lt;/span&gt;
            &lt;span class="o"&gt;[&lt;/span&gt;Nn&lt;span class="o"&gt;])&lt;/span&gt; &lt;span class="nv"&gt;a&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;No&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="p"&gt;;;&lt;/span&gt;
            *&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="p"&gt;;;&lt;/span&gt;
        &lt;span class="k"&gt;esac&lt;/span&gt;
    &lt;span class="k"&gt;done&lt;/span&gt;
&lt;span class="o"&gt;}&lt;/span&gt;

build_hash_db&lt;span class="o"&gt;()&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt;
&lt;span class="c1"&gt;# Проверяем существует ли указанный файл БД, если да, то спрашиваем что делать - удалить и создать новый или выйти.&lt;/span&gt;
    &lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Запущено построение базы хешей каталога: &amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;$1&lt;/span&gt;
    &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="o"&gt;[&lt;/span&gt; -f &lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;$db_FILE&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt; &lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="k"&gt;then&lt;/span&gt;
        get_yes_no &lt;span class="s1"&gt;&amp;#39;Файл БД уже существует, удалить и создать новый?&amp;#39;&lt;/span&gt;
        &lt;span class="o"&gt;[&lt;/span&gt; &lt;span class="nv"&gt;$a&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;No&amp;#39;&lt;/span&gt; &lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;Аварийное завершение.&amp;#39;&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class="nb"&gt;exit&lt;/span&gt; &lt;span class="m"&gt;1&lt;/span&gt;
        &lt;span class="o"&gt;[&lt;/span&gt; &lt;span class="nv"&gt;$a&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;Yes&amp;#39;&lt;/span&gt; &lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;Файл БД удален и будет создан заново.&amp;#39;&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt; rm -f &lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;$db_FILE&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;
    &lt;span class="k"&gt;fi&lt;/span&gt;

    find &lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;$1&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt; -type f -print &lt;span class="p"&gt;|&lt;/span&gt; &lt;span class="k"&gt;while&lt;/span&gt; &lt;span class="nb"&gt;read&lt;/span&gt; file&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;
        &lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;`md5 -q &amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;$file&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;`  &lt;/span&gt;&lt;span class="nv"&gt;$file&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt; &amp;gt;&amp;gt; &lt;span class="nv"&gt;$db_FILE&lt;/span&gt;
    &lt;span class="k"&gt;done&lt;/span&gt;
&lt;span class="o"&gt;}&lt;/span&gt;

find_and_delete_duplicates_by_hash_from_db&lt;span class="o"&gt;(){&lt;/span&gt;
    &lt;span class="c1"&gt;# Если база не создана, то предлагаем создать её.&lt;/span&gt;
    &lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Запущен поиск дубликатов в каталоге &lt;/span&gt;&lt;span class="nv"&gt;$1&lt;/span&gt;&lt;span class="s2"&gt; по базе хешей &lt;/span&gt;&lt;span class="nv"&gt;$db_FILE&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;
    &lt;span class="o"&gt;[&lt;/span&gt; ! -f &lt;span class="nv"&gt;$db_FILE&lt;/span&gt; &lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt; get_yes_no &lt;span class="s1"&gt;&amp;#39;Файл БД не существует, создать новый?&amp;#39;&lt;/span&gt;
    &lt;span class="o"&gt;[&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;$a&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;No&amp;#39;&lt;/span&gt; &lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;Аварийное завершение.&amp;#39;&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class="nb"&gt;exit&lt;/span&gt; &lt;span class="m"&gt;1&lt;/span&gt;
    &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="o"&gt;[&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;$a&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;Yes&amp;#39;&lt;/span&gt; &lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="k"&gt;then&lt;/span&gt;
        &lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;Создание файла БД: &amp;#39;&lt;/span&gt;&lt;span class="nv"&gt;$db_FILE&lt;/span&gt;
        &lt;span class="k"&gt;while&lt;/span&gt; &lt;span class="o"&gt;[&lt;/span&gt; &lt;span class="nb"&gt;true&lt;/span&gt; &lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;
            &lt;span class="nb"&gt;echo&lt;/span&gt; -n &lt;span class="s1"&gt;&amp;#39;Введите путь до каталога по которому будет создаваться файл БД: &amp;#39;&lt;/span&gt;
            &lt;span class="nb"&gt;read&lt;/span&gt; b
            &lt;span class="o"&gt;[&lt;/span&gt; &lt;span class="nv"&gt;$?&lt;/span&gt; !&lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="m"&gt;0&lt;/span&gt; &lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class="k"&gt;return&lt;/span&gt;
            &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="o"&gt;[&lt;/span&gt; -d &lt;span class="nv"&gt;$b&lt;/span&gt; &lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="k"&gt;then&lt;/span&gt;
                build_hash_db &lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;$b&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;
                &lt;span class="k"&gt;return&lt;/span&gt;
            &lt;span class="k"&gt;else&lt;/span&gt;
                &lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;Вы ввели неверный путь. Повторите попытку.&amp;#39;&lt;/span&gt;
            &lt;span class="k"&gt;fi&lt;/span&gt;
        &lt;span class="k"&gt;done&lt;/span&gt;
    &lt;span class="k"&gt;fi&lt;/span&gt;

    &lt;span class="c1"&gt;# Ищем дубликаты в каталоге $1 по БД хешей $db_FILE.&lt;/span&gt;
    &lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;#--------------------------- &amp;#39;&lt;/span&gt;&lt;span class="sb"&gt;`&lt;/span&gt;date &lt;span class="s2"&gt;&amp;quot;+%d.%m.%Y %H:%M:%S&amp;quot;&lt;/span&gt;&lt;span class="sb"&gt;`&lt;/span&gt; &amp;gt; &lt;span class="si"&gt;${&lt;/span&gt;&lt;span class="nv"&gt;db_FILE&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;.log
    find &lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;$1&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt; -type f -print &lt;span class="p"&gt;|&lt;/span&gt; &lt;span class="k"&gt;while&lt;/span&gt; &lt;span class="nb"&gt;read&lt;/span&gt; file&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;
        &lt;span class="nv"&gt;hash&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="sb"&gt;`&lt;/span&gt;md5 -q &lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;$file&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="sb"&gt;`&lt;/span&gt;
        &lt;span class="k"&gt;if&lt;/span&gt; grep -q &lt;span class="nv"&gt;$hash&lt;/span&gt; &lt;span class="nv"&gt;$db_FILE&lt;/span&gt; &lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="k"&gt;then&lt;/span&gt;
            &lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;$file&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39; is a duplicate and has been removed.&amp;#39;&lt;/span&gt;
            &lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="nv"&gt;$hash&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;     &amp;#39;&lt;/span&gt;&lt;span class="nv"&gt;$file&lt;/span&gt; &amp;gt;&amp;gt; &lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="si"&gt;${&lt;/span&gt;&lt;span class="nv"&gt;db_FILE&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="s2"&gt;.log&amp;quot;&lt;/span&gt;
            rm -vf &lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;$file&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;
        &lt;span class="k"&gt;fi&lt;/span&gt;
    &lt;span class="k"&gt;done&lt;/span&gt;
&lt;span class="o"&gt;}&lt;/span&gt;

usage&lt;span class="o"&gt;()&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt;
    &lt;span class="o"&gt;[&lt;/span&gt; -n &lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;$1&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt; &lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;$1&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;
    cat &lt;span class="s"&gt;&amp;lt;&amp;lt;-_EOF&lt;/span&gt;
&lt;span class="s"&gt;        Usage: &lt;/span&gt;
&lt;span class="s"&gt;        -c Режим построения базы хешей.&lt;/span&gt;
&lt;span class="s"&gt;        -d Режим поиска и удаления повторяющихся файлов на основе построенной ранее базы хешей.&lt;/span&gt;
&lt;span class="s"&gt;        -f Имя файла БД с хешами, если не будет указан, то будет использоваться значение по умолчанию - file.csv&lt;/span&gt;
&lt;span class="s"&gt;        -h | --help Справка.&lt;/span&gt;

&lt;span class="s"&gt;        Пример использования:&lt;/span&gt;
&lt;span class="s"&gt;        1. Создать базу хешей каталога 1:&lt;/span&gt;
&lt;span class="s"&gt;            $(basename $0) -c -f my_file.csv /path/to/folder&lt;/span&gt;
&lt;span class="s"&gt;        2. Найти и удалить дубликаты по созданной базе хешей в каталоге 2:&lt;/span&gt;
&lt;span class="s"&gt;            $(basename $0) -d -f my_file.csv /path/to/folder&lt;/span&gt;
&lt;span class="s"&gt;_EOF&lt;/span&gt;
    &lt;span class="nb"&gt;exit&lt;/span&gt; &lt;span class="m"&gt;2&lt;/span&gt;
&lt;span class="o"&gt;}&lt;/span&gt;

&lt;span class="c1"&gt;# Проверяем на пустые аргументы.&lt;/span&gt;
&lt;span class="o"&gt;[&lt;/span&gt; &lt;span class="nv"&gt;$#&lt;/span&gt; -lt &lt;span class="m"&gt;1&lt;/span&gt; &lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt; usage

&lt;span class="nv"&gt;c_FLG&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;0&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="nv"&gt;d_FLG&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;0&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="k"&gt;while&lt;/span&gt; &lt;span class="nb"&gt;getopts&lt;/span&gt; hcdf: a&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;
    &lt;span class="k"&gt;case&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;$a&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt; in
        c&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="o"&gt;[&lt;/span&gt; &lt;span class="nv"&gt;$d_FLG&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="m"&gt;1&lt;/span&gt; &lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt; usage &lt;span class="s1"&gt;&amp;#39;ОШИБКА! Нельзя использовать одновременно опции -c и -d.&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="nv"&gt;c_FLG&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;1&lt;/span&gt; &lt;span class="p"&gt;;;&lt;/span&gt;
        d&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="o"&gt;[&lt;/span&gt; &lt;span class="nv"&gt;$c_FLG&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="m"&gt;1&lt;/span&gt; &lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt; usage &lt;span class="s1"&gt;&amp;#39;ОШИБКА! Нельзя использовать одновременно опции -c и -d.&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="nv"&gt;d_FLG&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;1&lt;/span&gt; &lt;span class="p"&gt;;;&lt;/span&gt;
        f&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="nv"&gt;db_FILE&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;$OPTARG&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt; &lt;span class="p"&gt;;;&lt;/span&gt;
        ?&lt;span class="p"&gt;|&lt;/span&gt;h&lt;span class="o"&gt;)&lt;/span&gt; usage &lt;span class="p"&gt;;;&lt;/span&gt;
    &lt;span class="k"&gt;esac&lt;/span&gt;
&lt;span class="k"&gt;done&lt;/span&gt;

&lt;span class="c1"&gt;# Сдвигаем ряд аргументов на количество уже разобранных аргументов и оставляем последний.&lt;/span&gt;
&lt;span class="nb"&gt;shift&lt;/span&gt; &lt;span class="k"&gt;$((&lt;/span&gt;&lt;span class="nv"&gt;$OPTIND&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="m"&gt;1&lt;/span&gt;&lt;span class="k"&gt;))&lt;/span&gt; &lt;span class="c1"&gt;#shift `expr  $OPTIND - 1`&lt;/span&gt;

&lt;span class="c1"&gt;# Проверка аргументов и важных переменных.&lt;/span&gt;
&lt;span class="o"&gt;[&lt;/span&gt; -z &lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;$1&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt; &lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt; usage &lt;span class="s1"&gt;&amp;#39;ОШИБКА! Не задан каталог для обработки.&amp;#39;&lt;/span&gt;
&lt;span class="o"&gt;[&lt;/span&gt; -z &lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;$db_FILE&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt; &lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt; usage &lt;span class="s1"&gt;&amp;#39;ОШИБКА! Не задана опция -f.&amp;#39;&lt;/span&gt;
&lt;span class="o"&gt;[&lt;/span&gt; &lt;span class="nv"&gt;$c_FLG&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="m"&gt;0&lt;/span&gt; -a &lt;span class="nv"&gt;$d_FLG&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="m"&gt;0&lt;/span&gt; &lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt; usage &lt;span class="s1"&gt;&amp;#39;ОШИБКА! Не указана ни одна из опций -c или -d.&amp;#39;&lt;/span&gt;

&lt;span class="c1"&gt;# Запуск фукций в зависимости от установленных переменных.&lt;/span&gt;
&lt;span class="o"&gt;[&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;$c_FLG&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="m"&gt;1&lt;/span&gt; &lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt; build_hash_db &lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;$1&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;
&lt;span class="o"&gt;[&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;$d_FLG&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="m"&gt;1&lt;/span&gt; &lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt; find_and_delete_duplicates_by_hash_from_db &lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;$1&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;</content><category term="Bash"></category><category term="checksumm"></category><category term="delete duplicates"></category></entry><entry><title>Ubuntu 12.04 samba не работает при старте системы</title><link href="https://metajiji.github.io/blog/ubuntu-1204-samba/" rel="alternate"></link><published>2013-08-25T00:00:00+07:00</published><updated>2013-08-25T00:00:00+07:00</updated><author><name>Denis Kadyshev</name></author><id>tag:metajiji.github.io,2013-08-25:/blog/ubuntu-1204-samba/</id><summary type="html">&lt;p&gt;После установки &lt;code&gt;samba&lt;/code&gt; обнаружил проблему - после перезагрузки системы демон &lt;code&gt;smbd&lt;/code&gt; запускается, но пользователи не могут получить доступ к шарам.
Поиск по интернетам особо не дал результатов, пришлось разбираться самому.
Проблема заключалась в том, что демон стартует после инициализации файловых систем и поднятия сетевых интерфейсов.
И похоже &lt;code&gt;smbd&lt;/code&gt; стартовал сразу, как …&lt;/p&gt;</summary><content type="html">&lt;p&gt;После установки &lt;code&gt;samba&lt;/code&gt; обнаружил проблему - после перезагрузки системы демон &lt;code&gt;smbd&lt;/code&gt; запускается, но пользователи не могут получить доступ к шарам.
Поиск по интернетам особо не дал результатов, пришлось разбираться самому.
Проблема заключалась в том, что демон стартует после инициализации файловых систем и поднятия сетевых интерфейсов.
И похоже &lt;code&gt;smbd&lt;/code&gt; стартовал сразу, как только поднимался &lt;code&gt;lo0&lt;/code&gt;, не дожидаясь пока остальные интерфейсы получат &lt;strong&gt;ip&lt;/strong&gt; адреса по &lt;strong&gt;DHCP&lt;/strong&gt; и тоже перейдут в состояние &lt;code&gt;up&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Подсмотел в скрипт запуска &lt;code&gt;nmbd&lt;/code&gt; и обнаружил, что группа интерфейсов &lt;code&gt;lo&lt;/code&gt; игнорируется.
Этот же прием применил и для &lt;code&gt;smbd&lt;/code&gt;, отредактировав файл &lt;code&gt;/etc/init/smbd.conf&lt;/code&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;start on &lt;span class="o"&gt;(&lt;/span&gt;local-filesystems and net-device-up IFACE!&lt;span class="o"&gt;=&lt;/span&gt;lo&lt;span class="o"&gt;)&lt;/span&gt;
&lt;span class="c1"&gt;#start on (local-filesystems and net-device-up)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;</content><category term="Ubuntu"></category><category term="Linux"></category><category term="samba"></category></entry><entry><title>Работа с текстом во FreeBSD dos2unix, unix2dos, удаление BOM в консоли.</title><link href="https://metajiji.github.io/blog/freebsd-dos2unix-unix2dos-bom/" rel="alternate"></link><published>2013-08-03T00:00:00+07:00</published><updated>2013-08-03T00:00:00+07:00</updated><author><name>Denis Kadyshev</name></author><id>tag:metajiji.github.io,2013-08-03:/blog/freebsd-dos2unix-unix2dos-bom/</id><summary type="html">&lt;p&gt;Замена текста:&lt;/p&gt;
&lt;p&gt;Способ 1: Замена подстроки с помощью &lt;code&gt;perl&lt;/code&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;perl -e &lt;span class="s1"&gt;&amp;#39;s/foo/bar/g&amp;#39;&lt;/span&gt; -pi ./index.html
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Способ 2: Замена с помощью &lt;code&gt;sed&lt;/code&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;sed -e &lt;span class="s1"&gt;&amp;#39;s/foo/bar/g&amp;#39;&lt;/span&gt;  ./index.html &amp;gt; index_new.html
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Способ 3: Замена с помощью &lt;code&gt;awk&lt;/code&gt;&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;awk &lt;span class="s1"&gt;&amp;#39;{gsub(&amp;quot;foo&amp;quot;, &amp;quot;bar&amp;quot;, $0); print &amp;gt; FILENAME}&amp;#39;&lt;/span&gt; ./index.html
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Полезные …&lt;/p&gt;</summary><content type="html">&lt;p&gt;Замена текста:&lt;/p&gt;
&lt;p&gt;Способ 1: Замена подстроки с помощью &lt;code&gt;perl&lt;/code&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;perl -e &lt;span class="s1"&gt;&amp;#39;s/foo/bar/g&amp;#39;&lt;/span&gt; -pi ./index.html
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Способ 2: Замена с помощью &lt;code&gt;sed&lt;/code&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;sed -e &lt;span class="s1"&gt;&amp;#39;s/foo/bar/g&amp;#39;&lt;/span&gt;  ./index.html &amp;gt; index_new.html
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Способ 3: Замена с помощью &lt;code&gt;awk&lt;/code&gt;&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;awk &lt;span class="s1"&gt;&amp;#39;{gsub(&amp;quot;foo&amp;quot;, &amp;quot;bar&amp;quot;, $0); print &amp;gt; FILENAME}&amp;#39;&lt;/span&gt; ./index.html
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Полезные функции для работы с файлами:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;dos2unix&lt;span class="o"&gt;()&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt;
    sed -i &lt;span class="s1"&gt;&amp;#39;&amp;#39;&lt;/span&gt; -e &lt;span class="s1"&gt;&amp;#39;s/&amp;#39;&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="k"&gt;$(&lt;/span&gt;&lt;span class="nb"&gt;printf&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;\015&amp;#39;&lt;/span&gt;&lt;span class="k"&gt;)&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;$//g&amp;#39;&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;$2&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;
&lt;span class="o"&gt;}&lt;/span&gt;

unix2dos&lt;span class="o"&gt;()&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt;
    sed -i &lt;span class="s1"&gt;&amp;#39;&amp;#39;&lt;/span&gt; -e &lt;span class="s1"&gt;&amp;#39;s|$|&amp;#39;&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="k"&gt;$(&lt;/span&gt;&lt;span class="nb"&gt;printf&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;\015&amp;#39;&lt;/span&gt;&lt;span class="k"&gt;)&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;|g&amp;#39;&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;$2&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;
&lt;span class="o"&gt;}&lt;/span&gt;

delete_BOM&lt;span class="o"&gt;()&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt;
    &lt;span class="c1"&gt;#awk &amp;#39;{sub(/^\xEF\xBB\xBF/,&amp;quot;&amp;quot;,$0); print &amp;gt; FILENAME}&amp;#39; &amp;quot;$1&amp;quot;&lt;/span&gt;
    awk &lt;span class="s1"&gt;&amp;#39;{sub(/^\xEF\xBB\xBF/,&amp;quot;&amp;quot;,$0); print}&amp;#39;&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;$1&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt; &amp;gt;&amp;gt; &lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="si"&gt;${&lt;/span&gt;&lt;span class="nv"&gt;1&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="s2"&gt;.awkbak&amp;quot;&lt;/span&gt;
    mv &lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="si"&gt;${&lt;/span&gt;&lt;span class="nv"&gt;1&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="s2"&gt;.awkbak&amp;quot;&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;$1&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;
&lt;span class="o"&gt;}&lt;/span&gt;

&lt;span class="c1"&gt;#По 1 файлу&lt;/span&gt;
dos2unix -o russian.php
delete_BOM russian.php

&lt;span class="c1"&gt;# Найти и обработать все *.tpl и *.php файлы от текущего каталога.&lt;/span&gt;
&lt;span class="k"&gt;for&lt;/span&gt; i in &lt;span class="k"&gt;$(&lt;/span&gt;find . -type f &lt;span class="se"&gt;\(&lt;/span&gt; -name &lt;span class="s1"&gt;&amp;#39;*.tpl&amp;#39;&lt;/span&gt; -o -name &lt;span class="s1"&gt;&amp;#39;*.php&amp;#39;&lt;/span&gt; &lt;span class="se"&gt;\)&lt;/span&gt; -print&lt;span class="k"&gt;)&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;
    &lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;Working: &amp;#39;&lt;/span&gt;&lt;span class="nv"&gt;$i&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;...&amp;#39;&lt;/span&gt;
    dos2unix -o &lt;span class="nv"&gt;$i&lt;/span&gt;
    delete_BOM &lt;span class="nv"&gt;$i&lt;/span&gt;
&lt;span class="k"&gt;done&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;&lt;code&gt;dos2unix -o&lt;/code&gt; для обратной совместимости с одноименной консольной утилитой &lt;code&gt;/usr/ports/converters/unix2dos&lt;/code&gt;,
 но зачем засорять систему лишними пакетами, если можно обойтись встроенными средствами?&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;P.S. Если кто-то подскажет более изящное решение на &lt;code&gt;awk&lt;/code&gt;, &lt;code&gt;sed&lt;/code&gt; или еще чем-то, что идет штатно во &lt;strong&gt;FreeBSD&lt;/strong&gt; для удаления &lt;strong&gt;BOM&lt;/strong&gt;, буду только рад :)
 Варианты с &lt;code&gt;perl&lt;/code&gt; не предлагать, они очевидны и не интересны :)
Первый вариант с &lt;code&gt;awk&lt;/code&gt; почему-то не работает, часть файла теряется.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;FreeBSD&lt;/strong&gt; Подсказывает в &lt;code&gt;motd&lt;/code&gt; вариант на &lt;code&gt;sed&lt;/code&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;sed -e &lt;span class="s1"&gt;&amp;#39;1s/^\xef\xbb\xbf//&amp;#39;&lt;/span&gt; &amp;lt; bomfile &amp;gt; newfile
&lt;/pre&gt;&lt;/div&gt;</content><category term="FreeBSD"></category><category term="Linux"></category><category term="dos2unix"></category><category term="unix2dos"></category><category term="sed"></category><category term="awk"></category><category term="perl"></category><category term="BOM"></category></entry><entry><title>isc-dhcpd - Скрипт для просмотра и удаления арендованных адресов из файла dhcpd.leases.</title><link href="https://metajiji.github.io/blog/freebsd-isc-dhcpd-dhcpdleases/" rel="alternate"></link><published>2013-06-19T00:00:00+07:00</published><updated>2013-06-19T00:00:00+07:00</updated><author><name>Denis Kadyshev</name></author><id>tag:metajiji.github.io,2013-06-19:/blog/freebsd-isc-dhcpd-dhcpdleases/</id><summary type="html">&lt;p&gt;Скрипт парсит &lt;code&gt;dhcpd.leases&lt;/code&gt; файл и отображает список подсетей &lt;code&gt;0/24&lt;/code&gt; на выбор, после выбора подсети выдается список арендованных &lt;code&gt;ip&lt;/code&gt; со статусом &lt;code&gt;free&lt;/code&gt; или &lt;code&gt;active&lt;/code&gt;,
 где можно выбрать один или несколько &lt;code&gt;ip&lt;/code&gt; и удалить.
Скрипт использует &lt;code&gt;dialog&lt;/code&gt;, за счет чего меню получается очень привлекательным :) - писал под &lt;strong&gt;FreeBSD&lt;/strong&gt;,
 на &lt;strong&gt;Linux&lt;/strong&gt; не …&lt;/p&gt;</summary><content type="html">&lt;p&gt;Скрипт парсит &lt;code&gt;dhcpd.leases&lt;/code&gt; файл и отображает список подсетей &lt;code&gt;0/24&lt;/code&gt; на выбор, после выбора подсети выдается список арендованных &lt;code&gt;ip&lt;/code&gt; со статусом &lt;code&gt;free&lt;/code&gt; или &lt;code&gt;active&lt;/code&gt;,
 где можно выбрать один или несколько &lt;code&gt;ip&lt;/code&gt; и удалить.
Скрипт использует &lt;code&gt;dialog&lt;/code&gt;, за счет чего меню получается очень привлекательным :) - писал под &lt;strong&gt;FreeBSD&lt;/strong&gt;,
 на &lt;strong&gt;Linux&lt;/strong&gt; не тестировал (возможно будут проблемы из-за несовместимости &lt;strong&gt;BSD awk&lt;/strong&gt; и &lt;strong&gt;GNU awk&lt;/strong&gt;), хотя думаю, что должен работать и под &lt;strong&gt;Linux&lt;/strong&gt;.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="ch"&gt;#!/bin/sh&lt;/span&gt;

&lt;span class="c1"&gt;# загружаем /etc/rc.conf.&lt;/span&gt;
. /etc/rc.conf

&lt;span class="c1"&gt;#TODO - установить имя файла более точнее, см. /usr/local/etc/rc.d/isc-dhcpd.&lt;/span&gt;
&lt;span class="nv"&gt;file&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nv"&gt;$dhcpd_rootdir&lt;/span&gt;/var/db/dhcpd/dhcpd.leases

&lt;span class="nv"&gt;tempfile&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="k"&gt;$(&lt;/span&gt;mktemp &lt;span class="m"&gt;2&lt;/span&gt;&amp;gt;/dev/null&lt;span class="k"&gt;)&lt;/span&gt; &lt;span class="o"&gt;||&lt;/span&gt; &lt;span class="nv"&gt;tempfile&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;/tmp/&lt;span class="k"&gt;$(&lt;/span&gt;basename &lt;span class="nv"&gt;$0&lt;/span&gt;&lt;span class="k"&gt;)&lt;/span&gt;_&lt;span class="nv"&gt;$$&lt;/span&gt;
&lt;span class="nb"&gt;trap&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;rm -f &lt;/span&gt;&lt;span class="nv"&gt;$tempfile&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt; &lt;span class="m"&gt;0&lt;/span&gt; &lt;span class="m"&gt;1&lt;/span&gt; &lt;span class="m"&gt;2&lt;/span&gt; &lt;span class="m"&gt;5&lt;/span&gt; &lt;span class="m"&gt;15&lt;/span&gt;

&lt;span class="c1"&gt;### functions: BEGIN&lt;/span&gt;
&lt;span class="c1"&gt;# Функция запуска команд в информационном окошке.&lt;/span&gt;
exec_fun&lt;span class="o"&gt;()&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt;
    dialog --sleep &lt;span class="m"&gt;1&lt;/span&gt; --title &lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;$2&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt; &lt;span class="se"&gt;\&lt;/span&gt;
        --msgbox &lt;span class="s2"&gt;&amp;quot;`echo ;&lt;/span&gt;&lt;span class="nv"&gt;$1&lt;/span&gt;&lt;span class="s2"&gt; 2&amp;gt;&amp;amp;1;echo`&amp;quot;&lt;/span&gt; &lt;span class="m"&gt;15&lt;/span&gt; &lt;span class="m"&gt;85&lt;/span&gt;
&lt;span class="o"&gt;}&lt;/span&gt;


&lt;span class="c1"&gt;# Функция удаления lease.&lt;/span&gt;
del_lease&lt;span class="o"&gt;()&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt;
    exec_fun &lt;span class="s2"&gt;&amp;quot;service isc-dhcpd stop&amp;quot;&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Status Daemon:&amp;quot;&lt;/span&gt;
&lt;span class="c1"&gt;#TODO - убедиться, что демон остановлен.&lt;/span&gt;

    &lt;span class="c1"&gt;# Бекап базы.&lt;/span&gt;
    &lt;span class="nv"&gt;DATE&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="k"&gt;$(&lt;/span&gt;date &lt;span class="s2"&gt;&amp;quot;+%Y%m%d%H%M&amp;quot;&lt;/span&gt;&lt;span class="k"&gt;)&lt;/span&gt;
    cp -vf &lt;span class="nv"&gt;$file&lt;/span&gt; &lt;span class="si"&gt;${&lt;/span&gt;&lt;span class="nv"&gt;file&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;.&lt;span class="nv"&gt;$DATE&lt;/span&gt;

    &lt;span class="k"&gt;for&lt;/span&gt; i in &lt;span class="nv"&gt;$1&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;
        awk &lt;span class="s1"&gt;&amp;#39;BEGIN { FLG=0; } {&lt;/span&gt;
&lt;span class="s1"&gt;            if ($0==&amp;quot;lease &amp;#39;&lt;/span&gt;&lt;span class="nv"&gt;$i&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39; {&amp;quot;) FLG=1;&lt;/span&gt;
&lt;span class="s1"&gt;            if (FLG==&amp;quot;0&amp;quot;) printf &amp;quot;%s&amp;quot;,$0&amp;quot;\n&amp;quot;;&lt;/span&gt;
&lt;span class="s1"&gt;            if ($0==&amp;quot;}&amp;quot; &amp;amp;&amp;amp; FLG==&amp;quot;1&amp;quot;) FLG=0;&lt;/span&gt;
&lt;span class="s1"&gt;        }&amp;#39;&lt;/span&gt; &lt;span class="nv"&gt;$file&lt;/span&gt; &amp;gt; &lt;span class="si"&gt;${&lt;/span&gt;&lt;span class="nv"&gt;file&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;.new
        mv -vf &lt;span class="si"&gt;${&lt;/span&gt;&lt;span class="nv"&gt;file&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;.new &lt;span class="nv"&gt;$file&lt;/span&gt;
    &lt;span class="k"&gt;done&lt;/span&gt;

    &lt;span class="o"&gt;[&lt;/span&gt; -f &lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="si"&gt;${&lt;/span&gt;&lt;span class="nv"&gt;file&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="s2"&gt;~&amp;quot;&lt;/span&gt; &lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt; rm -vf &lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="si"&gt;${&lt;/span&gt;&lt;span class="nv"&gt;file&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="s2"&gt;~&amp;quot;&lt;/span&gt;
    exec_fun &lt;span class="s2"&gt;&amp;quot;service isc-dhcpd start&amp;quot;&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Status Daemon:&amp;quot;&lt;/span&gt;
&lt;span class="c1"&gt;#TODO - убедиться, что демон запущен.&lt;/span&gt;
&lt;span class="o"&gt;}&lt;/span&gt;

&lt;span class="c1"&gt;# Функция получения списка subnet из dhcpd.leasees файла.&lt;/span&gt;
get_subnet_list&lt;span class="o"&gt;()&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt;
    grep -oE &lt;span class="s1"&gt;&amp;#39;^lease [0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.&amp;#39;&lt;/span&gt; &lt;span class="nv"&gt;$file&lt;/span&gt; &lt;span class="p"&gt;|&lt;/span&gt; sort -u &lt;span class="se"&gt;\&lt;/span&gt;
        &lt;span class="p"&gt;|&lt;/span&gt; awk &lt;span class="s1"&gt;&amp;#39;BEGIN { n=1; }{ print n&amp;quot; &amp;quot;$2&amp;quot;0/24 off&amp;quot;; n++; }&amp;#39;&lt;/span&gt;
&lt;span class="o"&gt;}&lt;/span&gt;

&lt;span class="c1"&gt;# Функция получения списка ip по subnet&amp;#39;у /24 и вывод списка в виде dialog.&lt;/span&gt;
get_leases&lt;span class="o"&gt;()&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt;
    &lt;span class="k"&gt;while&lt;/span&gt; &lt;span class="o"&gt;[&lt;/span&gt; &lt;span class="nb"&gt;true&lt;/span&gt; &lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;
        &lt;span class="nv"&gt;LIST&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="sb"&gt;`&lt;/span&gt;awk &lt;span class="s1"&gt;&amp;#39;{ out=&amp;quot;&amp;quot;; sub(/[;#].*/,&amp;quot;&amp;quot;,$0); \&lt;/span&gt;
&lt;span class="s1"&gt;                if ($1&amp;quot; &amp;quot;$2&amp;quot; &amp;quot;$3 ~ /^lease &amp;#39;&lt;/span&gt;&lt;span class="k"&gt;$(&lt;/span&gt;&lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="nv"&gt;$1&lt;/span&gt; &lt;span class="p"&gt;|&lt;/span&gt; sed &lt;span class="s1"&gt;&amp;#39;s|\.|\\.|g&amp;#39;&lt;/span&gt;&lt;span class="k"&gt;)&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;[0-9]?[0-9]?[0-9] \{$/ ) { out=&amp;quot; &amp;quot;$2; FLG=1; } \&lt;/span&gt;
&lt;span class="s1"&gt;                if ($1==&amp;quot;binding&amp;quot; &amp;amp;&amp;amp; FLG==&amp;quot;1&amp;quot;) out=&amp;quot; &amp;quot;$3; \&lt;/span&gt;
&lt;span class="s1"&gt;                if ($1==&amp;quot;}&amp;quot; &amp;amp;&amp;amp; FLG==&amp;quot;1&amp;quot;) { out=&amp;quot;\n&amp;quot;; FLG=0; } \&lt;/span&gt;
&lt;span class="s1"&gt;                printf out,&amp;quot; &amp;quot;; }&amp;#39;&lt;/span&gt; &lt;span class="nv"&gt;$file&lt;/span&gt; &lt;span class="p"&gt;|&lt;/span&gt; &lt;span class="se"&gt;\&lt;/span&gt;
            sort -un -t . -k &lt;span class="m"&gt;1&lt;/span&gt;,1 -k &lt;span class="m"&gt;2&lt;/span&gt;,2 -k &lt;span class="m"&gt;3&lt;/span&gt;,3 -k &lt;span class="m"&gt;4&lt;/span&gt;,4 &lt;span class="p"&gt;|&lt;/span&gt; &lt;span class="se"&gt;\&lt;/span&gt;
            awk &lt;span class="s1"&gt;&amp;#39;BEGIN { n=1; }{ print n&amp;quot; \&amp;quot;&amp;quot;$1&amp;quot; &amp;quot;$2&amp;quot;\&amp;quot; off&amp;quot;; n++; }&amp;#39;&lt;/span&gt;&lt;span class="sb"&gt;`&lt;/span&gt;

        &lt;span class="nv"&gt;DIALOG&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;dialog --backtitle &amp;quot;Редактирование &amp;#39;&lt;/span&gt;&lt;span class="nv"&gt;$file&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;&amp;quot;&lt;/span&gt;
&lt;span class="s1"&gt;            --cancel-label Back&lt;/span&gt;
&lt;span class="s1"&gt;            --ok-label Delete&lt;/span&gt;
&lt;span class="s1"&gt;            --title &amp;quot;Редактирование &amp;#39;&lt;/span&gt;&lt;span class="nv"&gt;$1&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;0/24&amp;quot; --clear&lt;/span&gt;
&lt;span class="s1"&gt;            --checklist &amp;quot;Выбор lease&amp;quot; 20 61 10&lt;/span&gt;
&lt;span class="s1"&gt;            &amp;#39;&lt;/span&gt;&lt;span class="nv"&gt;$LIST&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39; 2&amp;gt; &amp;#39;&lt;/span&gt;&lt;span class="nv"&gt;$tempfile&lt;/span&gt;
        &lt;span class="nb"&gt;eval&lt;/span&gt; &lt;span class="nv"&gt;$DIALOG&lt;/span&gt;

        &lt;span class="c1"&gt;# Собственно удаление выбранных lease. $(cat $tempfile)&lt;/span&gt;
        &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="o"&gt;[&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;$?&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt; -eq &lt;span class="m"&gt;0&lt;/span&gt; &lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="k"&gt;then&lt;/span&gt;
            &lt;span class="c1"&gt;# Формируем и передаваем в функцию удаления список ip.&lt;/span&gt;
            &lt;span class="nv"&gt;DEL_LIST&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;&amp;#39;&lt;/span&gt;
            &lt;span class="k"&gt;for&lt;/span&gt; i in &lt;span class="k"&gt;$(&lt;/span&gt;cat &lt;span class="nv"&gt;$tempfile&lt;/span&gt;&lt;span class="k"&gt;)&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;
                &lt;span class="nv"&gt;DEL_LIST&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;$DEL_LIST&lt;/span&gt;&lt;span class="s2"&gt; &amp;quot;&lt;/span&gt;&lt;span class="k"&gt;$(&lt;/span&gt;&lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;$LIST&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt; &lt;span class="p"&gt;|&lt;/span&gt; awk &lt;span class="s1"&gt;&amp;#39;{&lt;/span&gt;
&lt;span class="s1"&gt;                    if ($1==&amp;quot;&amp;#39;&lt;/span&gt;&lt;span class="nv"&gt;$i&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;&amp;quot;) {&lt;/span&gt;
&lt;span class="s1"&gt;                        sub(/0\/24$/,&amp;quot;&amp;quot;,$2);&lt;/span&gt;
&lt;span class="s1"&gt;                        sub(/&amp;quot;/,&amp;quot;&amp;quot;,$2);&lt;/span&gt;
&lt;span class="s1"&gt;                        print $2;&lt;/span&gt;
&lt;span class="s1"&gt;                    }&lt;/span&gt;
&lt;span class="s1"&gt;                }&amp;#39;&lt;/span&gt;&lt;span class="k"&gt;)&lt;/span&gt;
            &lt;span class="k"&gt;done&lt;/span&gt;
            del_lease &lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;$DEL_LIST&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;
        &lt;span class="k"&gt;else&lt;/span&gt;
            break&lt;span class="p"&gt;;&lt;/span&gt;  &lt;span class="c1"&gt;# Выходим из while [true].&lt;/span&gt;
        &lt;span class="k"&gt;fi&lt;/span&gt;
    &lt;span class="k"&gt;done&lt;/span&gt;
&lt;span class="o"&gt;}&lt;/span&gt;
&lt;span class="c1"&gt;### functions: END&lt;/span&gt;

&lt;span class="o"&gt;[&lt;/span&gt; ! -f &lt;span class="nv"&gt;$file&lt;/span&gt; &lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;ERROR: File &amp;quot;&amp;#39;&lt;/span&gt;&lt;span class="nv"&gt;$file&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;&amp;quot; not exist or not readable!&amp;#39;&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class="nb"&gt;exit&lt;/span&gt; &lt;span class="m"&gt;1&lt;/span&gt;

&lt;span class="k"&gt;while&lt;/span&gt; &lt;span class="o"&gt;[&lt;/span&gt; &lt;span class="nb"&gt;true&lt;/span&gt; &lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;
    &lt;span class="nv"&gt;LIST&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="k"&gt;$(&lt;/span&gt;get_subnet_list&lt;span class="k"&gt;)&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;
    dialog --backtitle &lt;span class="s2"&gt;&amp;quot;Редактирование &lt;/span&gt;&lt;span class="nv"&gt;$file&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt; &lt;span class="se"&gt;\&lt;/span&gt;
        --cancel-label Exit &lt;span class="se"&gt;\&lt;/span&gt;
        --title &lt;span class="s2"&gt;&amp;quot;Редактирование &lt;/span&gt;&lt;span class="nv"&gt;$file&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt; --clear &lt;span class="se"&gt;\&lt;/span&gt;
        --radiolist &lt;span class="s2"&gt;&amp;quot;Выбор subnet&amp;quot;&lt;/span&gt; &lt;span class="m"&gt;20&lt;/span&gt; &lt;span class="m"&gt;61&lt;/span&gt; &lt;span class="m"&gt;10&lt;/span&gt; &lt;span class="se"&gt;\&lt;/span&gt;
        &lt;span class="nv"&gt;$LIST&lt;/span&gt; &lt;span class="m"&gt;2&lt;/span&gt;&amp;gt; &lt;span class="nv"&gt;$tempfile&lt;/span&gt;

    &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="o"&gt;[&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;$?&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt; -eq &lt;span class="m"&gt;0&lt;/span&gt; &lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="k"&gt;then&lt;/span&gt;
        &lt;span class="k"&gt;$(&lt;/span&gt;&lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;$LIST&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt; &lt;span class="p"&gt;|&lt;/span&gt; awk &lt;span class="s1"&gt;&amp;#39;{ if ($1==&amp;quot;&amp;#39;&lt;/span&gt;&lt;span class="k"&gt;$(&lt;/span&gt;cat &lt;span class="nv"&gt;$tempfile&lt;/span&gt;&lt;span class="k"&gt;)&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;&amp;quot;) { \&lt;/span&gt;
&lt;span class="s1"&gt;            sub(/0\/24$/,&amp;quot;&amp;quot;,$2); print &amp;quot;get_leases &amp;quot;$2 }}&amp;#39;&lt;/span&gt;&lt;span class="k"&gt;)&lt;/span&gt;
    &lt;span class="k"&gt;else&lt;/span&gt;
        break&lt;span class="p"&gt;;&lt;/span&gt;  &lt;span class="c1"&gt;# Выходим из while [true].&lt;/span&gt;
    &lt;span class="k"&gt;fi&lt;/span&gt;
&lt;span class="k"&gt;done&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;</content><category term="FreeBSD"></category><category term="isc-dhcpd"></category><category term="dhcp leases"></category></entry><entry><title>Windows 7 ошибочно полагает что нет доступа к internet или желтый восклицательный знак в трее</title><link href="https://metajiji.github.io/blog/windows-7-internet-connectivity/" rel="alternate"></link><published>2013-06-06T00:00:00+07:00</published><updated>2013-06-06T00:00:00+07:00</updated><author><name>Denis Kadyshev</name></author><id>tag:metajiji.github.io,2013-06-06:/blog/windows-7-internet-connectivity/</id><summary type="html">&lt;p&gt;После установки контент фильтра по статье &lt;a href="squid-rejik-ipcad-free-sa-nginx.html"&gt;Контент фильтр и статистика посещенных сайтов Squid + rejik + ipcad + Free-SA + nginx&lt;/a&gt; у пользователей &lt;strong&gt;Windows 7&lt;/strong&gt; возникли проблемы с сетевым апплетом в трее - он стал ошибочно показывать, что подключение к интернету отсутствует, хотя интернет работает.&lt;/p&gt;
&lt;p&gt;После недолгих поисков в интернете было найдено 2 решения.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href="http://technet.microsoft.com/ru-ru/library/ee126135%28v=ws.10%29.aspx" title="1"&gt;Первое …&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;</summary><content type="html">&lt;p&gt;После установки контент фильтра по статье &lt;a href="squid-rejik-ipcad-free-sa-nginx.html"&gt;Контент фильтр и статистика посещенных сайтов Squid + rejik + ipcad + Free-SA + nginx&lt;/a&gt; у пользователей &lt;strong&gt;Windows 7&lt;/strong&gt; возникли проблемы с сетевым апплетом в трее - он стал ошибочно показывать, что подключение к интернету отсутствует, хотя интернет работает.&lt;/p&gt;
&lt;p&gt;После недолгих поисков в интернете было найдено 2 решения.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href="http://technet.microsoft.com/ru-ru/library/ee126135%28v=ws.10%29.aspx" title="1"&gt;Первое [1]&lt;/a&gt; связано с разблокировкой сайта &lt;code&gt;msftncsi.com&lt;/code&gt;, который &lt;strong&gt;windows 7&lt;/strong&gt; проверяет на доступность и в случае,
 если она не смогла получить к этому сайту доступ - выдает пользователю, что интернета нет! :) А так же &lt;strong&gt;Windows 7&lt;/strong&gt; проверяет резолв доменого имени &lt;code&gt;dns.msftncsi.com&lt;/code&gt; - оно должно быть 
&lt;code&gt;131.107.255.255&lt;/code&gt;. Хоть и &lt;a href="http://technet.microsoft.com/ru-ru/library/ee126135%28v=ws.10%29.aspx" title="1"&gt;пишут в [1]&lt;/a&gt;, что &lt;strong&gt;Windows 7&lt;/strong&gt; проверяет оба варианта и, если хотябы один из них пройдет проверку, то &lt;strong&gt;Windows 7&lt;/strong&gt; определит, что интернет есть,
 но у меня это на всех машинах не работало, пока не занес адрес &lt;code&gt;msftncsi.com&lt;/code&gt; в список исключений на &lt;strong&gt;Rejik&lt;/strong&gt;'e.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Для любителей поковырять и оптимизировать свою ОС в интернете предлагается &lt;a href="http://did5.ru/it/windows/kak-ubrat-vosklicatelnyj-znak-so-znachka-podklyucheniya-k-seti-v-tree-v-windows-7.html" title="2"&gt;[2 вариант]&lt;/a&gt; - отключить в самой ОС проверки интернета и апплет всегда будет считать, что интернет есть.&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;p&gt;Ссылки по теме:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href="http://technet.microsoft.com/ru-ru/library/ee126135%28v=ws.10%29.aspx" title="1"&gt;Appendix H: Network Connectivity Status Indicator and Resulting Internet Communication in Windows 7 and Windows Server 2008 R2&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://did5.ru/it/windows/kak-ubrat-vosklicatelnyj-znak-so-znachka-podklyucheniya-k-seti-v-tree-v-windows-7.html" title="2"&gt;Как убрать восклицательный знак со значка подключения к сети в трее в Windows 7&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://www.msftncsi.com/ncsi.txt"&gt;http://www.msftncsi.com/ncsi.txt&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;</content><category term="Windows"></category><category term="internet connectivity"></category><category term="error"></category></entry><entry><title>Hex to string cmd, bat "function"</title><link href="https://metajiji.github.io/blog/hex-to-string-cmd-bat-function/" rel="alternate"></link><published>2013-05-11T00:00:00+07:00</published><updated>2013-05-11T00:00:00+07:00</updated><author><name>Denis Kadyshev</name></author><id>tag:metajiji.github.io,2013-05-11:/blog/hex-to-string-cmd-bat-function/</id><summary type="html">&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="p"&gt;@&lt;/span&gt;&lt;span class="k"&gt;ECHO&lt;/span&gt; OFF

&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="c1"&gt;: Включение расширенной обработки команд.&lt;/span&gt;
&lt;span class="k"&gt;SETLOCAL&lt;/span&gt; ENABLEEXTENSIONS ENABLEDELAYEDEXPANSION

&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="c1"&gt;: Строка в hex - в данном случае dlink.&lt;/span&gt;
&lt;span class="k"&gt;SET&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;x16=646c696e6b&amp;quot;&lt;/span&gt;
&lt;span class="k"&gt;CALL&lt;/span&gt; &lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="nl"&gt;Hex_To_String&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;%x16%&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt; str
&lt;span class="k"&gt;ECHO&lt;/span&gt;.&lt;span class="nv"&gt;%str%&lt;/span&gt;

&lt;span class="k"&gt;PAUSE&lt;/span&gt;
&lt;span class="k"&gt;EXIT&lt;/span&gt;

&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="nl"&gt;Hex_To_String&lt;/span&gt;
&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="c1"&gt;: Вызывать так: CALL :Hex_To_String %hex_x16_string% value_name&lt;/span&gt;
&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="c1"&gt;: Где %hex_x16_string% - строка в 16-ричном hex формате&lt;/span&gt;
&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="c1"&gt;: value_name - имя переменной, в которую вернуть значение вычисленной строки …&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;</summary><content type="html">&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="p"&gt;@&lt;/span&gt;&lt;span class="k"&gt;ECHO&lt;/span&gt; OFF

&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="c1"&gt;: Включение расширенной обработки команд.&lt;/span&gt;
&lt;span class="k"&gt;SETLOCAL&lt;/span&gt; ENABLEEXTENSIONS ENABLEDELAYEDEXPANSION

&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="c1"&gt;: Строка в hex - в данном случае dlink.&lt;/span&gt;
&lt;span class="k"&gt;SET&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;x16=646c696e6b&amp;quot;&lt;/span&gt;
&lt;span class="k"&gt;CALL&lt;/span&gt; &lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="nl"&gt;Hex_To_String&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;%x16%&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt; str
&lt;span class="k"&gt;ECHO&lt;/span&gt;.&lt;span class="nv"&gt;%str%&lt;/span&gt;

&lt;span class="k"&gt;PAUSE&lt;/span&gt;
&lt;span class="k"&gt;EXIT&lt;/span&gt;

&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="nl"&gt;Hex_To_String&lt;/span&gt;
&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="c1"&gt;: Вызывать так: CALL :Hex_To_String %hex_x16_string% value_name&lt;/span&gt;
&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="c1"&gt;: Где %hex_x16_string% - строка в 16-ричном hex формате&lt;/span&gt;
&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="c1"&gt;: value_name - имя переменной, в которую вернуть значение вычисленной строки.&lt;/span&gt;
    &lt;span class="k"&gt;SETLOCAL&lt;/span&gt; &lt;span class="p"&gt;&amp;amp;&lt;/span&gt; &lt;span class="k"&gt;SET&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;x16=&lt;/span&gt;&lt;span class="nv"&gt;%~1&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;
    &lt;span class="k"&gt;SET&lt;/span&gt; &lt;span class="nv"&gt;n&lt;/span&gt;&lt;span class="p"&gt;=&lt;/span&gt;45
    &lt;span class="k"&gt;FOR&lt;/span&gt; &lt;span class="se"&gt;%%&lt;/span&gt;A &lt;span class="k"&gt;IN&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;- . / 0 1 2 3 4 5 6 7 8 9&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="k"&gt;DO&lt;/span&gt; &lt;span class="k"&gt;SET&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;s.!n!=&lt;/span&gt;&lt;span class="se"&gt;%%&lt;/span&gt;&lt;span class="s2"&gt;A&amp;quot;&lt;/span&gt; &lt;span class="p"&gt;&amp;amp;&lt;/span&gt; &lt;span class="k"&gt;SET&lt;/span&gt; &lt;span class="k"&gt;/A&lt;/span&gt; &lt;span class="nv"&gt;n&lt;/span&gt;&lt;span class="o"&gt;+=&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;
    &lt;span class="k"&gt;SET&lt;/span&gt; &lt;span class="nv"&gt;n&lt;/span&gt;&lt;span class="p"&gt;=&lt;/span&gt;65
    &lt;span class="k"&gt;FOR&lt;/span&gt; &lt;span class="se"&gt;%%&lt;/span&gt;A &lt;span class="k"&gt;IN&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;A B C D E F G H I J K L M N O P Q R S T U V W X Y Z&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="k"&gt;DO&lt;/span&gt; &lt;span class="k"&gt;SET&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;s.!n!=&lt;/span&gt;&lt;span class="se"&gt;%%&lt;/span&gt;&lt;span class="s2"&gt;A&amp;quot;&lt;/span&gt; &lt;span class="p"&gt;&amp;amp;&lt;/span&gt; &lt;span class="k"&gt;SET&lt;/span&gt; &lt;span class="k"&gt;/A&lt;/span&gt; &lt;span class="nv"&gt;n&lt;/span&gt;&lt;span class="o"&gt;+=&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;
    &lt;span class="k"&gt;SET&lt;/span&gt; &lt;span class="nv"&gt;n&lt;/span&gt;&lt;span class="p"&gt;=&lt;/span&gt;97
    &lt;span class="k"&gt;FOR&lt;/span&gt; &lt;span class="se"&gt;%%&lt;/span&gt;A &lt;span class="k"&gt;IN&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;a b c d e f g h i j k l m n o p q r s t u v w x y z&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="k"&gt;DO&lt;/span&gt; &lt;span class="k"&gt;SET&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;s.!n!=&lt;/span&gt;&lt;span class="se"&gt;%%&lt;/span&gt;&lt;span class="s2"&gt;A&amp;quot;&lt;/span&gt; &lt;span class="p"&gt;&amp;amp;&lt;/span&gt; &lt;span class="k"&gt;SET&lt;/span&gt; &lt;span class="k"&gt;/A&lt;/span&gt; &lt;span class="nv"&gt;n&lt;/span&gt;&lt;span class="o"&gt;+=&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;
    &lt;span class="k"&gt;SET&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;xs=&amp;quot;&lt;/span&gt;
    &lt;span class="k"&gt;FOR&lt;/span&gt; &lt;span class="k"&gt;/L&lt;/span&gt; &lt;span class="se"&gt;%%&lt;/span&gt;C &lt;span class="k"&gt;IN&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;,&lt;span class="mi"&gt;2&lt;/span&gt;,&lt;span class="mi"&gt;8184&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="k"&gt;DO&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;
        &lt;span class="k"&gt;IF&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;!x16:~&lt;/span&gt;&lt;span class="se"&gt;%%&lt;/span&gt;&lt;span class="s2"&gt;C,1!&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;==&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&amp;quot;&lt;/span&gt; &lt;span class="k"&gt;GOTO&lt;/span&gt; &lt;span class="nl"&gt;_ex_Hex&lt;/span&gt;&lt;span class="c1"&gt; str&lt;/span&gt;
        &lt;span class="k"&gt;SET&lt;/span&gt; &lt;span class="k"&gt;/A&lt;/span&gt; &lt;span class="nv"&gt;x10&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="nv"&gt;x&lt;/span&gt;&lt;span class="o"&gt;!&lt;/span&gt;&lt;span class="nv"&gt;x16:&lt;/span&gt;&lt;span class="o"&gt;~%%&lt;/span&gt;&lt;span class="nv"&gt;C&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="o"&gt;!&lt;/span&gt;
        &lt;span class="k"&gt;CALL&lt;/span&gt; &lt;span class="k"&gt;SET&lt;/span&gt; &lt;span class="nv"&gt;xs&lt;/span&gt;&lt;span class="p"&gt;=&lt;/span&gt;&lt;span class="nv"&gt;!xs!&lt;/span&gt;&lt;span class="se"&gt;%%&lt;/span&gt;s.!x10!&lt;span class="se"&gt;%%&lt;/span&gt;
    &lt;span class="p"&gt;)&lt;/span&gt;

&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="nl"&gt;_ex_Hex&lt;/span&gt;
    &lt;span class="k"&gt;ENDLOCAL&lt;/span&gt; &lt;span class="p"&gt;&amp;amp;&lt;/span&gt; &lt;span class="k"&gt;SET&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;%~2&lt;/span&gt;&lt;span class="s2"&gt;=&lt;/span&gt;&lt;span class="nv"&gt;%xs%&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;
&lt;span class="k"&gt;GOTO&lt;/span&gt; &lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="nl"&gt;EOF&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;hr&gt;
&lt;p&gt;Ссылки по теме:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href="http://forum.script-coding.com/viewtopic.php?id=6978"&gt;CMD/BAT: hex дампер&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://www.cyberforum.ru/cmd-bat/thread671391-page4.html"&gt;Полезные BAT/CMD скрипты&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://www.string-functions.com/hex-string.aspx"&gt;Hex to string converter Online&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://www.string-functions.com/string-hex.aspx"&gt;String to hex converter Online&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;</content><category term="Windows"></category><category term="bat"></category><category term="cmd"></category><category term="hex to string"></category><category term="hex"></category><category term="string"></category></entry><entry><title>Создание ярлыка .url в Windows из cmd\bat</title><link href="https://metajiji.github.io/blog/create-shorcut-cmd-bat-in-windows/" rel="alternate"></link><published>2013-04-09T00:00:00+07:00</published><updated>2013-04-09T00:00:00+07:00</updated><author><name>Denis Kadyshev</name></author><id>tag:metajiji.github.io,2013-04-09:/blog/create-shorcut-cmd-bat-in-windows/</id><summary type="html">&lt;p&gt;Для создания ярлыка в &lt;strong&gt;Windows&lt;/strong&gt; на сетевую папку использую такой &lt;code&gt;bat&lt;/code&gt; скрипт:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="p"&gt;@&lt;/span&gt;&lt;span class="k"&gt;ECHO&lt;/span&gt; OFF

&lt;span class="k"&gt;SET&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;PATH_TO_URL=Server.url&amp;quot;&lt;/span&gt;

&lt;span class="p"&gt;(&lt;/span&gt;
    &lt;span class="k"&gt;ECHO&lt;/span&gt;.[InternetShortcut]
    &lt;span class="k"&gt;ECHO&lt;/span&gt;.URL=file://server/
    &lt;span class="k"&gt;ECHO&lt;/span&gt;.IconFile=&lt;span class="nv"&gt;%windir%&lt;/span&gt;\system32\SHELL32.dll
    &lt;span class="k"&gt;ECHO&lt;/span&gt;.IconIndex=17
&lt;span class="p"&gt;)&amp;gt;&lt;/span&gt;&lt;span class="nv"&gt;%PATH_TO_URL%&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;hr&gt;
&lt;p&gt;Ссылки по теме:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href="http://forum.oszone.net/post-2150529.html"&gt;forum.oszone.net: CMD/BAT - создать ярлык&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;</summary><content type="html">&lt;p&gt;Для создания ярлыка в &lt;strong&gt;Windows&lt;/strong&gt; на сетевую папку использую такой &lt;code&gt;bat&lt;/code&gt; скрипт:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="p"&gt;@&lt;/span&gt;&lt;span class="k"&gt;ECHO&lt;/span&gt; OFF

&lt;span class="k"&gt;SET&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;PATH_TO_URL=Server.url&amp;quot;&lt;/span&gt;

&lt;span class="p"&gt;(&lt;/span&gt;
    &lt;span class="k"&gt;ECHO&lt;/span&gt;.[InternetShortcut]
    &lt;span class="k"&gt;ECHO&lt;/span&gt;.URL=file://server/
    &lt;span class="k"&gt;ECHO&lt;/span&gt;.IconFile=&lt;span class="nv"&gt;%windir%&lt;/span&gt;\system32\SHELL32.dll
    &lt;span class="k"&gt;ECHO&lt;/span&gt;.IconIndex=17
&lt;span class="p"&gt;)&amp;gt;&lt;/span&gt;&lt;span class="nv"&gt;%PATH_TO_URL%&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;hr&gt;
&lt;p&gt;Ссылки по теме:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href="http://forum.oszone.net/post-2150529.html"&gt;forum.oszone.net: CMD/BAT - создать ярлык&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;</content><category term="cmd"></category><category term="bat"></category><category term="url file"></category><category term="shortcut"></category></entry><entry><title>Ротация логов named Bind и newsyslog</title><link href="https://metajiji.github.io/blog/log-rotation-named-bind/" rel="alternate"></link><published>2013-04-09T00:00:00+07:00</published><updated>2013-04-09T00:00:00+07:00</updated><author><name>Denis Kadyshev</name></author><id>tag:metajiji.github.io,2013-04-09:/blog/log-rotation-named-bind/</id><summary type="html">&lt;p&gt;Ротация логов bind средствами самого bind, создаем конфиг:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;logging &lt;span class="o"&gt;{&lt;/span&gt;
        channel update_debug &lt;span class="o"&gt;{&lt;/span&gt;
                file &lt;span class="s2"&gt;&amp;quot;/var/log/named-update.log&amp;quot;&lt;/span&gt; versions &lt;span class="m"&gt;6&lt;/span&gt; size 512K&lt;span class="p"&gt;;&lt;/span&gt;
                severity        debug &lt;span class="m"&gt;3&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
                print-category  yes&lt;span class="p"&gt;;&lt;/span&gt;
                print-severity  yes&lt;span class="p"&gt;;&lt;/span&gt;
                print-time      yes&lt;span class="p"&gt;;&lt;/span&gt;
        &lt;span class="o"&gt;}&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
        channel security_info &lt;span class="o"&gt;{&lt;/span&gt;
                file &lt;span class="s2"&gt;&amp;quot;/var/log/named-auth.log&amp;quot;&lt;/span&gt; versions &lt;span class="m"&gt;6&lt;/span&gt; size 512K&lt;span class="p"&gt;;&lt;/span&gt;
                severity        info&lt;span class="p"&gt;;&lt;/span&gt;
                print-category  yes&lt;span class="p"&gt;;&lt;/span&gt;
                print-severity  yes&lt;span class="p"&gt;;&lt;/span&gt;
                print-time      yes&lt;span class="p"&gt;;&lt;/span&gt;
        &lt;span class="o"&gt;}&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="c1"&gt;#       channel queries …&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;</summary><content type="html">&lt;p&gt;Ротация логов bind средствами самого bind, создаем конфиг:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;logging &lt;span class="o"&gt;{&lt;/span&gt;
        channel update_debug &lt;span class="o"&gt;{&lt;/span&gt;
                file &lt;span class="s2"&gt;&amp;quot;/var/log/named-update.log&amp;quot;&lt;/span&gt; versions &lt;span class="m"&gt;6&lt;/span&gt; size 512K&lt;span class="p"&gt;;&lt;/span&gt;
                severity        debug &lt;span class="m"&gt;3&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
                print-category  yes&lt;span class="p"&gt;;&lt;/span&gt;
                print-severity  yes&lt;span class="p"&gt;;&lt;/span&gt;
                print-time      yes&lt;span class="p"&gt;;&lt;/span&gt;
        &lt;span class="o"&gt;}&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
        channel security_info &lt;span class="o"&gt;{&lt;/span&gt;
                file &lt;span class="s2"&gt;&amp;quot;/var/log/named-auth.log&amp;quot;&lt;/span&gt; versions &lt;span class="m"&gt;6&lt;/span&gt; size 512K&lt;span class="p"&gt;;&lt;/span&gt;
                severity        info&lt;span class="p"&gt;;&lt;/span&gt;
                print-category  yes&lt;span class="p"&gt;;&lt;/span&gt;
                print-severity  yes&lt;span class="p"&gt;;&lt;/span&gt;
                print-time      yes&lt;span class="p"&gt;;&lt;/span&gt;
        &lt;span class="o"&gt;}&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="c1"&gt;#       channel queries {&lt;/span&gt;
&lt;span class="c1"&gt;#               file &amp;quot;/var/log/queries&amp;quot; versions 6 size 10m;&lt;/span&gt;
&lt;span class="c1"&gt;#               print-time      yes;&lt;/span&gt;
&lt;span class="c1"&gt;#               print-category  yes;&lt;/span&gt;
&lt;span class="c1"&gt;#               print-severity  yes;&lt;/span&gt;
&lt;span class="c1"&gt;#       };&lt;/span&gt;

&lt;span class="c1"&gt;#       category queries { queries; };&lt;/span&gt;
        category update &lt;span class="o"&gt;{&lt;/span&gt; update_debug&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="o"&gt;}&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
        category security &lt;span class="o"&gt;{&lt;/span&gt; security_info&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="o"&gt;}&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="o"&gt;}&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Обратите внимание на опцию:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;file &lt;span class="s2"&gt;&amp;quot;/var/log/named-update.log&amp;quot;&lt;/span&gt; versions &lt;span class="m"&gt;6&lt;/span&gt; size 512K&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Директива &lt;code&gt;file&lt;/code&gt; указывает на файл, куда нужно писать логи, а опция &lt;code&gt;versions&lt;/code&gt; задает количество лог-файлов, &lt;code&gt;size&lt;/code&gt; задает размер лог файла, при достижении которого нужно произвести ротацию.&lt;/p&gt;
&lt;p&gt;И подключаем в &lt;code&gt;named.conf&lt;/code&gt;&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;include &lt;span class="s2"&gt;&amp;quot;/etc/namedb/log.conf&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;&lt;strong&gt;! ! ВАЖНО ! ! !&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Не используйте &lt;code&gt;newsyslog&lt;/code&gt; для ротации логов &lt;code&gt;bind&lt;/code&gt;, т.к. он не поддерживает переоткрытие лог-файла, а после того как &lt;code&gt;newsyslog&lt;/code&gt; произведет ротацию и создаст новый файл &lt;code&gt;bind&lt;/code&gt;
 потеряет дескриптор (inode) прежнего лог-файла и перестанет писать логи, мало того &lt;code&gt;bind&lt;/code&gt; перестанет еще и обновлять &lt;code&gt;ddns&lt;/code&gt; зону!
 Поэтому разумнее использовать либо встроенные средства ротации логов, либо перенаправить логи в &lt;code&gt;syslog&lt;/code&gt;.&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;Ссылки по теме:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href="http://h30097.www3.hp.com/docs/base_doc/DOCUMENTATION/V50_HTML/SUPPDOCS/BIND_GDE/LOGGING.HTM"&gt;BIND Configuration File Guide - logging Statement&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://www.bog.pp.ru/work/bind.html"&gt;Bog BOS: DNS сервер BIND&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;</content><category term="Linux"></category><category term="FreeBSD"></category><category term="named"></category><category term="bind"></category><category term="logging"></category><category term="log rotation"></category><category term="newsyslog"></category></entry><entry><title>Скрипт для пакетного конвертирования из wav в alaw, ulaw, gsm через sox.</title><link href="https://metajiji.github.io/blog/asterisk-wav-to-alaw-ulaw-gsm-sox/" rel="alternate"></link><published>2013-03-22T00:00:00+07:00</published><updated>2013-03-22T00:00:00+07:00</updated><author><name>Denis Kadyshev</name></author><id>tag:metajiji.github.io,2013-03-22:/blog/asterisk-wav-to-alaw-ulaw-gsm-sox/</id><summary type="html">&lt;p&gt;Скрипт для пакетного конвертирования из &lt;code&gt;wav&lt;/code&gt; в &lt;code&gt;alaw&lt;/code&gt;, &lt;code&gt;ulaw&lt;/code&gt;, &lt;code&gt;gsm&lt;/code&gt;.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="ch"&gt;#!/bin/sh&lt;/span&gt;

&lt;span class="nv"&gt;IN&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;IN&amp;#39;&lt;/span&gt;  &lt;span class="c1"&gt;# Входная папка.&lt;/span&gt;
&lt;span class="nv"&gt;OUT&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;OUT&amp;#39;&lt;/span&gt;  &lt;span class="c1"&gt;# Выходная папка.&lt;/span&gt;

&lt;span class="o"&gt;[&lt;/span&gt; ! -d &lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;$IN&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt; &lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt; mkdir -v &lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;$IN&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Create dir: &lt;/span&gt;&lt;span class="nv"&gt;$IN&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;  &lt;span class="c1"&gt;# Создаем папку для входных файлов.&lt;/span&gt;
&lt;span class="c1"&gt;#[ -d &amp;quot;$OUT&amp;quot; ] &amp;amp;&amp;amp; rm -vrf &amp;quot;$OUT&amp;quot; &amp;amp;&amp;amp; echo &amp;quot;Delete dir: $OUT&amp;quot;  # Чистим папку OUT.&lt;/span&gt;
&lt;span class="o"&gt;[&lt;/span&gt; ! -d &lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;$OUT&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt; &lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt; mkdir -v …&lt;/pre&gt;&lt;/div&gt;</summary><content type="html">&lt;p&gt;Скрипт для пакетного конвертирования из &lt;code&gt;wav&lt;/code&gt; в &lt;code&gt;alaw&lt;/code&gt;, &lt;code&gt;ulaw&lt;/code&gt;, &lt;code&gt;gsm&lt;/code&gt;.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="ch"&gt;#!/bin/sh&lt;/span&gt;

&lt;span class="nv"&gt;IN&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;IN&amp;#39;&lt;/span&gt;  &lt;span class="c1"&gt;# Входная папка.&lt;/span&gt;
&lt;span class="nv"&gt;OUT&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;OUT&amp;#39;&lt;/span&gt;  &lt;span class="c1"&gt;# Выходная папка.&lt;/span&gt;

&lt;span class="o"&gt;[&lt;/span&gt; ! -d &lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;$IN&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt; &lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt; mkdir -v &lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;$IN&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Create dir: &lt;/span&gt;&lt;span class="nv"&gt;$IN&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;  &lt;span class="c1"&gt;# Создаем папку для входных файлов.&lt;/span&gt;
&lt;span class="c1"&gt;#[ -d &amp;quot;$OUT&amp;quot; ] &amp;amp;&amp;amp; rm -vrf &amp;quot;$OUT&amp;quot; &amp;amp;&amp;amp; echo &amp;quot;Delete dir: $OUT&amp;quot;  # Чистим папку OUT.&lt;/span&gt;
&lt;span class="o"&gt;[&lt;/span&gt; ! -d &lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;$OUT&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt; &lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt; mkdir -v &lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;$OUT&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Create dir: &lt;/span&gt;&lt;span class="nv"&gt;$OUT&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;  &lt;span class="c1"&gt;# Создаем папку для выходных файлов.&lt;/span&gt;
&lt;span class="o"&gt;[&lt;/span&gt; -d &lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;$OUT&lt;/span&gt;&lt;span class="s2"&gt;/wav&amp;quot;&lt;/span&gt; &lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt; rm -vrf &lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;$OUT&lt;/span&gt;&lt;span class="s2"&gt;/wav&amp;quot;&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Delete dir: &lt;/span&gt;&lt;span class="nv"&gt;$OUT&lt;/span&gt;&lt;span class="s2"&gt;/wav&amp;quot;&lt;/span&gt;  &lt;span class="c1"&gt;# Чистим папку для wav файлов.&lt;/span&gt;
&lt;span class="o"&gt;[&lt;/span&gt; ! -d &lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;$OUT&lt;/span&gt;&lt;span class="s2"&gt;/wav&amp;quot;&lt;/span&gt; &lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt; mkdir -v &lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;$OUT&lt;/span&gt;&lt;span class="s2"&gt;/wav&amp;quot;&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Create dir: &lt;/span&gt;&lt;span class="nv"&gt;$OUT&lt;/span&gt;&lt;span class="s2"&gt;/wav&amp;quot;&lt;/span&gt;  &lt;span class="c1"&gt;# Создаем папку для wav файлов.&lt;/span&gt;

convert_to&lt;span class="o"&gt;()&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt;
    &lt;span class="c1"&gt;#$1 - Output format file.&lt;/span&gt;
    &lt;span class="c1"&gt;#$2 - IN file.&lt;/span&gt;

    &lt;span class="o"&gt;[&lt;/span&gt; -z &lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;$1&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt; &lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;ERROR: $1 is empty!&amp;#39;&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class="nb"&gt;exit&lt;/span&gt; &lt;span class="m"&gt;1&lt;/span&gt;
    &lt;span class="o"&gt;[&lt;/span&gt; -z &lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;$2&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt; &lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;ERROR: $2 is empty!&amp;#39;&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class="nb"&gt;exit&lt;/span&gt; &lt;span class="m"&gt;1&lt;/span&gt;

    &lt;span class="k"&gt;case&lt;/span&gt; &lt;span class="nv"&gt;$1&lt;/span&gt; in
        alaw&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="nv"&gt;SOX_OPT&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;-t al&amp;#39;&lt;/span&gt; &lt;span class="p"&gt;;;&lt;/span&gt;
        ulaw&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="nv"&gt;SOX_OPT&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;-t ul&amp;#39;&lt;/span&gt; &lt;span class="p"&gt;;;&lt;/span&gt;
        gsm&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="nv"&gt;SOX_OPT&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;&amp;#39;&lt;/span&gt; &lt;span class="p"&gt;;;&lt;/span&gt;
        *&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;ERROR: fromat &lt;/span&gt;&lt;span class="nv"&gt;$1&lt;/span&gt;&lt;span class="s2"&gt; is not supported!&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="nb"&gt;exit&lt;/span&gt; &lt;span class="m"&gt;1&lt;/span&gt; &lt;span class="p"&gt;;;&lt;/span&gt;
    &lt;span class="k"&gt;esac&lt;/span&gt;

    &lt;span class="c1"&gt;# Если нужные директории не существуют, то создаем их.&lt;/span&gt;
    &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="o"&gt;[&lt;/span&gt; ! -d &lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;$OUT&lt;/span&gt;&lt;span class="s2"&gt;/wav&lt;/span&gt;&lt;span class="nv"&gt;$D_OUT&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt; &lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="k"&gt;then&lt;/span&gt;
        &lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Create dir: &lt;/span&gt;&lt;span class="nv"&gt;$D_IN&lt;/span&gt;&lt;span class="s2"&gt; -&amp;gt; &lt;/span&gt;&lt;span class="nv"&gt;$OUT&lt;/span&gt;&lt;span class="s2"&gt;/wav&lt;/span&gt;&lt;span class="nv"&gt;$D_OUT&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
        mkdir -vp &lt;span class="nv"&gt;$OUT&lt;/span&gt;/wav&lt;span class="nv"&gt;$D_OUT&lt;/span&gt;
        &lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;------------------------&amp;#39;&lt;/span&gt;
    &lt;span class="k"&gt;fi&lt;/span&gt;

    &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="o"&gt;[&lt;/span&gt; ! -d &lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;$OUT&lt;/span&gt;&lt;span class="s2"&gt;/&lt;/span&gt;&lt;span class="nv"&gt;$1$D_OUT&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt; &lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="k"&gt;then&lt;/span&gt;
        &lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Create dir: &lt;/span&gt;&lt;span class="nv"&gt;$D_IN&lt;/span&gt;&lt;span class="s2"&gt; -&amp;gt; &lt;/span&gt;&lt;span class="nv"&gt;$OUT&lt;/span&gt;&lt;span class="s2"&gt;/&lt;/span&gt;&lt;span class="nv"&gt;$1$D_OUT&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
        mkdir -vp &lt;span class="nv"&gt;$OUT&lt;/span&gt;/&lt;span class="nv"&gt;$1$D_OUT&lt;/span&gt;
        &lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;------------------------&amp;#39;&lt;/span&gt;
    &lt;span class="k"&gt;fi&lt;/span&gt;

    &lt;span class="nv"&gt;F_OUT&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="k"&gt;$(&lt;/span&gt;basename &lt;span class="nv"&gt;$2&lt;/span&gt; .wav&lt;span class="k"&gt;)&lt;/span&gt;
    &lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Processing: &lt;/span&gt;&lt;span class="nv"&gt;$2&lt;/span&gt;&lt;span class="s2"&gt; -&amp;gt; &lt;/span&gt;&lt;span class="nv"&gt;$OUT&lt;/span&gt;&lt;span class="s2"&gt;/&lt;/span&gt;&lt;span class="nv"&gt;$1$D_OUT&lt;/span&gt;&lt;span class="s2"&gt;/&lt;/span&gt;&lt;span class="nv"&gt;$F_OUT&lt;/span&gt;&lt;span class="s2"&gt;.&lt;/span&gt;&lt;span class="nv"&gt;$1&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;

    &lt;span class="c1"&gt;# Проверим, существует ли входной файл.&lt;/span&gt;
    &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="o"&gt;[&lt;/span&gt; -f &lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;$2&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt; &lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="k"&gt;then&lt;/span&gt;
        &lt;span class="c1"&gt;# Если нету wav, то для начала сконвертим в wav.&lt;/span&gt;
        &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="o"&gt;[&lt;/span&gt; ! -f &lt;span class="nv"&gt;$OUT&lt;/span&gt;/wav&lt;span class="nv"&gt;$D_OUT&lt;/span&gt;/&lt;span class="nv"&gt;$F_OUT&lt;/span&gt;.wav &lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="k"&gt;then&lt;/span&gt;
            &lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;Convert to 8bit wav first at 8000Hz - this can take a while...&amp;#39;&lt;/span&gt;
            sox &lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;$2&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt; -r &lt;span class="m"&gt;8000&lt;/span&gt; -c1 &lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;$OUT&lt;/span&gt;&lt;span class="s2"&gt;/wav&lt;/span&gt;&lt;span class="nv"&gt;$D_OUT&lt;/span&gt;&lt;span class="s2"&gt;/&lt;/span&gt;&lt;span class="nv"&gt;$F_OUT&lt;/span&gt;&lt;span class="s2"&gt;.wav&amp;quot;&lt;/span&gt;
        &lt;span class="k"&gt;fi&lt;/span&gt;

        &lt;span class="c1"&gt;#Проверяем имеется ли входной wav файл.&lt;/span&gt;
        &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="o"&gt;[&lt;/span&gt; -f &lt;span class="nv"&gt;$OUT&lt;/span&gt;/wav&lt;span class="nv"&gt;$D_OUT&lt;/span&gt;/&lt;span class="nv"&gt;$F_OUT&lt;/span&gt;.wav &lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="k"&gt;then&lt;/span&gt;
            &lt;span class="c1"&gt;# Если файл в нужном формате $1 уже существует, то сперва удаляем его, потом конвертим&lt;/span&gt;
            &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="o"&gt;[&lt;/span&gt; -f &lt;span class="nv"&gt;$OUT&lt;/span&gt;/&lt;span class="nv"&gt;$1$D_OUT&lt;/span&gt;/&lt;span class="nv"&gt;$F_OUT&lt;/span&gt;.&lt;span class="nv"&gt;$1&lt;/span&gt; &lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="k"&gt;then&lt;/span&gt;
                &lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;INFO: File exist! &lt;/span&gt;&lt;span class="nv"&gt;$OUT&lt;/span&gt;&lt;span class="s2"&gt;/&lt;/span&gt;&lt;span class="nv"&gt;$1$D_OUT&lt;/span&gt;&lt;span class="s2"&gt;/&lt;/span&gt;&lt;span class="nv"&gt;$F_OUT&lt;/span&gt;&lt;span class="s2"&gt;.&lt;/span&gt;&lt;span class="nv"&gt;$1&lt;/span&gt;&lt;span class="s2"&gt; remove...&amp;quot;&lt;/span&gt;
                rm -vf &lt;span class="nv"&gt;$OUT&lt;/span&gt;/&lt;span class="nv"&gt;$1$D_OUT&lt;/span&gt;/&lt;span class="nv"&gt;$F_OUT&lt;/span&gt;.&lt;span class="nv"&gt;$1&lt;/span&gt;
            &lt;span class="k"&gt;fi&lt;/span&gt;
            sox &lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;$OUT&lt;/span&gt;&lt;span class="s2"&gt;/wav&lt;/span&gt;&lt;span class="nv"&gt;$D_OUT&lt;/span&gt;&lt;span class="s2"&gt;/&lt;/span&gt;&lt;span class="nv"&gt;$F_OUT&lt;/span&gt;&lt;span class="s2"&gt;.wav&amp;quot;&lt;/span&gt; &lt;span class="nv"&gt;$SOX_OPT&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;$OUT&lt;/span&gt;&lt;span class="s2"&gt;/&lt;/span&gt;&lt;span class="nv"&gt;$1$D_OUT&lt;/span&gt;&lt;span class="s2"&gt;/&lt;/span&gt;&lt;span class="nv"&gt;$F_OUT&lt;/span&gt;&lt;span class="s2"&gt;.&lt;/span&gt;&lt;span class="nv"&gt;$1&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;
        &lt;span class="k"&gt;else&lt;/span&gt;
            &lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;ERROR: Input wav file &lt;/span&gt;&lt;span class="nv"&gt;$OUT&lt;/span&gt;&lt;span class="s2"&gt;/wav&lt;/span&gt;&lt;span class="nv"&gt;$D_OUT&lt;/span&gt;&lt;span class="s2"&gt;/&lt;/span&gt;&lt;span class="nv"&gt;$F_OUT&lt;/span&gt;&lt;span class="s2"&gt;.wav is not exist!&amp;quot;&lt;/span&gt;
            &lt;span class="nb"&gt;exit&lt;/span&gt; &lt;span class="m"&gt;1&lt;/span&gt;
        &lt;span class="k"&gt;fi&lt;/span&gt;
    &lt;span class="k"&gt;else&lt;/span&gt;
        &lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;ERROR: Input file &lt;/span&gt;&lt;span class="nv"&gt;$2&lt;/span&gt;&lt;span class="s2"&gt; not exists!&amp;quot;&lt;/span&gt;
    &lt;span class="k"&gt;fi&lt;/span&gt;
&lt;span class="o"&gt;}&lt;/span&gt;

find &lt;span class="nv"&gt;$IN&lt;/span&gt; -type d -depth -print &lt;span class="p"&gt;|&lt;/span&gt; &lt;span class="k"&gt;while&lt;/span&gt; &lt;span class="nb"&gt;read&lt;/span&gt; D_IN&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt; &lt;span class="c1"&gt;# ищем сперва самые &amp;quot;глубокие Директории&amp;quot;&lt;/span&gt;
    &lt;span class="nv"&gt;D_OUT&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="k"&gt;$(&lt;/span&gt;&lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;$D_IN&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt; &lt;span class="p"&gt;|&lt;/span&gt; sed -e &lt;span class="s1"&gt;&amp;#39;s/&amp;#39;&lt;/span&gt;&lt;span class="nv"&gt;$IN&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;//&amp;#39;&lt;/span&gt;&lt;span class="k"&gt;)&lt;/span&gt; &lt;span class="c1"&gt;# Получаем имя выходного каталога.&lt;/span&gt;

    &lt;span class="c1"&gt;# Ищем во входном каталоге wav файлы.&lt;/span&gt;
    find &lt;span class="nv"&gt;$D_IN&lt;/span&gt; -type f -name &lt;span class="s2"&gt;&amp;quot;*.wav&amp;quot;&lt;/span&gt; -print -maxdepth &lt;span class="m"&gt;1&lt;/span&gt; &lt;span class="p"&gt;|&lt;/span&gt; &lt;span class="k"&gt;while&lt;/span&gt; &lt;span class="nb"&gt;read&lt;/span&gt; file&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;
        convert_to alaw &lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;$file&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;
        convert_to ulaw &lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;$file&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;
        convert_to gsm &lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;$file&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;
    &lt;span class="k"&gt;done&lt;/span&gt;
&lt;span class="k"&gt;done&lt;/span&gt;

&lt;span class="c1"&gt;# TIP - Увеличение громкости&lt;/span&gt;
&lt;span class="c1"&gt;#sox file1.wav -v 5 file2.wav&lt;/span&gt;
&lt;span class="c1"&gt;#ffmpeg myfile.wav $i -vol 256 -acodec pcm_s16le -ar 8000 -ac 1 -y filename_out&amp;quot;${i%wav}wav&amp;quot; -vol volume change audio volume (256=normal)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;</content><category term="FreeBSD"></category><category term="Asterisk"></category><category term="wav to alaw ulaw gsm sox"></category></entry><entry><title>Контент фильтр и статистика посещенных сайтов Squid + rejik + ipcad + Free-SA + nginx</title><link href="https://metajiji.github.io/blog/squid-rejik-ipcad-free-sa-nginx/" rel="alternate"></link><published>2013-03-21T00:00:00+07:00</published><updated>2013-03-21T00:00:00+07:00</updated><author><name>Denis Kadyshev</name></author><id>tag:metajiji.github.io,2013-03-21:/blog/squid-rejik-ipcad-free-sa-nginx/</id><summary type="html">&lt;p&gt;Для организации логирования, статистики посещенных сайтов и других сетевых соединений я воспользовался связкой &lt;strong&gt;Squid&lt;/strong&gt; + &lt;strong&gt;Free-SA&lt;/strong&gt; + &lt;strong&gt;ipcad&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Squid&lt;/strong&gt; - Прокси сервер, который работает у меня в прозрачном (&lt;strong&gt;transparent&lt;/strong&gt; или &lt;strong&gt;intercept&lt;/strong&gt;) режиме - пользователям ничего настраивать не придется.
 Более подробно о нем писать не вижу смысла.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Free-SA&lt;/strong&gt; - Анализатор логов &lt;strong&gt;Squid&lt;/strong&gt; написан на языке Си …&lt;/li&gt;&lt;/ul&gt;</summary><content type="html">&lt;p&gt;Для организации логирования, статистики посещенных сайтов и других сетевых соединений я воспользовался связкой &lt;strong&gt;Squid&lt;/strong&gt; + &lt;strong&gt;Free-SA&lt;/strong&gt; + &lt;strong&gt;ipcad&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Squid&lt;/strong&gt; - Прокси сервер, который работает у меня в прозрачном (&lt;strong&gt;transparent&lt;/strong&gt; или &lt;strong&gt;intercept&lt;/strong&gt;) режиме - пользователям ничего настраивать не придется.
 Более подробно о нем писать не вижу смысла.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Free-SA&lt;/strong&gt; - Анализатор логов &lt;strong&gt;Squid&lt;/strong&gt; написан на языке Си, по функциональности и назначению похож на &lt;strong&gt;LightSquid&lt;/strong&gt;.
 Главное отличие - скорость формирования отчетов от 7 до 20 раз выше по сравнению с &lt;strong&gt;LightSquid&lt;/strong&gt; (7х - для 50 Мб файла &lt;code&gt;access.log&lt;/code&gt;, 20x - для 1 Гб).
 Присутствуют дополнительные отчеты (в том числе для оценки эффективности сервера), изменяемые "на лету" темы оформления,
 имеется поддержка различных форматов файлов журналов (&lt;strong&gt;Squid&lt;/strong&gt;, &lt;strong&gt;CLF&lt;/strong&gt;, &lt;strong&gt;Postfix&lt;/strong&gt;, &lt;strong&gt;Qmail&lt;/strong&gt;, &lt;strong&gt;CGP&lt;/strong&gt;).
 Имеет мало зависимостей в отличие от того же &lt;strong&gt;LightSquid&lt;/strong&gt; и малые требования к веб серверу! В настройках можно много чего интересного покрутить, об этом ниже.
 Еще хотелось бы отметить полезного из функционала - опционально можно включить в отчеты полные URL - для подробной отчетности, либо наоборот отключить (будет быстрее формироваться статистика).&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Rejik&lt;/strong&gt; - &lt;code&gt;redirector&lt;/code&gt; для &lt;strong&gt;Squid&lt;/strong&gt;, выполняющий функции контент фильтра. Поддерживает регулярные выражения, и просто списки сайтов.
 Можно добавлять исключения, применять правила по времени или ip адресам. Из плюсов - высокая скорость работы.
 Из минусов, чтобы скачать базы, нужно либо поработать - проверить несколько сотен сайтов на принадлежность, либо просто купить списки "плохих" сайтов.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ipcad&lt;/strong&gt; - Коллектора для сбора трафика, идущего в обход прокси-сервера. Остается только взять извлечь из него статистику и записать в лог &lt;strong&gt;Squid&lt;/strong&gt;. Скрипт для этого есть ниже.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;nginx&lt;/strong&gt; - Легковесный и производительный веб-сервер. Для запуска &lt;strong&gt;CGI&lt;/strong&gt; скриптов/программ лучше всего использовать &lt;code&gt;fcgiwrap&lt;/code&gt;, о настройке ниже. Более подробно расписывать не вижу смысла.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Весь выбранный софт бесплатный и имеется в портах &lt;strong&gt;FreeBSD&lt;/strong&gt; и под &lt;strong&gt;Linux&lt;/strong&gt;, думаю тоже все эти пакеты есть.&lt;/p&gt;
&lt;p&gt;Итак по порядку, первым делом обновляем порты и устанавливаем весь перечисленный софт:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;FreeBSD# &lt;span class="nb"&gt;cd&lt;/span&gt; /usr/ports
FreeBSD# portsnap fetch update
FreeBSD# &lt;span class="nb"&gt;cd&lt;/span&gt; /usr/ports/www/squid
FreeBSD# make config &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt; make config-recursive
&lt;span class="o"&gt;[&lt;/span&gt;x&lt;span class="o"&gt;]&lt;/span&gt; SQUID_IDENT
&lt;span class="o"&gt;[&lt;/span&gt;x&lt;span class="o"&gt;]&lt;/span&gt; SQUID_KQUEUE
&lt;span class="o"&gt;[&lt;/span&gt;x&lt;span class="o"&gt;]&lt;/span&gt; SQUID_LARGEFILE
FreeBSD# make install clean
FreeBSD# &lt;span class="nb"&gt;cd&lt;/span&gt; /usr/ports/www/free-sa
FreeBSD# make install clean
FreeBSD# &lt;span class="nb"&gt;cd&lt;/span&gt; /usr/ports/www/rejik
FreeBSD# make config &lt;span class="p"&gt;&amp;amp;&lt;/span&gt;amp&lt;span class="p"&gt;;&amp;amp;&lt;/span&gt;amp&lt;span class="p"&gt;;&lt;/span&gt; make config-recursive
&lt;span class="o"&gt;[&lt;/span&gt;x&lt;span class="o"&gt;]&lt;/span&gt; BAN
&lt;span class="o"&gt;[&lt;/span&gt;x&lt;span class="o"&gt;]&lt;/span&gt; DBL
&lt;span class="o"&gt;[&lt;/span&gt;x&lt;span class="o"&gt;]&lt;/span&gt; WWW
FreeBSD# make install clean
FreeBSD# &lt;span class="nb"&gt;cd&lt;/span&gt; /usr/ports/www/nginx
FreeBSD# make config &lt;span class="p"&gt;&amp;amp;&lt;/span&gt;amp&lt;span class="p"&gt;;&amp;amp;&lt;/span&gt;amp&lt;span class="p"&gt;;&lt;/span&gt; make config-recursive
&lt;span class="o"&gt;[&lt;/span&gt;x&lt;span class="o"&gt;]&lt;/span&gt; HTTP
&lt;span class="o"&gt;[&lt;/span&gt;x&lt;span class="o"&gt;]&lt;/span&gt; HTTP_CACHE
&lt;span class="o"&gt;[&lt;/span&gt;x&lt;span class="o"&gt;]&lt;/span&gt; HTTP_REWRITE
&lt;span class="o"&gt;[&lt;/span&gt;x&lt;span class="o"&gt;]&lt;/span&gt; HTTP_STATUS
&lt;span class="o"&gt;[&lt;/span&gt;x&lt;span class="o"&gt;]&lt;/span&gt; WWW
FreeBSD# make install clean
FreeBSD# &lt;span class="nb"&gt;cd&lt;/span&gt; /usr/ports/www/fcgiwrap
FreeBSD# make install clean
FreeBSD# &lt;span class="nb"&gt;cd&lt;/span&gt; /usr/ports/net-mgmt/ipcad
FreeBSD# make install clean
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Когда все успешно установится переходим к настройкам:
Листинг &lt;code&gt;free-sa.conf&lt;/code&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="c1"&gt;#&lt;/span&gt;
&lt;span class="c1"&gt;# Sample configuration file for free-sa(1)&lt;/span&gt;
&lt;span class="c1"&gt;#&lt;/span&gt;
&lt;span class="c1"&gt;# copy to /usr/local/etc/free-sa/free-sa.conf&lt;/span&gt;
&lt;span class="c1"&gt;#&lt;/span&gt;


&lt;span class="c1"&gt;#########&lt;/span&gt;
&lt;span class="c1"&gt;# FILES #&lt;/span&gt;
&lt;span class="c1"&gt;#########&lt;/span&gt;
&lt;span class="nv"&gt;log&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;/var/log/squid/access.log&amp;quot;&lt;/span&gt;
&lt;span class="c1"&gt;#usertab=&amp;quot;/usr/local/etc/free-sa/users&amp;quot;&lt;/span&gt;
&lt;span class="nv"&gt;downloads&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;/usr/local/etc/free-sa/downloads.sample&amp;quot;&lt;/span&gt;
&lt;span class="c1"&gt;#local_filter=&amp;quot;&amp;quot;&lt;/span&gt;
&lt;span class="c1"&gt;#global_filter=&amp;quot;&amp;quot;&lt;/span&gt;


&lt;span class="c1"&gt;###############&lt;/span&gt;
&lt;span class="c1"&gt;# DIRECTORIES #&lt;/span&gt;
&lt;span class="c1"&gt;###############&lt;/span&gt;
&lt;span class="nv"&gt;targetdir&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;/usr/local/www/data/free-sa&amp;quot;&lt;/span&gt;
&lt;span class="nv"&gt;tmpdir&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;/var/cache/free-sa&amp;quot;&lt;/span&gt;


&lt;span class="c1"&gt;#####################&lt;/span&gt;
&lt;span class="c1"&gt;# REPORTS SELECTION #&lt;/span&gt;
&lt;span class="c1"&gt;#####################&lt;/span&gt;
&lt;span class="nv"&gt;ts&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;true&amp;quot;&lt;/span&gt;
&lt;span class="nv"&gt;paf&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;true&amp;quot;&lt;/span&gt;
&lt;span class="nv"&gt;saf&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;true&amp;quot;&lt;/span&gt;
&lt;span class="nv"&gt;pdn&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;true&amp;quot;&lt;/span&gt;
&lt;span class="nv"&gt;sdn&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;true&amp;quot;&lt;/span&gt;
&lt;span class="nv"&gt;cct&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;true&amp;quot;&lt;/span&gt;
&lt;span class="nv"&gt;pst&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;true&amp;quot;&lt;/span&gt;
&lt;span class="nv"&gt;dld&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;true&amp;quot;&lt;/span&gt;
&lt;span class="nv"&gt;fullurl&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;true&amp;quot;&lt;/span&gt;
&lt;span class="nv"&gt;users&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;true&amp;quot;&lt;/span&gt;
&lt;span class="c1"&gt;#email=&amp;quot;&amp;quot;&lt;/span&gt;


&lt;span class="c1"&gt;##################&lt;/span&gt;
&lt;span class="c1"&gt;# REPORTS LIMITS #&lt;/span&gt;
&lt;span class="c1"&gt;##################&lt;/span&gt;
&lt;span class="c1"&gt;#paf_limit=&amp;quot;50&amp;quot;&lt;/span&gt;
&lt;span class="c1"&gt;#saf_limit=&amp;quot;50&amp;quot;&lt;/span&gt;
&lt;span class="c1"&gt;#pdn_limit=&amp;quot;50&amp;quot;&lt;/span&gt;
&lt;span class="c1"&gt;#sdn_limit=&amp;quot;50&amp;quot;&lt;/span&gt;
&lt;span class="c1"&gt;#cct_limit=&amp;quot;50&amp;quot;&lt;/span&gt;
&lt;span class="c1"&gt;#pst_limit=&amp;quot;50&amp;quot;&lt;/span&gt;
&lt;span class="c1"&gt;#dld_limit=&amp;quot;50&amp;quot;&lt;/span&gt;
&lt;span class="c1"&gt;#lcf_limit=&amp;quot;50&amp;quot;&lt;/span&gt;
&lt;span class="c1"&gt;#url_limit=&amp;quot;50&amp;quot;&lt;/span&gt;
&lt;span class="c1"&gt;#ts_limit=&amp;quot;0&amp;quot;&lt;/span&gt;
&lt;span class="c1"&gt;#dld_min=&amp;quot;0&amp;quot;&lt;/span&gt;
&lt;span class="c1"&gt;#rtr_timeout=&amp;quot;5000&amp;quot;&lt;/span&gt;


&lt;span class="c1"&gt;####################&lt;/span&gt;
&lt;span class="c1"&gt;# OTHER PARAMETERS #&lt;/span&gt;
&lt;span class="c1"&gt;####################&lt;/span&gt;
&lt;span class="nv"&gt;name&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;free-sa.conf&amp;quot;&lt;/span&gt;
&lt;span class="nv"&gt;logformat&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;0&amp;quot;&lt;/span&gt;
&lt;span class="c1"&gt;#skip_errors=&amp;quot;false&amp;quot;&lt;/span&gt;
&lt;span class="nv"&gt;fulltraffic&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;true&amp;quot;&lt;/span&gt;
&lt;span class="nv"&gt;inameuser&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;true&amp;quot;&lt;/span&gt;
&lt;span class="c1"&gt;#user_unescape=&amp;quot;false&amp;quot;&lt;/span&gt;
&lt;span class="nv"&gt;indicators&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;true&amp;quot;&lt;/span&gt;
&lt;span class="nv"&gt;overwrite&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;2&amp;quot;&lt;/span&gt;
&lt;span class="nv"&gt;resolveip&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;true&amp;quot;&lt;/span&gt;
&lt;span class="nv"&gt;showinfo&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;true&amp;quot;&lt;/span&gt;
&lt;span class="c1"&gt;#site=&amp;quot;&amp;quot;&lt;/span&gt;
&lt;span class="c1"&gt;#logo=&amp;quot;&amp;quot;&lt;/span&gt;
&lt;span class="nv"&gt;locale&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;ru_RU.KOI8-R&amp;quot;&lt;/span&gt;
&lt;span class="c1"&gt;#rotate=&amp;quot;&amp;quot;&lt;/span&gt;
&lt;span class="nv"&gt;divisor&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;b&amp;quot;&lt;/span&gt;
&lt;span class="c1"&gt;#tz_shift=&amp;quot;0&amp;quot;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Создаем каталог для скриптов:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;mkdir /usr/local/etc/squid/scripts
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;И создаем в этой папке скрипты:&lt;/p&gt;
&lt;p&gt;Листинг &lt;code&gt;ipcadstat.sh&lt;/code&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="ch"&gt;#!/bin/sh&lt;/span&gt;

&lt;span class="c1"&gt;# Диапазон адресов локальной cети, указываем подсеть.&lt;/span&gt;
&lt;span class="nv"&gt;net&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;192\.168\.[0-9]?[0-9]?[0-9]\.[0-9]?[0-9]?[0-9]&lt;/span&gt;$&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt; &lt;span class="c1"&gt;# 192.168.0.0/16&lt;/span&gt;
&lt;span class="c1"&gt;#net=&amp;quot;192\.168\.0\.[0-9]?[0-9]?[0-9]$&amp;quot; # 192.168.0.0/24&lt;/span&gt;

&lt;span class="c1"&gt;# Каталог с логами squid&amp;#39;а&lt;/span&gt;
&lt;span class="nv"&gt;squid_DIR&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;/var/log/squid/&amp;#39;&lt;/span&gt;

&lt;span class="nv"&gt;ttime&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="sb"&gt;`&lt;/span&gt;rsh localhost sh ip acco &lt;span class="p"&gt;|&lt;/span&gt; grep &lt;span class="s1"&gt;&amp;#39;Accounting data saved&amp;#39;&lt;/span&gt; &lt;span class="p"&gt;|&lt;/span&gt; awk &lt;span class="s1"&gt;&amp;#39;{print ($4)}&amp;#39;&lt;/span&gt;&lt;span class="sb"&gt;`&lt;/span&gt;
rsh localhost clear ip accounting &amp;gt; /dev/null
rsh localhost show ip accounting checkpoint &lt;span class="p"&gt;|&lt;/span&gt; awk -v &lt;span class="nv"&gt;vtime&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nv"&gt;$ttime&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;{&lt;/span&gt;
&lt;span class="s1"&gt; if ( $2 ~ /^&amp;#39;&lt;/span&gt;&lt;span class="nv"&gt;$net&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;/ )&lt;/span&gt;
&lt;span class="s1"&gt;     print (vtime&amp;quot;.000&amp;quot;,1,$2,&amp;quot;TCP_MISS/200&amp;quot;,$4,&amp;quot;CONNECT&amp;quot;,$1&amp;quot;:&amp;quot;$5,&amp;quot;-&amp;quot;,&amp;quot;DIRECT/&amp;quot;$1,&amp;quot;-&amp;quot;)&lt;/span&gt;
&lt;span class="s1"&gt; }&amp;#39;&lt;/span&gt; &amp;gt;&amp;gt; &lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;$squid_DIR&lt;/span&gt;&lt;span class="s2"&gt;/access.log&amp;quot;&lt;/span&gt;

&lt;span class="c1"&gt;#TODO - если ошибок не было, то продолжаем.&lt;/span&gt;
/usr/local/bin/free-sa
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Листинг &lt;code&gt;rotate_log.sh&lt;/code&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="ch"&gt;#!/bin/sh&lt;/span&gt;

&lt;span class="c1"&gt;# Ротация логов Squid&lt;/span&gt;
/usr/local/sbin/squid -k rotate
&lt;span class="k"&gt;for&lt;/span&gt; i in &lt;span class="k"&gt;$(&lt;/span&gt;ls &lt;span class="nv"&gt;$squid_DIR&lt;/span&gt; &lt;span class="p"&gt;|&lt;/span&gt; grep -i &lt;span class="s1"&gt;&amp;#39;\.log\.[4-9]&amp;#39;&lt;/span&gt;&lt;span class="k"&gt;)&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;
    rm -f &lt;span class="nv"&gt;$squid_DIR&lt;/span&gt;/&lt;span class="nv"&gt;$i&lt;/span&gt;
&lt;span class="k"&gt;done&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Добавляем эти скрипты в планировщик заданий &lt;code&gt;/etc/crontab&lt;/code&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="c1"&gt;# rotate squid logs&lt;/span&gt;
&lt;span class="m"&gt;0&lt;/span&gt;    &lt;span class="m"&gt;0&lt;/span&gt;  */1  *  *  root  /usr/local/etc/squid/scripts/rotate_log.sh &amp;gt;&amp;gt;/var/log/squid/rotate_log.log &lt;span class="m"&gt;2&lt;/span&gt;&amp;gt;&lt;span class="p"&gt;&amp;amp;&lt;/span&gt;&lt;span class="m"&gt;1&lt;/span&gt;

&lt;span class="c1"&gt;# Наполнение лога squid данными из ipcad.&lt;/span&gt;
*/5  *  *    *  *  root  /usr/local/etc/squid/scripts/ipcadstat.sh &amp;gt;&amp;gt;/var/log/squid/ipcadstat.log &lt;span class="m"&gt;2&lt;/span&gt;&amp;gt;&lt;span class="p"&gt;&amp;amp;&lt;/span&gt;&lt;span class="m"&gt;1&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Привожу только те строки, которые изменил в дефолтном конфиге &lt;strong&gt;Squid&lt;/strong&gt; - &lt;code&gt;/usr/local/etc/squid/squid.conf&lt;/code&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;http_port &lt;span class="m"&gt;3129&lt;/span&gt; transparent
cache_mem &lt;span class="m"&gt;500&lt;/span&gt; MB
maximum_object_size_in_memory &lt;span class="m"&gt;64&lt;/span&gt; KB
cache_dir ufs /var/squid/cache &lt;span class="m"&gt;20480&lt;/span&gt; &lt;span class="m"&gt;16&lt;/span&gt; &lt;span class="m"&gt;256&lt;/span&gt;
maximum_object_size &lt;span class="m"&gt;100&lt;/span&gt; MB
access_log /var/log/squid/access.log squid
cache_log /var/log/squid/cache.log
logfile_rotate &lt;span class="m"&gt;100&lt;/span&gt;
strip_query_terms off
url_rewrite_program /usr/local/rejik/redirector /usr/local/rejik/redirector.conf
url_rewrite_children &lt;span class="m"&gt;10&lt;/span&gt;
header_access Via deny all
cache_mgr Тут@Мое.мыло
visible_hostname имя.сервера.сквида
error_directory /usr/local/etc/squid/errors/Russian-1251
dns_nameservers Тут.ip.вашего.DNS.сервера
append_domain .local
forwarded_for off
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Страницу блокировки я предпочитаю отдавать самим &lt;strong&gt;Squid&lt;/strong&gt;, как это описано в &lt;strong&gt;FAQ&lt;/strong&gt; по &lt;strong&gt;rejik&lt;/strong&gt;'у - &lt;a href="http://rejik.ru/index_ru_6_0.html"&gt;А нельзя ли обойтись без установки локального web сервера?&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Добавляем строки в &lt;code&gt;/usr/local/etc/squid/mime.conf&lt;/code&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="c1"&gt;# Для rejik&lt;/span&gt;
dfgxfdgdfg-squid-porno dfgxfdgdfg-squid-deny/dfgxfdgdfg-squid-porno-html rejik/porno.html - ascii
dfgxfdgdfg-squid-deny dfgxfdgdfg-squid-deny/dfgxfdgdfg-squid-deny-html rejik/deny.html  - ascii
dfgxfdgdfg-squid-banner dfgxfdgdfg-squid-banner/dfgxfdgdfg-squid-banner-1px rejik/1x1.gif  - image
dfgxfdgdfg-squid-js dfgxfdgdfg-squid-js/dfgxfdgdfg-squid-js-js  rejik/js.js  - ascii
&lt;/pre&gt;&lt;/div&gt;


&lt;blockquote&gt;
&lt;p&gt;Файл &lt;code&gt;1x1.gif&lt;/code&gt; - это пустая &lt;strong&gt;gif&lt;/strong&gt; картинка размером &lt;strong&gt;1x1&lt;/strong&gt; пиксель.
Файл &lt;code&gt;js.js&lt;/code&gt; - это пустой текстовый файл.
Файлы &lt;code&gt;porno.html&lt;/code&gt;, &lt;code&gt;deny.html&lt;/code&gt; - произвольный &lt;strong&gt;html&lt;/strong&gt; документ, который будут видеть те, кто откроет запрещенный сайт.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Например у меня &lt;code&gt;deny.html&lt;/code&gt; выглядит так:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="cp"&gt;&amp;lt;!DOCTYPE html PUBLIC &amp;quot;-//W3C//DTD XHTML 1.0 Transitional//EN&amp;quot; &amp;quot;http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd&amp;quot;&amp;gt;&lt;/span&gt;
&lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;html&lt;/span&gt; &lt;span class="na"&gt;xmlns&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;http://www.w3.org/1999/xhtml&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
    &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;head&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
        &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;meta&lt;/span&gt; &lt;span class="na"&gt;http-equiv&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;Content-Type&amp;quot;&lt;/span&gt; &lt;span class="na"&gt;content&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;text/html; charset=UTF-8&amp;quot;&lt;/span&gt; &lt;span class="p"&gt;/&amp;gt;&lt;/span&gt;
        &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;title&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;Доступ ограничен&lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;title&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
        &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;style&lt;/span&gt; &lt;span class="na"&gt;type&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;text/css&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
            &lt;span class="o"&gt;&amp;lt;!&lt;/span&gt;&lt;span class="nt"&gt;--&lt;/span&gt;
            &lt;span class="nt"&gt;body&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt;&lt;span class="nt"&gt;td&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt;&lt;span class="nt"&gt;th&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
                &lt;span class="k"&gt;font-family&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;Verdana&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;Arial&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;Helvetica&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="kc"&gt;sans-serif&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
                &lt;span class="k"&gt;font-size&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="mi"&gt;14&lt;/span&gt;&lt;span class="kt"&gt;px&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
                &lt;span class="k"&gt;color&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="mh"&gt;#FFFFFF&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
            &lt;span class="p"&gt;}&lt;/span&gt;
            &lt;span class="nt"&gt;body&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
                &lt;span class="k"&gt;background-color&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="mh"&gt;#000000&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
                &lt;span class="k"&gt;margin-top&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="mi"&gt;100&lt;/span&gt;&lt;span class="kt"&gt;px&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
                &lt;span class="k"&gt;margin-left&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="mi"&gt;100&lt;/span&gt;&lt;span class="kt"&gt;px&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
                &lt;span class="k"&gt;margin-right&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="mi"&gt;100&lt;/span&gt;&lt;span class="kt"&gt;px&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
            &lt;span class="p"&gt;}&lt;/span&gt;
            &lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nc"&gt;style1&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
                &lt;span class="k"&gt;color&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="mh"&gt;#FF0000&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
                &lt;span class="k"&gt;font-size&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="mi"&gt;16&lt;/span&gt;&lt;span class="kt"&gt;px&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
                &lt;span class="k"&gt;font-weight&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="kc"&gt;bold&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
            &lt;span class="p"&gt;}&lt;/span&gt;
            &lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nc"&gt;style2&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="k"&gt;font-size&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="mi"&gt;10&lt;/span&gt;&lt;span class="kt"&gt;px&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;
            &lt;span class="nt"&gt;--&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;
        &lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;style&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
    &lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;head&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;

    &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;body&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
        &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;div&lt;/span&gt; &lt;span class="na"&gt;align&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;center&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
            &lt;span class="ni"&gt;&amp;amp;nbsp;&lt;/span&gt; &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;p&lt;/span&gt; &lt;span class="na"&gt;class&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;style1&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;Содержимое данного сайта заблокировано!&lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;p&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
            &lt;span class="ni"&gt;&amp;amp;nbsp;&lt;/span&gt; &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;p&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;Система контентной фильтрации определила,&lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;br&lt;/span&gt; &lt;span class="p"&gt;/&amp;gt;&lt;/span&gt;
            &lt;span class="ni"&gt;&amp;amp;nbsp;&lt;/span&gt; что материалы запрашиваемого вами ресурса&lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;br&lt;/span&gt; &lt;span class="p"&gt;/&amp;gt;&lt;/span&gt;
            &lt;span class="ni"&gt;&amp;amp;nbsp;&lt;/span&gt; могут противоречить целям и задачам &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;br&lt;/span&gt; &lt;span class="p"&gt;/&amp;gt;&lt;/span&gt;
            &lt;span class="ni"&gt;&amp;amp;nbsp;&lt;/span&gt; образовательного процесса.&lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;p&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
            &lt;span class="ni"&gt;&amp;amp;nbsp;&lt;/span&gt; &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;hr&lt;/span&gt; &lt;span class="na"&gt;width&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;400&amp;quot;&lt;/span&gt; &lt;span class="na"&gt;size&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;3&amp;quot;&lt;/span&gt; &lt;span class="p"&gt;/&amp;gt;&lt;/span&gt;
            &lt;span class="ni"&gt;&amp;amp;nbsp;&lt;/span&gt; &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;p&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;span&lt;/span&gt; &lt;span class="na"&gt;class&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;style2&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;Если вы уверены, что сайт не содержит недопустимой информации,&lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;br&lt;/span&gt; &lt;span class="p"&gt;/&amp;gt;&lt;/span&gt;
            &lt;span class="ni"&gt;&amp;amp;nbsp;&lt;/span&gt; обратитесь к системному администратору. После проверки адрес&lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;br&lt;/span&gt; &lt;span class="p"&gt;/&amp;gt;&lt;/span&gt;
            &lt;span class="ni"&gt;&amp;amp;nbsp;&lt;/span&gt; будет добавлен в список разрешенных ресурсов.&lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;span&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;p&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
        &lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;div&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
    &lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;body&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
&lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;html&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Листинг &lt;code&gt;/usr/local/rejik/redirector.conf&lt;/code&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;error_log&lt;/span&gt; &lt;span class="s"&gt;/usr/local/rejik/redirector.err&lt;/span&gt;
&lt;span class="s"&gt;change_log&lt;/span&gt; &lt;span class="s"&gt;/usr/local/rejik/redirector.log&lt;/span&gt;
&lt;span class="s"&gt;make-cache&lt;/span&gt; &lt;span class="s"&gt;/usr/local/rejik/make-cache&lt;/span&gt;
&lt;span class="s"&gt;allow_urls&lt;/span&gt; &lt;span class="s"&gt;/usr/local/rejik/banlists/allow_urls&lt;/span&gt;

&lt;span class="c1"&gt;# Список ip - исключений. (для кого НЕ будут применяться правила фильтрации)&lt;/span&gt;
&lt;span class="s"&gt;allow_ip&lt;/span&gt; &lt;span class="s"&gt;f:/usr/local/rejik/ip/allow&lt;/span&gt;


&lt;span class="c1"&gt;#&amp;lt;audio-video&amp;gt;&lt;/span&gt;
&lt;span class="c1"&gt;#ban_dir  /usr/local/rejik/banlists/audio-video&lt;/span&gt;
&lt;span class="c1"&gt;#url http://127.0.0.1:3126/squid-internal-static/icons/rejik/deny.html&lt;/span&gt;
&lt;span class="c1"&gt;#log off&lt;/span&gt;

&lt;span class="c1"&gt;#&amp;lt;avto-moto&amp;gt;&lt;/span&gt;
&lt;span class="c1"&gt;#ban_dir  /usr/local/rejik/banlists/avto-moto&lt;/span&gt;
&lt;span class="c1"&gt;#url http://127.0.0.1:3126/squid-internal-static/icons/rejik/deny.html&lt;/span&gt;
&lt;span class="c1"&gt;#log off&lt;/span&gt;

&lt;span class="s"&gt;&amp;lt;banner&amp;gt;&lt;/span&gt;
&lt;span class="s"&gt;ban_dir&lt;/span&gt; &lt;span class="s"&gt;/usr/local/rejik/banlists/banners&lt;/span&gt;
&lt;span class="c1"&gt;#файлы смотри в каталоге /usr/local/etc/squid/icons/rejik + mime.conf файл сквида&lt;/span&gt;
&lt;span class="s"&gt;url&lt;/span&gt; &lt;span class="s"&gt;http://127.0.0.1:3126/squid-internal-static/icons/rejik/1x1.gif&lt;/span&gt;
&lt;span class="s"&gt;log&lt;/span&gt; &lt;span class="no"&gt;off&lt;/span&gt;

&lt;span class="c1"&gt;#&amp;lt;chats&amp;gt;&lt;/span&gt;
&lt;span class="c1"&gt;#ban_dir  /usr/local/rejik/banlists/chats&lt;/span&gt;
&lt;span class="c1"&gt;#url http://127.0.0.1:3126/squid-internal-static/icons/rejik/deny.html&lt;/span&gt;
&lt;span class="c1"&gt;#log off&lt;/span&gt;

&lt;span class="c1"&gt;#&amp;lt;dating&amp;gt;&lt;/span&gt;
&lt;span class="c1"&gt;#ban_dir  /usr/local/rejik/banlists/dating&lt;/span&gt;
&lt;span class="c1"&gt;#url http://127.0.0.1:3126/squid-internal-static/icons/rejik/deny.html&lt;/span&gt;
&lt;span class="c1"&gt;#log off&lt;/span&gt;

&lt;span class="s"&gt;&amp;lt;extremism&amp;gt;&lt;/span&gt;
&lt;span class="s"&gt;ban_dir&lt;/span&gt;  &lt;span class="s"&gt;/usr/local/rejik/banlists/extremism&lt;/span&gt;
&lt;span class="s"&gt;url&lt;/span&gt; &lt;span class="s"&gt;http://127.0.0.1:3126/squid-internal-static/icons/rejik/deny.html&lt;/span&gt;
&lt;span class="s"&gt;log&lt;/span&gt; &lt;span class="no"&gt;off&lt;/span&gt;

&lt;span class="c1"&gt;#&amp;lt;icq&amp;gt;&lt;/span&gt;
&lt;span class="c1"&gt;#ban_dir  /usr/local/rejik/banlists/icq&lt;/span&gt;
&lt;span class="c1"&gt;#url http://127.0.0.1:3126/squid-internal-static/icons/rejik/deny.html&lt;/span&gt;
&lt;span class="c1"&gt;#log off&lt;/span&gt;

&lt;span class="c1"&gt;#&amp;lt;jobsearch&amp;gt;&lt;/span&gt;
&lt;span class="c1"&gt;#ban_dir  /usr/local/rejik/banlists/jobsearch&lt;/span&gt;
&lt;span class="c1"&gt;#url http://127.0.0.1:3126/squid-internal-static/icons/rejik/deny.html&lt;/span&gt;
&lt;span class="c1"&gt;#log off&lt;/span&gt;

&lt;span class="s"&gt;&amp;lt;online-games&amp;gt;&lt;/span&gt;
&lt;span class="s"&gt;ban_dir&lt;/span&gt;  &lt;span class="s"&gt;/usr/local/rejik/banlists/online-games&lt;/span&gt;
&lt;span class="s"&gt;url&lt;/span&gt; &lt;span class="s"&gt;http://127.0.0.1:3126/squid-internal-static/icons/rejik/deny.html&lt;/span&gt;
&lt;span class="s"&gt;log&lt;/span&gt; &lt;span class="no"&gt;off&lt;/span&gt;

&lt;span class="s"&gt;&amp;lt;phishihg&amp;gt;&lt;/span&gt;
&lt;span class="s"&gt;ban_dir&lt;/span&gt;  &lt;span class="s"&gt;/usr/local/rejik/banlists/phishing&lt;/span&gt;
&lt;span class="s"&gt;url&lt;/span&gt; &lt;span class="s"&gt;http://127.0.0.1:3126/squid-internal-static/icons/rejik/deny.html&lt;/span&gt;
&lt;span class="s"&gt;log&lt;/span&gt; &lt;span class="no"&gt;off&lt;/span&gt;

&lt;span class="c1"&gt;#&amp;lt;photogallery&amp;gt;&lt;/span&gt;
&lt;span class="c1"&gt;#ban_dir  /usr/local/rejik/banlists/photogallery&lt;/span&gt;
&lt;span class="c1"&gt;#url http://127.0.0.1:3126/squid-internal-static/icons/rejik/deny.html&lt;/span&gt;
&lt;span class="c1"&gt;#log off&lt;/span&gt;

&lt;span class="s"&gt;&amp;lt;porno&amp;gt;&lt;/span&gt;
&lt;span class="s"&gt;ban_dir&lt;/span&gt;  &lt;span class="s"&gt;/usr/local/rejik/banlists/porno&lt;/span&gt;
&lt;span class="s"&gt;url&lt;/span&gt; &lt;span class="s"&gt;http://127.0.0.1:3126/squid-internal-static/icons/rejik/deny.html&lt;/span&gt;
&lt;span class="s"&gt;log&lt;/span&gt; &lt;span class="no"&gt;off&lt;/span&gt;

&lt;span class="s"&gt;&amp;lt;socnet&amp;gt;&lt;/span&gt;
&lt;span class="s"&gt;ban_dir&lt;/span&gt;  &lt;span class="s"&gt;/usr/local/rejik/banlists/socnet&lt;/span&gt;
&lt;span class="s"&gt;url&lt;/span&gt; &lt;span class="s"&gt;http://127.0.0.1:3126/squid-internal-static/icons/rejik/deny.html&lt;/span&gt;
&lt;span class="s"&gt;work_ip&lt;/span&gt; &lt;span class="s"&gt;f:/usr/local/rejik/ip/deny_socnet&lt;/span&gt;
&lt;span class="s"&gt;log&lt;/span&gt; &lt;span class="no"&gt;off&lt;/span&gt;

&lt;span class="s"&gt;&amp;lt;spyware&amp;gt;&lt;/span&gt;
&lt;span class="s"&gt;ban_dir&lt;/span&gt;  &lt;span class="s"&gt;/usr/local/rejik/banlists/spyware&lt;/span&gt;
&lt;span class="s"&gt;url&lt;/span&gt; &lt;span class="s"&gt;http://127.0.0.1:3126/squid-internal-static/icons/rejik/deny.html&lt;/span&gt;
&lt;span class="s"&gt;log&lt;/span&gt; &lt;span class="no"&gt;off&lt;/span&gt;

&lt;span class="s"&gt;&amp;lt;torrents&amp;gt;&lt;/span&gt;
&lt;span class="s"&gt;ban_dir&lt;/span&gt;  &lt;span class="s"&gt;/usr/local/rejik/banlists/torrents&lt;/span&gt;
&lt;span class="s"&gt;url&lt;/span&gt; &lt;span class="s"&gt;http://127.0.0.1:3126/squid-internal-static/icons/rejik/deny.html&lt;/span&gt;
&lt;span class="s"&gt;log&lt;/span&gt; &lt;span class="no"&gt;off&lt;/span&gt;

&lt;span class="s"&gt;&amp;lt;virus-detect&amp;gt;&lt;/span&gt;
&lt;span class="s"&gt;ban_dir&lt;/span&gt;  &lt;span class="s"&gt;/usr/local/rejik/banlists/virus-detect&lt;/span&gt;
&lt;span class="s"&gt;url&lt;/span&gt; &lt;span class="s"&gt;http://127.0.0.1:3126/squid-internal-static/icons/rejik/deny.html&lt;/span&gt;
&lt;span class="s"&gt;log&lt;/span&gt; &lt;span class="no"&gt;off&lt;/span&gt;

&lt;span class="s"&gt;&amp;lt;warez&amp;gt;&lt;/span&gt;
&lt;span class="s"&gt;ban_dir&lt;/span&gt;  &lt;span class="s"&gt;/usr/local/rejik/banlists/warez&lt;/span&gt;
&lt;span class="s"&gt;url&lt;/span&gt; &lt;span class="s"&gt;http://127.0.0.1:3126/squid-internal-static/icons/rejik/deny.html&lt;/span&gt;
&lt;span class="s"&gt;log&lt;/span&gt; &lt;span class="no"&gt;off&lt;/span&gt;

&lt;span class="c1"&gt;#&amp;lt;web-mail&amp;gt;&lt;/span&gt;
&lt;span class="c1"&gt;#ban_dir  /usr/local/rejik/banlists/web-mail&lt;/span&gt;
&lt;span class="c1"&gt;#url http://127.0.0.1:3126/squid-internal-static/icons/rejik/deny.html&lt;/span&gt;
&lt;span class="c1"&gt;#log off&lt;/span&gt;

&lt;span class="s"&gt;&amp;lt;web-proxy&amp;gt;&lt;/span&gt;
&lt;span class="s"&gt;ban_dir&lt;/span&gt;  &lt;span class="s"&gt;/usr/local/rejik/banlists/web-proxy&lt;/span&gt;
&lt;span class="s"&gt;url&lt;/span&gt; &lt;span class="s"&gt;http://127.0.0.1:3126/squid-internal-static/icons/rejik/deny.html&lt;/span&gt;
&lt;span class="s"&gt;log&lt;/span&gt; &lt;span class="no"&gt;off&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Так как &lt;strong&gt;rejik&lt;/strong&gt; из текстовых файлов со списками плохих сайтов делает файлы бинарные файлы, от после внесения изменений в списки, нужно обновлять &lt;code&gt;*.cache&lt;/code&gt; файлы &lt;strong&gt;rejik&lt;/strong&gt;'а, для этого я использую скрипт:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="ch"&gt;#!/bin/sh&lt;/span&gt;

&lt;span class="c1"&gt;# Путь  до rejik&lt;/span&gt;
&lt;span class="nv"&gt;REJIK_PATH&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;/usr/local/rejik


&lt;span class="c1"&gt;# Найдем и удалим файлы кеша rejik&lt;/span&gt;
find &lt;span class="nv"&gt;$REJIK_PATH&lt;/span&gt; -name &lt;span class="s1"&gt;&amp;#39;*.cache&amp;#39;&lt;/span&gt; -exec rm &lt;span class="o"&gt;{}&lt;/span&gt; &lt;span class="se"&gt;\;&lt;/span&gt;
&lt;span class="c1"&gt;# Создадим снова кеш rejik&lt;/span&gt;
&lt;span class="nv"&gt;$REJIK_PATH&lt;/span&gt;/make-cache

&lt;span class="c1"&gt;# говорим squid перечитать новую конфигурацию&lt;/span&gt;
/usr/local/sbin/squid -k reconfigure
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Листинг с описанием виртуального хоста &lt;code&gt;squid.local&lt;/code&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;server&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
&lt;span class="c1"&gt;#-------------------------- Options --------------------------#&lt;/span&gt;
    &lt;span class="kn"&gt;listen&lt;/span&gt; &lt;span class="s"&gt;*:80&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="kn"&gt;server_name&lt;/span&gt; &lt;span class="s"&gt;squid.local&lt;/span&gt; &lt;span class="s"&gt;squid&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;

    &lt;span class="kn"&gt;open_file_cache&lt;/span&gt; &lt;span class="s"&gt;max=100000&lt;/span&gt; &lt;span class="s"&gt;inactive=40s&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="kn"&gt;open_file_cache_valid&lt;/span&gt; &lt;span class="s"&gt;60s&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="kn"&gt;open_file_cache_min_uses&lt;/span&gt; &lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="kn"&gt;open_file_cache_errors&lt;/span&gt; &lt;span class="no"&gt;on&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;

    &lt;span class="c1"&gt;# Logs&lt;/span&gt;
    &lt;span class="kn"&gt;access_log&lt;/span&gt; &lt;span class="s"&gt;/var/log/nginx/squid.local_http_access.log&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="kn"&gt;error_log&lt;/span&gt; &lt;span class="s"&gt;/var/log/nginx/squid.local_http_error.log&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;


&lt;span class="c1"&gt;#-------------------------- Configs --------------------------#&lt;/span&gt;
    &lt;span class="c1"&gt;# redirect server error pages to the static page /50x.html&lt;/span&gt;
    &lt;span class="kn"&gt;error_page&lt;/span&gt; &lt;span class="mi"&gt;500&lt;/span&gt; &lt;span class="mi"&gt;502&lt;/span&gt; &lt;span class="mi"&gt;503&lt;/span&gt; &lt;span class="mi"&gt;504&lt;/span&gt; &lt;span class="s"&gt;/50x.html&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="kn"&gt;location&lt;/span&gt; &lt;span class="p"&gt;=&lt;/span&gt; &lt;span class="s"&gt;/50x.html&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
        &lt;span class="kn"&gt;root&lt;/span&gt; &lt;span class="s"&gt;/usr/local/www/nginx-dist&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="p"&gt;}&lt;/span&gt;

    &lt;span class="c1"&gt;# deny access to .htaccess files, if Apache&amp;#39;s document root concurs with nginx&amp;#39;s one&lt;/span&gt;
    &lt;span class="kn"&gt;location&lt;/span&gt; &lt;span class="p"&gt;~&lt;/span&gt; &lt;span class="sr"&gt;/\.ht&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt; &lt;span class="kn"&gt;deny&lt;/span&gt; &lt;span class="s"&gt;all&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="p"&gt;}&lt;/span&gt;

    &lt;span class="kn"&gt;index&lt;/span&gt; &lt;span class="s"&gt;index.html&lt;/span&gt; &lt;span class="s"&gt;free-sa.cgi&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;

&lt;span class="c1"&gt;#-------------------------- Locations ------------------------#&lt;/span&gt;

    &lt;span class="kn"&gt;location&lt;/span&gt; &lt;span class="p"&gt;~&lt;/span&gt; &lt;span class="sr"&gt;^/favicon.ico$&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
        &lt;span class="kn"&gt;root&lt;/span&gt; &lt;span class="s"&gt;/usr/local/www/data/free-sa&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
        &lt;span class="kn"&gt;log_not_found&lt;/span&gt; &lt;span class="no"&gt;off&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
        &lt;span class="kn"&gt;access_log&lt;/span&gt; &lt;span class="no"&gt;off&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
        &lt;span class="kn"&gt;expires&lt;/span&gt; &lt;span class="s"&gt;max&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="p"&gt;}&lt;/span&gt;

    &lt;span class="c1"&gt;# Main location&lt;/span&gt;
    &lt;span class="kn"&gt;location&lt;/span&gt; &lt;span class="s"&gt;/&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
        &lt;span class="kn"&gt;root&lt;/span&gt; &lt;span class="s"&gt;/usr/local/www/data/free-sa&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;

        &lt;span class="kn"&gt;location&lt;/span&gt; &lt;span class="p"&gt;~&lt;/span&gt; &lt;span class="sr"&gt;\.cgi$&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
            &lt;span class="kn"&gt;gzip&lt;/span&gt; &lt;span class="no"&gt;off&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="c1"&gt;#gzip makes scripts feel slower since they have to complete before getting gzipped&lt;/span&gt;
            &lt;span class="kn"&gt;fastcgi_pass&lt;/span&gt; &lt;span class="s"&gt;unix:/var/run/fcgiwrap/lightsquid.socket&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
            &lt;span class="kn"&gt;fastcgi_index&lt;/span&gt; &lt;span class="s"&gt;free-sa.cgi&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
            &lt;span class="kn"&gt;fastcgi_param&lt;/span&gt; &lt;span class="s"&gt;SCRIPT_FILENAME&lt;/span&gt; &lt;span class="s"&gt;/usr/local/www/data/free-sa/&lt;/span&gt;&lt;span class="nv"&gt;$fastcgi_script_name&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
            &lt;span class="kn"&gt;fastcgi_param&lt;/span&gt; &lt;span class="s"&gt;QUERY_STRING&lt;/span&gt; &lt;span class="nv"&gt;$query_string&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
            &lt;span class="kn"&gt;fastcgi_param&lt;/span&gt; &lt;span class="s"&gt;REQUEST_METHOD&lt;/span&gt; &lt;span class="nv"&gt;$request_method&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
            &lt;span class="kn"&gt;fastcgi_param&lt;/span&gt; &lt;span class="s"&gt;CONTENT_TYPE&lt;/span&gt; &lt;span class="nv"&gt;$content_type&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
            &lt;span class="kn"&gt;fastcgi_param&lt;/span&gt; &lt;span class="s"&gt;CONTENT_LENGTH&lt;/span&gt; &lt;span class="nv"&gt;$content_length&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
            &lt;span class="kn"&gt;fastcgi_param&lt;/span&gt; &lt;span class="s"&gt;GATEWAY_INTERFACE&lt;/span&gt; &lt;span class="s"&gt;CGI/1.1&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
            &lt;span class="kn"&gt;fastcgi_param&lt;/span&gt; &lt;span class="s"&gt;SERVER_SOFTWARE&lt;/span&gt; &lt;span class="s"&gt;nginx&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
            &lt;span class="kn"&gt;fastcgi_param&lt;/span&gt; &lt;span class="s"&gt;SCRIPT_NAME&lt;/span&gt; &lt;span class="nv"&gt;$fastcgi_script_name&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
            &lt;span class="kn"&gt;fastcgi_param&lt;/span&gt; &lt;span class="s"&gt;REQUEST_URI&lt;/span&gt; &lt;span class="nv"&gt;$request_uri&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
            &lt;span class="kn"&gt;fastcgi_param&lt;/span&gt; &lt;span class="s"&gt;DOCUMENT_URI&lt;/span&gt; &lt;span class="nv"&gt;$document_uri&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
            &lt;span class="kn"&gt;fastcgi_param&lt;/span&gt; &lt;span class="s"&gt;DOCUMENT_ROOT&lt;/span&gt; &lt;span class="nv"&gt;$document_root&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
            &lt;span class="kn"&gt;fastcgi_param&lt;/span&gt; &lt;span class="s"&gt;SERVER_PROTOCOL&lt;/span&gt; &lt;span class="nv"&gt;$server_protocol&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
            &lt;span class="kn"&gt;fastcgi_param&lt;/span&gt; &lt;span class="s"&gt;REMOTE_ADDR&lt;/span&gt; &lt;span class="nv"&gt;$remote_addr&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
            &lt;span class="kn"&gt;fastcgi_param&lt;/span&gt; &lt;span class="s"&gt;REMOTE_PORT&lt;/span&gt; &lt;span class="nv"&gt;$remote_port&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
            &lt;span class="kn"&gt;fastcgi_param&lt;/span&gt; &lt;span class="s"&gt;SERVER_ADDR&lt;/span&gt; &lt;span class="nv"&gt;$server_addr&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
            &lt;span class="kn"&gt;fastcgi_param&lt;/span&gt; &lt;span class="s"&gt;SERVER_PORT&lt;/span&gt; &lt;span class="nv"&gt;$server_port&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
            &lt;span class="kn"&gt;fastcgi_param&lt;/span&gt; &lt;span class="s"&gt;SERVER_NAME&lt;/span&gt; &lt;span class="nv"&gt;$server_name&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
        &lt;span class="p"&gt;}&lt;/span&gt;
    &lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Конечно же каталог с логами должен существовать и права должны быть такие же как у &lt;strong&gt;nginx&lt;/strong&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;mkdir /var/log/nginx
chown www:www /var/log/nginx
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Не забываем про ротацию логов - добавляем в &lt;code&gt;/etc/newsyslog.conf&lt;/code&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="c1"&gt;# nginx&lt;/span&gt;
/var/log/nginx-error.log www:www  &lt;span class="m"&gt;644&lt;/span&gt;  &lt;span class="m"&gt;7&lt;/span&gt;    &lt;span class="m"&gt;900&lt;/span&gt; *     XC /var/run/nginx.pid &lt;span class="m"&gt;30&lt;/span&gt;
/var/log/nginx/*.log  www:www  &lt;span class="m"&gt;644&lt;/span&gt;  &lt;span class="m"&gt;7&lt;/span&gt;    &lt;span class="m"&gt;900&lt;/span&gt; *     GXC /var/run/nginx.pid &lt;span class="m"&gt;30&lt;/span&gt;

&lt;span class="c1"&gt;# rejik&lt;/span&gt;
/usr/local/rejik/redirector.err squid:squid &lt;span class="m"&gt;644&lt;/span&gt;  &lt;span class="m"&gt;10&lt;/span&gt;    &lt;span class="m"&gt;300&lt;/span&gt; *     XC
&lt;span class="c1"&gt;# crontab for Squid&lt;/span&gt;
/var/log/squid/rotate_log.log   &lt;span class="m"&gt;644&lt;/span&gt;  &lt;span class="m"&gt;3&lt;/span&gt;    &lt;span class="m"&gt;100&lt;/span&gt; *     XC
/var/log/squid/ipcadstat.log   &lt;span class="m"&gt;644&lt;/span&gt;  &lt;span class="m"&gt;3&lt;/span&gt;    &lt;span class="m"&gt;100&lt;/span&gt; *     XC
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;И перезапускаем демона &lt;code&gt;newsyslog&lt;/code&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;service newsyslog restart
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;В качестве бонуса привожу скрипт для удобной перезагрузки конфига &lt;em&gt;Squid&lt;/em&gt;. Так как после внесения изменений в конфигурацию &lt;strong&gt;Squid&lt;/strong&gt;, нужно перезапускать сервис,
 либо из консоли давать команду &lt;code&gt;squid -k reconfigure&lt;/code&gt;, что не всегда удобно + если мы допустили ошибку в конфиге ничего хорошего не будет от такой команды
 и уж темболее от перезагрузки сервиса - он не запустится, а у людей не будет интернета, чтобы всего этого избежать я написал простенький скриптик:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="ch"&gt;#!/bin/sh&lt;/span&gt;

&lt;span class="c1"&gt;# Функция вывода цветных сообщений&lt;/span&gt;
COLOR_STR&lt;span class="o"&gt;()&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt;
    &lt;span class="k"&gt;case&lt;/span&gt; &lt;span class="nv"&gt;$2&lt;/span&gt; in
        red&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="nb"&gt;printf&lt;/span&gt; %b &lt;span class="s2"&gt;&amp;quot;\033[1;31m&lt;/span&gt;&lt;span class="nv"&gt;$1&lt;/span&gt;&lt;span class="s2"&gt;\033[0m&amp;quot;&lt;/span&gt; &lt;span class="p"&gt;;;&lt;/span&gt;
        green&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="nb"&gt;printf&lt;/span&gt; %b &lt;span class="s2"&gt;&amp;quot;\033[1;32m&lt;/span&gt;&lt;span class="nv"&gt;$1&lt;/span&gt;&lt;span class="s2"&gt;\033[0m&amp;quot;&lt;/span&gt; &lt;span class="p"&gt;;;&lt;/span&gt;
    &lt;span class="k"&gt;esac&lt;/span&gt;
&lt;span class="o"&gt;}&lt;/span&gt;

squid -k check
&lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="o"&gt;[&lt;/span&gt; &lt;span class="nv"&gt;$?&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="m"&gt;0&lt;/span&gt; &lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="k"&gt;then&lt;/span&gt;
    squid -k reconfigure
    COLOR_STR &lt;span class="s1"&gt;&amp;#39;SUCCESS&amp;#39;&lt;/span&gt; green
    &lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;: Squid config reloaded.&amp;#39;&lt;/span&gt;
&lt;span class="k"&gt;else&lt;/span&gt;
    COLOR_STR &lt;span class="s1"&gt;&amp;#39;ERROR&amp;#39;&lt;/span&gt; red
    &lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;: in Squid config file.&amp;#39;&lt;/span&gt;
&lt;span class="k"&gt;fi&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;В кратце как это работает - скрипт сперва проверяет синтаксис конфига &lt;code&gt;squid -k check&lt;/code&gt;, и если ошибок небыло, то выполняет загрузку нового конфига &lt;code&gt;squid -k reconfigure&lt;/code&gt;,
 если были ошибки, то он выдаст ошибку и &lt;strong&gt;Squid&lt;/strong&gt; останется работать со старым конфигом, следовательно у всех будет интернет, а у вас будет время все исправить.&lt;/p&gt;
&lt;p&gt;И последний конфиг - листинг файла конфигурации &lt;strong&gt;IpCad&lt;/strong&gt; &lt;code&gt;/usr/local/etc/ipcad.conf&lt;/code&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;capture-ports enable&lt;span class="p"&gt;;&lt;/span&gt;

interface lan0 filter &lt;span class="s2"&gt;&amp;quot;ip and dst net 192.168.0.0/16 and not src net 192.168.0.0/16 and not src port 80&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;

aggregate &lt;span class="m"&gt;0&lt;/span&gt;.0.0.0/0 strip &lt;span class="m"&gt;32&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; /* Drop the last octet of all other IPs */

aggregate &lt;span class="m"&gt;110&lt;/span&gt; into &lt;span class="m"&gt;110&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
aggregate &lt;span class="m"&gt;443&lt;/span&gt; into &lt;span class="m"&gt;443&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
aggregate &lt;span class="m"&gt;3129&lt;/span&gt; into &lt;span class="m"&gt;0&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
aggregate &lt;span class="m"&gt;3128&lt;/span&gt; into &lt;span class="m"&gt;0&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
aggregate &lt;span class="m"&gt;3130&lt;/span&gt;-65535 into &lt;span class="m"&gt;65535&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;

rsh &lt;span class="nb"&gt;enable&lt;/span&gt; at &lt;span class="m"&gt;127&lt;/span&gt;.0.0.1&lt;span class="p"&gt;;&lt;/span&gt;
rsh root@127.0.0.1 admin&lt;span class="p"&gt;;&lt;/span&gt;
rsh root@127.0.0.1 backup&lt;span class="p"&gt;;&lt;/span&gt;
rsh root@127.0.0.1&lt;span class="p"&gt;;&lt;/span&gt;
rsh &lt;span class="m"&gt;127&lt;/span&gt;.0.0.1 view-only&lt;span class="p"&gt;;&lt;/span&gt;
rsh &lt;span class="nv"&gt;ttl&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="m"&gt;3&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
rsh &lt;span class="nv"&gt;timeout&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="m"&gt;30&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="nv"&gt;chroot&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; /var/log/ipcad&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="nv"&gt;dumpfile&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; ipcad.dump&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="nv"&gt;pidfile&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; ipcad.pid&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Обратите внимание на строку &lt;code&gt;interface lan0 filter "ip and dst net 192.168.0.0/16 and not src net 192.168.0.0/16 and not src port 80";&lt;/code&gt;
 Эта строка предписывает &lt;code&gt;ipcad&lt;/code&gt; собирать статистику пакетов попадающих в локальную сеть извне (из интернет) на &lt;strong&gt;LAN&lt;/strong&gt;-интерфейсе.
 При этом в статистику не должны попадать пакеты от &lt;strong&gt;squid&lt;/strong&gt; (т.е. те, порт источника которых равен &lt;code&gt;80&lt;/code&gt; - у нас же прозрачный прокси) т.к. &lt;strong&gt;squid&lt;/strong&gt; сам отразит их статистику в своем логе.
 Дублирование статистики нам ни к чему.&lt;/p&gt;
&lt;p&gt;Как и чем заворачивать всех клиентов в &lt;strong&gt;Squid&lt;/strong&gt; выбирайте сами - в интернете полно информации по этому поводу, я приведу 2 примера заворота при помощи &lt;code&gt;pf&lt;/code&gt; и &lt;code&gt;ipfw&lt;/code&gt;:&lt;/p&gt;
&lt;h4&gt;Пример для &lt;code&gt;pf&lt;/code&gt;:&lt;/h4&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="c1"&gt;# редиректим всех, кроме таблицы &amp;lt;no_www_proxy&amp;gt; на наш Proxy сервер, чтобы отфильтровать &amp;quot;Плохие сайты&amp;quot;&lt;/span&gt;
rdr proto tcp from !&amp;lt;no_www_proxy&amp;gt; to !lan0:network port http -&amp;gt; &lt;span class="m"&gt;127&lt;/span&gt;.0.0.1 port &lt;span class="m"&gt;3129&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h4&gt;Пример для &lt;code&gt;ipfw&lt;/code&gt;:&lt;/h4&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="c1"&gt;# Squid transparent redirect&lt;/span&gt;
add fwd &lt;span class="m"&gt;127&lt;/span&gt;.0.0.1,3129 tcp from any to not &lt;span class="m"&gt;192&lt;/span&gt;.168.0.0/16 http via lan0
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Где &lt;code&gt;lan0&lt;/code&gt; - имя локального интерфейса.&lt;/p&gt;
&lt;p&gt;Теперь можно все это добавить в автозагрузку и запустить.&lt;/p&gt;
&lt;p&gt;Вырезка из &lt;code&gt;/etc/rc.conf&lt;/code&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="c1"&gt;#------------------------------ squid ------------------------------------#&lt;/span&gt;
&lt;span class="nv"&gt;squid_enable&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;YES&amp;quot;&lt;/span&gt; &lt;span class="c1"&gt;# Прозрачный прокси, для ведения статистики посещенных сайтов.&lt;/span&gt;
&lt;span class="nv"&gt;ipcad_enable&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;YES&amp;quot;&lt;/span&gt; &lt;span class="c1"&gt;# Для записи в статистику squid&amp;#39;а, всего остального трафика.&lt;/span&gt;
&lt;span class="c1"&gt;#-------------------------------------------------------------------------#&lt;/span&gt;


&lt;span class="c1"&gt;#------------------------------ nginx ------------------------------------#&lt;/span&gt;
&lt;span class="nv"&gt;nginx_enable&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;YES&amp;quot;&lt;/span&gt;  &lt;span class="c1"&gt;# (bool) Set to &amp;quot;NO&amp;quot; by default. Set it to &amp;quot;YES&amp;quot; to enable nginx&lt;/span&gt;

&lt;span class="c1"&gt;#php_fpm_enable=&amp;quot;YES&amp;quot;&lt;/span&gt;

&lt;span class="nv"&gt;fcgiwrap_enable&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;YES&amp;quot;&lt;/span&gt;
&lt;span class="nv"&gt;fcgiwrap_profiles&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;lightsquid&amp;quot;&lt;/span&gt;
&lt;span class="nv"&gt;fcgiwrap_flags&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;-c 4&amp;quot;&lt;/span&gt;
&lt;span class="nv"&gt;fcgiwrap_lightsquid_socket&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;unix:/var/run/fcgiwrap/lightsquid.socket&amp;quot;&lt;/span&gt;
&lt;span class="nv"&gt;fcgiwrap_lightsquid_user&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;www&amp;quot;&lt;/span&gt;
&lt;span class="c1"&gt;#-------------------------------------------------------------------------#&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Запускаем всех демонов:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;service squid start
service ipcad start
service fcgiwrap start
service nginx start
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Пробуем выйти в интернет, открыть запрещенные сайты - все должно работать как и предполагали. Через пять минут пробуем зайти в &lt;strong&gt;Free-SA&lt;/strong&gt; &lt;code&gt;http://squid.local/&lt;/code&gt; и посмотреть статистику.
 Чтобы посмотреть статистику в режиме реального времени нужно открыть ссылку &lt;code&gt;http://squid.local/cgi-bin/&lt;/code&gt;, где &lt;code&gt;squid.local&lt;/code&gt; - имя вашего сервера с &lt;strong&gt;nginx&lt;/strong&gt;.&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;Ссылки по теме:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href="http://rejik.ru/index_ru_6_0.html"&gt;Rejik FAQ: А нельзя ли обойтись без установки локального web сервера?&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://wiki.dieg.info/ipcad"&gt;Wiki - IT рабочие заметки: ipcad&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://www.lissyara.su/articles/freebsd/programms/free-sa/"&gt;lissyara.su: Анализатор статистики Free-SA&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://rootmaster.at.ua/publ/shljuz_dlja_nebolshoj_seti_na_osnove_freebsd/1-1-0-82"&gt;rootmaster.at.ua: шлюз для небольшой сети на основе FreeBSD.&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://ru.doc.pfsense.org/index.php/%D0%9F%D0%BE%D0%B4%D1%81%D1%87%D0%B5%D1%82_%D1%82%D1%80%D0%B0%D1%84%D0%B8%D0%BA%D0%B0_%D1%81_%D0%BF%D0%BE%D0%BC%D0%BE%D1%89%D1%8C%D1%8E_Squid_%D0%B8_ipcad_%D0%B2_pfSense_1.2.3"&gt;Подсчет трафика с помощью Squid и ipcad в pfSense 1.2.3&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://coolchevy.org.ua/2011/11/25/simple-cgi-support-for-nginx/"&gt;coolchevy's blog: Simple CGI support for Nginx&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://habrahabr.ru/post/138984/"&gt;Habrahabr: Вебсервер nginx + fastcgi-wrapper + matlab&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://nginx.localdomain.pl/wiki/FcgiWrap"&gt;nginx.localdomain.pl: Simple CGI support for Nginx (fcgiwrap)&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://www.rejik.ru/index_ru_8_1.html"&gt;Rejik: DBL листы - что это и где взять?&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://free-sa.sourceforge.net/"&gt;Free-SA log processor&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;</content><category term="FreeBSD"></category><category term="rejik"></category><category term="squid"></category><category term="ipcad"></category><category term="Free-SA"></category><category term="nginx"></category><category term="content filter"></category></entry><entry><title>FreeBSD chroot sftp и chroot ssh</title><link href="https://metajiji.github.io/blog/freebsd-chroot-sftp-chroot-ssh/" rel="alternate"></link><published>2013-03-14T00:00:00+07:00</published><updated>2013-03-14T00:00:00+07:00</updated><author><name>Denis Kadyshev</name></author><id>tag:metajiji.github.io,2013-03-14:/blog/freebsd-chroot-sftp-chroot-ssh/</id><summary type="html">&lt;p&gt;Для предоставления доступа через &lt;code&gt;ssh&lt;/code&gt; и &lt;code&gt;sftp&lt;/code&gt; например к файлам сайта, можно использовать штатный для &lt;strong&gt;FreeBSD&lt;/strong&gt; демон &lt;code&gt;sshd&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Для начала добавим в конфиг демона &lt;code&gt;/etc/ssh/sshd_config&lt;/code&gt; строки:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="c1"&gt;############## : BEGIN&lt;/span&gt;
&lt;span class="c1"&gt;#pw usermod sftponly -d /usr/local/www/&lt;/span&gt;
&lt;span class="c1"&gt;#chown root:wheel /usr/local/www/&lt;/span&gt;
&lt;span class="c1"&gt;#AllowGroups wheel sftp&lt;/span&gt;
&lt;span class="c1"&gt;#AllowUsers user1 user2 user3@192 …&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;</summary><content type="html">&lt;p&gt;Для предоставления доступа через &lt;code&gt;ssh&lt;/code&gt; и &lt;code&gt;sftp&lt;/code&gt; например к файлам сайта, можно использовать штатный для &lt;strong&gt;FreeBSD&lt;/strong&gt; демон &lt;code&gt;sshd&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Для начала добавим в конфиг демона &lt;code&gt;/etc/ssh/sshd_config&lt;/code&gt; строки:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="c1"&gt;############## : BEGIN&lt;/span&gt;
&lt;span class="c1"&gt;#pw usermod sftponly -d /usr/local/www/&lt;/span&gt;
&lt;span class="c1"&gt;#chown root:wheel /usr/local/www/&lt;/span&gt;
&lt;span class="c1"&gt;#AllowGroups wheel sftp&lt;/span&gt;
&lt;span class="c1"&gt;#AllowUsers user1 user2 user3@192.168.1.1 user3@192.168.2.*&lt;/span&gt;

Match User web
   ChrootDirectory /home/%u
   X11Forwarding no
   AllowTcpForwarding no

Match Group sftp
   ChrootDirectory %h
   X11Forwarding no
   AllowTcpForwarding no
   ForceCommand internal-sftp
&lt;span class="c1"&gt;############## : END&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Добавляем в систему пользователя &lt;code&gt;sftp&lt;/code&gt; и &lt;code&gt;web&lt;/code&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;FreeBSD# adduser
Username: sftp
Full name:     
Uid &lt;span class="o"&gt;(&lt;/span&gt;Leave empty &lt;span class="k"&gt;for&lt;/span&gt; default&lt;span class="o"&gt;)&lt;/span&gt;: 
Login group &lt;span class="o"&gt;[&lt;/span&gt;sftp&lt;span class="o"&gt;]&lt;/span&gt;: 
Login group is sftp. Invite sftp into other groups? &lt;span class="o"&gt;[]&lt;/span&gt;: 
Login class &lt;span class="o"&gt;[&lt;/span&gt;default&lt;span class="o"&gt;]&lt;/span&gt;: 
Shell &lt;span class="o"&gt;(&lt;/span&gt;sh csh tcsh nologin&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="o"&gt;[&lt;/span&gt;sh&lt;span class="o"&gt;]&lt;/span&gt;: nologin
Home directory &lt;span class="o"&gt;[&lt;/span&gt;/home/sftp&lt;span class="o"&gt;]&lt;/span&gt;: /usr/local/www
Home directory permissions &lt;span class="o"&gt;(&lt;/span&gt;Leave empty &lt;span class="k"&gt;for&lt;/span&gt; default&lt;span class="o"&gt;)&lt;/span&gt;: 
Use password-based authentication? &lt;span class="o"&gt;[&lt;/span&gt;yes&lt;span class="o"&gt;]&lt;/span&gt;: 
Use an empty password? &lt;span class="o"&gt;(&lt;/span&gt;yes/no&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="o"&gt;[&lt;/span&gt;no&lt;span class="o"&gt;]&lt;/span&gt;: 
Use a random password? &lt;span class="o"&gt;(&lt;/span&gt;yes/no&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="o"&gt;[&lt;/span&gt;no&lt;span class="o"&gt;]&lt;/span&gt;: 
Enter password: 
Enter password again: 
Lock out the account after creation? &lt;span class="o"&gt;[&lt;/span&gt;no&lt;span class="o"&gt;]&lt;/span&gt;: 
Username   : sftp
Password   : *****
Full Name  : 
Uid        : &lt;span class="m"&gt;1002&lt;/span&gt;
Class      : 
Groups     : sftp 
Home       : /usr/local/www
Home Mode  : 
Shell      : /usr/sbin/nologin
Locked     : no
OK? &lt;span class="o"&gt;(&lt;/span&gt;yes/no&lt;span class="o"&gt;)&lt;/span&gt;: y
adduser: INFO: Successfully added &lt;span class="o"&gt;(&lt;/span&gt;sftp&lt;span class="o"&gt;)&lt;/span&gt; to the user database.
Add another user? &lt;span class="o"&gt;(&lt;/span&gt;yes/no&lt;span class="o"&gt;)&lt;/span&gt;: y
Username: web
Full name: 
Uid &lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="m"&gt;1003&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;: 
Login group &lt;span class="o"&gt;[&lt;/span&gt;web&lt;span class="o"&gt;]&lt;/span&gt;: 
Login group is web. Invite webb into other groups? &lt;span class="o"&gt;[]&lt;/span&gt;: 
Login class &lt;span class="o"&gt;[&lt;/span&gt;default&lt;span class="o"&gt;]&lt;/span&gt;: 
Shell &lt;span class="o"&gt;(&lt;/span&gt;sh csh tcsh nologin&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="o"&gt;[&lt;/span&gt;sh&lt;span class="o"&gt;]&lt;/span&gt;: csh
Home directory &lt;span class="o"&gt;[&lt;/span&gt;/usr/local/web&lt;span class="o"&gt;]&lt;/span&gt;: /home/web
Home directory permissions &lt;span class="o"&gt;(&lt;/span&gt;Leave empty &lt;span class="k"&gt;for&lt;/span&gt; default&lt;span class="o"&gt;)&lt;/span&gt;: 
Use password-based authentication? &lt;span class="o"&gt;[&lt;/span&gt;yes&lt;span class="o"&gt;]&lt;/span&gt;: 
Use an empty password? &lt;span class="o"&gt;(&lt;/span&gt;yes/no&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="o"&gt;[&lt;/span&gt;no&lt;span class="o"&gt;]&lt;/span&gt;: 
Use a random password? &lt;span class="o"&gt;(&lt;/span&gt;yes/no&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="o"&gt;[&lt;/span&gt;no&lt;span class="o"&gt;]&lt;/span&gt;: 
Enter password: 
Enter password again: 
Lock out the account after creation? &lt;span class="o"&gt;[&lt;/span&gt;no&lt;span class="o"&gt;]&lt;/span&gt;: 
Username   : web
Password   : *****
Full Name  : 
Uid        : &lt;span class="m"&gt;1003&lt;/span&gt;
Class      : 
Groups     : web 
Home       : /home/web
Home Mode  : 
Shell      : /bin/csh
Locked     : no
OK? &lt;span class="o"&gt;(&lt;/span&gt;yes/no&lt;span class="o"&gt;)&lt;/span&gt;: y
adduser: INFO: Successfully added &lt;span class="o"&gt;(&lt;/span&gt;web&lt;span class="o"&gt;)&lt;/span&gt; to the user database.
Add another user? &lt;span class="o"&gt;(&lt;/span&gt;yes/no&lt;span class="o"&gt;)&lt;/span&gt;: n
Goodbye!
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Теперь нужно создать &lt;code&gt;chroot&lt;/code&gt; окружение для пользователя &lt;code&gt;web&lt;/code&gt;, для этого я написал скрипт &lt;code&gt;add_ssh_chrootuser.sh&lt;/code&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="ch"&gt;#!/bin/sh&lt;/span&gt;

&lt;span class="c1"&gt;# Проверка задано ли имя пользователя&lt;/span&gt;
&lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="o"&gt;[&lt;/span&gt; -z &lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;$1&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt; &lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="k"&gt;then&lt;/span&gt;
 &lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;  Usage: &lt;/span&gt;&lt;span class="nv"&gt;$0&lt;/span&gt;&lt;span class="s2"&gt; [ username ]&amp;quot;&lt;/span&gt;
 &lt;span class="nb"&gt;exit&lt;/span&gt; &lt;span class="m"&gt;1&lt;/span&gt;
&lt;span class="k"&gt;fi&lt;/span&gt;

&lt;span class="nv"&gt;USER&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nv"&gt;$1&lt;/span&gt;
&lt;span class="nv"&gt;GID&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="k"&gt;$(&lt;/span&gt;id -g &lt;span class="nv"&gt;$USER&lt;/span&gt;&lt;span class="k"&gt;)&lt;/span&gt;
&lt;span class="nv"&gt;HOMEDIR&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;/home/&lt;span class="nv"&gt;$USER&lt;/span&gt;

&lt;span class="c1"&gt;# Задаем список каталогов в chroot окружении.&lt;/span&gt;
&lt;span class="nv"&gt;SKEL&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;/bin&lt;/span&gt;
&lt;span class="s2"&gt;    /sbin&lt;/span&gt;
&lt;span class="s2"&gt;    /etc&lt;/span&gt;
&lt;span class="s2"&gt;    /home/&lt;/span&gt;&lt;span class="nv"&gt;$USER&lt;/span&gt;&lt;span class="s2"&gt;&lt;/span&gt;
&lt;span class="s2"&gt;    /lib&lt;/span&gt;
&lt;span class="s2"&gt;    /libexec&lt;/span&gt;
&lt;span class="s2"&gt;    /tmp&lt;/span&gt;
&lt;span class="s2"&gt;    /usr/bin&lt;/span&gt;
&lt;span class="s2"&gt;    /usr/share&lt;/span&gt;
&lt;span class="s2"&gt;    /usr/local/bin&lt;/span&gt;
&lt;span class="s2"&gt;    /usr/local/etc&lt;/span&gt;
&lt;span class="s2"&gt;    /usr/local/share&lt;/span&gt;
&lt;span class="s2"&gt;    /usr/local/libexec&amp;quot;&lt;/span&gt;

&lt;span class="c1"&gt;# Создаем структуру каталогов внутри `chroot` окружения&lt;/span&gt;
&lt;span class="k"&gt;for&lt;/span&gt; i in &lt;span class="nv"&gt;$SKEL&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;
    &lt;span class="o"&gt;[&lt;/span&gt; ! -d &lt;span class="nv"&gt;$HOMEDIR$i&lt;/span&gt; &lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt; mkdir -pv &lt;span class="nv"&gt;$HOMEDIR$i&lt;/span&gt;
&lt;span class="k"&gt;done&lt;/span&gt;

&lt;span class="c1"&gt;# Определяем какие библиотеки необходимо скопировать&lt;/span&gt;
&lt;span class="k"&gt;for&lt;/span&gt; item in sh csh zcat cat tbl groff chmod cp &lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="se"&gt;\&lt;/span&gt;
    ln ls date expr mkdir mv &lt;span class="nb"&gt;pwd&lt;/span&gt; locale &lt;span class="se"&gt;\&lt;/span&gt;
    rm rmdir awk bzip2 diff du &lt;span class="se"&gt;\&lt;/span&gt;
    ee fetch find grep gunzip gzip &lt;span class="se"&gt;\&lt;/span&gt;
    more less sed sort tail head &lt;span class="se"&gt;\&lt;/span&gt;
    tar touch vi ee mc mcedit &lt;span class="se"&gt;\&lt;/span&gt;
    mysql mysqldump clear tput reset man zcat troff grotty&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;
    &lt;span class="nv"&gt;p&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="k"&gt;$(&lt;/span&gt;whereis -q &lt;span class="nv"&gt;$item&lt;/span&gt; &lt;span class="p"&gt;|&lt;/span&gt; awk &lt;span class="s1"&gt;&amp;#39;{print $1}&amp;#39;&lt;/span&gt;&lt;span class="k"&gt;)&lt;/span&gt;
    &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="o"&gt;[&lt;/span&gt; -n &lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;$p&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt; &lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="k"&gt;then&lt;/span&gt;
        &lt;span class="c1"&gt;# Копируем бинарники внутрь chroot окружения&lt;/span&gt;
        cp -vf &lt;span class="nv"&gt;$p&lt;/span&gt; &lt;span class="nv"&gt;$HOMEDIR$p&lt;/span&gt;
        ldd &lt;span class="nv"&gt;$p&lt;/span&gt; &lt;span class="p"&gt;|&lt;/span&gt; awk &lt;span class="s1"&gt;&amp;#39;{print $3}&amp;#39;&lt;/span&gt; &lt;span class="p"&gt;|&lt;/span&gt; grep &lt;span class="s1"&gt;&amp;#39;.&amp;#39;&lt;/span&gt; &amp;gt;&amp;gt;/tmp/chroot_liblist
        &lt;span class="c1"&gt;#ldd $CMD_LIST|grep -v &amp;#39;:$&amp;#39;|grep -v &amp;quot;not a dynamic executable&amp;quot;|cut -f 3 -d &amp;quot; &amp;quot;|sort|uniq|sed 1d&lt;/span&gt;
    &lt;span class="k"&gt;else&lt;/span&gt;
        &lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;$item&lt;/span&gt;&lt;span class="s2"&gt; is NOT found, skip!&amp;quot;&lt;/span&gt;
    &lt;span class="k"&gt;fi&lt;/span&gt;
&lt;span class="k"&gt;done&lt;/span&gt;

&lt;span class="c1"&gt;# Копируем библиотеки&lt;/span&gt;
&lt;span class="k"&gt;for&lt;/span&gt; item in &lt;span class="k"&gt;$(&lt;/span&gt;cat /tmp/chroot_liblist &lt;span class="p"&gt;|&lt;/span&gt; sort &lt;span class="p"&gt;|&lt;/span&gt; uniq&lt;span class="k"&gt;)&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;
    cp -vf &lt;span class="nv"&gt;$item&lt;/span&gt; &lt;span class="nv"&gt;$HOMEDIR&lt;/span&gt;/lib/
&lt;span class="k"&gt;done&lt;/span&gt;
&lt;span class="c1"&gt;# Подчищаем за собой&lt;/span&gt;
&lt;span class="o"&gt;[&lt;/span&gt; -f /tmp/chroot_liblist &lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt; rm -vf /tmp/chroot_liblist

&lt;span class="c1"&gt;# Копируем оставшиеся необходимые файлы и библиотеки&lt;/span&gt;
&lt;span class="k"&gt;for&lt;/span&gt; i in /etc/termcap &lt;span class="se"&gt;\&lt;/span&gt;
    /etc/resolv.conf &lt;span class="se"&gt;\&lt;/span&gt;
    /etc/nsswitch.conf &lt;span class="se"&gt;\&lt;/span&gt;
    /libexec/ld-elf.so.1 &lt;span class="se"&gt;\&lt;/span&gt;
    /libexec/ld-elf32.so.1&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;
    cp -vf &lt;span class="nv"&gt;$i&lt;/span&gt; &lt;span class="nv"&gt;$HOMEDIR$i&lt;/span&gt;
&lt;span class="k"&gt;done&lt;/span&gt;

&lt;span class="c1"&gt;# если копировали mc, то копируем все необходимые для mc файлы.&lt;/span&gt;
&lt;span class="k"&gt;for&lt;/span&gt; i in /usr/local/share/mc &lt;span class="se"&gt;\&lt;/span&gt;
    /usr/local/libexec/mc &lt;span class="se"&gt;\&lt;/span&gt;
    /usr/local/etc/mc &lt;span class="se"&gt;\&lt;/span&gt;
    /usr/local/man &lt;span class="se"&gt;\&lt;/span&gt;
    /usr/share/man &lt;span class="se"&gt;\&lt;/span&gt;
    /usr/share/groff_font &lt;span class="se"&gt;\&lt;/span&gt;
    /usr/share/tmac&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;
    cp -vfR &lt;span class="nv"&gt;$i&lt;/span&gt; &lt;span class="nv"&gt;$HOMEDIR$i&lt;/span&gt;
&lt;span class="k"&gt;done&lt;/span&gt;

&lt;span class="c1"&gt;# Если копировали mysql клиента, то настроим дефолтные опции.&lt;/span&gt;
cat &amp;gt;&lt;span class="nv"&gt;$HOMEDIR&lt;/span&gt;/usr/local/etc/my.cnf&lt;span class="s"&gt;&amp;lt;&amp;lt;-_EOF&lt;/span&gt;
&lt;span class="s"&gt;    [client]&lt;/span&gt;
&lt;span class="s"&gt;    port=3306&lt;/span&gt;
&lt;span class="s"&gt;    host=192.168.120.2&lt;/span&gt;
&lt;span class="s"&gt;_EOF&lt;/span&gt;

&lt;span class="c1"&gt;# Генерируем /etc/motd для chroot окружения&lt;/span&gt;
&lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;Welcome to chroot environment&amp;#39;&lt;/span&gt; &amp;gt; &lt;span class="nv"&gt;$HOMEDIR&lt;/span&gt;/etc/motd

&lt;span class="c1"&gt;# Генерируем csh.cshrc для chroot окружения&lt;/span&gt;
&lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;setenv TERMCAP /etc/termcap&amp;#39;&lt;/span&gt; &amp;gt; &lt;span class="nv"&gt;$HOMEDIR&lt;/span&gt;/etc/csh.cshrc
cp -fv /.cshrc &lt;span class="nv"&gt;$HOMEDIR&lt;/span&gt;/home/&lt;span class="nv"&gt;$USER&lt;/span&gt;/

&lt;span class="c1"&gt;#т.к. man требует зачем-то наличие /sbin/sysctl, то создаем заглушку - пустой файл с правами запуска.&lt;/span&gt;
&lt;span class="o"&gt;[&lt;/span&gt; ! -d &lt;span class="nv"&gt;$HOMEDIR&lt;/span&gt;/sbin/ &lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt; mkdir -pv &lt;span class="nv"&gt;$HOMEDIR&lt;/span&gt;/sbin
&lt;span class="o"&gt;[&lt;/span&gt; ! -x &lt;span class="nv"&gt;$HOMEDIR&lt;/span&gt;/sbin/sysctl &lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt; chmod -v +x &lt;span class="nv"&gt;$HOMEDIR&lt;/span&gt;/sbin/sysctl

&lt;span class="c1"&gt;# Генерируем /etc/group для chroot окружения&lt;/span&gt;
grep &lt;span class="nv"&gt;$GID&lt;/span&gt; /etc/group &amp;gt; &lt;span class="nv"&gt;$HOMEDIR&lt;/span&gt;/etc/group

&lt;span class="c1"&gt;# Переносим запись о пользователе&lt;/span&gt;
grep &lt;span class="s2"&gt;&amp;quot;^&lt;/span&gt;&lt;span class="nv"&gt;$USER&lt;/span&gt;&lt;span class="s2"&gt;:&amp;quot;&lt;/span&gt; /etc/master.passwd &amp;gt; &lt;span class="nv"&gt;$HOMEDIR&lt;/span&gt;/etc/master.passwd
pwd_mkdb -d &lt;span class="nv"&gt;$HOMEDIR&lt;/span&gt;/etc &lt;span class="nv"&gt;$HOMEDIR&lt;/span&gt;/etc/master.passwd

&lt;span class="c1"&gt;# Выставляем права&lt;/span&gt;
chown root:wheel &lt;span class="nv"&gt;$HOMEDIR&lt;/span&gt;
chmod &lt;span class="m"&gt;755&lt;/span&gt; &lt;span class="nv"&gt;$HOMEDIR&lt;/span&gt;
chmod &lt;span class="m"&gt;777&lt;/span&gt; &lt;span class="nv"&gt;$HOMEDIR&lt;/span&gt;/tmp

&lt;span class="k"&gt;for&lt;/span&gt; i in &lt;span class="nv"&gt;$SKEL&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;
    chown -vR &lt;span class="nv"&gt;$USER&lt;/span&gt;:&lt;span class="nv"&gt;$GID&lt;/span&gt; &lt;span class="nv"&gt;$HOMEDIR$i&lt;/span&gt;
&lt;span class="k"&gt;done&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Затем запускаем скрипт, указывая пользователя web:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;sh add_ssh_chrootuser.sh web
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;В каталоге &lt;code&gt;/home/web&lt;/code&gt; будет создана структура каталогов системы и будут скопированы программы и все необходимые для их запуска библиотеки.
 В скрипте я копирую минимальный набор, которого хватает для чтения логов &lt;code&gt;nginx&lt;/code&gt;, работы с &lt;code&gt;mysql&lt;/code&gt; и некоторые другие программки - например &lt;code&gt;mc&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Перезапускаем демона &lt;code&gt;sshd&lt;/code&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;FreeBSD# service sshd restart
Stopping sshd.
Starting sshd.
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Все готово! Можно подключаться под созданными учетными записями.&lt;/p&gt;
&lt;p&gt;Пользователь &lt;code&gt;web&lt;/code&gt; при подключении по &lt;code&gt;ssh&lt;/code&gt;, попадет в &lt;code&gt;chroot&lt;/code&gt; окружение, которое было создано скриптом, а пользователь &lt;code&gt;sftp&lt;/code&gt; не сможет входить по &lt;code&gt;ssh&lt;/code&gt;,
 но сможет сводобно работать по &lt;code&gt;sftp&lt;/code&gt; протоколу, и самое главное, для него будет коневым каталогом &lt;code&gt;/usr/local/www&lt;/code&gt;, за его пределы он не сможет выйти.&lt;/p&gt;
&lt;p&gt;P.S. Важно, чтобы права на &lt;strong&gt;chroot&lt;/strong&gt; директории были &lt;code&gt;chmod 755&lt;/code&gt; и владелец &lt;code&gt;root:wheel&lt;/code&gt;, в противном случае пользователи не смогут войти.&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;Ссылки по теме:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href="http://www.lissyara.su/articles/freebsd/trivia/sftp+chroot/"&gt;lissyara.su - "Использование sftp+chroot из openssh в качестве альтернативы ftp-серверу."&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://wolandblog.com/1082-bash-sozdanie-chroot-okruzheniya-dlya-ssh-chroot-v-freebsd/"&gt;WOLAND's blog - "BASH. Создание chroot окружения для SSH chroot в FreeBSD."&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://forums.freebsd.org/showthread.php?t=19632"&gt;Forums.freebsd.org - [Solved] sftp/scp chroot solution?&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://www.hilik.org.ua/chroot-ssh-%D0%B4%D0%BE%D1%81%D1%82%D1%83%D0%BF-%D0%BD%D0%B0%D1%81%D1%82%D1%80%D0%BE%D0%B9%D0%BA%D0%B0/"&gt;Hilink - "chroot ssh доступ. Настройка."&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://al.ndd.ru/man/ssh-chroot_howto.html"&gt;Под защитой песочного демона (Евгений Зобнин) - Хакер, номер #093, стр. 093-118-4&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://www.opennet.ru/openforum/vsluhforumID1/46802.html"&gt;opennet.ru - "ssh chroot"&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;</content><category term="FreeBSD"></category><category term="Linux"></category><category term="chroot"></category><category term="ssh"></category><category term="sftp"></category><category term="sftponly"></category></entry><entry><title>Восстановление ассоциаций офисных документов в Microsoft Office Starter 2010</title><link href="https://metajiji.github.io/blog/microsoft-office-starter-2010-file-associations/" rel="alternate"></link><published>2013-03-10T00:00:00+07:00</published><updated>2013-03-10T00:00:00+07:00</updated><author><name>Denis Kadyshev</name></author><id>tag:metajiji.github.io,2013-03-10:/blog/microsoft-office-starter-2010-file-associations/</id><summary type="html">&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="p"&gt;@&lt;/span&gt;&lt;span class="k"&gt;ECHO&lt;/span&gt; OFF

&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="c1"&gt;: http://support.microsoft.com/KB/323526&lt;/span&gt;

&lt;span class="k"&gt;ASSOC&lt;/span&gt; .doc=Word.Document.8
&lt;span class="k"&gt;ASSOC&lt;/span&gt; .docx=Word.Document.12
&lt;span class="k"&gt;ASSOC&lt;/span&gt; .xls=Excel.Sheet.8
&lt;span class="k"&gt;ASSOC&lt;/span&gt; .xlsx=Excel.Sheet.12

&lt;span class="k"&gt;PAUSE&lt;/span&gt;

&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="c1"&gt;:.mdb=Access.MDBFile&lt;/span&gt;
&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="c1"&gt;:.ppt=PowerPoint.Show.8&lt;/span&gt;
&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="c1"&gt;:.doc=Word.Document.8&lt;/span&gt;
&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="c1"&gt;:.docx=Word.Document.12&lt;/span&gt;
&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="c1"&gt;:.xls=Excel.Sheet.8&lt;/span&gt;
&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="c1"&gt;:.xlsx=Excel …&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;</summary><content type="html">&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="p"&gt;@&lt;/span&gt;&lt;span class="k"&gt;ECHO&lt;/span&gt; OFF

&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="c1"&gt;: http://support.microsoft.com/KB/323526&lt;/span&gt;

&lt;span class="k"&gt;ASSOC&lt;/span&gt; .doc=Word.Document.8
&lt;span class="k"&gt;ASSOC&lt;/span&gt; .docx=Word.Document.12
&lt;span class="k"&gt;ASSOC&lt;/span&gt; .xls=Excel.Sheet.8
&lt;span class="k"&gt;ASSOC&lt;/span&gt; .xlsx=Excel.Sheet.12

&lt;span class="k"&gt;PAUSE&lt;/span&gt;

&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="c1"&gt;:.mdb=Access.MDBFile&lt;/span&gt;
&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="c1"&gt;:.ppt=PowerPoint.Show.8&lt;/span&gt;
&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="c1"&gt;:.doc=Word.Document.8&lt;/span&gt;
&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="c1"&gt;:.docx=Word.Document.12&lt;/span&gt;
&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="c1"&gt;:.xls=Excel.Sheet.8&lt;/span&gt;
&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="c1"&gt;:.xlsx=Excel.Sheet.12&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;hr&gt;
&lt;p&gt;Ссылки по теме:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href="http://support.microsoft.com/KB/323526"&gt;ПРАКТИЧЕСКОЕ руководство: Использование команды ASSOC для отображения и изменения связей расширений имен файлов в Windows 2000&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;</content><category term="Windows"></category><category term="Office"></category><category term="file associations"></category><category term="ASSOC"></category></entry><entry><title>Блокирование рекламы в Skype 6.11.66.102 bat,cmd файл.</title><link href="https://metajiji.github.io/blog/windows-skype-disable-ad/" rel="alternate"></link><published>2013-02-20T00:00:00+07:00</published><updated>2013-02-20T00:00:00+07:00</updated><author><name>Denis Kadyshev</name></author><id>tag:metajiji.github.io,2013-02-20:/blog/windows-skype-disable-ad/</id><summary type="html">&lt;p&gt;Для блокировки назойливой рекламы, которая к тому же сделана на *&lt;em&gt;Flash&lt;/em&gt;, что сильно мешает нормальной работе за комптютером, был написан простенький &lt;code&gt;bat&lt;/code&gt; файл:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="p"&gt;@&lt;/span&gt;&lt;span class="k"&gt;ECHO&lt;/span&gt; OFF
CHCP 866 &lt;span class="p"&gt;&amp;gt;&lt;/span&gt;nul

&lt;span class="k"&gt;FOR&lt;/span&gt; &lt;span class="se"&gt;%%&lt;/span&gt;a &lt;span class="k"&gt;IN&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;rad.msn.com apps.skype.com&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="k"&gt;DO&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;
    &lt;span class="k"&gt;TYPE&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;%SystemRoot%&lt;/span&gt;&lt;span class="s2"&gt;\system32\drivers\etc\hosts&amp;quot;&lt;/span&gt; &lt;span class="p"&gt;|&lt;/span&gt; FIND /I &lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="se"&gt;%%&lt;/span&gt;&lt;span class="s2"&gt;a&amp;quot;&lt;/span&gt; &lt;span class="p"&gt;|&lt;/span&gt; FIND &lt;span class="s2"&gt;&amp;quot;127.0 …&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;</summary><content type="html">&lt;p&gt;Для блокировки назойливой рекламы, которая к тому же сделана на *&lt;em&gt;Flash&lt;/em&gt;, что сильно мешает нормальной работе за комптютером, был написан простенький &lt;code&gt;bat&lt;/code&gt; файл:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="p"&gt;@&lt;/span&gt;&lt;span class="k"&gt;ECHO&lt;/span&gt; OFF
CHCP 866 &lt;span class="p"&gt;&amp;gt;&lt;/span&gt;nul

&lt;span class="k"&gt;FOR&lt;/span&gt; &lt;span class="se"&gt;%%&lt;/span&gt;a &lt;span class="k"&gt;IN&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;rad.msn.com apps.skype.com&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="k"&gt;DO&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;
    &lt;span class="k"&gt;TYPE&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;%SystemRoot%&lt;/span&gt;&lt;span class="s2"&gt;\system32\drivers\etc\hosts&amp;quot;&lt;/span&gt; &lt;span class="p"&gt;|&lt;/span&gt; FIND /I &lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="se"&gt;%%&lt;/span&gt;&lt;span class="s2"&gt;a&amp;quot;&lt;/span&gt; &lt;span class="p"&gt;|&lt;/span&gt; FIND &lt;span class="s2"&gt;&amp;quot;127.0.0.1&amp;quot;&lt;/span&gt; &lt;span class="p"&gt;&amp;gt;&lt;/span&gt;nul &lt;span class="p"&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class="k"&gt;ECHO&lt;/span&gt;.&lt;span class="se"&gt;%%&lt;/span&gt;a уже заблокирован! &lt;span class="p"&gt;||&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&amp;gt;&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;%SystemRoot%&lt;/span&gt;&lt;span class="s2"&gt;\system32\drivers\etc\hosts&amp;quot;&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;ECHO&lt;/span&gt;.127.0.0.1 &lt;span class="se"&gt;%%&lt;/span&gt;a&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class="k"&gt;ECHO&lt;/span&gt;.&lt;span class="se"&gt;%%&lt;/span&gt;a заблокирован! &lt;span class="p"&gt;||&lt;/span&gt; &lt;span class="k"&gt;ECHO&lt;/span&gt;.Ошибка записи! &lt;span class="p"&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class="k"&gt;PAUSE&lt;/span&gt; &lt;span class="p"&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class="k"&gt;EXIT&lt;/span&gt;
&lt;span class="p"&gt;)&lt;/span&gt;

&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="c1"&gt;: Reset DNS cache&lt;/span&gt;
IPCONFIG /flushdns

&lt;span class="k"&gt;PAUSE&lt;/span&gt;
&lt;span class="k"&gt;EXIT&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Скопировать текст скрипта, сохранить как &lt;code&gt;Block_SkypeAD.bat&lt;/code&gt; в кодировке &lt;code&gt;cp866&lt;/code&gt; (&lt;strong&gt;DOS&lt;/strong&gt;) и запустить.&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;Ссылки по теме:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href="http://yoursitename.ru/0713-reklama-skype/"&gt;Реклама в скайпе&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://community.skype.com/t5/Общий-Форум/Как-отключить-дурацкую-рекламу-в-скайп/td-p/811628"&gt;Как отключить дурацкую рекламу в скайп???????&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;</content><category term="Windows"></category><category term="Skype"></category><category term="block ad"></category><category term="disable spam"></category><category term="spam"></category></entry><entry><title>Ubuntu Gnome-Terminal - включение beep enable system-beep, audible ping, bell, подавать гудок.</title><link href="https://metajiji.github.io/blog/ubuntu-gnome-terminal-enable-system-beep/" rel="alternate"></link><published>2013-01-30T00:00:00+07:00</published><updated>2013-01-30T00:00:00+07:00</updated><author><name>Denis Kadyshev</name></author><id>tag:metajiji.github.io,2013-01-30:/blog/ubuntu-gnome-terminal-enable-system-beep/</id><summary type="html">&lt;p&gt;Первым делом необходимо установить утилиту &lt;code&gt;beep&lt;/code&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;sudo apt-get install beep
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Затем нужно разрешить загрузку модуля &lt;code&gt;pcspkr&lt;/code&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;sudo sed -i&lt;span class="s1"&gt;&amp;#39;&amp;#39;&lt;/span&gt; -e &lt;span class="s1"&gt;&amp;#39;s/blacklist pcspkr/#blacklist pcspkr/&amp;#39;&lt;/span&gt; /etc/modprobe.d/blacklist.conf
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Либо, если Beep поддерживает звуковая карта ноутбука, попробовать активировать эту функцию:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;cat &amp;gt;&amp;gt;/etc/modprobe.d/alsa-base.conf&lt;span class="s"&gt;&amp;lt;&amp;lt;-_EOF&lt;/span&gt;

&lt;span class="s"&gt;#Enable Beep …&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;</summary><content type="html">&lt;p&gt;Первым делом необходимо установить утилиту &lt;code&gt;beep&lt;/code&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;sudo apt-get install beep
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Затем нужно разрешить загрузку модуля &lt;code&gt;pcspkr&lt;/code&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;sudo sed -i&lt;span class="s1"&gt;&amp;#39;&amp;#39;&lt;/span&gt; -e &lt;span class="s1"&gt;&amp;#39;s/blacklist pcspkr/#blacklist pcspkr/&amp;#39;&lt;/span&gt; /etc/modprobe.d/blacklist.conf
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Либо, если Beep поддерживает звуковая карта ноутбука, попробовать активировать эту функцию:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;cat &amp;gt;&amp;gt;/etc/modprobe.d/alsa-base.conf&lt;span class="s"&gt;&amp;lt;&amp;lt;-_EOF&lt;/span&gt;

&lt;span class="s"&gt;#Enable Beep&lt;/span&gt;
&lt;span class="s"&gt;#https://bugs.launchpad.net/ubuntu/+source/beep/+bug/144022&lt;/span&gt;
&lt;span class="s"&gt;options snd-hda-intel power_save=10 power_save_controller=Y index=0 beep_mode=1&lt;/span&gt;
&lt;span class="s"&gt;_EOF&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Для включения сигналов в &lt;code&gt;gnome-terminal&lt;/code&gt; нужно включить в &lt;code&gt;metacity&lt;/code&gt; параметр &lt;code&gt;audible_bell&lt;/code&gt; и в самом &lt;code&gt;gnome-terminal&lt;/code&gt; проверить наличие галочки "&lt;strong&gt;Подавать гудок&lt;/strong&gt;".&lt;/p&gt;
&lt;p&gt;Я сделал это через консоль:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;gconftool-2 --set --type bool &lt;span class="s2"&gt;&amp;quot;/apps/gnome-terminal/profiles/Default/silent_bell&amp;quot;&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;false&amp;quot;&lt;/span&gt;
gconftool-2 --set --type string &lt;span class="s2"&gt;&amp;quot;/apps/metacity/general/audible_bell&amp;quot;&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;on&amp;quot;&lt;/span&gt;
gsettings &lt;span class="nb"&gt;set&lt;/span&gt; org.gnome.desktop.wm.preferences audible-bell &lt;span class="s1"&gt;&amp;#39;true&amp;#39;&lt;/span&gt;
gconftool-2 --set --type string &lt;span class="s2"&gt;&amp;quot;/desktop/gnome/peripherals/keyboard/bell_mode&amp;quot;&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;on&amp;quot;&lt;/span&gt;
gsettings &lt;span class="nb"&gt;set&lt;/span&gt; org.gnome.settings-daemon.peripherals.keyboard bell-mode &lt;span class="s1"&gt;&amp;#39;on&amp;#39;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Проверяем:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nb"&gt;echo&lt;/span&gt; -e &lt;span class="s2"&gt;&amp;quot;\a&amp;quot;&lt;/span&gt;
&lt;span class="nb"&gt;echo&lt;/span&gt; -e &lt;span class="s1"&gt;&amp;#39;\a&amp;#39;&lt;/span&gt;
ping -a ya.ru
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;У меня после этих манипуляций был слышен звук, как и в системной консоли.
Регулировать громкость сигнала можно через &lt;code&gt;alsamixer&lt;/code&gt; в консоли - параметр &lt;code&gt;Beep&lt;/code&gt;, у меня он почему-то был почти около нуля и я добавил громкости.&lt;/p&gt;
&lt;p&gt;Но радоваться рано, после перезагрузки гудок пропал. Выяснилось, что если отключить гудок и включить его снова, то все работает, но до следующей перезагрузки :(&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;gsettings &lt;span class="nb"&gt;set&lt;/span&gt; org.gnome.desktop.wm.preferences audible-bell &lt;span class="s1"&gt;&amp;#39;false&amp;#39;&lt;/span&gt;
gsettings &lt;span class="nb"&gt;set&lt;/span&gt; org.gnome.desktop.wm.preferences audible-bell &lt;span class="s1"&gt;&amp;#39;true&amp;#39;&lt;/span&gt;
&lt;span class="nb"&gt;echo&lt;/span&gt; -e &lt;span class="s1"&gt;&amp;#39;\a&amp;#39;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Немного подумав, сделал такой костыль:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;cat &amp;gt;&amp;gt;~/.bashrc&lt;span class="s"&gt;&amp;lt;&amp;lt;-_EOF&lt;/span&gt;
&lt;span class="s"&gt;if [ -n &amp;quot;$DISPLAY&amp;quot; ]; then&lt;/span&gt;
&lt;span class="s"&gt;    gsettings set org.gnome.desktop.wm.preferences audible-bell &amp;#39;false&amp;#39;&lt;/span&gt;
&lt;span class="s"&gt;    gsettings set org.gnome.desktop.wm.preferences audible-bell &amp;#39;true&amp;#39;&lt;/span&gt;
&lt;span class="s"&gt;fi&lt;/span&gt;
&lt;span class="s"&gt;_EOF&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Буду крайне признателен, если кто-то подскажет более изящное решение.&lt;/p&gt;
&lt;p&gt;P.S. Может кому пригодится, приведу еще дополнительные опции из &lt;code&gt;gconftool&lt;/code&gt; и &lt;code&gt;gsettings&lt;/code&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;Ubuntu~$ gsettings list-recursively &lt;span class="p"&gt;|&lt;/span&gt; grep bell
org.gnome.desktop.wm.preferences audible-bell &lt;span class="nb"&gt;true&lt;/span&gt;
org.gnome.desktop.wm.preferences visual-bell &lt;span class="nb"&gt;false&lt;/span&gt;
org.gnome.desktop.wm.preferences visual-bell-type &lt;span class="s1"&gt;&amp;#39;fullscreen-flash&amp;#39;&lt;/span&gt;
org.gnome.settings-daemon.peripherals.keyboard bell-custom-file &lt;span class="s1"&gt;&amp;#39;&amp;#39;&lt;/span&gt;
org.gnome.settings-daemon.peripherals.keyboard bell-duration &lt;span class="m"&gt;100&lt;/span&gt;
org.gnome.settings-daemon.peripherals.keyboard bell-mode &lt;span class="s1"&gt;&amp;#39;on&amp;#39;&lt;/span&gt;
org.gnome.settings-daemon.peripherals.keyboard bell-pitch &lt;span class="m"&gt;400&lt;/span&gt;

Ubuntu~$ gconftool -R /desktop &lt;span class="p"&gt;|&lt;/span&gt; grep -B4 bell
  /desktop/gnome/peripherals:
   /desktop/gnome/peripherals/keyboard:
    &lt;span class="nv"&gt;repeat&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;true&lt;/span&gt;
    &lt;span class="nv"&gt;delay&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="m"&gt;500&lt;/span&gt;
    &lt;span class="nv"&gt;bell_mode&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; off
    &lt;span class="nv"&gt;bell_custom_file&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="o"&gt;(&lt;/span&gt;значение не установлено&lt;span class="o"&gt;)&lt;/span&gt;
    &lt;span class="nv"&gt;remember_numlock_state&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;true&lt;/span&gt;
    &lt;span class="nv"&gt;click_volume&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="m"&gt;0&lt;/span&gt;
    &lt;span class="nv"&gt;click&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;true&lt;/span&gt;
    &lt;span class="nv"&gt;bell_pitch&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="m"&gt;400&lt;/span&gt;
    &lt;span class="nv"&gt;bell_duration&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="m"&gt;100&lt;/span&gt;

Ubuntu~$ gconftool -R /apps &lt;span class="p"&gt;|&lt;/span&gt; grep -B20 bell
&lt;/pre&gt;&lt;/div&gt;


&lt;hr&gt;
&lt;p&gt;Ссылки по теме:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href="https://bugs.launchpad.net/ubuntu/+source/metacity/+bug/486154/comments/50"&gt;Comment 50 for bug 486154&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://ubuntuforums.org/showthread.php?t=1331186"&gt;Trying to ENABLE bell in gnome-terminal&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://bugs.launchpad.net/ubuntu/+source/beep/+bug/144022/comments/18"&gt;Comment 18 for bug 144022&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;</content><category term="Ubuntu"></category><category term="Linux"></category><category term="System beep"></category><category term="speaker"></category></entry><entry><title>Linux Ubuntu создаем файл подкачки Swap</title><link href="https://metajiji.github.io/blog/linux-ubuntu-swap-to-file/" rel="alternate"></link><published>2012-12-27T00:00:00+07:00</published><updated>2012-12-27T00:00:00+07:00</updated><author><name>Denis Kadyshev</name></author><id>tag:metajiji.github.io,2012-12-27:/blog/linux-ubuntu-swap-to-file/</id><summary type="html">&lt;p&gt;Обычно &lt;strong&gt;swap&lt;/strong&gt; создают размером в 2 раза превышающим размер доступной оперативной памяти.&lt;/p&gt;
&lt;p&gt;Шаг первый: Создадим файл с помощью команды низкоуровневого копирования &lt;code&gt;dd&lt;/code&gt; Файл забьём нулями из &lt;code&gt;/dev/zero&lt;/code&gt; и разметим на &lt;code&gt;256&lt;/code&gt; блоков по &lt;code&gt;1Мб&lt;/code&gt; каждый:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;sudo dd &lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;/dev/zero &lt;span class="nv"&gt;of&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;/swap256.swap &lt;span class="nv"&gt;bs&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;1M &lt;span class="nv"&gt;count&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;256&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Шаг второй …&lt;/p&gt;</summary><content type="html">&lt;p&gt;Обычно &lt;strong&gt;swap&lt;/strong&gt; создают размером в 2 раза превышающим размер доступной оперативной памяти.&lt;/p&gt;
&lt;p&gt;Шаг первый: Создадим файл с помощью команды низкоуровневого копирования &lt;code&gt;dd&lt;/code&gt; Файл забьём нулями из &lt;code&gt;/dev/zero&lt;/code&gt; и разметим на &lt;code&gt;256&lt;/code&gt; блоков по &lt;code&gt;1Мб&lt;/code&gt; каждый:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;sudo dd &lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;/dev/zero &lt;span class="nv"&gt;of&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;/swap256.swap &lt;span class="nv"&gt;bs&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;1M &lt;span class="nv"&gt;count&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;256&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Шаг второй: отформатируем получившийся файл как &lt;strong&gt;swap&lt;/strong&gt; устройство:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;sudo mkswap /swap256.swap
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Шаг третий: подключаем отформатированный файл (после второго шага это уже полноценный &lt;strong&gt;swap&lt;/strong&gt;) с помощью команды &lt;code&gt;swapon&lt;/code&gt; которая как раз для этого и предназначена.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;sudo swapon /swap256.swap
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Четвёртый шаг: делаем так чтобы &lt;strong&gt;swap&lt;/strong&gt; файл подключался каждый раз при загрузке системы. Для этого в &lt;code&gt;/etc/fstab&lt;/code&gt; добавляем одну строчку:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;/swap256.swap none swap sw &lt;span class="m"&gt;0&lt;/span&gt; &lt;span class="m"&gt;0&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Контролировать использование &lt;strong&gt;swap&lt;/strong&gt; можно как обычно через опцию &lt;code&gt;sysctl vm.swappiness&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;У меня в &lt;code&gt;/etc/sysctl.conf&lt;/code&gt; прописано:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;vm.swappiness&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;10&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Это значит, что система будет использовать &lt;strong&gt;swap&lt;/strong&gt;, если останется &lt;code&gt;10%&lt;/code&gt; от объема оперативной памяти.&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;Ссылки по теме:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href="http://pintograss.blogspot.ru/2011/03/ubuntu-swap.html"&gt;Ubuntu. Как создать swap файл подкачки&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://en.wikipedia.org/wiki/Swappiness"&gt;Swappiness&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;</content><category term="Linux"></category><category term="Ubuntu"></category><category term="Swap"></category><category term="Swap to file"></category></entry><entry><title>Asterisk 1.8 и статистика по SNMP в zabbix</title><link href="https://metajiji.github.io/blog/freebsd_asterisk-18-snmp-zabbix/" rel="alternate"></link><published>2012-12-26T00:00:00+07:00</published><updated>2012-12-26T00:00:00+07:00</updated><author><name>Denis Kadyshev</name></author><id>tag:metajiji.github.io,2012-12-26:/blog/freebsd_asterisk-18-snmp-zabbix/</id><summary type="html">&lt;p&gt;Прежде чем начинать собирать статистику с &lt;strong&gt;Asterisk&lt;/strong&gt; по протоколу &lt;code&gt;snmp&lt;/code&gt;, нужно чтобы в нем был модуль &lt;code&gt;res_snmp.so&lt;/code&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;FreeBSD# asterisk -rvvvv
...
pbx*CLI&amp;gt; module show like snmp
Module           Description                    Use Count
res_snmp.so      SNMP &lt;span class="o"&gt;[&lt;/span&gt;Sub&lt;span class="o"&gt;]&lt;/span&gt;Agent &lt;span class="k"&gt;for&lt;/span&gt; Asterisk   &lt;span class="m"&gt;0&lt;/span&gt;
&lt;span class="m"&gt;1&lt;/span&gt; modules loaded
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Как видим, все на месте. Для тех, у …&lt;/p&gt;</summary><content type="html">&lt;p&gt;Прежде чем начинать собирать статистику с &lt;strong&gt;Asterisk&lt;/strong&gt; по протоколу &lt;code&gt;snmp&lt;/code&gt;, нужно чтобы в нем был модуль &lt;code&gt;res_snmp.so&lt;/code&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;FreeBSD# asterisk -rvvvv
...
pbx*CLI&amp;gt; module show like snmp
Module           Description                    Use Count
res_snmp.so      SNMP &lt;span class="o"&gt;[&lt;/span&gt;Sub&lt;span class="o"&gt;]&lt;/span&gt;Agent &lt;span class="k"&gt;for&lt;/span&gt; Asterisk   &lt;span class="m"&gt;0&lt;/span&gt;
&lt;span class="m"&gt;1&lt;/span&gt; modules loaded
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Как видим, все на месте. Для тех, у кого это нет этого модуля, нужно пересобрать порт с нужной опцией:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;FreeBSD# make config
...
&lt;span class="o"&gt;[&lt;/span&gt;*&lt;span class="o"&gt;]&lt;/span&gt; SNMP      SNMP protocol
...
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Когда разобрались с наличием модуля, идем в конфиг &lt;code&gt;/usr/local/etc/asterisk/res_snmp.conf&lt;/code&gt; и включаем &lt;strong&gt;SNMP&lt;/strong&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;general&lt;span class="o"&gt;]&lt;/span&gt;
&lt;span class="p"&gt;;&lt;/span&gt; We run as a subagent per default -- to run as a full agent
&lt;span class="p"&gt;;&lt;/span&gt; we must run as root &lt;span class="o"&gt;(&lt;/span&gt;to be able to &lt;span class="nb"&gt;bind&lt;/span&gt; to port &lt;span class="m"&gt;161&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt;
&lt;span class="nv"&gt;subagent&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; yes
&lt;span class="p"&gt;;&lt;/span&gt; SNMP must be explicitly enabled to be active
&lt;span class="nv"&gt;enabled&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; yes
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Как видим, &lt;strong&gt;Asterisk&lt;/strong&gt; не может открыть &lt;code&gt;161&lt;/code&gt; порт (на этом порту работает протокол &lt;code&gt;snmp&lt;/code&gt;), если он запущен не от пользователя &lt;code&gt;root&lt;/code&gt;.
 Но не беда, по умолчанию &lt;code&gt;asterisk&lt;/code&gt; работает как суб-агент &lt;code&gt;snmp&lt;/code&gt; это значит, что он может отдавать данные в демон &lt;code&gt;snmpd&lt;/code&gt; через сокет и ему не надо будет открывать &lt;code&gt;161&lt;/code&gt; порт.
Готовим конфиг для &lt;code&gt;snmp&lt;/code&gt;, вот мой конфиг &lt;code&gt;/usr/local/etc/snmp/snmpd.conf&lt;/code&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;syslocation  &lt;span class="s2"&gt;&amp;quot;Univers Server Room&amp;quot;&lt;/span&gt;
syscontact  admin@my_organization_dom
rocommunity  public ТУТ_IP_сервера_zabbix

master agentx
agentXPerms  &lt;span class="m"&gt;0660&lt;/span&gt; &lt;span class="m"&gt;0550&lt;/span&gt; asterisk asterisk
agentXSocket /var/agentx/master
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Если с запуском &lt;strong&gt;Asterisk 1.8&lt;/strong&gt; в &lt;strong&gt;jail&lt;/strong&gt; не возникло проблем, то с запуском &lt;code&gt;snmpd&lt;/code&gt; было 2 проблемы:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;Не запускался демон &lt;code&gt;snmpd&lt;/code&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;FreeBSD# service snmpd restart
snmpd not running? (check /var/run/net_snmpd.pid).
Starting snmpd.
/usr/local/etc/rc.d/snmpd: WARNING: failed to start snmpd
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Сообщение об ошибке как-то не особо помогло в решении проблемы, но все-же рискнем заглянуть в логи:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;FreeBSD# cat /var/log/snmpd.log
init_kmem: kvm_openfiles failed: /dev/mem: No such file or directory
Agent initialization failed
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Решение оказалось простым &lt;code&gt;man snmpd&lt;/code&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;FreeBSD# man snmpd
....
-r      Do not require root access to run the daemon.  Specifically, do
               not exit if files only accessible to root  (such  as  /dev/kmem
               etc.) cannot be opened.
.....
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Как сказано в мане, говорим демону &lt;code&gt;snmpd&lt;/code&gt; запускаться с опцией &lt;code&gt;-r&lt;/code&gt;, добавляем в &lt;code&gt;/etc/rc.conf&lt;/code&gt; строку:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;#----------------------------- SNMP ---------------------------------------#
snmpd_enable=&amp;quot;YES&amp;quot;
snmpd_flags=&amp;quot;-r&amp;quot;
#--------------------------------------------------------------------------#
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;И пробуем еще раз, теперь должно все запуститься:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;FreeBSD# service snmpd restart
Stopping snmpd.
Waiting for PIDS: 27711.
Starting snmpd.
Error 2 (No such file or directory) could not get the assoclist
&lt;/pre&gt;&lt;/div&gt;


&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Опять какая-то ошибка, немного погуглив яндексом в рамблере нашел страничку с описанием бага &lt;a href="http://sourceforge.net/p/net-snmp/bugs/2311/"&gt;#2311&lt;/a&gt;,
 там говорится про ядро &lt;em&gt;FreeBSD&lt;/em&gt; и отсутствие в нем &lt;code&gt;SCTP&lt;/code&gt; (У меня в ядре как раз небыло этого &lt;code&gt;SCTP&lt;/code&gt;) и эту ошибку можно спокойно проигнорировать.&lt;/p&gt;
&lt;p&gt;Ну чтож, если говорят, что все должно работать, то проверяем:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;FreeBSD# sockstat | grep snmpd
root     snmpd      27758 6  udp4   *:161                 *:*
root     snmpd      27758 7  stream /var/agentx/master
root     snmpd      27758 8  tcp4   *:199                 *:*
root     snmpd      27758 9  stream /var/agentx/master

Как видим, `snmpd` слушает `161` порт и **UNIX**-сокет `/var/agentx/master`. Значит мы все сделали правильно, и теперь двигаемся дальше к настройке **zabbix**.
&lt;/pre&gt;&lt;/div&gt;


&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;...... Тут должна быть часть о настройке Zabbix :) Когла-нибудь допишу. ......&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Настройка сервера Zabbix
Основную работу мы проделали. Теперь нам нужно подключить сервер к Zabbix и добавить туда шаблон.
Сначала добавим шаблон, это делается в меню Настройки – Шаблон – Импорт шаблона.
Шаблон можно скачать тут. Перед тем, как импортировать его, все значения PASSWORD нужно сменить на тот пароль, который вы указали в snmpd.conf.
Теперь добавим наш сервер Настройка – Узлы сети – Создать узел сети.
Заполняем поля, вводим название хоста, его ИП адрес, присоединяем шаблон, который мы импортировали.
Все, теперь все должно работать. Шаблон умеет показывать количество каналов, версию &lt;em&gt;, аптайм &lt;/em&gt;,
 ИД процесса, количество загруженных модулей. Так же в шаблоне есть встроенный график, отображающий количество каналов.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;hr&gt;
&lt;p&gt;Ссылки по теме:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href="http://ggeek.blogspot.ru/2008/10/freebsd-jails-and-net-snmp.html"&gt;FreeBSD jails and net-snmp&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://sourceforge.net/p/net-snmp/bugs/2311/"&gt;SourceForge SNMPd bug: #2311 5.7.1 errors at startup on FreeBSD systems without SCTP&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://wiki.asterisk.org/wiki/display/AST/Asterisk+MIB+Definitions"&gt;Asterisk MIB Definitions&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://lists.digium.com/pipermail/asterisk-users/2009-November/241388.html"&gt;asterisk-users mailing list - ASTERISK and SNMP&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://habrahabr.ru/sandbox/33568/"&gt;Мониторим Asterisk при помощи snmp и Zabbix&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;</content><category term="Asterisk"></category><category term="FreeBSD"></category><category term="zabbix"></category><category term="SNMP"></category></entry><entry><title>Установка git + gitweb + nginx + fcgiwrap на FreeBSD.</title><link href="https://metajiji.github.io/blog/freebsd-git-gitweb-nginx-fcgiwrap/" rel="alternate"></link><published>2012-12-21T00:00:00+07:00</published><updated>2012-12-21T00:00:00+07:00</updated><author><name>Denis Kadyshev</name></author><id>tag:metajiji.github.io,2012-12-21:/blog/freebsd-git-gitweb-nginx-fcgiwrap/</id><summary type="html">&lt;p&gt;Понадобился репозиторий для хранения конфигов серверов и активного сетевого оборудования. Почитав про системы контроля версий и немного поразмыслив выбрал &lt;code&gt;git&lt;/code&gt;.
У меня уже имелся готовый веб хостинг на &lt;strong&gt;nginx&lt;/strong&gt; под &lt;strong&gt;FreeBSD&lt;/strong&gt; - решил использовать его.&lt;/p&gt;
&lt;p&gt;Итак смотрим что есть в составе порта &lt;code&gt;git&lt;/code&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nb"&gt;cd&lt;/span&gt; /usr/ports/devel/git/
make config
&lt;span class="o"&gt;[&lt;/span&gt;*&lt;span class="o"&gt;]&lt;/span&gt; CONTRIB …&lt;/pre&gt;&lt;/div&gt;</summary><content type="html">&lt;p&gt;Понадобился репозиторий для хранения конфигов серверов и активного сетевого оборудования. Почитав про системы контроля версий и немного поразмыслив выбрал &lt;code&gt;git&lt;/code&gt;.
У меня уже имелся готовый веб хостинг на &lt;strong&gt;nginx&lt;/strong&gt; под &lt;strong&gt;FreeBSD&lt;/strong&gt; - решил использовать его.&lt;/p&gt;
&lt;p&gt;Итак смотрим что есть в составе порта &lt;code&gt;git&lt;/code&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nb"&gt;cd&lt;/span&gt; /usr/ports/devel/git/
make config
&lt;span class="o"&gt;[&lt;/span&gt;*&lt;span class="o"&gt;]&lt;/span&gt; CONTRIB    Install contributed scripts
&lt;span class="o"&gt;[&lt;/span&gt;*&lt;span class="o"&gt;]&lt;/span&gt; CURL       Data transfer via cURL
&lt;span class="o"&gt;[&lt;/span&gt;*&lt;span class="o"&gt;]&lt;/span&gt; CVS        Enable CVS support
&lt;span class="o"&gt;[&lt;/span&gt; &lt;span class="o"&gt;]&lt;/span&gt; ETCSHELLS  Modify /etc/shells
&lt;span class="o"&gt;[&lt;/span&gt;*&lt;span class="o"&gt;]&lt;/span&gt; GITWEB     Install gitweb
&lt;span class="o"&gt;[&lt;/span&gt; &lt;span class="o"&gt;]&lt;/span&gt; GUI        GUI &lt;span class="o"&gt;(&lt;/span&gt;Graphical User Interface&lt;span class="o"&gt;)&lt;/span&gt;
&lt;span class="o"&gt;[&lt;/span&gt; &lt;span class="o"&gt;]&lt;/span&gt; HTMLDOCS   Install additional documentation
&lt;span class="o"&gt;[&lt;/span&gt;*&lt;span class="o"&gt;]&lt;/span&gt; ICONV      Encoding conversion via iconv
&lt;span class="o"&gt;[&lt;/span&gt;*&lt;span class="o"&gt;]&lt;/span&gt; NLS        Native Language Support
&lt;span class="o"&gt;[&lt;/span&gt;*&lt;span class="o"&gt;]&lt;/span&gt; P4         Enable Perforce support
&lt;span class="o"&gt;[&lt;/span&gt;*&lt;span class="o"&gt;]&lt;/span&gt; PERL       Perl scripting language
&lt;span class="o"&gt;[&lt;/span&gt; &lt;span class="o"&gt;]&lt;/span&gt; SVN        Subversion support
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Меня интересовали 2 вещи, какая-нибудь простенькая веб &lt;strike&gt;морда&lt;/strike&gt; интерфейс и собственно сам &lt;code&gt;git&lt;/code&gt;.
 Видим, что в составе порта есть &lt;code&gt;GITWEB&lt;/code&gt;, как говорит &lt;strong&gt;wikipedia&lt;/strong&gt; "&lt;code&gt;gitweb&lt;/code&gt; - написан на &lt;code&gt;Perl&lt;/code&gt; (Kay Sievers).
 Большинство &lt;strike&gt;приведённых ниже&lt;/strike&gt; крупных публичных &lt;code&gt;git&lt;/code&gt;-репозиториев его и применяет."&lt;/p&gt;
&lt;p&gt;Настраиваем по вкусу и ставим:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;make config-recursive
make install clean
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Затем идем в &lt;code&gt;/etc/rc.conf&lt;/code&gt; и приводим блок с веб сервером примерно к такому виду:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="c1"&gt;#----------------------------- nginx --------------------------------------#&lt;/span&gt;
&lt;span class="nv"&gt;nginx_enable&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;YES&amp;quot;&lt;/span&gt;  &lt;span class="c1"&gt;# (bool) Set to &amp;quot;NO&amp;quot; by default. Set it to &amp;quot;YES&amp;quot; to enable nginx&lt;/span&gt;
&lt;span class="nv"&gt;nginx_profiles&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&amp;quot;&lt;/span&gt;  &lt;span class="c1"&gt;# (str) Set to &amp;quot;&amp;quot; by default. Define your profiles here.&lt;/span&gt;
&lt;span class="nv"&gt;nginxlimits_enable&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;NO&amp;quot;&lt;/span&gt;  &lt;span class="c1"&gt;# (bool) Set to &amp;quot;NO&amp;quot; by default. Set it to yes to run `limits $limits_args` just before nginx starts.&lt;/span&gt;
&lt;span class="nv"&gt;nginx_flags&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&amp;quot;&lt;/span&gt;  &lt;span class="c1"&gt;# (str) Set to &amp;quot;&amp;quot; by default. Extra flags passed to start command.&lt;/span&gt;
&lt;span class="nv"&gt;nginxlimits_args&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;-e -U www&amp;quot;&lt;/span&gt;  &lt;span class="c1"&gt;# (str) Default to &amp;quot;-e -U www&amp;quot; Arguments of pre-start limits run.&lt;/span&gt;

&lt;span class="nv"&gt;php_fpm_enable&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;YES&amp;quot;&lt;/span&gt;

&lt;span class="nv"&gt;fcgiwrap_enable&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;YES&amp;quot;&lt;/span&gt;
&lt;span class="nv"&gt;fcgiwrap_user&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;www&amp;quot;&lt;/span&gt;  &lt;span class="c1"&gt;# (str) run fcgiwrap as user&lt;/span&gt;
&lt;span class="c1"&gt;#fcgiwrap_socket=&amp;quot;unix:/var/run/fcgiwrap/fcgiwrap.sock&amp;quot; #this could also be: tcp:[ipv4_addr]:port (for ipv4) | tcp6:[ipv6_addr]:port (for ipv6)&lt;/span&gt;
&lt;span class="c1"&gt;#fcgiwrap_flags=&amp;quot;-c 4&amp;quot;&lt;/span&gt;
&lt;span class="nv"&gt;fcgiwrap_profiles&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;gitweb&amp;quot;&lt;/span&gt;
&lt;span class="nv"&gt;fcgiwrap_gitweb_socket&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;unix:/var/run/fcgiwrap/gitweb.socket&amp;quot;&lt;/span&gt;
&lt;span class="c1"&gt;#--------------------------------------------------------------------------#&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Я специально запускаю отдельный экземпляр &lt;code&gt;fcgiwrap&lt;/code&gt; для каждого "сайта". Если не дай бог упадет, то упадет только один сайт, а не все сразу. :)&lt;/p&gt;
&lt;p&gt;Теперь настройки nginx:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;server&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
&lt;span class="c1"&gt;#-------------------------- Options --------------------------#&lt;/span&gt;
 &lt;span class="kn"&gt;listen&lt;/span&gt; &lt;span class="n"&gt;192.168.4.27&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;443&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
 &lt;span class="kn"&gt;server_name&lt;/span&gt; &lt;span class="s"&gt;git.local&lt;/span&gt; &lt;span class="s"&gt;git&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;

 &lt;span class="kn"&gt;open_file_cache&lt;/span&gt; &lt;span class="s"&gt;max=100000&lt;/span&gt; &lt;span class="s"&gt;inactive=40s&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
 &lt;span class="kn"&gt;open_file_cache_valid&lt;/span&gt; &lt;span class="s"&gt;60s&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
 &lt;span class="kn"&gt;open_file_cache_min_uses&lt;/span&gt; &lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
 &lt;span class="kn"&gt;open_file_cache_errors&lt;/span&gt; &lt;span class="no"&gt;on&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;

&lt;span class="c1"&gt;#ssl&lt;/span&gt;
&lt;span class="c1"&gt;# ssl on;&lt;/span&gt;
&lt;span class="c1"&gt;# ssl_certificate  ssl/git/git.local.crt;&lt;/span&gt;
&lt;span class="c1"&gt;# ssl_certificate_key ssl/git/git.local.key;&lt;/span&gt;

&lt;span class="c1"&gt;#logs&lt;/span&gt;
 &lt;span class="kn"&gt;access_log&lt;/span&gt; &lt;span class="s"&gt;/var/log/nginx/git.local_https_access.log&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
 &lt;span class="kn"&gt;error_log&lt;/span&gt; &lt;span class="s"&gt;/var/log/nginx/git.local_https_error.log&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;


&lt;span class="c1"&gt;#-------------------------- Configs --------------------------#&lt;/span&gt;
 &lt;span class="c1"&gt;# Default config&lt;/span&gt;
 &lt;span class="kn"&gt;include&lt;/span&gt; &lt;span class="s"&gt;confs/main.conf&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
 &lt;span class="kn"&gt;gzip&lt;/span&gt; &lt;span class="no"&gt;off&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;

&lt;span class="c1"&gt;#-------------------------- Locations ------------------------#&lt;/span&gt;

&lt;span class="c1"&gt;# Main location&lt;/span&gt;
 &lt;span class="kn"&gt;location&lt;/span&gt; &lt;span class="s"&gt;/&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
  &lt;span class="kn"&gt;root&lt;/span&gt; &lt;span class="s"&gt;/usr/local/www/gitweb&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
  &lt;span class="kn"&gt;index&lt;/span&gt; &lt;span class="s"&gt;gitweb.cgi&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;

  &lt;span class="kn"&gt;location&lt;/span&gt; &lt;span class="p"&gt;~&lt;/span&gt; &lt;span class="sr"&gt;^/(.*\.cgi)$&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
   &lt;span class="kn"&gt;include&lt;/span&gt;  &lt;span class="s"&gt;fastcgi_params&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
   &lt;span class="kn"&gt;fastcgi_pass&lt;/span&gt; &lt;span class="s"&gt;unix:/var/run/fcgiwrap/gitweb.socket&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
   &lt;span class="kn"&gt;fastcgi_index&lt;/span&gt; &lt;span class="s"&gt;gitweb.cgi&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
   &lt;span class="kn"&gt;fastcgi_param&lt;/span&gt; &lt;span class="s"&gt;SCRIPT_FILENAME&lt;/span&gt; &lt;span class="s"&gt;/usr/local/www/gitweb/gitweb.cgi&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
   &lt;span class="kn"&gt;fastcgi_param&lt;/span&gt; &lt;span class="s"&gt;DOCUMENT_ROOT&lt;/span&gt; &lt;span class="s"&gt;/usr/local/www/gitweb&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
  &lt;span class="p"&gt;}&lt;/span&gt;

 &lt;span class="p"&gt;}&lt;/span&gt;

&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Теперь самое интересное, после установки порта &lt;code&gt;devel/git&lt;/code&gt; в каталоге веб сервера &lt;code&gt;/usr/local/www&lt;/code&gt; ничего не появилось,
 хотя опция &lt;code&gt;GITWEB&lt;/code&gt; была отмечена, беглый анализ логов установки и поиск по винту навел на папочку:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;FreeBSD# find /usr -name gitweb
/usr/local/share/examples/git/gitweb

FreeBSD# ls /usr/local/share/examples/git/gitweb
gitweb.cgi static
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Вот оно! Копируем всю найденную папку &lt;code&gt;gitweb&lt;/code&gt; в каталог веб сервера:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;cp /usr/local/share/examples/git/gitweb /usr/local/www
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Запускаем сервисы:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;FreeBSD# service nginx reload
Performing sanity check on nginx configuration:
nginx: the configuration file /usr/local/etc/nginx/nginx.conf syntax is ok
nginx: configuration file /usr/local/etc/nginx/nginx.conf &lt;span class="nb"&gt;test&lt;/span&gt; is successful
FreeBSD# service fcgiwrap &lt;span class="nv"&gt;start&lt;/span&gt;
&lt;span class="o"&gt;===&lt;/span&gt;&amp;gt; fcgiwrap profile: gitweb
Starting fcgiwrap.
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Переходим по ссылке &lt;code&gt;http://git.local&lt;/code&gt; - все работает, ура! :)&lt;/p&gt;
&lt;p&gt;P.S. Памятка работы с git репозиторием:&lt;/p&gt;
&lt;p&gt;Создаю на сервере новую папку (например &lt;code&gt;/git/www/test&lt;/code&gt;).&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;mkdir -p /git/www/test
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Делаю в ней инициализацию пустого репозитория &lt;code&gt;git init&lt;/code&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nb"&gt;cd&lt;/span&gt; /git/www/test
git init
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;На локальной машине скачиваю созданный репозиторий:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;git clone git@git.local:/git/www/test/.git
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Это создаст локальную копию удалённого репозитория (пока пустого).&lt;/p&gt;
&lt;p&gt;Накидываю кучу файлов в локальную папку, которую мы создали на предыдущем шаге. Делаю, так сказать, каркас проекта. Если нужно — добавляю исключения в файл (&lt;code&gt;.gitignore&lt;/code&gt;)&lt;/p&gt;
&lt;p&gt;Выполняю:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nb"&gt;cd&lt;/span&gt; /git/www/test
git add .
git commit
git push
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Обязательно ввожу комментарий к своим изменениям - желательно писать всегда что-то адекватное, чтобы потом можно было понять что именно было изменено.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;git add .&lt;/code&gt; - добавляет новые файлы в репозиторий от текущего каталога.&lt;/li&gt;
&lt;li&gt;`git commit&lt;/b&gt; - Фиксирует новую ревизию кода - тут-то и спросит ввести комментарий.&lt;/li&gt;
&lt;li&gt;`git push&lt;/b&gt; - Отправляет изменения на сервер.&lt;/li&gt;
&lt;li&gt;Всё. Локальный и удалённый репозиарии обновлены и синхронизированы.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Если вы веб-разрабочик и вам нужно довольно часто показывать текущий результат работы — очень полезно будет положить файл &lt;code&gt;post-receive&lt;/code&gt; в папку &lt;code&gt;.git/hooks&lt;/code&gt; какого-либо проекта с таким содержимым:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="ch"&gt;#!/bin/sh&lt;/span&gt;
&lt;span class="nb"&gt;cd&lt;/span&gt; ..
env -i git checkout -f
&lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Удалённый репозиторий успешно обновлён!&amp;quot;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;И дайте ему права на исполнение. Теперь после каждого обновления (шаг 5) будет также обновляться рабочее дерево проекта и реальные файлы всегда будут последней,
 актуальной версии (а этого почти все и ожидают, когда обновили удалённый репозиторий, но так по умолчанию не происходит).&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;UPD&lt;/strong&gt;: 21.06.2014&lt;/p&gt;
&lt;p&gt;Если после настройки появляется ошибка:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;404&lt;/span&gt; &lt;span class="s"&gt;-&lt;/span&gt; &lt;span class="s"&gt;No&lt;/span&gt; &lt;span class="s"&gt;projects&lt;/span&gt; &lt;span class="s"&gt;found.&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Возможно причина в правах на репазитории, необходимо, чтобы владельцем файлов в репазиториях был тот же пользователь, что и у &lt;code&gt;fcgiwrap&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Если репазитории храятся в /git-repos, то решением будет:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nb"&gt;cd&lt;/span&gt; /git-repos
chown -R www:www .
&lt;/pre&gt;&lt;/div&gt;


&lt;hr&gt;
&lt;p&gt;Ссылки по теме:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href="http://ru.wikipedia.org/wiki/Git"&gt;Wikipedia - Git&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://forums.freebsd.org/showthread.php?t=19101"&gt;HOWTO: GIT hosting = nginx + cgit + gitosis + ssh&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://habrahabr.ru/post/86753/"&gt;Устанавливаем и настраиваем cGit на Ubuntu&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://habrahabr.ru/post/43806/"&gt;Собственный сервер Git на базе Ubuntu или Debian/GNU Linux&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://habrahabr.ru/post/43808/"&gt;Tip по использованию Git под Windows&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://www.unix-heaven.org/node/30"&gt;Installing Git and Gitweb on FreeBSD&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://nginx.localdomain.pl/wiki/FcgiWrap"&gt;Simple CGI support for Nginx (fcgiwrap)&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://git-scm.com/book/ru/Git-%D0%BD%D0%B0-%D1%81%D0%B5%D1%80%D0%B2%D0%B5%D1%80%D0%B5-%D0%9F%D1%80%D0%BE%D1%82%D0%BE%D0%BA%D0%BE%D0%BB%D1%8B"&gt;4.1 Git на сервере - Протоколы&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://stackoverflow.com/questions/10275536/configuring-gitweb-404-no-projects-found"&gt;Configuring GitWeb - 404 - No projects found&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;</content><category term="FreeBSD"></category><category term="git"></category><category term="gitweb"></category><category term="fcgiwrap"></category></entry><entry><title>VirtualBox и FreeBSD, не запускаются виртуальные машины при загрузке системы.</title><link href="https://metajiji.github.io/blog/freebsd-virtualbox-autostart-vm-on-boot/" rel="alternate"></link><published>2012-12-18T00:00:00+07:00</published><updated>2012-12-18T00:00:00+07:00</updated><author><name>Denis Kadyshev</name></author><id>tag:metajiji.github.io,2012-12-18:/blog/freebsd-virtualbox-autostart-vm-on-boot/</id><summary type="html">&lt;p&gt;Столкнулся с проблемой на &lt;strong&gt;FreeBSD&lt;/strong&gt; - не запускаются виртуальные машины при загрузке системы.&lt;/p&gt;
&lt;p&gt;Все оказалось довольно просто - нужные модули ядра не подгружались при загрузке системы,
 выход оказался очень прост - при запуске скрипта &lt;code&gt;/usr/local/etc/rc.d/vboxheadless&lt;/code&gt; подгружать эти модули, если они вдруг не загружены.&lt;/p&gt;
&lt;p&gt;Открываем стартовый скрипт &lt;code&gt;/usr/local …&lt;/code&gt;&lt;/p&gt;</summary><content type="html">&lt;p&gt;Столкнулся с проблемой на &lt;strong&gt;FreeBSD&lt;/strong&gt; - не запускаются виртуальные машины при загрузке системы.&lt;/p&gt;
&lt;p&gt;Все оказалось довольно просто - нужные модули ядра не подгружались при загрузке системы,
 выход оказался очень прост - при запуске скрипта &lt;code&gt;/usr/local/etc/rc.d/vboxheadless&lt;/code&gt; подгружать эти модули, если они вдруг не загружены.&lt;/p&gt;
&lt;p&gt;Открываем стартовый скрипт &lt;code&gt;/usr/local/etc/rc.d/vboxheadless&lt;/code&gt;, находим там строки:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;vboxheadless_start&lt;span class="o"&gt;()&lt;/span&gt;
&lt;span class="o"&gt;{&lt;/span&gt;
 &lt;span class="nb"&gt;local&lt;/span&gt; machine mpidfile pid vmname vmuser vmflags vmdelay
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;И добавляем заветные строки, которые будут проверять и загружать необходимые модули ядра, если потребуется:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;vboxheadless_start&lt;span class="o"&gt;()&lt;/span&gt;
&lt;span class="o"&gt;{&lt;/span&gt;
 &lt;span class="nb"&gt;local&lt;/span&gt; machine mpidfile pid vmname vmuser vmflags vmdelay

&lt;span class="o"&gt;(&lt;/span&gt; ! kldstat &lt;span class="p"&gt;|&lt;/span&gt; grep vboxnetflt &amp;gt;/dev/null &lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt; kldload vboxnetflt
&lt;span class="o"&gt;(&lt;/span&gt; ! kldstat &lt;span class="p"&gt;|&lt;/span&gt; grep vboxnetadp &amp;gt;/dev/null &lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt; kldload vboxnetadp
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Ну и не забываем в &lt;code&gt;/etc/rc.conf&lt;/code&gt; указать нужные настройки:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="c1"&gt;#---------------------- VirtualBox ----------------------------------------#&lt;/span&gt;
&lt;span class="nv"&gt;vboxnet_enable&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;YES&amp;quot;&lt;/span&gt;
&lt;span class="nv"&gt;vboxheadless_enable&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;YES&amp;quot;&lt;/span&gt;  &lt;span class="c1"&gt;# (bool): Set to &amp;quot;NO&amp;quot; by default. Set it to &amp;quot;YES&amp;quot; to enable vboxheadless.&lt;/span&gt;
&lt;span class="nv"&gt;vboxheadless_user&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;root&amp;quot;&lt;/span&gt;  &lt;span class="c1"&gt;# (str): Default user account to run with. (default: vboxusers)&lt;/span&gt;
&lt;span class="nv"&gt;vboxheadless_stop&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;poweroff&amp;quot;&lt;/span&gt;  &lt;span class="c1"&gt;# (str): Default stop cmd for VBoxManage controlvm. (default: savestate)&lt;/span&gt;
&lt;span class="nv"&gt;vboxheadless_delay&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;0&amp;quot;&lt;/span&gt;   &lt;span class="c1"&gt;# (int): Default startup/shutdown delay in seconds. (default: 0)&lt;/span&gt;
&lt;span class="nv"&gt;vboxheadless_machines&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;Win7&amp;quot;&lt;/span&gt;  &lt;span class="c1"&gt;# (str): Space separated list of machines.&lt;/span&gt;
&lt;span class="c1"&gt;#--------------------------------------------------------------------------#&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;А так же в файле &lt;code&gt;/boot/loader.conf&lt;/code&gt; добавляем строку:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nv"&gt;vboxdrv_load&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;YES&amp;quot;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Теперь все будет само запускаться, при загрузке системы!&lt;/p&gt;</content><category term="FreeBSD"></category><category term="Virtualbox"></category></entry><entry><title>Настраиваем запись логов в isc-dhcp-server под FreeBSD</title><link href="https://metajiji.github.io/blog/logging-in-isc-dhcp-server-freebsd/" rel="alternate"></link><published>2012-12-12T00:00:00+07:00</published><updated>2012-12-12T00:00:00+07:00</updated><author><name>Denis Kadyshev</name></author><id>tag:metajiji.github.io,2012-12-12:/blog/logging-in-isc-dhcp-server-freebsd/</id><summary type="html">&lt;p&gt;После установки и настройки порта &lt;code&gt;isc-dhcpd-server&lt;/code&gt; очень захотелось,
 чтобы логи от этого демона складировались в отдельный файлик, например &lt;code&gt;/var/log/dhcpd.log&lt;/code&gt;,
 а не в общий системный лог &lt;code&gt;/var/log/messages&lt;/code&gt;. Как этого достичь описано ниже.&lt;/p&gt;
&lt;p&gt;Первым делом добавляем строку в конфиг демона dhcpd &lt;code&gt;/usr/local/etc/dhcpd.conf&lt;/code&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;log-facility …&lt;/pre&gt;&lt;/div&gt;</summary><content type="html">&lt;p&gt;После установки и настройки порта &lt;code&gt;isc-dhcpd-server&lt;/code&gt; очень захотелось,
 чтобы логи от этого демона складировались в отдельный файлик, например &lt;code&gt;/var/log/dhcpd.log&lt;/code&gt;,
 а не в общий системный лог &lt;code&gt;/var/log/messages&lt;/code&gt;. Как этого достичь описано ниже.&lt;/p&gt;
&lt;p&gt;Первым делом добавляем строку в конфиг демона dhcpd &lt;code&gt;/usr/local/etc/dhcpd.conf&lt;/code&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;log-facility local7&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="c1"&gt;# куда в syslog шлем логи&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Теперь в &lt;code&gt;syslog&lt;/code&gt; принимаем от демона &lt;code&gt;dhcpd&lt;/code&gt; логи - добавляем строки в файл &lt;code&gt;/etc/syslog.conf&lt;/code&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;!dhcpd
local7.*  /var/log/dhcpd.log

&lt;span class="c1"&gt;# Если встретили эту сроку (я имею ввиду это -&amp;gt; !*), то закоментируйте, а то не заработает :)&lt;/span&gt;
&lt;span class="c1"&gt;#!*&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;А так же рассказываем &lt;code&gt;syslog&lt;/code&gt;'у, что у нас есть &lt;code&gt;dhcpd&lt;/code&gt; демон, для этого добавляем опцию в &lt;code&gt;/etc/rc.conf&lt;/code&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nv"&gt;syslogd_flags&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;-l /var/db/dhcpd/var/run/log -ss&amp;quot;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;И не забываем про ротацию логов в &lt;code&gt;/etc/newsyslog.conf&lt;/code&gt; добавляем строки:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="c1"&gt;# dhcp&lt;/span&gt;
/var/log/dhcpd.log  &lt;span class="m"&gt;644&lt;/span&gt;  &lt;span class="m"&gt;15&lt;/span&gt;    &lt;span class="m"&gt;300&lt;/span&gt; *     XC
&lt;/pre&gt;&lt;/div&gt;


&lt;hr&gt;
&lt;p&gt;Ссылки по теме:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href="http://www.sergeysl.ru/freebsd-isc-dhcp-server/"&gt;FreeBSD: DHCP-сервер для локальной сети на базе ISC DHCP Server&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://www.thtech.net/dhcp-snooping/"&gt;Cisco DHCP Snooping with ISC DHCPd&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://team.pc-club.ru/?page_id=91"&gt;Reagent Team - dhcp opt 82&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;</content><category term="FeeBSD"></category><category term="isc-dhcp-server"></category><category term="isc-dhcpd"></category><category term="logging"></category></entry><entry><title>Перенос Windows на RAID контроллер.</title><link href="https://metajiji.github.io/blog/windows-migrate-to-hardware-raid/" rel="alternate"></link><published>2012-10-14T00:00:00+07:00</published><updated>2012-10-14T00:00:00+07:00</updated><author><name>Denis Kadyshev</name></author><id>tag:metajiji.github.io,2012-10-14:/blog/windows-migrate-to-hardware-raid/</id><summary type="html">&lt;ol&gt;
&lt;li&gt;Уменьшить размер раздела через &lt;strong&gt;Gparted&lt;/strong&gt; через &lt;strong&gt;Ubuntu Live CD&lt;/strong&gt;.&lt;/li&gt;
&lt;li&gt;Загрузиться и проверить, что все ОК. Скорей всего запустится &lt;code&gt;chkdsk&lt;/code&gt; и будет испрвлять ошибки.&lt;/li&gt;
&lt;li&gt;Сделать образ &lt;strong&gt;РАЗДЕЛОВ&lt;/strong&gt; в &lt;strong&gt;clonezilla&lt;/strong&gt;.&lt;/li&gt;
&lt;li&gt;Собрать рейд и установить винду на рейд, используя драйвера.&lt;/li&gt;
&lt;li&gt;Отключить рейд контроллер и подключить винты в материнскую плату.&lt;/li&gt;
&lt;li&gt;Восстановить из образа &lt;strong&gt;clonezilla …&lt;/strong&gt;&lt;/li&gt;&lt;/ol&gt;</summary><content type="html">&lt;ol&gt;
&lt;li&gt;Уменьшить размер раздела через &lt;strong&gt;Gparted&lt;/strong&gt; через &lt;strong&gt;Ubuntu Live CD&lt;/strong&gt;.&lt;/li&gt;
&lt;li&gt;Загрузиться и проверить, что все ОК. Скорей всего запустится &lt;code&gt;chkdsk&lt;/code&gt; и будет испрвлять ошибки.&lt;/li&gt;
&lt;li&gt;Сделать образ &lt;strong&gt;РАЗДЕЛОВ&lt;/strong&gt; в &lt;strong&gt;clonezilla&lt;/strong&gt;.&lt;/li&gt;
&lt;li&gt;Собрать рейд и установить винду на рейд, используя драйвера.&lt;/li&gt;
&lt;li&gt;Отключить рейд контроллер и подключить винты в материнскую плату.&lt;/li&gt;
&lt;li&gt;Восстановить из образа &lt;strong&gt;clonezilla&lt;/strong&gt; содержимое разделов, не трогая &lt;strong&gt;MBR&lt;/strong&gt;!
    Возможно &lt;strong&gt;100Мб&lt;/strong&gt; раздел не нужно восстанавливать, т.к. туда были установлены драйвера для рейда, а в сохраненном образе их НЕТ!
    Следовательно средство восстановления запуска не получится запустить в дальнейшем...
    Чтобы избежать этой проблемы лучше не восстаналивать &lt;strong&gt;100Мб&lt;/strong&gt; раздел... Хотя не уверен! Нужно проверить.&lt;/li&gt;
&lt;li&gt;Подключить обратно рейд контроллер и винты.&lt;/li&gt;
&lt;li&gt;Загрузиться и проверить, что все работает :) Скорей всего запустится &lt;code&gt;chkdsk&lt;/code&gt; и будет испрвлять ошибки.&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;P.S. Это сырая статья.&lt;/p&gt;</content><category term="Windows"></category><category term="Raid"></category></entry><entry><title>Ubuntu установка VNC сервера не зависимого от пользователей.</title><link href="https://metajiji.github.io/blog/ubuntu-system-vnc/" rel="alternate"></link><published>2012-09-27T00:00:00+07:00</published><updated>2012-09-27T00:00:00+07:00</updated><author><name>Denis Kadyshev</name></author><id>tag:metajiji.github.io,2012-09-27:/blog/ubuntu-system-vnc/</id><summary type="html">&lt;p&gt;Выкладываю функцию добавления &lt;strong&gt;VNC&lt;/strong&gt; сервиса. Данная функция используется в моем скрипте &lt;code&gt;lentayka_14.04.sh&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Функция была проверена на &lt;strong&gt;Ubuntu 12.04 LTS&lt;/strong&gt;&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;install_vnc_service&lt;span class="o"&gt;()&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt;
    apt-get purge vino
    apt-get install x11vnc

    mkdir /etc/x11vnc
    chmod &lt;span class="m"&gt;755&lt;/span&gt; /etc/x11vnc

    sudo x11vnc -storepasswd YouPasswordHere /etc/x11vnc/passwd
    chmod &lt;span class="m"&gt;644&lt;/span&gt; /etc/x11vnc/passwd

    cat &amp;gt; /etc …&lt;/pre&gt;&lt;/div&gt;</summary><content type="html">&lt;p&gt;Выкладываю функцию добавления &lt;strong&gt;VNC&lt;/strong&gt; сервиса. Данная функция используется в моем скрипте &lt;code&gt;lentayka_14.04.sh&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Функция была проверена на &lt;strong&gt;Ubuntu 12.04 LTS&lt;/strong&gt;&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;install_vnc_service&lt;span class="o"&gt;()&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt;
    apt-get purge vino
    apt-get install x11vnc

    mkdir /etc/x11vnc
    chmod &lt;span class="m"&gt;755&lt;/span&gt; /etc/x11vnc

    sudo x11vnc -storepasswd YouPasswordHere /etc/x11vnc/passwd
    chmod &lt;span class="m"&gt;644&lt;/span&gt; /etc/x11vnc/passwd

    cat &amp;gt; /etc/init/x11vnc.conf &lt;span class="s"&gt;&amp;lt;&amp;lt;-_EOF&lt;/span&gt;
&lt;span class="s"&gt;    start on login-session-start&lt;/span&gt;
&lt;span class="s"&gt;    script&lt;/span&gt;
&lt;span class="s"&gt;    x11vnc -xkb -bg \&lt;/span&gt;
&lt;span class="s"&gt;        -noxrecord \&lt;/span&gt;
&lt;span class="s"&gt;        -noxfixes \&lt;/span&gt;
&lt;span class="s"&gt;        -noxdamage \&lt;/span&gt;
&lt;span class="s"&gt;        -display :0 \&lt;/span&gt;
&lt;span class="s"&gt;        -auth /var/run/lightdm/root/:0 \&lt;/span&gt;
&lt;span class="s"&gt;        -rfbauth /etc/x11vnc/passwd \&lt;/span&gt;
&lt;span class="s"&gt;        -forever \&lt;/span&gt;
&lt;span class="s"&gt;        -o /var/log/x11vnc.log&lt;/span&gt;
&lt;span class="s"&gt;    end script&lt;/span&gt;
&lt;span class="s"&gt;_EOF&lt;/span&gt;
&lt;span class="o"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Данная функция настраивает запуск &lt;code&gt;x11vnc&lt;/code&gt; через &lt;code&gt;upstart&lt;/code&gt;.&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;Ссылки по теме:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href="http://cisight.com/how-to-setup-vnc-server-remote-desktop-in-ubuntu-11-10-oneiric/"&gt;How to setup VNC server for remote desktop in Ubuntu 11.10 Oneiric&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://mlepicki.com/2011/10/remote-vnc-login-to-ubuntu-11-10/"&gt;Remote VNC login to Ubuntu 11.10&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://www.ara1307.info/index.php/2011/10/21/?p=18/"&gt;Запуск VNC-сервера в Ubuntu 11.10 (LightDM)&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://oss-it.ru/23"&gt;Быстрая настройка x11vnc&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;</content><category term="Ubuntu"></category><category term="Linux"></category><category term="VNC"></category></entry><entry><title>Борьба с DDoS SYN-Flood штатными средствами и nginx в Linux</title><link href="https://metajiji.github.io/blog/ddos-nginx-linux/" rel="alternate"></link><published>2012-09-08T00:00:00+07:00</published><updated>2012-09-08T00:00:00+07:00</updated><author><name>Denis Kadyshev</name></author><id>tag:metajiji.github.io,2012-09-08:/blog/ddos-nginx-linux/</id><summary type="html">&lt;p&gt;Однажды мой знакомый написал мне, что его сайт перестал открываться сказал, что на сайт обрушилась &lt;strong&gt;DDoS&lt;/strong&gt; атака.
 Полез я разбираться, в чем дело и в итоге суть проблемы была найдена - куча &lt;code&gt;ip&lt;/code&gt; адресов с различными &lt;strong&gt;User Agent&lt;/strong&gt;'ами приходили на сайт и делали очень много различных запросов...&lt;/p&gt;
&lt;p&gt;В общем нужно …&lt;/p&gt;</summary><content type="html">&lt;p&gt;Однажды мой знакомый написал мне, что его сайт перестал открываться сказал, что на сайт обрушилась &lt;strong&gt;DDoS&lt;/strong&gt; атака.
 Полез я разбираться, в чем дело и в итоге суть проблемы была найдена - куча &lt;code&gt;ip&lt;/code&gt; адресов с различными &lt;strong&gt;User Agent&lt;/strong&gt;'ами приходили на сайт и делали очень много различных запросов...&lt;/p&gt;
&lt;p&gt;В общем нужно было этих ботов отлавливать и блокировать им доступ к сайту, сперва подумал об &lt;code&gt;iptables&lt;/code&gt; и &lt;code&gt;ConfigServer Firewall&lt;/code&gt; (&lt;code&gt;csf&lt;/code&gt;), но хостинг был внутри &lt;strong&gt;OpenVZ&lt;/strong&gt;,
 а это означало невозможность использования более &lt;code&gt;120&lt;/code&gt; правил, а так же невозможность установки модулей ядра и вообще каких либо изменений опций ядра.
 Потому стандартные подходы для решения проблемы сразу отпадали.&lt;/p&gt;
&lt;p&gt;А время шло, и переписываться с тех поддежкой хостинга небыло времени, а платить огромные суммы за защиту от такой примитивной атаки небыло никакого желания.&lt;/p&gt;
&lt;p&gt;Решение пришло в голову неожиданно, при перечитывании &lt;code&gt;man ip&lt;/code&gt;, вспомнить зачем я его читал затрудняюсь, но решение было &lt;strike&gt;на редкость извращенским&lt;/strike&gt;, но вполне рабочим :)&lt;/p&gt;
&lt;p&gt;Решением было добавление маршрута проблемного &lt;code&gt;IP&lt;/code&gt; в &lt;code&gt;blackhole&lt;/code&gt;. В следствие чего пакеты от этих адресов будут молча отбрасываться (the rule prescribes to silently drop the packet.).&lt;/p&gt;
&lt;p&gt;Сперва конфигурируем &lt;code&gt;nginx&lt;/code&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;...
worker_rlimit_nofile &lt;span class="m"&gt;200000&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
events &lt;span class="o"&gt;{&lt;/span&gt;
    worker_connections &lt;span class="m"&gt;1024&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    use epoll&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="o"&gt;}&lt;/span&gt;

....

http &lt;span class="o"&gt;{&lt;/span&gt;
        index index.html index.htm index.php&lt;span class="p"&gt;;&lt;/span&gt;

        &lt;span class="c1"&gt;##&lt;/span&gt;
        &lt;span class="c1"&gt;# Basic Settings&lt;/span&gt;
        &lt;span class="c1"&gt;##&lt;/span&gt;
        sendfile on&lt;span class="p"&gt;;&lt;/span&gt;
        send_timeout &lt;span class="m"&gt;5&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
        tcp_nopush on&lt;span class="p"&gt;;&lt;/span&gt;
        tcp_nodelay on&lt;span class="p"&gt;;&lt;/span&gt;
        keepalive_timeout &lt;span class="m"&gt;30&lt;/span&gt; &lt;span class="m"&gt;15&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
        types_hash_max_size &lt;span class="m"&gt;2048&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
        server_tokens off&lt;span class="p"&gt;;&lt;/span&gt;

        client_header_timeout &lt;span class="m"&gt;15&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
        client_body_timeout &lt;span class="m"&gt;15&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;

        &lt;span class="c1"&gt;# лимитируем для зоны one 10 конектов в 1 сек.&lt;/span&gt;
        limit_req_zone &lt;span class="nv"&gt;$binary_remote_addr&lt;/span&gt; &lt;span class="nv"&gt;zone&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;one:16m &lt;span class="nv"&gt;rate&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;10r/s&lt;span class="p"&gt;;&lt;/span&gt;

        &lt;span class="c1"&gt;# В ситуации когда сервер записал в сокет данные, но клиент не хочет&lt;/span&gt;
        &lt;span class="c1"&gt;#       их забирать, после таймаута по закрытию соединения в ядре&lt;/span&gt;
        &lt;span class="c1"&gt;#       данные будут держаться еще несколько минут. В nginx если директи                                                                             ва&lt;/span&gt;
        &lt;span class="c1"&gt;#       для принудительного сброса всех данных после закрытия по таймаут                                                                             у.&lt;/span&gt;
        reset_timedout_connection on&lt;span class="p"&gt;;&lt;/span&gt;

        include /etc/nginx/mime.types&lt;span class="p"&gt;;&lt;/span&gt;
        default_type application/octet-stream&lt;span class="p"&gt;;&lt;/span&gt;

        &lt;span class="c1"&gt;# Logging Settings&lt;/span&gt;
        access_log /var/log/nginx/access.log&lt;span class="p"&gt;;&lt;/span&gt;
        error_log /var/log/nginx/error.log&lt;span class="p"&gt;;&lt;/span&gt;

        gzip on&lt;span class="p"&gt;;&lt;/span&gt;
        gzip_disable &lt;span class="s2"&gt;&amp;quot;msie6&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
...
server &lt;span class="o"&gt;{&lt;/span&gt;
        listen &lt;span class="m"&gt;80&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
        server_name my.site&lt;span class="p"&gt;;&lt;/span&gt;

        open_file_cache &lt;span class="nv"&gt;max&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;100000&lt;/span&gt; &lt;span class="nv"&gt;inactive&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;40s&lt;span class="p"&gt;;&lt;/span&gt;
        open_file_cache_valid 60s&lt;span class="p"&gt;;&lt;/span&gt;
        open_file_cache_min_uses &lt;span class="m"&gt;2&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
        open_file_cache_errors on&lt;span class="p"&gt;;&lt;/span&gt;

        &lt;span class="c1"&gt;# это значит что законектится с лимитом в 3 подключения за 1 сек можно 3 раза, а дальше 503 ошибка. Что и пишется в лог access.&lt;/span&gt;
        limit_req &lt;span class="nv"&gt;zone&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;one &lt;span class="nv"&gt;burst&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;10&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;

        &lt;span class="c1"&gt;# Default locations config.&lt;/span&gt;
        include conf.std&lt;span class="p"&gt;;&lt;/span&gt;
...
&lt;span class="o"&gt;}&lt;/span&gt;
...
&lt;span class="o"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Файлик &lt;code&gt;/etc/nginx/conf.std&lt;/code&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="c1"&gt;####### STANDART&lt;/span&gt;
&lt;span class="c1"&gt;# redirect server error pages to the static page /50x.html&lt;/span&gt;
error_page &lt;span class="m"&gt;500&lt;/span&gt; &lt;span class="m"&gt;502&lt;/span&gt; &lt;span class="m"&gt;503&lt;/span&gt; &lt;span class="m"&gt;504&lt;/span&gt; /50x.html&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="nv"&gt;location&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; /50x.html &lt;span class="o"&gt;{&lt;/span&gt;
    root /usr/share/nginx/html&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="o"&gt;}&lt;/span&gt;

&lt;span class="c1"&gt;# Deny access to .htaccess files, if Apache&amp;#39;s document root concurs with nginx&amp;#39;s one&lt;/span&gt;
location ~ /&lt;span class="se"&gt;\.&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;ht&lt;span class="p"&gt;|&lt;/span&gt;hg&lt;span class="p"&gt;|&lt;/span&gt;git&lt;span class="p"&gt;|&lt;/span&gt;svn&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt; deny all&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="o"&gt;}&lt;/span&gt;
location ~ /&lt;span class="se"&gt;\&amp;lt;&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt; deny  all&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="o"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;С конфигурацией &lt;code&gt;nginx&lt;/code&gt; все, теперь скрипты.&lt;/p&gt;
&lt;p&gt;Добавляем в файл &lt;code&gt;/etc/crontab&lt;/code&gt; строки:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="c1"&gt;# parse nginx logs and ban bad ip via nullroute&lt;/span&gt;
* * * * * root /root/ddos/parse_nginx.log.sh &amp;gt;/root/ddos/parse_nginx.log.log &lt;span class="m"&gt;2&lt;/span&gt;&amp;gt;&lt;span class="p"&gt;&amp;amp;&lt;/span&gt;&lt;span class="m"&gt;1&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Содержимое скрипта &lt;code&gt;/root/ddos/parse_nginx.log.sh&lt;/code&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="ch"&gt;#!/bin/sh&lt;/span&gt;

&lt;span class="nv"&gt;ADMINS_IP&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;ip.ip.ip.ip&amp;#39;&lt;/span&gt;

&lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="k"&gt;$(&lt;/span&gt;date&lt;span class="k"&gt;)&lt;/span&gt;
&lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;--- запускаем систему парсинга nginx лога---&amp;#39;&lt;/span&gt;

&lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39; ищем ботов&amp;#39;&lt;/span&gt;
cat /var/log/nginx/access.log &lt;span class="se"&gt;\&lt;/span&gt;
    &lt;span class="p"&gt;|&lt;/span&gt; grep -E -e &lt;span class="s1"&gt;&amp;#39;HTTP/1.(0|1)&amp;quot; (400|403|405|499|503)&amp;#39;&lt;/span&gt; -e &lt;span class="s1"&gt;&amp;#39;] &amp;quot;-&amp;quot; 400 0 &amp;quot;-&amp;quot; &amp;quot;-&amp;quot;&amp;#39;&lt;/span&gt; &lt;span class="se"&gt;\&lt;/span&gt;
    &lt;span class="p"&gt;|&lt;/span&gt; awk &lt;span class="s1"&gt;&amp;#39;{print $1}&amp;#39;&lt;/span&gt; &lt;span class="se"&gt;\&lt;/span&gt;
    &lt;span class="p"&gt;|&lt;/span&gt; sort -nr &lt;span class="p"&gt;|&lt;/span&gt; uniq -c &lt;span class="se"&gt;\&lt;/span&gt;
    &lt;span class="p"&gt;|&lt;/span&gt; awk &lt;span class="s1"&gt;&amp;#39;{if($1&amp;gt;10)print $1&amp;quot; &amp;quot;$2}&amp;#39;&lt;/span&gt; &lt;span class="se"&gt;\&lt;/span&gt;
    &amp;gt; /root/ddos/banlist.txt

cat /var/log/nginx/error.log &lt;span class="se"&gt;\&lt;/span&gt;
    &lt;span class="p"&gt;|&lt;/span&gt; grep -E &lt;span class="s1"&gt;&amp;#39;(limiting requests|limiting connections)&amp;#39;&lt;/span&gt; &lt;span class="se"&gt;\&lt;/span&gt;
    &lt;span class="p"&gt;|&lt;/span&gt; awk -F&lt;span class="s2"&gt;&amp;quot;client: &amp;quot;&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;{print $2}&amp;#39;&lt;/span&gt; &lt;span class="se"&gt;\&lt;/span&gt;
    &lt;span class="p"&gt;|&lt;/span&gt; awk -F&lt;span class="s2"&gt;&amp;quot;,&amp;quot;&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;{print $1}&amp;#39;&lt;/span&gt; &lt;span class="se"&gt;\&lt;/span&gt;
    &lt;span class="p"&gt;|&lt;/span&gt; sort -nr &lt;span class="p"&gt;|&lt;/span&gt; uniq -c &lt;span class="se"&gt;\&lt;/span&gt;
    &lt;span class="p"&gt;|&lt;/span&gt; awk &lt;span class="s1"&gt;&amp;#39;{if($1&amp;gt;10)print $1&amp;quot; &amp;quot;$2}&amp;#39;&lt;/span&gt; &lt;span class="se"&gt;\&lt;/span&gt;
    &amp;gt;&amp;gt; /root/ddos/banlist.txt

&lt;span class="c1"&gt;# get unique ip&lt;/span&gt;
cat /root/ddos/banlist.txt &lt;span class="se"&gt;\&lt;/span&gt;
    &lt;span class="p"&gt;|&lt;/span&gt; grep -v &lt;span class="nv"&gt;$ADMINS_IP&lt;/span&gt; &lt;span class="se"&gt;\&lt;/span&gt;
    &lt;span class="p"&gt;|&lt;/span&gt; uniq &lt;span class="p"&gt;|&lt;/span&gt; sort -nr &lt;span class="se"&gt;\&lt;/span&gt;
    &amp;gt; /root/ddos/banlist_uniq.txt

&lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;------  очищаем tmp file бана-&amp;#39;&lt;/span&gt;
cat /dev/null &amp;gt; /root/ddos/banlist.txt

&lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39; создаем DROP правила для 50 самых агрессивных ботов&amp;#39;&lt;/span&gt;
awk &lt;span class="s1"&gt;&amp;#39;{print $2}&amp;#39;&lt;/span&gt; /root/ddos/banlist_uniq.txt &lt;span class="p"&gt;|&lt;/span&gt; uniq &lt;span class="p"&gt;|&lt;/span&gt; head -n &lt;span class="m"&gt;150&lt;/span&gt; &amp;gt; /root/ddos/banlist.txt

&lt;span class="c1"&gt;#т.к. iptables полнейшее УГ, особенно внутри OpenVZ, баним ip вот таким извращенским методом... через nullroute&lt;/span&gt;
&lt;span class="c1"&gt;#ip route flush type blackhole&lt;/span&gt;
&lt;span class="k"&gt;for&lt;/span&gt; ip in &lt;span class="k"&gt;$(&lt;/span&gt;cat /root/ddos/banlist.txt&lt;span class="k"&gt;)&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;
    ip route add blackhole &lt;span class="si"&gt;${&lt;/span&gt;&lt;span class="nv"&gt;ip&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;/32
&lt;span class="k"&gt;done&lt;/span&gt;

&lt;span class="c1"&gt;#echo &amp;#39;записываем злобных ботов в csf.deny&amp;#39;&lt;/span&gt;
&lt;span class="c1"&gt;#cat /etc/csf/csf.deny &amp;gt;&amp;gt; /root/ddos/banlist.txt&lt;/span&gt;
&lt;span class="c1"&gt;#cat /root/ddos/banlist.txt | uniq | sort -nr &amp;gt; /etc/csf/csf.deny&lt;/span&gt;

&lt;span class="c1"&gt;#echo &amp;#39;csf релоад, внесение в iptables ботов&amp;#39;&lt;/span&gt;
&lt;span class="c1"&gt;#/usr/sbin/csf -r&lt;/span&gt;
sleep &lt;span class="m"&gt;5&lt;/span&gt;

&lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;--  делаем ротацию лога--------&amp;#39;&lt;/span&gt;
&lt;span class="nb"&gt;test&lt;/span&gt; -x /usr/sbin/logrotate &lt;span class="o"&gt;||&lt;/span&gt; &lt;span class="nb"&gt;exit&lt;/span&gt; &lt;span class="m"&gt;0&lt;/span&gt;
/usr/sbin/logrotate /etc/logrotate.conf

&lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;=====злобные боты в списке бана=====&amp;#39;&lt;/span&gt;

sleep &lt;span class="m"&gt;1&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Для мониторинга состояния сервера используем такой скрипт:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="ch"&gt;#!/bin/sh&lt;/span&gt;

&lt;span class="k"&gt;while&lt;/span&gt; true&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;
&lt;span class="nv"&gt;netstat_str&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="k"&gt;$(&lt;/span&gt;netstat -an&lt;span class="k"&gt;)&lt;/span&gt;
        &lt;span class="nb"&gt;echo&lt;/span&gt; -n &lt;span class="s1"&gt;&amp;#39;SYN_RECV: &amp;#39;&lt;/span&gt;
        &lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;$netstat_str&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt; &lt;span class="p"&gt;|&lt;/span&gt; grep &lt;span class="m"&gt;80&lt;/span&gt; &lt;span class="p"&gt;|&lt;/span&gt; grep -c SYN_RECV
        &lt;span class="nb"&gt;echo&lt;/span&gt; -n &lt;span class="s1"&gt;&amp;#39;TIME_WAIT: &amp;#39;&lt;/span&gt;
        &lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;$netstat_str&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt; &lt;span class="p"&gt;|&lt;/span&gt; grep &lt;span class="m"&gt;80&lt;/span&gt; &lt;span class="p"&gt;|&lt;/span&gt; grep -c TIME_WAIT
        &lt;span class="nb"&gt;echo&lt;/span&gt; -n &lt;span class="s1"&gt;&amp;#39;FIN_WAIT: &amp;#39;&lt;/span&gt;
        &lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;$netstat_str&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt; &lt;span class="p"&gt;|&lt;/span&gt; grep &lt;span class="m"&gt;80&lt;/span&gt; &lt;span class="p"&gt;|&lt;/span&gt; grep -c FIN_WAI1
        &lt;span class="nb"&gt;echo&lt;/span&gt; -n &lt;span class="s1"&gt;&amp;#39;ESTABLISHED: &amp;#39;&lt;/span&gt;
        &lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;$netstat_str&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt; &lt;span class="p"&gt;|&lt;/span&gt; grep &lt;span class="m"&gt;80&lt;/span&gt; &lt;span class="p"&gt;|&lt;/span&gt; grep -c ESTABLISHED

        &lt;span class="nb"&gt;echo&lt;/span&gt; -n &lt;span class="s1"&gt;&amp;#39;BLOCKED_IP to Black-route: &amp;#39;&lt;/span&gt;
        ip route list &lt;span class="p"&gt;|&lt;/span&gt; grep -c blackhole

        sleep &lt;span class="m"&gt;2&lt;/span&gt;
        &lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;------------------------- for stop this script Press Ctrl+C&amp;#39;&lt;/span&gt;
&lt;span class="k"&gt;done&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Еще понадобится настроить ротацию логов, приводим файл &lt;code&gt;/etc/logrotate.d/nginx&lt;/code&gt; к такому виду:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;/var/log/nginx/*.log &lt;span class="o"&gt;{&lt;/span&gt;
    size 1M
    missingok
    rotate &lt;span class="m"&gt;52&lt;/span&gt;
    compress
    delaycompress
    notifempty
    create &lt;span class="m"&gt;640&lt;/span&gt; nginx adm
    sharedscripts
    postrotate
        &lt;span class="o"&gt;[&lt;/span&gt; -f /var/run/nginx.pid &lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class="nb"&gt;kill&lt;/span&gt; -USR1 &lt;span class="sb"&gt;`&lt;/span&gt;cat /var/run/nginx.pid&lt;span class="sb"&gt;`&lt;/span&gt;
    endscript
&lt;span class="o"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Поменялся метод ротации вместо &lt;code&gt;daily&lt;/code&gt; теперь используется &lt;code&gt;size 1M&lt;/code&gt;, это позволит уменьшить объем лог файла,
 т.к. за сутки он может очень сильно вырасти в объеме, что замедлит парсинг и увеличит нагрузку на сервер,
 а использование ротации по размеру исправит эту ситуацию.&lt;/p&gt;
&lt;p&gt;Еще я использовал встроенные средства &lt;code&gt;iptables&lt;/code&gt; для борьбы с &lt;strong&gt;DDoS&lt;/strong&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="ch"&gt;#!/bin/sh&lt;/span&gt;

iptables -F
iptables -N syn_flood
iptables -A INPUT -p tcp --syn -j syn_flood
iptables -A syn_flood -m limit --limit &lt;span class="m"&gt;100&lt;/span&gt;/s --limit-burst &lt;span class="m"&gt;150&lt;/span&gt; -j RETURN
iptables -A syn_flood -j DROP
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Данный скрипт спокойно блокировал &lt;strong&gt;DDoS&lt;/strong&gt; примерно в &lt;em&gt;10 000 ботов&lt;/em&gt;, при этом сайт был полностью доступен и атака вообще не чувствовалась.&lt;/p&gt;
&lt;p&gt;Прошу обратить внимание на то, что скрипт запускается раз в минуту, и блокирует &lt;code&gt;ip&lt;/code&gt; адреса по заданным критериям в скрипте &lt;code&gt;/root/ddos/parse_nginx.log.sh&lt;/code&gt;.
 В моем случае атака была "вялой" и одной минуты вполне хватало для сбора &lt;code&gt;ip&lt;/code&gt; адресов ботов.
 В первые минуты сайт "туго" работал, но спустя &lt;em&gt;минут 10&lt;/em&gt;, когда список заблокированных вырос сайт начал свою штатную работу,
 а список блокированных с течением времени увеличивался все медленнее и в итоге совсем перестал расти - у атакующего закончились боты.&lt;/p&gt;</content><category term="DDoS"></category><category term="SYN-flood"></category><category term="Linux"></category><category term="iptables"></category><category term="ip-route-blackhole"></category></entry><entry><title>RDP Windows, перенаправленные принтеры, Easy Print Driver.</title><link href="https://metajiji.github.io/blog/rdp-windows-easy-print-driver/" rel="alternate"></link><published>2012-08-31T00:00:00+07:00</published><updated>2012-08-31T00:00:00+07:00</updated><author><name>Denis Kadyshev</name></author><id>tag:metajiji.github.io,2012-08-31:/blog/rdp-windows-easy-print-driver/</id><summary type="html">&lt;p&gt;Для работы перенаправленных принтеров через &lt;strong&gt;RDP&lt;/strong&gt; сессию в &lt;strong&gt;Windows 2008&lt;/strong&gt; нужно, чтобы у клиента были установлены:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Microsoft .NET Framework 3.5.&lt;/li&gt;
&lt;li&gt;Клиент служб терминалов версии 6.1, для Windows XP (KB952155).&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;В этом случае принтеры имеющиеся у клиента, будут автоматически перенаправлены через &lt;strong&gt;RDP&lt;/strong&gt; сессию на сервер терминалов.&lt;/p&gt;
&lt;p&gt;ВАЖНО! Чтобы не …&lt;/p&gt;</summary><content type="html">&lt;p&gt;Для работы перенаправленных принтеров через &lt;strong&gt;RDP&lt;/strong&gt; сессию в &lt;strong&gt;Windows 2008&lt;/strong&gt; нужно, чтобы у клиента были установлены:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Microsoft .NET Framework 3.5.&lt;/li&gt;
&lt;li&gt;Клиент служб терминалов версии 6.1, для Windows XP (KB952155).&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;В этом случае принтеры имеющиеся у клиента, будут автоматически перенаправлены через &lt;strong&gt;RDP&lt;/strong&gt; сессию на сервер терминалов.&lt;/p&gt;
&lt;p&gt;ВАЖНО! Чтобы не расшаривать каждый принтер у клиента, нужно &lt;strong&gt;включить Брандмауэр&lt;/strong&gt; и выбрать тип сети - "&lt;strong&gt;Сеть Предприятия&lt;/strong&gt;".&lt;/p&gt;
&lt;p&gt;P.S. Что самое &lt;s&gt;замечательное&lt;/s&gt;, у клиентов видны только их принтеры, и они не смогут распечатать случайно на чужом принтере!&lt;/p&gt;
&lt;p&gt;И еще больше всего мне понравилось то, надобность установки драйверов отпадает для многих принтеров - практически все заводятся через &lt;strong&gt;Easy Print&lt;/strong&gt; драйвер.&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;Ссылки по теме:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href="http://www.microsoft.com/ru-ru/download/details.aspx?id=7208"&gt;Подключение к удаленному рабочему столу (клиент служб терминалов версии 6.1) для Windows XP (KB952155)&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://www.microsoft.com/en-us/download/details.aspx?id=21"&gt;Microsoft .NET Framework 3.5&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;</content><category term="Windows"></category><category term="Easy Print Driver"></category><category term="RDP"></category></entry><entry><title>Запуск КИАСУО 1252 на Windows Server x64, corflags.exe, NetFramework 3.5</title><link href="https://metajiji.github.io/blog/KIASUO-1252-windows-server-x64-corflags-exe/" rel="alternate"></link><published>2012-08-29T00:00:00+07:00</published><updated>2012-08-29T00:00:00+07:00</updated><author><name>Denis Kadyshev</name></author><id>tag:metajiji.github.io,2012-08-29:/blog/KIASUO-1252-windows-server-x64-corflags-exe/</id><summary type="html">&lt;p&gt;Дело в том, что программа &lt;strong&gt;КИАСУО&lt;/strong&gt; ниже версии &lt;strong&gt;1280&lt;/strong&gt; откомпилирована с опцией "для всех архитектур",
 и при запуске на &lt;strong&gt;64&lt;/strong&gt; разрядных ОС не запускается. Лечится это довольно просто, ниже описана методика.&lt;/p&gt;
&lt;p&gt;Смотрим статус:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;C:\Users\Администратор&amp;gt;cd &amp;quot;C:\Program Files (x86)\КИАСУО3\OuServer\bin\Release&amp;quot;
C:\Program Files (x86)\КИАСУО3 …&lt;/pre&gt;&lt;/div&gt;</summary><content type="html">&lt;p&gt;Дело в том, что программа &lt;strong&gt;КИАСУО&lt;/strong&gt; ниже версии &lt;strong&gt;1280&lt;/strong&gt; откомпилирована с опцией "для всех архитектур",
 и при запуске на &lt;strong&gt;64&lt;/strong&gt; разрядных ОС не запускается. Лечится это довольно просто, ниже описана методика.&lt;/p&gt;
&lt;p&gt;Смотрим статус:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;C:\Users\Администратор&amp;gt;cd &amp;quot;C:\Program Files (x86)\КИАСУО3\OuServer\bin\Release&amp;quot;
C:\Program Files (x86)\КИАСУО3\OuServer\bin\Release&amp;gt;CorFlags.exe OuServer.exe
Microsoft (R) .NET Framework CorFlags Conversion Tool.  Version  2.0.50727.42
Copyright (c) Microsoft Corporation.  All rights reserved.

Version   : v2.0.50727
CLR Header: 2.5
PE        : PE32
CorFlags  : 9
ILONLY    : 1
32BIT     : 0
Signed    : 1
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Видим, что флаг &lt;code&gt;32BIT     : 0&lt;/code&gt; не установлен.&lt;/p&gt;
&lt;p&gt;Для запуска &lt;strong&gt;КИАСУО&lt;/strong&gt; на &lt;strong&gt;Windows Server 2008 X64&lt;/strong&gt; нужно найти утилитку &lt;a href="http://up.optizone.ru/657449/"&gt;CorFlags.exe — 73.7 КБ&lt;/a&gt;,
 скопировать ее в папку с файлом &lt;code&gt;OuServer.exe&lt;/code&gt; и проделать следующее:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;C:\Users\Администратор&amp;gt;cd &amp;quot;C:\Program Files (x86)\КИАСУО3\OuServer\bin\Release&amp;quot;
C:\Program Files (x86)\КИАСУО3\OuServer\bin\Release&amp;gt;CorFlags.exe OuServer.exe /32BIT+ /Force
Microsoft (R) .NET Framework CorFlags Conversion Tool.  Version  2.0.50727.42
Copyright (c) Microsoft Corporation.  All rights reserved.

corflags : warning CF011 : The specified file is strong name signed.  Using /For
ce will invalidate the signature of this image and will require the assembly to
be resigned.
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Проверяем результат:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;C:\Program Files (x86)\КИАСУО3\OuServer\bin\Release&amp;gt;CorFlags.exe OuServer.exe
Microsoft (R) .NET Framework CorFlags Conversion Tool.  Version  2.0.50727.42
Copyright (c) Microsoft Corporation.  All rights reserved.

Version   : v2.0.50727
CLR Header: 2.5
PE        : PE32
CorFlags  : 11
ILONLY    : 1
32BIT     : 1
Signed    : 1
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Видим флаг &lt;code&gt;32BIT     : 1&lt;/code&gt; установлен, приятной работы!&lt;/p&gt;
&lt;p&gt;После этого сервер запускается нормально. У меня заработал как в ручном режиме запуска, так и в режиме сервиса.&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;Ссылки по теме:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href="http://msdn.microsoft.com/en-us/library/ms164699.aspx"&gt;CorFlags.exe (CorFlags Conversion Tool)&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://blogs.msdn.com/b/joshwil/archive/2005/05/06/415191.aspx"&gt;Flipping bits on managed images to make them load with the right bitness...&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;</content><category term="КИАСУО"></category><category term="windows-x64"></category><category term="windows-server"></category><category term="windows"></category></entry><entry><title>Ubuntu и DNS-Суффикс, /etc/nsswitch.conf, NetworkManager</title><link href="https://metajiji.github.io/blog/ubuntu-dns-suffix_etc-nsswitch.conf/" rel="alternate"></link><published>2012-08-27T00:00:00+07:00</published><updated>2012-08-27T00:00:00+07:00</updated><author><name>Denis Kadyshev</name></author><id>tag:metajiji.github.io,2012-08-27:/blog/ubuntu-dns-suffix_etc-nsswitch.conf/</id><summary type="html">&lt;p&gt;Столкнулся с проблемой, когда &lt;strong&gt;Ubuntu&lt;/strong&gt; при работе по &lt;strong&gt;DHCP&lt;/strong&gt; неправильно работала с &lt;strong&gt;DNS&lt;/strong&gt;-суффиксом,
 а именно работала только с суффиксами, а полные доменные имена (&lt;strong&gt;FQDN&lt;/strong&gt;) не понимала,
 как следствие некорректно работали некоторые локальные сайты в браузерах, да и банальные пинги работали как-то не совсем правильно:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;ping server
PING server.local …&lt;/pre&gt;&lt;/div&gt;</summary><content type="html">&lt;p&gt;Столкнулся с проблемой, когда &lt;strong&gt;Ubuntu&lt;/strong&gt; при работе по &lt;strong&gt;DHCP&lt;/strong&gt; неправильно работала с &lt;strong&gt;DNS&lt;/strong&gt;-суффиксом,
 а именно работала только с суффиксами, а полные доменные имена (&lt;strong&gt;FQDN&lt;/strong&gt;) не понимала,
 как следствие некорректно работали некоторые локальные сайты в браузерах, да и банальные пинги работали как-то не совсем правильно:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;ping server
PING server.local &lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="m"&gt;192&lt;/span&gt;.168.0.2&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="m"&gt;56&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="m"&gt;84&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; bytes of data.
&lt;span class="m"&gt;64&lt;/span&gt; bytes from server.local &lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="m"&gt;192&lt;/span&gt;.168.0.2&lt;span class="o"&gt;)&lt;/span&gt;: &lt;span class="nv"&gt;icmp_req&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;1&lt;/span&gt; &lt;span class="nv"&gt;ttl&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;64&lt;/span&gt; &lt;span class="nv"&gt;time&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;0&lt;/span&gt;.131 ms
^C
&lt;/pre&gt;&lt;/div&gt;


&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;ping server.local
ping: unknown host server.local
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;При этом &lt;strong&gt;DNS&lt;/strong&gt; сервер отлично обрабатывает запросы:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;nslookup server
Server:  &lt;span class="m"&gt;192&lt;/span&gt;.168.0.254
Address: &lt;span class="m"&gt;192&lt;/span&gt;.168.0.254#53

Name: server.local
Address: &lt;span class="m"&gt;192&lt;/span&gt;.168.0.2
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;И для доменного имени полностью:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;nslookup server.local
Server:  &lt;span class="m"&gt;192&lt;/span&gt;.168.0.254
Address: &lt;span class="m"&gt;192&lt;/span&gt;.168.0.254#53

Name: server.local
Address: &lt;span class="m"&gt;192&lt;/span&gt;.168.0.2
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Погуглив немного, решил, что проблема в &lt;strong&gt;NetworkManager&lt;/strong&gt;'е, на старых версиях &lt;strong&gt;Ubuntu&lt;/strong&gt; он неправильно генерировал &lt;code&gt;/etc/resolv.conf&lt;/code&gt;, проверил свой:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;cat /etc/resolv.conf
&lt;span class="c1"&gt;# Dynamic resolv.conf(5) file for glibc resolver(3) generated by resolvconf(8)&lt;/span&gt;
&lt;span class="c1"&gt;#     DO NOT EDIT THIS FILE BY HAND -- YOUR CHANGES WILL BE OVERWRITTEN&lt;/span&gt;
nameserver &lt;span class="m"&gt;192&lt;/span&gt;.168.0.254
search &lt;span class="nb"&gt;local&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Как оказалось, в моем случае &lt;strong&gt;NetworkManager&lt;/strong&gt; вовсе не виноват! Но в чем же тогда проблема?
 Еще раз погуглил яндексом в рамблере и пришел к выводу, что виноват конфиг &lt;code&gt;/etc/nsswitch.conf&lt;/code&gt;, сравнил его с &lt;strong&gt;FreeBSD&lt;/strong&gt;'шным,
 где все работает как надо и пришел к выводу, что нужно строку &lt;code&gt;hosts:&lt;/code&gt; привести к такому виду:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="c1"&gt;# НЕ работает!&lt;/span&gt;
&lt;span class="c1"&gt;#hosts:          files mdns4_minimal [NOTFOUND=return] dns mdns4&lt;/span&gt;

&lt;span class="c1"&gt;# работает!&lt;/span&gt;
hosts:          files dns
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Что такое &lt;code&gt;mdns4&lt;/code&gt; разбираться не стал (позже узнал, что это &lt;strong&gt;avahi&lt;/strong&gt; так делает), без него все работает так, как надо и это главное.&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;Ссылки по теме:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href="http://forum.oszone.net/thread-159390.html"&gt;Debian/Ubuntu - [решено] Не распознаёт имя контроллера домена&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;</content><category term="Ubuntu"></category><category term="Networkmanager"></category><category term="nsswitch.conf"></category><category term="dns-suffix"></category></entry><entry><title>Перенос FreeBSD 4 на VirtualBox</title><link href="https://metajiji.github.io/blog/freebsd4-migrate-to-virtualbox/" rel="alternate"></link><published>2012-06-08T00:00:00+07:00</published><updated>2012-06-08T00:00:00+07:00</updated><author><name>Denis Kadyshev</name></author><id>tag:metajiji.github.io,2012-06-08:/blog/freebsd4-migrate-to-virtualbox/</id><summary type="html">&lt;p&gt;Заходим по &lt;strong&gt;ssh&lt;/strong&gt; на машину, которую будем переносить, останавливаем все процессы, которые могут использовать &lt;strong&gt;hdd&lt;/strong&gt; и писать туда важную информацию (например &lt;strong&gt;MySQL&lt;/strong&gt; и т.п.) и делаем дампы всех важных разделов:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;dump -0uan -f - /usr &lt;span class="p"&gt;|&lt;/span&gt; ssh -c blowfish user@ip.ip.ip.ip dd &lt;span class="nv"&gt;of&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;/home/user/oldsrv/var.dd …&lt;/pre&gt;&lt;/div&gt;</summary><content type="html">&lt;p&gt;Заходим по &lt;strong&gt;ssh&lt;/strong&gt; на машину, которую будем переносить, останавливаем все процессы, которые могут использовать &lt;strong&gt;hdd&lt;/strong&gt; и писать туда важную информацию (например &lt;strong&gt;MySQL&lt;/strong&gt; и т.п.) и делаем дампы всех важных разделов:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;dump -0uan -f - /usr &lt;span class="p"&gt;|&lt;/span&gt; ssh -c blowfish user@ip.ip.ip.ip dd &lt;span class="nv"&gt;of&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;/home/user/oldsrv/var.dd
dump -0uan -f - /var &lt;span class="p"&gt;|&lt;/span&gt; ssh -c blowfish user@ip.ip.ip.ip dd &lt;span class="nv"&gt;of&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;/home/user/oldsrv/var.dd
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Грузимся с &lt;strong&gt;LiveCD FreeBSD&lt;/strong&gt; у меня уже была загрузка по сети &lt;strong&gt;FreeBSD 9.0&lt;/strong&gt; (но думаю подойдет и любой другой дистрибутив, &lt;strong&gt;Frenzy&lt;/strong&gt; например).&lt;/p&gt;
&lt;p&gt;Восстанавливаем корневой раздел:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;mkdir /tmp/oldsrv
&lt;span class="nb"&gt;cd&lt;/span&gt; /tmp/oldsrv
scp user@ip.ip.ip.ip:/home/user/oldsrv/*.dd
dd &lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;from_real_srv/rootfs.dd &lt;span class="p"&gt;|&lt;/span&gt; restore -rf -
...
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Убедиться, что все необходимые каталоги, куда будем восстанавливать остальные разделы имеются:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;ls usr
ls var
...
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;И начинаем восстанавливать остальные разделы:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;dd &lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;from_real_srv/usr.dd &lt;span class="p"&gt;|&lt;/span&gt; &lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;cd&lt;/span&gt; usr&lt;span class="p"&gt;;&lt;/span&gt; restore -rf -&lt;span class="o"&gt;)&lt;/span&gt;
dd &lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;from_real_srv/var.dd &lt;span class="p"&gt;|&lt;/span&gt; &lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;cd&lt;/span&gt; var&lt;span class="p"&gt;;&lt;/span&gt; restore -rf -&lt;span class="o"&gt;)&lt;/span&gt;
...
&lt;/pre&gt;&lt;/div&gt;


&lt;hr&gt;
&lt;p&gt;Ссылки по теме:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href="http://www.freebsd.org/doc/ru/books/handbook/backup-basics.html"&gt;17.12. Основы технологии резервного копирования.&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://www.lissyara.su/articles/freebsd/trivia/move_system_between_hard_drives/"&gt;Перенос FreeBSD с одного жёсткого диска на другой.&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;</content><category term="FreeBSD"></category><category term="dump"></category><category term="restore"></category><category term="ssh"></category><category term="virtualbox"></category></entry><entry><title>Ubuntu и Midnight Commander, mc и Unity 3D исправляем проблему с F10 в терминале</title><link href="https://metajiji.github.io/blog/ubuntu-midnight-commander/" rel="alternate"></link><published>2012-05-30T00:00:00+07:00</published><updated>2012-05-30T00:00:00+07:00</updated><author><name>Denis Kadyshev</name></author><id>tag:metajiji.github.io,2012-05-30:/blog/ubuntu-midnight-commander/</id><summary type="html">&lt;p&gt;Вот такой нехитрый скрипт установит и избавит от проблем с &lt;code&gt;F10&lt;/code&gt; при работе в терминале с &lt;code&gt;mc&lt;/code&gt; в &lt;strong&gt;Ubuntu&lt;/strong&gt;.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="ch"&gt;#!/bin/sh&lt;/span&gt;

sudo apt-get install mc
gconftool-2 --set --type string &lt;span class="s2"&gt;&amp;quot;/apps/compiz-1/plugins/unityshell/screen0/options/panel_first_menu&amp;quot;&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Disabled&amp;quot;&lt;/span&gt; &lt;span class="c1"&gt;# Unity Panel 3D&lt;/span&gt;

gconftool-2 --set --type bool &lt;span class="s2"&gt;&amp;quot;/apps/gnome-terminal/global/use_menu_accelerators&amp;quot;&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;false&amp;quot;&lt;/span&gt; &lt;span class="c1"&gt;# Gnome-Terminal …&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;</summary><content type="html">&lt;p&gt;Вот такой нехитрый скрипт установит и избавит от проблем с &lt;code&gt;F10&lt;/code&gt; при работе в терминале с &lt;code&gt;mc&lt;/code&gt; в &lt;strong&gt;Ubuntu&lt;/strong&gt;.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="ch"&gt;#!/bin/sh&lt;/span&gt;

sudo apt-get install mc
gconftool-2 --set --type string &lt;span class="s2"&gt;&amp;quot;/apps/compiz-1/plugins/unityshell/screen0/options/panel_first_menu&amp;quot;&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Disabled&amp;quot;&lt;/span&gt; &lt;span class="c1"&gt;# Unity Panel 3D&lt;/span&gt;

gconftool-2 --set --type bool &lt;span class="s2"&gt;&amp;quot;/apps/gnome-terminal/global/use_menu_accelerators&amp;quot;&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;false&amp;quot;&lt;/span&gt; &lt;span class="c1"&gt;# Gnome-Terminal&lt;/span&gt;

&lt;span class="c1"&gt;# И последний штрих для Ubuntu 12.04-LTS&lt;/span&gt;
&lt;span class="o"&gt;[&lt;/span&gt; ! -d ~/.config/gtk-3.0/ &lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt; mkdir -p ~/.config/gtk-3.0/
cat &amp;gt;~/.config/gtk-3.0/gtk.css &lt;span class="s"&gt;&amp;lt;&amp;lt;_EOF&lt;/span&gt;
&lt;span class="s"&gt;@binding-set NoKeyboardNavigation {&lt;/span&gt;
&lt;span class="s"&gt; unbind &amp;quot;&amp;lt;shift&amp;gt;F10&amp;quot;&lt;/span&gt;
&lt;span class="s"&gt;}&lt;/span&gt;

&lt;span class="s"&gt;* {&lt;/span&gt;
&lt;span class="s"&gt; gtk-key-bindings: NoKeyboardNavigation&lt;/span&gt;
&lt;span class="s"&gt;}&lt;/span&gt;
&lt;span class="s"&gt;_EOF&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;После чего придется закрыть все открытые окна терминала, чтобы изменения вступили в силу.&lt;/p&gt;</content><category term="ubuntu"></category><category term="linux"></category><category term="mc"></category><category term="midnight-commander"></category></entry><entry><title>Custom user fonts in Ubuntu Linux</title><link href="https://metajiji.github.io/blog/custom-user-fonts-in-ubuntu-linux/" rel="alternate"></link><published>2012-05-09T00:00:00+07:00</published><updated>2012-05-09T00:00:00+07:00</updated><author><name>Denis Kadyshev</name></author><id>tag:metajiji.github.io,2012-05-09:/blog/custom-user-fonts-in-ubuntu-linux/</id><summary type="html">&lt;p&gt;Extract the &lt;code&gt;ttf&lt;/code&gt; file and copy into &lt;code&gt;.fonts&lt;/code&gt; via:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Go to your home folder&lt;/li&gt;
&lt;li&gt;Enable "&lt;strong&gt;Show Hidden Files&lt;/strong&gt;" option from Nautilus View menu&lt;/li&gt;
&lt;li&gt;Then create new folder with name &lt;code&gt;.fonts&lt;/code&gt; (with dot in front)&lt;/li&gt;
&lt;li&gt;Now in new folder copy all your true type fonts. If you want to copy your …&lt;/li&gt;&lt;/ol&gt;</summary><content type="html">&lt;p&gt;Extract the &lt;code&gt;ttf&lt;/code&gt; file and copy into &lt;code&gt;.fonts&lt;/code&gt; via:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Go to your home folder&lt;/li&gt;
&lt;li&gt;Enable "&lt;strong&gt;Show Hidden Files&lt;/strong&gt;" option from Nautilus View menu&lt;/li&gt;
&lt;li&gt;Then create new folder with name &lt;code&gt;.fonts&lt;/code&gt; (with dot in front)&lt;/li&gt;
&lt;li&gt;Now in new folder copy all your true type fonts. If you want to copy your Windows fonts, you can find it in &lt;code&gt;Windows/Fonts&lt;/code&gt; folder.&lt;/li&gt;
&lt;li&gt;Now restart and new fonts will be in use.&lt;/li&gt;
&lt;/ol&gt;</content><category term="Ubuntu"></category><category term="Linux"></category><category term="Fonts"></category><category term="Ubuntu Custom Fonts"></category></entry><entry><title>Отключение ipv6 в Ubuntu</title><link href="https://metajiji.github.io/blog/disable-ipv6-ubuntu/" rel="alternate"></link><published>2012-05-06T00:00:00+07:00</published><updated>2012-05-06T00:00:00+07:00</updated><author><name>Denis Kadyshev</name></author><id>tag:metajiji.github.io,2012-05-06:/blog/disable-ipv6-ubuntu/</id><summary type="html">&lt;p&gt;Для начала открываем, а если его еще нет, то создаем файл &lt;code&gt;/etc/modprobe.d/aliases&lt;/code&gt; и добавляем такие строки:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nb"&gt;alias&lt;/span&gt; net-pf-10 ipv6 off
&lt;span class="nb"&gt;alias&lt;/span&gt; net-pf-10 off
&lt;span class="nb"&gt;alias&lt;/span&gt; ipv6 off
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Далее правим &lt;code&gt;/etc/modprobe.d/blacklist.conf&lt;/code&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;blacklist ipv6&amp;quot;&lt;/span&gt; &amp;gt;&amp;gt; /etc/modprobe.d/blacklist.conf
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;И наконец редактируем файл &lt;code&gt;/etc/default …&lt;/code&gt;&lt;/p&gt;</summary><content type="html">&lt;p&gt;Для начала открываем, а если его еще нет, то создаем файл &lt;code&gt;/etc/modprobe.d/aliases&lt;/code&gt; и добавляем такие строки:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nb"&gt;alias&lt;/span&gt; net-pf-10 ipv6 off
&lt;span class="nb"&gt;alias&lt;/span&gt; net-pf-10 off
&lt;span class="nb"&gt;alias&lt;/span&gt; ipv6 off
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Далее правим &lt;code&gt;/etc/modprobe.d/blacklist.conf&lt;/code&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;blacklist ipv6&amp;quot;&lt;/span&gt; &amp;gt;&amp;gt; /etc/modprobe.d/blacklist.conf
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;И наконец редактируем файл &lt;code&gt;/etc/default/grub&lt;/code&gt;, добавляя в конец опции &lt;code&gt;GRUB_CMDLINE_LINUX_DEFAULT&lt;/code&gt; строку &lt;code&gt;ipv6.disable=1&lt;/code&gt;, в итоге получаем:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nv"&gt;GRUB_CMDLINE_LINUX_DEFAULT&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;quiet splash ipv6.disable=1&amp;quot;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;После чего даем команду &lt;code&gt;sudo update-grub&lt;/code&gt; и перезагружаем систему.&lt;/p&gt;
&lt;p&gt;На этом все, &lt;code&gt;ipv6&lt;/code&gt; будет отключен в системе.&lt;/p&gt;
&lt;p&gt;Для проверки отключен ли &lt;code&gt;ipv6&lt;/code&gt; выполняем:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;sudo netstat -npl &lt;span class="p"&gt;|&lt;/span&gt; grep -E &lt;span class="s2"&gt;&amp;quot;tcp6|udp6&amp;quot;&lt;/span&gt; &lt;span class="p"&gt;|&lt;/span&gt; wc -l
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Если видим &lt;code&gt;0&lt;/code&gt;, значит все сделано правильно.&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;Ссылки по теме:
1.  &lt;a href="http://debianworld.ru/articles/otklyuchenie-ipv6-v-ubuntu-debian/"&gt;Отключение ipv6 в Ubuntu / Debian&lt;/a&gt;&lt;/p&gt;</content><category term="Linux"></category><category term="Ubuntu"></category><category term="ipv6"></category></entry><entry><title>JavaScript вывод даты модификации html документа в форматированном виде</title><link href="https://metajiji.github.io/blog/javascript-formatted-date/" rel="alternate"></link><published>2012-04-06T00:00:00+07:00</published><updated>2012-04-06T00:00:00+07:00</updated><author><name>Denis Kadyshev</name></author><id>tag:metajiji.github.io,2012-04-06:/blog/javascript-formatted-date/</id><summary type="html">&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;script&lt;/span&gt; &lt;span class="na"&gt;language&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;JavaScript&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
&lt;span class="c"&gt;&amp;lt;!--&lt;/span&gt;
    &lt;span class="kd"&gt;var&lt;/span&gt; &lt;span class="nx"&gt;month&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt; &lt;span class="nb"&gt;Array&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;12&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
    &lt;span class="nx"&gt;month&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;Января&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="nx"&gt;month&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;Февраля&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="nx"&gt;month&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;Марта&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="nx"&gt;month&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;Апреля&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="nx"&gt;month&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;Мая&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="nx"&gt;month&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;5&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;Июня&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="nx"&gt;month&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;6&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;Июля&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="nx"&gt;month&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;7&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;Августа&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="nx"&gt;month&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;8&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;Сентября&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="nx"&gt;month&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;9&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;Октября&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="nx"&gt;month&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;10&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;Ноября&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="nx"&gt;month&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;11&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;Декабря&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="kd"&gt;var&lt;/span&gt; &lt;span class="nx"&gt;lastmoddate&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nb"&gt;Date&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;parse&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;document&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;lastModified …&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;</summary><content type="html">&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;script&lt;/span&gt; &lt;span class="na"&gt;language&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;JavaScript&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
&lt;span class="c"&gt;&amp;lt;!--&lt;/span&gt;
    &lt;span class="kd"&gt;var&lt;/span&gt; &lt;span class="nx"&gt;month&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt; &lt;span class="nb"&gt;Array&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;12&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
    &lt;span class="nx"&gt;month&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;Января&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="nx"&gt;month&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;Февраля&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="nx"&gt;month&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;Марта&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="nx"&gt;month&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;Апреля&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="nx"&gt;month&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;Мая&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="nx"&gt;month&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;5&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;Июня&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="nx"&gt;month&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;6&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;Июля&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="nx"&gt;month&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;7&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;Августа&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="nx"&gt;month&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;8&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;Сентября&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="nx"&gt;month&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;9&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;Октября&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="nx"&gt;month&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;10&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;Ноября&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="nx"&gt;month&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;11&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;Декабря&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="kd"&gt;var&lt;/span&gt; &lt;span class="nx"&gt;lastmoddate&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nb"&gt;Date&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;parse&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;document&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;lastModified&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt; &lt;span class="c1"&gt;// Получает строку даты последней модификации&lt;/span&gt;
    &lt;span class="kd"&gt;var&lt;/span&gt; &lt;span class="nx"&gt;d&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt; &lt;span class="nb"&gt;Date&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt; &lt;span class="nx"&gt;d&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;setTime&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;lastmoddate&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;          &lt;span class="c1"&gt;// lastmoddate приводим к типу данных Date&lt;/span&gt;
    &lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;lastmoddate&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;                             &lt;span class="c1"&gt;// неизвестная дата (или 1 июля, 1970 GMT)&lt;/span&gt;
        &lt;span class="kd"&gt;var&lt;/span&gt; &lt;span class="nx"&gt;datestr&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;Неизвестна&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="p"&gt;}&lt;/span&gt; &lt;span class="k"&gt;else&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
        &lt;span class="kd"&gt;var&lt;/span&gt; &lt;span class="nx"&gt;datestr&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nx"&gt;d&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;getDate&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39; &amp;#39;&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="nx"&gt;month&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="nx"&gt;d&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;getMonth&lt;/span&gt;&lt;span class="p"&gt;()]&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39; &amp;#39;&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="nx"&gt;d&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;getFullYear&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;
    &lt;span class="p"&gt;}&lt;/span&gt;
    &lt;span class="nb"&gt;document&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;write&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;Дата последнего изменения: &amp;quot;&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="nx"&gt;datestr&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;span class="c1"&gt;//--&amp;gt;;&lt;/span&gt;
&lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;script&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;hr&gt;
&lt;p&gt;Ссылки по теме:
1.  &lt;a href="http://ab-w.net/JS/JS_date.php"&gt;Отображаем точное время и дату с помощью JavaScript.&lt;/a&gt;
2.  &lt;a href="http://javascript.ru/Date.parse"&gt;Date.parse Синтаксис, Описание, примеры.&lt;/a&gt;&lt;/p&gt;</content><category term="javascript"></category><category term="date"></category></entry><entry><title>FreeBSD 9.0 GPT + gmirror</title><link href="https://metajiji.github.io/blog/freebsd-90-gpt-gmirror/" rel="alternate"></link><published>2012-04-04T00:00:00+07:00</published><updated>2012-04-04T00:00:00+07:00</updated><author><name>Denis Kadyshev</name></author><id>tag:metajiji.github.io,2012-04-04:/blog/freebsd-90-gpt-gmirror/</id><summary type="html">&lt;p&gt;Столкнулся с проблемой реализации подобной связки &lt;strong&gt;GPT&lt;/strong&gt; и &lt;code&gt;gmirror&lt;/code&gt; на &lt;strong&gt;FreeBSD 9.0&lt;/strong&gt;.&lt;/p&gt;
&lt;p&gt;Методом проб и ошибок получилась вот такая пошаговая инструкция:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Загружаемся с диска &lt;strong&gt;FreeBSD 9.0&lt;/strong&gt; &lt;code&gt;amd64&lt;/code&gt; в режиме &lt;strong&gt;LiveCD&lt;/strong&gt;, система спросит логин, вводим &lt;code&gt;root&lt;/code&gt;, а вместо пароля просто жмем Enter.&lt;/li&gt;
&lt;li&gt;Удаляем все &lt;strong&gt;GPT&lt;/strong&gt; данные с дисков:&lt;/li&gt;
&lt;/ol&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;gpart …&lt;/pre&gt;&lt;/div&gt;</summary><content type="html">&lt;p&gt;Столкнулся с проблемой реализации подобной связки &lt;strong&gt;GPT&lt;/strong&gt; и &lt;code&gt;gmirror&lt;/code&gt; на &lt;strong&gt;FreeBSD 9.0&lt;/strong&gt;.&lt;/p&gt;
&lt;p&gt;Методом проб и ошибок получилась вот такая пошаговая инструкция:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Загружаемся с диска &lt;strong&gt;FreeBSD 9.0&lt;/strong&gt; &lt;code&gt;amd64&lt;/code&gt; в режиме &lt;strong&gt;LiveCD&lt;/strong&gt;, система спросит логин, вводим &lt;code&gt;root&lt;/code&gt;, а вместо пароля просто жмем Enter.&lt;/li&gt;
&lt;li&gt;Удаляем все &lt;strong&gt;GPT&lt;/strong&gt; данные с дисков:&lt;/li&gt;
&lt;/ol&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;gpart destroy -F ada0
gpart destroy -F ada1
&lt;/pre&gt;&lt;/div&gt;


&lt;ol&gt;
&lt;li&gt;Создаем &lt;strong&gt;GPT&lt;/strong&gt; на &lt;code&gt;1&lt;/code&gt; диске:
    &lt;code&gt;bash
    gpart create -s gpt ada0&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Создаем &lt;strong&gt;GPT&lt;/strong&gt; разметку на &lt;code&gt;1&lt;/code&gt; диске:
3.1 Загрузочный раздел&lt;/li&gt;
&lt;/ol&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;gpart add -b &lt;span class="m"&gt;34&lt;/span&gt; -s &lt;span class="m"&gt;94&lt;/span&gt; -t freebsd-boot ada0
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;3.2 Раздел подкачки&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;gpart add -s 5G -t freebsd-swap ada0
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;3.3 Файловую систему &lt;code&gt;UFS&lt;/code&gt;&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;gpart add -t freebsd-ufs ada0
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;3.4 Проверяем все ли так, как мы задумали&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;gpart &lt;span class="nv"&gt;show&lt;/span&gt;
&lt;span class="o"&gt;=&lt;/span&gt;&amp;gt;        &lt;span class="m"&gt;34&lt;/span&gt;  &lt;span class="m"&gt;2930277101&lt;/span&gt;  ada0  GPT  &lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="m"&gt;1&lt;/span&gt;.4T&lt;span class="o"&gt;)&lt;/span&gt;
          &lt;span class="m"&gt;34&lt;/span&gt;          &lt;span class="m"&gt;94&lt;/span&gt;     &lt;span class="m"&gt;1&lt;/span&gt;  freebsd-boot  &lt;span class="o"&gt;(&lt;/span&gt;47k&lt;span class="o"&gt;)&lt;/span&gt;
         &lt;span class="m"&gt;128&lt;/span&gt;     &lt;span class="m"&gt;2097152&lt;/span&gt;     &lt;span class="m"&gt;2&lt;/span&gt;  freebsd-swap  &lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="m"&gt;1&lt;/span&gt;.0G&lt;span class="o"&gt;)&lt;/span&gt;
     &lt;span class="m"&gt;2097280&lt;/span&gt;  &lt;span class="m"&gt;2928179855&lt;/span&gt;     &lt;span class="m"&gt;3&lt;/span&gt;  freebsd-ufs  &lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="m"&gt;1&lt;/span&gt;.4T&lt;span class="o"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;3.5 Записываем загрузчик&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;gpart bootcode -b /boot/pmbr -p /boot/gptboot -i &lt;span class="m"&gt;1&lt;/span&gt; ada0
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;3.6 Копируем разметку &lt;strong&gt;GTP&lt;/strong&gt; с &lt;code&gt;1&lt;/code&gt; диска на &lt;code&gt;2&lt;/code&gt; диск&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;gpart backup ada0 &lt;span class="p"&gt;|&lt;/span&gt; gpart restore -F ada1
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;3.7. Проверяем что теперь получилось:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;gpart &lt;span class="nv"&gt;show&lt;/span&gt;
&lt;span class="o"&gt;=&lt;/span&gt;&amp;gt;        &lt;span class="m"&gt;34&lt;/span&gt;  &lt;span class="m"&gt;2930277101&lt;/span&gt;  ada0  GPT  &lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="m"&gt;1&lt;/span&gt;.4T&lt;span class="o"&gt;)&lt;/span&gt;
          &lt;span class="m"&gt;34&lt;/span&gt;          &lt;span class="m"&gt;94&lt;/span&gt;     &lt;span class="m"&gt;1&lt;/span&gt;  freebsd-boot  &lt;span class="o"&gt;(&lt;/span&gt;47k&lt;span class="o"&gt;)&lt;/span&gt;
         &lt;span class="m"&gt;128&lt;/span&gt;     &lt;span class="m"&gt;2097152&lt;/span&gt;     &lt;span class="m"&gt;2&lt;/span&gt;  freebsd-swap  &lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="m"&gt;1&lt;/span&gt;.0G&lt;span class="o"&gt;)&lt;/span&gt;
     &lt;span class="m"&gt;2097280&lt;/span&gt;  &lt;span class="m"&gt;2928179855&lt;/span&gt;     &lt;span class="m"&gt;3&lt;/span&gt;  freebsd-ufs  &lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="m"&gt;1&lt;/span&gt;.4T&lt;span class="o"&gt;)&lt;/span&gt;

&lt;span class="o"&gt;=&lt;/span&gt;&amp;gt;        &lt;span class="m"&gt;34&lt;/span&gt;  &lt;span class="m"&gt;2930277101&lt;/span&gt;  ada1  GPT  &lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="m"&gt;1&lt;/span&gt;.4T&lt;span class="o"&gt;)&lt;/span&gt;
          &lt;span class="m"&gt;34&lt;/span&gt;          &lt;span class="m"&gt;94&lt;/span&gt;     &lt;span class="m"&gt;1&lt;/span&gt;  freebsd-boot  &lt;span class="o"&gt;(&lt;/span&gt;47k&lt;span class="o"&gt;)&lt;/span&gt;
         &lt;span class="m"&gt;128&lt;/span&gt;     &lt;span class="m"&gt;2097152&lt;/span&gt;     &lt;span class="m"&gt;2&lt;/span&gt;  freebsd-swap  &lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="m"&gt;1&lt;/span&gt;.0G&lt;span class="o"&gt;)&lt;/span&gt;
     &lt;span class="m"&gt;2097280&lt;/span&gt;  &lt;span class="m"&gt;2928179855&lt;/span&gt;     &lt;span class="m"&gt;3&lt;/span&gt;  freebsd-ufs  &lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="m"&gt;1&lt;/span&gt;.4T&lt;span class="o"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;ol&gt;
&lt;li&gt;загружаем &lt;code&gt;gmirror&lt;/code&gt;:&lt;/li&gt;
&lt;/ol&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;gmirror load
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;4.1 Создаем &lt;strong&gt;RAID1&lt;/strong&gt; для &lt;strong&gt;SWAP&lt;/strong&gt; раздела&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;gmirror label -v -b round-robin swap /dev/ada0p2
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;4.2 Добавляем &lt;code&gt;2&lt;/code&gt;-ой диск в зеркало:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;gmirror insert swap /dev/ada1p2
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;4.3 Создаем &lt;strong&gt;RAID1&lt;/strong&gt; для &lt;strong&gt;UFS&lt;/strong&gt; раздела:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;gmirror label -v -b round-robin rootfs ada0p3
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;4.4 Добавляем &lt;code&gt;2&lt;/code&gt;-ой диск в зеркало:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;gmirror insert rootfs /dev/ada1p3
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;4.5 Удалить случайно созданные &lt;strong&gt;RAID1&lt;/strong&gt; разделы(если вдруг чего-то напутали выше)&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;gmirror remove swap ada0p2 ada1p2
&lt;/pre&gt;&lt;/div&gt;


&lt;ol&gt;
&lt;li&gt;Создаем файловые системы на &lt;strong&gt;RAID1&lt;/strong&gt; разделах&lt;/li&gt;
&lt;/ol&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;newfs -m &lt;span class="m"&gt;1&lt;/span&gt; -U /dev/mirror/rootfs
&lt;/pre&gt;&lt;/div&gt;


&lt;ol&gt;
&lt;li&gt;УСТАНОВКА &lt;strong&gt;FreeBSD&lt;/strong&gt;:
6.1 Монтируем созданную файловую систему в &lt;code&gt;/mnt&lt;/code&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;mount /dev/mirror/rootfs /mnt
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;6.2 Устанавливаем &lt;code&gt;FreeBSD 9.0&lt;/code&gt;&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nb"&gt;cd&lt;/span&gt; /usr/freebsd-dist
sh
&lt;span class="nb"&gt;export&lt;/span&gt; &lt;span class="nv"&gt;DESTDIR&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;/mnt
&lt;span class="k"&gt;for&lt;/span&gt; file in base.txz kernel.txz lib32.txz&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt; &lt;span class="o"&gt;(&lt;/span&gt;cat &lt;span class="nv"&gt;$file&lt;/span&gt; &lt;span class="p"&gt;|&lt;/span&gt; tar --unlink -xpJf - -C &lt;span class="si"&gt;${&lt;/span&gt;&lt;span class="nv"&gt;DESTDIR&lt;/span&gt;&lt;span class="k"&gt;:-&lt;/span&gt;&lt;span class="p"&gt;/&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="k"&gt;done&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;6.3 Создаем &lt;code&gt;/etc/fstab&lt;/code&gt; для установленной системы:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;cat &amp;gt; /mnt/etc/fstab &lt;span class="s"&gt;&amp;lt;&amp;lt;-__EOF__&lt;/span&gt;
&lt;span class="s"&gt;#dev   #mount #fs #opts #dump #pass&lt;/span&gt;
&lt;span class="s"&gt;/dev/mirror/rootfs / ufs rw 1 1&lt;/span&gt;
&lt;span class="s"&gt;/dev/mirror/swap none swap sw 0 0&lt;/span&gt;
&lt;span class="s"&gt;__EOF__&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;6.4 Создаем &lt;code&gt;/boot/loader.conf&lt;/code&gt;&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;cat &amp;gt; /mnt/boot/loader.conf &lt;span class="s"&gt;&amp;lt;&amp;lt;-__EOF__&lt;/span&gt;
&lt;span class="s"&gt;geom_mirror_load=&amp;quot;YES&amp;quot;&lt;/span&gt;
&lt;span class="s"&gt;__EOF__&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;ol&gt;
&lt;li&gt;Отмонтируем зеркало&lt;/li&gt;
&lt;/ol&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;umount /mnt
&lt;/pre&gt;&lt;/div&gt;


&lt;ol&gt;
&lt;li&gt;все готово, теперь можно перезагружаться и смотреть на результат&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Ссылки по теме:
&lt;em&gt; http://forums.freebsd.org/showthread.php?t=29098 HOWTO: Install FreeBSD 9.0 RELEASE (Root on UFS + ZFS, RAID1)
&lt;/em&gt; http://bu7cher.blogspot.com/2011/03/freebsd-gmirror-gpt-ufs.html Варианты загрузки FreeBSD: gmirror + GPT + UFS
&lt;em&gt; http://www.lissyara.su/articles/freebsd/file_system/gmirror/ Использование gmirror для создания программного зеркалирования дисков
&lt;/em&gt; http://forums.freebsd.org/showthread.php?t=28348 [Solved] No gmirror in 9.0, now what?
&lt;em&gt; http://www.wonkity.com/~wblock/docs/html/gmirror.html gmirror With Disk Partitions
&lt;/em&gt; http://blather.michaelwlucas.com/archives/1071 mirroring FreeBSD-9 disks with GPT&lt;/p&gt;</content><category term="FreeBSD"></category><category term="GPT"></category><category term="gmirror"></category></entry><entry><title>Аналоги на sed для dos2unix и unix2dos</title><link href="https://metajiji.github.io/blog/sed-dos2unix-unix2dos/" rel="alternate"></link><published>2012-02-26T00:00:00+07:00</published><updated>2012-02-26T00:00:00+07:00</updated><author><name>Denis Kadyshev</name></author><id>tag:metajiji.github.io,2012-02-26:/blog/sed-dos2unix-unix2dos/</id><summary type="html">&lt;p&gt;Команда &lt;code&gt;dos2unix&lt;/code&gt; служит для преобразования форматов текстовых файлов &lt;strong&gt;MSDOS&lt;/strong&gt; к &lt;strong&gt;UNIX&lt;/strong&gt; формату,
 а команда &lt;code&gt;unix2dos&lt;/code&gt; служит для преобразования форматов текстовых файлов &lt;strong&gt;UNIX&lt;/strong&gt; к формату &lt;strong&gt;MSDOS* и &lt;/strong&gt;&lt;em&gt;windows&lt;/em&gt;*.&lt;/p&gt;
&lt;p&gt;Известно, что форматы текстовых файлов в &lt;strong&gt;DOS&lt;/strong&gt; и в &lt;strong&gt;UNIX&lt;/strong&gt; немного отличаются:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;В &lt;strong&gt;DOS&lt;/strong&gt; все строки заканчиваются парой символов &lt;code&gt;CR&lt;/code&gt; и &lt;code&gt;LF&lt;/code&gt; (возврат …&lt;/li&gt;&lt;/ul&gt;</summary><content type="html">&lt;p&gt;Команда &lt;code&gt;dos2unix&lt;/code&gt; служит для преобразования форматов текстовых файлов &lt;strong&gt;MSDOS&lt;/strong&gt; к &lt;strong&gt;UNIX&lt;/strong&gt; формату,
 а команда &lt;code&gt;unix2dos&lt;/code&gt; служит для преобразования форматов текстовых файлов &lt;strong&gt;UNIX&lt;/strong&gt; к формату &lt;strong&gt;MSDOS* и &lt;/strong&gt;&lt;em&gt;windows&lt;/em&gt;*.&lt;/p&gt;
&lt;p&gt;Известно, что форматы текстовых файлов в &lt;strong&gt;DOS&lt;/strong&gt; и в &lt;strong&gt;UNIX&lt;/strong&gt; немного отличаются:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;В &lt;strong&gt;DOS&lt;/strong&gt; все строки заканчиваются парой символов &lt;code&gt;CR&lt;/code&gt; и &lt;code&gt;LF&lt;/code&gt; (возврат каретки &lt;code&gt;/r&lt;/code&gt; и перевод строки &lt;code&gt;/n&lt;/code&gt;)&lt;/li&gt;
&lt;li&gt;А *&lt;em&gt;UNIX&lt;/em&gt; использует только символ &lt;code&gt;LF&lt;/code&gt; перевод строки &lt;code&gt;/n&lt;/code&gt;, справедливо полагая, что второй символ совершенно излишен.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Чтобы не устанавливать эти консольные утилиты &lt;code&gt;dos2unix&lt;/code&gt; и &lt;code&gt;unix2dos&lt;/code&gt; можно воспользоваться вот такими несложными функциями написанными с использованием &lt;code&gt;sed&lt;/code&gt; в &lt;code&gt;sh&lt;/code&gt; или &lt;code&gt;bash&lt;/code&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="ch"&gt;#!/bin/sh&lt;/span&gt;

dos2unix&lt;span class="o"&gt;()&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt;
 sed -i &lt;span class="s1"&gt;&amp;#39;&amp;#39;&lt;/span&gt; -e &lt;span class="s1"&gt;&amp;#39;s/&amp;#39;&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="k"&gt;$(&lt;/span&gt;&lt;span class="nb"&gt;printf&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;\015&amp;#39;&lt;/span&gt;&lt;span class="k"&gt;)&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;$//&amp;#39;&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;$1&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;
&lt;span class="o"&gt;}&lt;/span&gt;

unix2dos&lt;span class="o"&gt;()&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt;
 sed -i &lt;span class="s1"&gt;&amp;#39;&amp;#39;&lt;/span&gt; -e &lt;span class="s1"&gt;&amp;#39;s|$|&amp;#39;&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="k"&gt;$(&lt;/span&gt;&lt;span class="nb"&gt;printf&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;\015&amp;#39;&lt;/span&gt;&lt;span class="k"&gt;)&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;|&amp;#39;&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;$1&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;
&lt;span class="o"&gt;}&lt;/span&gt;

&lt;span class="c1"&gt;# Сделать окончания строк LF (Unix)&lt;/span&gt;
dos2unix file.test

&lt;span class="c1"&gt;# Сделать окончания строк CR/LF (Win or Dos)&lt;/span&gt;
unix2dos file.test
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Запустить аналог на &lt;code&gt;sed&lt;/code&gt; для &lt;code&gt;dos2unix&lt;/code&gt; прямо в консоли можно командой:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;sed -i &lt;span class="s1"&gt;&amp;#39;&amp;#39;&lt;/span&gt; -e &lt;span class="s1"&gt;&amp;#39;s/&amp;#39;&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;`printf &amp;#39;\015&amp;#39;`&amp;quot;&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;$//&amp;#39;&lt;/span&gt; file.name
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;А аналог на &lt;code&gt;sed&lt;/code&gt; для `unix2dos прямо в консоли выглядит так:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;sed -i &lt;span class="s1"&gt;&amp;#39;&amp;#39;&lt;/span&gt; -e &lt;span class="s1"&gt;&amp;#39;s|$|&amp;#39;&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;`printf &amp;#39;\015&amp;#39;`&amp;quot;&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;|&amp;#39;&lt;/span&gt; file.name
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Обработать рекурсивно все &lt;code&gt;php&lt;/code&gt; файлы в текущем каталоге:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;find . -name &lt;span class="s2"&gt;&amp;quot;*.php&amp;quot;&lt;/span&gt; -type f -exec sed -i &lt;span class="s1"&gt;&amp;#39;&amp;#39;&lt;/span&gt; -e &lt;span class="s1"&gt;&amp;#39;s/&amp;#39;&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;`printf &amp;#39;\015&amp;#39;`&amp;quot;&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;$//&amp;#39;&lt;/span&gt; &lt;span class="o"&gt;{}&lt;/span&gt; &lt;span class="se"&gt;\;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Причины НЕ устанавливать данные консольные утилиты могут быть разными, например невозможность их установить (случай с VPS или web хостингом), спортивный интерес ну или просто лень :)&lt;/p&gt;</content><category term="Linux"></category><category term="FreeBSD"></category><category term="bash"></category></entry><entry><title>FreeBSD утилита pw, управление пользователями и группами</title><link href="https://metajiji.github.io/blog/freebsd-pw/" rel="alternate"></link><published>2012-02-08T00:00:00+07:00</published><updated>2012-02-08T00:00:00+07:00</updated><author><name>Denis Kadyshev</name></author><id>tag:metajiji.github.io,2012-02-08:/blog/freebsd-pw/</id><summary type="html">&lt;h2&gt;Просмотреть текущее состояние можно командой &lt;code&gt;id&lt;/code&gt;&lt;/h2&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;id USER
&lt;/pre&gt;&lt;/div&gt;


&lt;h2&gt;Сменить &lt;strong&gt;UID&lt;/strong&gt;:&lt;/h2&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;pw usermod metall -u &lt;span class="m"&gt;1005&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h2&gt;Сменить &lt;strong&gt;GID&lt;/strong&gt;:&lt;/h2&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;pw groupmod metall -g &lt;span class="m"&gt;1005&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Или:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;pw usermod metall -g &lt;span class="m"&gt;1005&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h2&gt;Изменить список групп, к которым принадлежит пользователь:&lt;/h2&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;pw usermod USER -G vboxusers
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Или:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;pw usermod root -G operator,vboxusers
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Хочу обратить внимание …&lt;/p&gt;</summary><content type="html">&lt;h2&gt;Просмотреть текущее состояние можно командой &lt;code&gt;id&lt;/code&gt;&lt;/h2&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;id USER
&lt;/pre&gt;&lt;/div&gt;


&lt;h2&gt;Сменить &lt;strong&gt;UID&lt;/strong&gt;:&lt;/h2&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;pw usermod metall -u &lt;span class="m"&gt;1005&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h2&gt;Сменить &lt;strong&gt;GID&lt;/strong&gt;:&lt;/h2&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;pw groupmod metall -g &lt;span class="m"&gt;1005&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Или:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;pw usermod metall -g &lt;span class="m"&gt;1005&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h2&gt;Изменить список групп, к которым принадлежит пользователь:&lt;/h2&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;pw usermod USER -G vboxusers
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Или:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;pw usermod root -G operator,vboxusers
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Хочу обратить внимание на то, что группа "по умолчанию" не изменяется. Например для &lt;code&gt;root&lt;/code&gt; такая группа будет &lt;code&gt;wheel&lt;/code&gt; и ее указывать не нужно.&lt;/p&gt;
&lt;h2&gt;Например, как добавить пользователя в группу &lt;code&gt;vboxusers&lt;/code&gt;:&lt;/h2&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;pw usermod USER -G wheel,vboxusers
&lt;/pre&gt;&lt;/div&gt;


&lt;h2&gt;Добавить в группу пользователя (Чаще бывает нужно добавить пользователя в группу, но команда дословно интерпретируется именно так):&lt;/h2&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;pw groupmod GROUP -m USER
&lt;/pre&gt;&lt;/div&gt;</content><category term="freebsd"></category><category term="pw"></category><category term="usermod"></category><category term="groupmod"></category></entry><entry><title>Перенос Windows 7 с одного HDD на другой HDD меньшего объема. (dd + Gparted)</title><link href="https://metajiji.github.io/blog/windows-hdd2hdd-gparted-dd/" rel="alternate"></link><published>2012-02-08T00:00:00+07:00</published><updated>2012-02-08T00:00:00+07:00</updated><author><name>Denis Kadyshev</name></author><id>tag:metajiji.github.io,2012-02-08:/blog/windows-hdd2hdd-gparted-dd/</id><summary type="html">&lt;p&gt;На работе часто бывает необходимо перенести или скопировать &lt;strong&gt;Windows 7&lt;/strong&gt; с одного &lt;strong&gt;HDD&lt;/strong&gt; на другой по разным причинам,
 умирает &lt;strong&gt;HDD&lt;/strong&gt; или нужно установить &lt;strong&gt;HDD&lt;/strong&gt; с меньшим или наоборот с бОльшим объемом,
 в общем проблема решается довольно просто, при помощи 2 утилит &lt;code&gt;dd&lt;/code&gt; и &lt;strong&gt;Gparted&lt;/strong&gt;.&lt;/p&gt;
&lt;p&gt;Загружаемся в &lt;strong&gt;Ubuntu LiveCD&lt;/strong&gt;, у меня …&lt;/p&gt;</summary><content type="html">&lt;p&gt;На работе часто бывает необходимо перенести или скопировать &lt;strong&gt;Windows 7&lt;/strong&gt; с одного &lt;strong&gt;HDD&lt;/strong&gt; на другой по разным причинам,
 умирает &lt;strong&gt;HDD&lt;/strong&gt; или нужно установить &lt;strong&gt;HDD&lt;/strong&gt; с меньшим или наоборот с бОльшим объемом,
 в общем проблема решается довольно просто, при помощи 2 утилит &lt;code&gt;dd&lt;/code&gt; и &lt;strong&gt;Gparted&lt;/strong&gt;.&lt;/p&gt;
&lt;p&gt;Загружаемся в &lt;strong&gt;Ubuntu LiveCD&lt;/strong&gt;, у меня была загрузка по сети образа &lt;strong&gt;Ubuntu 12.04 LTS Desktop&lt;/strong&gt;.&lt;/p&gt;
&lt;p&gt;И первым делом копируем главную загрузочную запись (&lt;strong&gt;MBR&lt;/strong&gt;):&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;dd &lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;/dev/sda &lt;span class="nv"&gt;of&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;/dev/sdb &lt;span class="nv"&gt;bs&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;512&lt;/span&gt; &lt;span class="nv"&gt;count&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;1&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;После чего запускаем &lt;strong&gt;Ggparted&lt;/strong&gt; и копируем разделы (она имеется в обычном &lt;strong&gt;ISO&lt;/strong&gt;).&lt;/p&gt;
&lt;p&gt;Не забываем проверить флаг &lt;code&gt;boot&lt;/code&gt; на &lt;code&gt;100М&lt;/code&gt;байтном разделе.&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;Немного об утилите &lt;code&gt;dd&lt;/code&gt;:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;if=/dev/sda&lt;/code&gt; -- &lt;code&gt;i&lt;/code&gt;nput &lt;code&gt;f&lt;/code&gt;ile (входной файл, в данном случае диск с &lt;strong&gt;Windows 7&lt;/strong&gt;)&lt;/li&gt;
&lt;li&gt;&lt;code&gt;of=/dev/sdb&lt;/code&gt; -- &lt;code&gt;o&lt;/code&gt;utput &lt;code&gt;f&lt;/code&gt;ile (выходной файл, в данном случае диск куда копируем)&lt;/li&gt;
&lt;li&gt;&lt;code&gt;bs=512&lt;/code&gt; -- &lt;strong&gt;b&lt;/strong&gt;lock &lt;strong&gt;s&lt;/strong&gt;ize (&lt;strong&gt;Внимание&lt;/strong&gt;! Операнд &lt;code&gt;count&lt;/code&gt; работает с блоками, а не с байтами! &lt;code&gt;512&lt;/code&gt; блоков)&lt;/li&gt;
&lt;li&gt;&lt;code&gt;count=1&lt;/code&gt; -- &lt;code&gt;count&lt;/code&gt; (количество раз проведения операции копирования буфером)&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;MBR&lt;/strong&gt; находится в &lt;code&gt;0&lt;/code&gt; секторе первого раздела жесткого диска и занимает вместе с таблицей разделов ровно &lt;code&gt;512&lt;/code&gt; байт.
 Поэтому и размер блока выбираем &lt;code&gt;512&lt;/code&gt;, а количество &lt;code&gt;count&lt;/code&gt; единица - получаем &lt;code&gt;512&lt;/code&gt; байт.&lt;/p&gt;
&lt;p&gt;А если нам нужно не весь &lt;strong&gt;MBR&lt;/strong&gt;, а только загрузочный код, который занимает первые &lt;code&gt;446&lt;/code&gt; байт &lt;code&gt;0&lt;/code&gt; сектора, то придется изменить размер блока:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;dd &lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;/dev/sda &lt;span class="nv"&gt;of&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;boot-code.mbr &lt;span class="nv"&gt;bs&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;446&lt;/span&gt; &lt;span class="nv"&gt;count&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;1&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Обратите внимание, на то, что сохраняем в файл, т.к. в устройство записать такой объем не получится, как уже говорилось выше, запись на устройства производится блоками по &lt;code&gt;512&lt;/code&gt; байт.&lt;/p&gt;
&lt;p&gt;Чтобы теперь записать сохраненный загрузчик, нужно получить блок размером в &lt;code&gt;512&lt;/code&gt; байт,
 для этого сохраняем в другой файл таблицу разделов - это оставшиеся &lt;code&gt;66&lt;/code&gt; байт после загрузочного кода - &lt;code&gt;446&lt;/code&gt; байт.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;dd &lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;/dev/sdb &lt;span class="nv"&gt;of&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;part-table.mbr &lt;span class="nv"&gt;bs&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;1&lt;/span&gt; &lt;span class="nv"&gt;count&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;66&lt;/span&gt; &lt;span class="nv"&gt;skip&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;446&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;&lt;code&gt;skip=n&lt;/code&gt;(блоков) Этот операнд пропускает n блоков от начала входного (&lt;code&gt;if&lt;/code&gt;) файла(устройства), а затем копирует указанное количество блоков.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Внимание&lt;/strong&gt;! Операнд &lt;code&gt;skip&lt;/code&gt; (как и &lt;code&gt;count&lt;/code&gt;) имеет дело с блоками, а не с байтами! Поэтому размер блока следует выбирать вдумчиво.
И еще обратите внимание на то, что сейчас мы выбрали устройство &lt;code&gt;/dev/sdb&lt;/code&gt;, т.к. нам нужна таблица разделов именно этого устройства,
 ведь мы туда собираемся копировать загрузчик с устройства &lt;code&gt;/dev/sda&lt;/code&gt; :)&lt;/p&gt;
&lt;p&gt;Теперь нужно "собрать" &lt;strong&gt;MBR&lt;/strong&gt; из имеющихся кусочков:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;cat boot-code.mbr &amp;gt; mbr
cat part-table.mbr &amp;gt;&amp;gt; mbr
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Теперь наконец-то мы можем записать загрузочный код на устройство!&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;dd &lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;mbr &lt;span class="nv"&gt;of&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;/dev/sdb &lt;span class="nv"&gt;bs&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;512&lt;/span&gt; &lt;span class="nv"&gt;count&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;1&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;hr&gt;
&lt;p&gt;Ссылки по теме:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href="http://www.youisbee.ru/index.php/documents/25-linux/62-dd.pdf"&gt;Команда dd и её использование.&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://asplinux.net/node/5548"&gt;Как мне скопировать загрузочную запись линуха на дискету?&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;</content><category term="windows"></category><category term="gparted"></category><category term="dd"></category></entry><entry><title>Проблема с grub и русской локализацией в Ubuntu</title><link href="https://metajiji.github.io/blog/grub-ubuntu/" rel="alternate"></link><published>2012-02-05T00:00:00+07:00</published><updated>2012-02-05T00:00:00+07:00</updated><author><name>Denis Kadyshev</name></author><id>tag:metajiji.github.io,2012-02-05:/blog/grub-ubuntu/</id><summary type="html">&lt;p&gt;В некоторых версиях &lt;strong&gt;Ubuntu&lt;/strong&gt; почему-то отсутствует файл локализации &lt;code&gt;ru.mo&lt;/code&gt; в &lt;strong&gt;Grub&lt;/strong&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;ls /boot/grub/locale/
en_AU.mo  en_CA.mo  en_GB.mo
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;В результате мы видим меню граба на английском языке, хотя при этом язык установлен правильно:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;cat /boot/grub/grub.cfg &lt;span class="p"&gt;|&lt;/span&gt; grep lang
  &lt;span class="nb"&gt;set&lt;/span&gt; &lt;span class="nv"&gt;lang&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;ru_RU
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;&lt;strong&gt;ВНИМАНИЕ&lt;/strong&gt;, перед дальнейшими …&lt;/p&gt;</summary><content type="html">&lt;p&gt;В некоторых версиях &lt;strong&gt;Ubuntu&lt;/strong&gt; почему-то отсутствует файл локализации &lt;code&gt;ru.mo&lt;/code&gt; в &lt;strong&gt;Grub&lt;/strong&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;ls /boot/grub/locale/
en_AU.mo  en_CA.mo  en_GB.mo
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;В результате мы видим меню граба на английском языке, хотя при этом язык установлен правильно:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;cat /boot/grub/grub.cfg &lt;span class="p"&gt;|&lt;/span&gt; grep lang
  &lt;span class="nb"&gt;set&lt;/span&gt; &lt;span class="nv"&gt;lang&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;ru_RU
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;&lt;strong&gt;ВНИМАНИЕ&lt;/strong&gt;, перед дальнейшими действиями сделайте резервные копии всех модифицированных вами файлов от &lt;strong&gt;Grub&lt;/strong&gt;'а, например &lt;code&gt;/etc/default/grub&lt;/code&gt; или &lt;code&gt;/etc/grub.d/00_header&lt;/code&gt;,
 если вы счастливый обладатель нетбука с чипсетом &lt;code&gt;i915&lt;/code&gt; &lt;a href="http://metajiji.blogspot.com/2011/12/ubuntu-1110-eeepc-1024x600-grub2.html" title="Ubuntu 11.10 на EeePC разрешение экрана 1024x600 в меню GRUB2"&gt;Ubuntu 11.10 на EeePC разрешение экрана 1024x600 в меню GRUB2 [1]&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Чтобы меню граба снова стало на русском, нужно сперва удалить пакет &lt;code&gt;grub-pc&lt;/code&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;sudo apt-get purge grub-pc
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Затем снова установить:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;sudo apt-get install grub-pc
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Теперь проверяем появился ли &lt;code&gt;ru.mo&lt;/code&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;ls /boot/grub/locale/
en_AU.mo  en_CA.mo  en_GB.mo  ru.mo
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Теперь можно перезагрузиться и проверить, что все нормально.&lt;/p&gt;
&lt;p&gt;P.S. думаю и обычное копирование этого файла с "рабочей" системы так же исправит ситуацию, но я такой метод не проверял.&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;Ссылки по теме:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href="http://metajiji.blogspot.com/2011/12/ubuntu-1110-eeepc-1024x600-grub2.html" title="Ubuntu 11.10 на EeePC разрешение экрана 1024x600 в меню GRUB2"&gt;Ubuntu 11.10 на EeePC разрешение экрана 1024x600 в меню GRUB2&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;</content><category term="Linux"></category><category term="Ubuntu"></category><category term="Grub"></category></entry><entry><title>Уменьшение количества соединений в состоянии TCP TIME_WAIT</title><link href="https://metajiji.github.io/blog/freebsd-tcp-timewait/" rel="alternate"></link><published>2012-01-30T00:00:00+07:00</published><updated>2012-01-30T00:00:00+07:00</updated><author><name>Denis Kadyshev</name></author><id>tag:metajiji.github.io,2012-01-30:/blog/freebsd-tcp-timewait/</id><summary type="html">&lt;p&gt;&lt;strong&gt;TCP TIME_WAIT&lt;/strong&gt; состояние характерно для завершающей стадии соединения.&lt;/p&gt;
&lt;p&gt;Рассмотрим пример:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;FIN&lt;/code&gt; 1 =&amp;gt; 2&lt;/li&gt;
&lt;li&gt;&lt;code&gt;ACK&lt;/code&gt; 1 &amp;lt;= 2&lt;/li&gt;
&lt;li&gt;&lt;code&gt;FIN&lt;/code&gt; 1 &amp;lt;= 2&lt;/li&gt;
&lt;li&gt;&lt;code&gt;ACK&lt;/code&gt; 1 =&amp;gt; 2&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;В первой строке хост 1 инициирует завершение соединение отправкой пакета с флагом &lt;code&gt;FIN&lt;/code&gt;.
Хост 2, получив такой пакет подтверждает его флагом &lt;code&gt;ACK&lt;/code&gt;, после чего в свою очередь отправляет …&lt;/p&gt;</summary><content type="html">&lt;p&gt;&lt;strong&gt;TCP TIME_WAIT&lt;/strong&gt; состояние характерно для завершающей стадии соединения.&lt;/p&gt;
&lt;p&gt;Рассмотрим пример:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;FIN&lt;/code&gt; 1 =&amp;gt; 2&lt;/li&gt;
&lt;li&gt;&lt;code&gt;ACK&lt;/code&gt; 1 &amp;lt;= 2&lt;/li&gt;
&lt;li&gt;&lt;code&gt;FIN&lt;/code&gt; 1 &amp;lt;= 2&lt;/li&gt;
&lt;li&gt;&lt;code&gt;ACK&lt;/code&gt; 1 =&amp;gt; 2&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;В первой строке хост 1 инициирует завершение соединение отправкой пакета с флагом &lt;code&gt;FIN&lt;/code&gt;.
Хост 2, получив такой пакет подтверждает его флагом &lt;code&gt;ACK&lt;/code&gt;, после чего в свою очередь отправляет хосту 1 свой пакет с флагом &lt;code&gt;FIN&lt;/code&gt; и закрывает соединение.
 С момента получения этого пакета хостом 1, соединение переходит в состояние &lt;code&gt;TIME_WAIT&lt;/code&gt;.
 Это время дается на случай, если последний &lt;code&gt;ACK&lt;/code&gt; не дойдет до хоста 2, тогда он снова отправит &lt;code&gt;FIN&lt;/code&gt;, на который хост 1 еще раз отошлет &lt;code&gt;ACK&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Соединение может еще долгое время находится в состоянии &lt;code&gt;TIME_WAIT&lt;/code&gt;, согласно &lt;strong&gt;RFC 1323&lt;/strong&gt; это время должно равнятся 2 минутам, двум &lt;code&gt;msl&lt;/code&gt; (&lt;strong&gt;Maximum Segment Lifetime&lt;/strong&gt;).
 &lt;code&gt;MSL&lt;/code&gt; - это время, в течение которого сегмент может путешествовать по сети (&lt;strong&gt;RFC&lt;/strong&gt; рекомендует &lt;strong&gt;60 секунд&lt;/strong&gt;).
 На загруженном сервере при таком значении &lt;code&gt;msl&lt;/code&gt; число соединений &lt;code&gt;time_wait&lt;/code&gt; расчет очень быстро, к тому же упомянутый &lt;strong&gt;RFC&lt;/strong&gt; составлялся достаточно давно и пропускная способность каналов с тех пор возросла многократно,
 поэтому многие уменьшают это значение.&lt;/p&gt;
&lt;p&gt;Во &lt;strong&gt;FreeBSD&lt;/strong&gt; есть переменная &lt;code&gt;sysctl net.inet.tcp.msl&lt;/code&gt;, по умолчанию равная &lt;strong&gt;30 секундам&lt;/strong&gt;.
Можно уменьшить его до &lt;strong&gt;20&lt;/strong&gt; или даже &lt;strong&gt;15 секунд&lt;/strong&gt;.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;net.inet.tcp.msl=15000&amp;quot;&lt;/span&gt; &amp;gt;&amp;gt; /etc/sysctl.conf
/etc/rc.d/sysctl start
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;В &lt;strong&gt;Linux&lt;/strong&gt; немного сложнее, там &lt;code&gt;msl&lt;/code&gt; спрятано в ядре в файле &lt;code&gt;/net/tcp.h&lt;/code&gt;&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="c1"&gt;#define TCP_TIMEWAIT_LEN (60*HZ)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;</content><category term="FreeBSD"></category><category term="TCP time-wait"></category><category term="timewait"></category></entry><entry><title>Jupiter на Ubuntu 11.10 и исправление проблем с ним.</title><link href="https://metajiji.github.io/blog/jupiter-ubuntu-1110/" rel="alternate"></link><published>2011-12-25T00:00:00+07:00</published><updated>2011-12-25T00:00:00+07:00</updated><author><name>Denis Kadyshev</name></author><id>tag:metajiji.github.io,2011-12-25:/blog/jupiter-ubuntu-1110/</id><summary type="html">&lt;p&gt;&lt;strong&gt;Jupiter&lt;/strong&gt; — апплет, разработанный для нетбуков и ноутбуков. Он позволяет переключаться между максимальной/высокой производительностью
 и энергосберегающим режимом, менять разрешение экрана и ориентацию, включать/отключать &lt;strong&gt;bluetooth&lt;/strong&gt;, тачпад, &lt;strong&gt;WiFi&lt;/strong&gt; и т.д. 
Если вы владелец нетбука &lt;strong&gt;ASUS EeePC&lt;/strong&gt;, вам будет полезен отдельный пакет, добавляющий поддержку &lt;strong&gt;SHE&lt;/strong&gt; (&lt;strong&gt;ASUS Super Hybrid Engine&lt;/strong&gt;) 
и ряда …&lt;/p&gt;</summary><content type="html">&lt;p&gt;&lt;strong&gt;Jupiter&lt;/strong&gt; — апплет, разработанный для нетбуков и ноутбуков. Он позволяет переключаться между максимальной/высокой производительностью
 и энергосберегающим режимом, менять разрешение экрана и ориентацию, включать/отключать &lt;strong&gt;bluetooth&lt;/strong&gt;, тачпад, &lt;strong&gt;WiFi&lt;/strong&gt; и т.д. 
Если вы владелец нетбука &lt;strong&gt;ASUS EeePC&lt;/strong&gt;, вам будет полезен отдельный пакет, добавляющий поддержку &lt;strong&gt;SHE&lt;/strong&gt; (&lt;strong&gt;ASUS Super Hybrid Engine&lt;/strong&gt;) 
и ряда тонких настроек &lt;strong&gt;EeePC&lt;/strong&gt;. Но в нем есть одна проблема, при включении/отключении &lt;strong&gt;WiFi&lt;/strong&gt; отображается неверный статус - &lt;code&gt;WIFI Radio Off&lt;/code&gt;.
 Проблема заключается в том, что разработчики программы &lt;strong&gt;Jupiter&lt;/strong&gt; используют неверные пути &lt;code&gt;/sbin/rfkill&lt;/code&gt; в скриптах &lt;code&gt;/usr/lib/jupiter/scripts/bluetooth&lt;/code&gt;,
 &lt;code&gt;/usr/lib/jupiter/scripts/wifi&lt;/code&gt; чтобы исправить ошибку в &lt;strong&gt;Jupiter&lt;/strong&gt; при работе с &lt;strong&gt;Wi-Fi&lt;/strong&gt; в &lt;strong&gt;Ubuntu 11.10&lt;/strong&gt; нужно исправить в скриптах пути до &lt;code&gt;rfkill&lt;/code&gt;,
 а лучше заменить &lt;code&gt;/sbin/rfkill&lt;/code&gt; на &lt;code&gt;$(which rfkill)&lt;/code&gt; - это более универсальный способ и работа скриптов не будет зависеть от версии &lt;strong&gt;Linux&lt;/strong&gt;,
 либо смириться с текущим положением дел и выполнить в терминале такую команду:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;sudo ln -s /usr/sbin/rfkill /sbin/rfkill
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Такой вариант пока предпочтительнее, потому как при обновлении ОС, ваши изменения могут быть потеряны, и придется все повторить.&lt;/p&gt;
&lt;p&gt;Теперь исправляем проблему с файлом &lt;code&gt;/usr/lib/jupiter/scripts/notify&lt;/code&gt;. Проблема связана с командой &lt;code&gt;who&lt;/code&gt;  в &lt;strong&gt;Ubuntu 11.10&lt;/strong&gt;,
 которая работает несколько иначе, чем в предыдущих выпусках.&lt;/p&gt;
&lt;p&gt;Открываем файл &lt;code&gt;/usr/lib/jupiter/scripts/notify&lt;/code&gt; и ищем строку:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nv"&gt;USER&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="k"&gt;$(&lt;/span&gt;who -u &lt;span class="p"&gt;|&lt;/span&gt; sed -n &lt;span class="s1"&gt;&amp;#39;/ (:0[\.0]*)$\| :0 /{s/ .*//p;q}&amp;#39;&lt;/span&gt;&lt;span class="k"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Заменяем ее на:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nv"&gt;USER&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="k"&gt;$(&lt;/span&gt;users /var/log/wtmp &lt;span class="p"&gt;|&lt;/span&gt; sed &lt;span class="s1"&gt;&amp;#39;s| |\n|g&amp;#39;&lt;/span&gt; &lt;span class="p"&gt;|&lt;/span&gt; uniq&lt;span class="k"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;И еще одну строку:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nv"&gt;USERCNT&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="k"&gt;$(&lt;/span&gt;who &lt;span class="p"&gt;|&lt;/span&gt; wc -l&lt;span class="k"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;заменяем на:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nv"&gt;USERCNT&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="k"&gt;$(&lt;/span&gt;users /var/log/wtmp &lt;span class="p"&gt;|&lt;/span&gt; sed &lt;span class="s1"&gt;&amp;#39;s| |\n|g&amp;#39;&lt;/span&gt; &lt;span class="p"&gt;|&lt;/span&gt; uniq &lt;span class="p"&gt;|&lt;/span&gt; wc -l&lt;span class="k"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Открываем еще один файл &lt;code&gt;/etc/acpi/actions/eeepc-actions.sh&lt;/code&gt; и ищем строку:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nv"&gt;EEE_USER&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="k"&gt;$(&lt;/span&gt;who &lt;span class="p"&gt;|&lt;/span&gt; sed -n &lt;span class="s1"&gt;&amp;#39;/ (:0[\.0]*)$\| :0 /{s/ .*//p;q}&amp;#39;&lt;/span&gt;&lt;span class="k"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Приводим к такому виду:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nv"&gt;EEE_USER&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="k"&gt;$(&lt;/span&gt;users /var/log/wtmp &lt;span class="p"&gt;|&lt;/span&gt; sed &lt;span class="s1"&gt;&amp;#39;s| |\n|g&amp;#39;&lt;/span&gt; &lt;span class="p"&gt;|&lt;/span&gt; uniq&lt;span class="k"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Теперь при отключении &lt;strong&gt;Wi-Fi&lt;/strong&gt; будут отображаться верные статусы:&lt;/p&gt;
&lt;p&gt;&lt;img alt="Wifi On" src="https://metajiji.github.io/blog/jupiter-ubuntu-1110/25-12-2011_jupiter-ubuntu-1110/wifi_on.png" title="Wifi On"&gt;
&lt;img alt="Wifi Off" src="https://metajiji.github.io/blog/jupiter-ubuntu-1110/25-12-2011_jupiter-ubuntu-1110/wifi_off.png" title="Wifi Off"&gt;
&lt;img alt="Bluetooth On" src="https://metajiji.github.io/blog/jupiter-ubuntu-1110/25-12-2011_jupiter-ubuntu-1110/bt_on.png" title="Bluetooth On"&gt;
&lt;img alt="Bluetooth Off" src="https://metajiji.github.io/blog/jupiter-ubuntu-1110/25-12-2011_jupiter-ubuntu-1110/bt_off.png" title="Bluetooth Off"&gt;
&lt;img alt="Touchpad On" src="https://metajiji.github.io/blog/jupiter-ubuntu-1110/25-12-2011_jupiter-ubuntu-1110/tp_on.png" title="Touchpad On"&gt;
&lt;img alt="Touchpad Off" src="https://metajiji.github.io/blog/jupiter-ubuntu-1110/25-12-2011_jupiter-ubuntu-1110/tp_off.png" title="Touchpad Off"&gt;&lt;/p&gt;
&lt;p&gt;Очень надеюсь, что разработчики этой программки, исправят ситуацию, и данный прием не нужно будет применять.&lt;/p&gt;
&lt;p&gt;Если у вас нетбук &lt;strong&gt;Asus EeePC&lt;/strong&gt;, также установите пакет &lt;code&gt;jupiter-support-eee&lt;/code&gt; — необходимо для &lt;strong&gt;SHE&lt;/strong&gt; (&lt;strong&gt;Super Hybrid Engine&lt;/strong&gt;):&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;sudo apt-get install jupiter-support-eee
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Если вы работаете в &lt;strong&gt;Unity&lt;/strong&gt;, после первого запуска &lt;strong&gt;Jupiter&lt;/strong&gt; вам необходимо перезайти, чтобы увидеть иконку апплета в области уведомлений.
 Конечно, в том случае, если в &lt;strong&gt;whitelist&lt;/strong&gt; не занесен весь системный трей.&lt;/p&gt;</content><category term="Ubuntu"></category><category term="jupiter"></category></entry><entry><title>Список контактов qutim 0.2 в Ubuntu 11.10</title><link href="https://metajiji.github.io/blog/qutim-02-ubuntu-1110/" rel="alternate"></link><published>2011-12-24T00:00:00+07:00</published><updated>2011-12-24T00:00:00+07:00</updated><author><name>Denis Kadyshev</name></author><id>tag:metajiji.github.io,2011-12-24:/blog/qutim-02-ubuntu-1110/</id><summary type="html">&lt;p&gt;У &lt;strong&gt;qutim 0.2&lt;/strong&gt; в &lt;strong&gt;Ubuntu 11.10 Oneric Ocelot&lt;/strong&gt; есть одна серьезная проблема,
 при закрытии окна со списком контактов его невозможно вызвать стандартными средствами.
 Контекстное меню &lt;s&gt;трея&lt;/s&gt; панели индикаторов позволяет лишь открыть окно настроек или сменить статус.
 Опции "&lt;strong&gt;показать список контактов&lt;/strong&gt;" или "&lt;strong&gt;Открыть&lt;/strong&gt;" или чего-либо подобного нету. 
Контекстное меню …&lt;/p&gt;</summary><content type="html">&lt;p&gt;У &lt;strong&gt;qutim 0.2&lt;/strong&gt; в &lt;strong&gt;Ubuntu 11.10 Oneric Ocelot&lt;/strong&gt; есть одна серьезная проблема,
 при закрытии окна со списком контактов его невозможно вызвать стандартными средствами.
 Контекстное меню &lt;s&gt;трея&lt;/s&gt; панели индикаторов позволяет лишь открыть окно настроек или сменить статус.
 Опции "&lt;strong&gt;показать список контактов&lt;/strong&gt;" или "&lt;strong&gt;Открыть&lt;/strong&gt;" или чего-либо подобного нету. 
Контекстное меню открывается одинаковое и по правой, и по левой кнопке мыши.&lt;/p&gt;
&lt;p&gt;Фишка в том что &lt;strong&gt;qt&lt;/strong&gt;-приложения в юнити рисуют иконку в трее через &lt;code&gt;dbus&lt;/code&gt; и являются уже не обычными иконками в трее,
 а "&lt;strong&gt;индикаторами&lt;/strong&gt;" гнома, отсюда и проблемы с исчезновениями иконки. Помогает либо перезапуск &lt;code&gt;qutIM&lt;/code&gt;, либо стараться не закрывать,
 а сворачивать список контактов, что весьма неудобно в работе.&lt;/p&gt;
&lt;p&gt;Чтобы исправить ситуацию - нужно создать файл &lt;code&gt;~/.config/sni-qt.conf&lt;/code&gt; со следующим содержимым:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;[need-activate-action]&lt;/span&gt;
&lt;span class="na"&gt;qutim&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;1&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;После чего придется перезапустить &lt;code&gt;qutim&lt;/code&gt;, в контекстном меню появится пункт "&lt;strong&gt;Активировать&lt;/strong&gt;",
 который будет работать как клик левой кнопкой мыши в обычном трее.&lt;/p&gt;</content><category term="Ubuntu"></category><category term="qutim"></category></entry><entry><title>Ubuntu 11.10 на EeePC разрешение экрана 1024x600 в меню GRUB2</title><link href="https://metajiji.github.io/blog/grub-linux-intel-915-1024x600/" rel="alternate"></link><published>2011-12-23T00:00:00+07:00</published><updated>2011-12-23T00:00:00+07:00</updated><author><name>Denis Kadyshev</name></author><id>tag:metajiji.github.io,2011-12-23:/blog/grub-linux-intel-915-1024x600/</id><summary type="html">&lt;p&gt;Как известно в нетбуках &lt;strong&gt;EeePC 1000&lt;/strong&gt; и им подобным используется чипсет &lt;code&gt;i915&lt;/code&gt;, максимальное разрешение матрицы такого нетбука &lt;code&gt;1024x600&lt;/code&gt;.
По умолчанию &lt;strong&gt;GRUB&lt;/strong&gt; не умеет работать с таким разрешением, но ситуацию можно исправить, для этого существует специальный модуль &lt;strong&gt;GRUB&lt;/strong&gt;'а &lt;code&gt;915resolution.mod&lt;/code&gt;, с ним и будем работать.
Чтобы установить разрешение экрана в …&lt;/p&gt;</summary><content type="html">&lt;p&gt;Как известно в нетбуках &lt;strong&gt;EeePC 1000&lt;/strong&gt; и им подобным используется чипсет &lt;code&gt;i915&lt;/code&gt;, максимальное разрешение матрицы такого нетбука &lt;code&gt;1024x600&lt;/code&gt;.
По умолчанию &lt;strong&gt;GRUB&lt;/strong&gt; не умеет работать с таким разрешением, но ситуацию можно исправить, для этого существует специальный модуль &lt;strong&gt;GRUB&lt;/strong&gt;'а &lt;code&gt;915resolution.mod&lt;/code&gt;, с ним и будем работать.
Чтобы установить разрешение экрана в меню &lt;strong&gt;GRUB&lt;/strong&gt;'а &lt;code&gt;1024x600&lt;/code&gt; на &lt;strong&gt;EeePC 1000&lt;/strong&gt; и им подобным, выполняем следующее:&lt;/p&gt;
&lt;p&gt;Открываем файл &lt;code&gt;/etc/grub.d/00_header&lt;/code&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;sudo mcedit /etc/grub.d/00_header
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Находим кусок кода:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;    cat &lt;span class="s"&gt;&amp;lt;&amp;lt; EOF&lt;/span&gt;
&lt;span class="s"&gt;if loadfont `make_system_path_relative_to_its_root &amp;quot;${GRUB_FONT_PATH}&amp;quot;` ; then&lt;/span&gt;
&lt;span class="s"&gt;  set gfxmode=${GRUB_GFXMODE}&lt;/span&gt;
&lt;span class="s"&gt;  load_video&lt;/span&gt;
&lt;span class="s"&gt;  insmod gfxterm&lt;/span&gt;
&lt;span class="s"&gt;EOF&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;И приводим его к такому виду:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;    cat &lt;span class="s"&gt;&amp;lt;&amp;lt; EOF&lt;/span&gt;
&lt;span class="s"&gt;if loadfont `make_system_path_relative_to_its_root &amp;quot;${GRUB_FONT_PATH}&amp;quot;` ; then&lt;/span&gt;
&lt;span class="s"&gt;  # Fix resolution for EeePC: BEGIN&lt;/span&gt;
&lt;span class="s"&gt;  insmod 915resolution&lt;/span&gt;
&lt;span class="s"&gt;  915resolution 5c 1024 600&lt;/span&gt;
&lt;span class="s"&gt;  # Fix resolution for EeePC: END&lt;/span&gt;
&lt;span class="s"&gt;  set gfxmode=${GRUB_GFXMODE}&lt;/span&gt;
&lt;span class="s"&gt;  load_video&lt;/span&gt;
&lt;span class="s"&gt;  insmod gfxterm&lt;/span&gt;
&lt;span class="s"&gt;EOF&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Затем нужно обновить конфигурацию &lt;strong&gt;GRUB&lt;/strong&gt;'a командой:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;update-grub
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;После проделанных манипуляций меню &lt;strong&gt;GRUB&lt;/strong&gt;'а будет иметь разрешение &lt;code&gt;1024x600&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Если просто загружать модуль &lt;code&gt;915resolution.mod&lt;/code&gt;, то разрешение не будет установлено,
 так как модуль будет просто загружен, а вот команда &lt;strong&gt;GRUB&lt;/strong&gt;'а &lt;code&gt;915resolution 5c 1024 600&lt;/code&gt; выполнена не будет,
 а значит и разрешение не будет установлено, хотя оно станет доступным для ручной установки из командной строки &lt;strong&gt;GRUB&lt;/strong&gt;.&lt;/p&gt;
&lt;p&gt;Способ с загрузкой модуля через конфиг &lt;strong&gt;НЕ&lt;/strong&gt; подходит:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nv"&gt;GRUB_PRELOAD_MODULES&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;915resolution&amp;quot;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Бонус!&lt;/p&gt;
&lt;p&gt;Теперь самое время установить фоновую картинку в меню.
Создаем картинку &lt;code&gt;my_image.png&lt;/code&gt; размером &lt;code&gt;1024x600&lt;/code&gt; и сохраняем ее в домашнем каталоге.&lt;/p&gt;
&lt;p&gt;Затем в терминале выполняем команды:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;sudo mkdir -p &lt;span class="s2"&gt;&amp;quot;/usr/share/images/desktop-base/&amp;quot;&lt;/span&gt;
sudo cp my_image.png &lt;span class="s2"&gt;&amp;quot;/usr/share/images/desktop-base/desktop-grub.png&amp;quot;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;После этих команд картинку из домашнего каталога по желанию можно удалить, это никак не скажется на работе &lt;strong&gt;GRUB&lt;/strong&gt;'a.&lt;/p&gt;
&lt;p&gt;P.S. путь до картинки подсмотрел командой:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;cat /etc/grub.d/05_debian_theme &lt;span class="p"&gt;|&lt;/span&gt; grep &lt;span class="s1"&gt;&amp;#39;.png&amp;#39;&lt;/span&gt; &lt;span class="p"&gt;|&lt;/span&gt; grep &lt;span class="s1"&gt;&amp;#39;usr&amp;#39;&lt;/span&gt;
&lt;span class="k"&gt;if&lt;/span&gt; set_background_image &lt;span class="s2"&gt;&amp;quot;/usr/share/images/desktop-base/desktop-grub.png&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="k"&gt;then&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Или можно воспользоваться более человечным способом:
Добавляем в файл &lt;code&gt;/etc/default/grub&lt;/code&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="c1"&gt;# Grub Background&lt;/span&gt;
&lt;span class="nv"&gt;GRUB_BACKGROUND&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;/путь/до/картинки
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;P.S. Данный способ подошел и для ноутбука &lt;strong&gt;HP Compaq 6710b&lt;/strong&gt; с разрешением &lt;code&gt;1280x800&lt;/code&gt; и графическим адаптером &lt;code&gt;GM965/GL960&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;Про &lt;code&gt;/etc/grub.d/40_custom&lt;/code&gt; знаю, но вот беда, как &lt;a href="https://help.ubuntu.com/community/AspireOne/AO751h" title="AspireOne/AO751h"&gt;пишут тут [1]&lt;/a&gt; у меня не заработало. Скорей всего потому, что все необходимые модули для работы видео в &lt;strong&gt;GRUB&lt;/strong&gt; были загружены прежде (как раз то место, где я добавлял строки в &lt;code&gt;/etc/grub.d/00_head&lt;/code&gt;), чем сработал скрипт &lt;code&gt;/etc/grub.d/40_custom&lt;/code&gt;, т.к. строки из него добавляются в самом конце &lt;code&gt;grub.cfg&lt;/code&gt;. Поэтому мой метод наиболее предпочтителен, но при обновлении скрипта &lt;code&gt;/etc/grub.d/00_head&lt;/code&gt; потребуется вновь его отредактировать.&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;Ссылки по теме:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href="https://help.ubuntu.com/community/AspireOne/AO751h" title="AspireOne/AO751h"&gt;AspireOne/AO751h&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;</content><category term="Linux"></category><category term="Ubuntu"></category><category term="Grub"></category></entry><entry><title>FreeBSD, Linux узнать внешний ip адрес с консоли.</title><link href="https://metajiji.github.io/blog/freebsd-linux-external-ip/" rel="alternate"></link><published>2011-12-22T00:00:00+07:00</published><updated>2011-12-22T00:00:00+07:00</updated><author><name>Denis Kadyshev</name></author><id>tag:metajiji.github.io,2011-12-22:/blog/freebsd-linux-external-ip/</id><summary type="html">&lt;p&gt;Бывает необходимость быстро узнать через какой &lt;code&gt;ip&lt;/code&gt; выходит в интернет тот или иной сервер к которому вы подключены, ниже приведен простой способ решения данной задачи.&lt;/p&gt;
&lt;p&gt;Так как во &lt;strong&gt;FreeBSD&lt;/strong&gt; в стандартной комплектации нет &lt;code&gt;wget&lt;/code&gt;, но зато есть &lt;code&gt;fetch&lt;/code&gt;, команда будет такой:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;fetch -qo - http://checkip.dyndns.org/ &lt;span class="p"&gt;|&lt;/span&gt; grep -Eo &lt;span class="s1"&gt;&amp;#39;\&amp;lt;[[:digit …&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;</summary><content type="html">&lt;p&gt;Бывает необходимость быстро узнать через какой &lt;code&gt;ip&lt;/code&gt; выходит в интернет тот или иной сервер к которому вы подключены, ниже приведен простой способ решения данной задачи.&lt;/p&gt;
&lt;p&gt;Так как во &lt;strong&gt;FreeBSD&lt;/strong&gt; в стандартной комплектации нет &lt;code&gt;wget&lt;/code&gt;, но зато есть &lt;code&gt;fetch&lt;/code&gt;, команда будет такой:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;fetch -qo - http://checkip.dyndns.org/ &lt;span class="p"&gt;|&lt;/span&gt; grep -Eo &lt;span class="s1"&gt;&amp;#39;\&amp;lt;[[:digit:]]{1,3}(\.[[:digit:]]{1,3}){3}\&amp;gt;&amp;#39;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;А для &lt;strong&gt;Linux&lt;/strong&gt; подойдет вариант с &lt;code&gt;wget&lt;/code&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;wget -qO- http://checkip.dyndns.org/ &lt;span class="p"&gt;|&lt;/span&gt; grep -Eo &lt;span class="s1"&gt;&amp;#39;\&amp;lt;[[:digit:]]{1,3}(\.[[:digit:]]{1,3}){3}\&amp;gt;&amp;#39;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Еще один вариант с &lt;code&gt;curl&lt;/code&gt;, может подойти для обоих платформ, если конечно установлен:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;curl -so- http://checkip.dyndns.org/ &lt;span class="p"&gt;|&lt;/span&gt; grep -Eo &lt;span class="s1"&gt;&amp;#39;\&amp;lt;[[:digit:]]{1,3}(\.[[:digit:]]{1,3}){3}\&amp;gt;&amp;#39;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;</content><category term="Linux"></category><category term="FreeBSD"></category></entry><entry><title>Ubuntu 11.10 USB HDD NTFS только в режиме чтения</title><link href="https://metajiji.github.io/blog/ubuntu-usb-hdd-ntfs/" rel="alternate"></link><published>2011-12-15T00:00:00+07:00</published><updated>2011-12-15T00:00:00+07:00</updated><author><name>Denis Kadyshev</name></author><id>tag:metajiji.github.io,2011-12-15:/blog/ubuntu-usb-hdd-ntfs/</id><summary type="html">&lt;p&gt;Если при подключении внешнего &lt;strong&gt;USB HDD&lt;/strong&gt; с файловой системой &lt;strong&gt;ntfs&lt;/strong&gt; диск доступен только в режиме чтения, вероятнее всего не установлен пакет &lt;code&gt;ntfs-3g&lt;/code&gt;&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;apt-get -y install ntfs-3g
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;После этого &lt;strong&gt;USB HDD&lt;/strong&gt; с &lt;strong&gt;ntfs&lt;/strong&gt; на борту будут монтироваться автоматически и в режиме записи.&lt;/p&gt;</summary><content type="html">&lt;p&gt;Если при подключении внешнего &lt;strong&gt;USB HDD&lt;/strong&gt; с файловой системой &lt;strong&gt;ntfs&lt;/strong&gt; диск доступен только в режиме чтения, вероятнее всего не установлен пакет &lt;code&gt;ntfs-3g&lt;/code&gt;&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;apt-get -y install ntfs-3g
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;После этого &lt;strong&gt;USB HDD&lt;/strong&gt; с &lt;strong&gt;ntfs&lt;/strong&gt; на борту будут монтироваться автоматически и в режиме записи.&lt;/p&gt;</content><category term="Linux"></category><category term="Ubuntu"></category></entry><entry><title>Ubuntu и русские man'ы</title><link href="https://metajiji.github.io/blog/ubuntu-man/" rel="alternate"></link><published>2011-11-12T00:00:00+07:00</published><updated>2011-11-12T00:00:00+07:00</updated><author><name>Denis Kadyshev</name></author><id>tag:metajiji.github.io,2011-11-12:/blog/ubuntu-man/</id><summary type="html">&lt;p&gt;В Ubuntu есть некоторые маны на других языках.&lt;/p&gt;
&lt;p&gt;Все английские маны лежат в каталоге &lt;code&gt;/usr/share/man/man{1..8}&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;А маны на других языках располагаются в &lt;code&gt;/usr/share/man/ЯЗЫК/man{1..8}&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;У утилиты &lt;code&gt;man&lt;/code&gt; есть ключ &lt;code&gt;-L&lt;/code&gt;, которому передается нужный язык.&lt;/p&gt;
&lt;p&gt;Почитаем &lt;code&gt;man mc&lt;/code&gt; на русском:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;man …&lt;/pre&gt;&lt;/div&gt;</summary><content type="html">&lt;p&gt;В Ubuntu есть некоторые маны на других языках.&lt;/p&gt;
&lt;p&gt;Все английские маны лежат в каталоге &lt;code&gt;/usr/share/man/man{1..8}&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;А маны на других языках располагаются в &lt;code&gt;/usr/share/man/ЯЗЫК/man{1..8}&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;У утилиты &lt;code&gt;man&lt;/code&gt; есть ключ &lt;code&gt;-L&lt;/code&gt;, которому передается нужный язык.&lt;/p&gt;
&lt;p&gt;Почитаем &lt;code&gt;man mc&lt;/code&gt; на русском:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;man -L ru mc
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;В репозиториях есть даже специальный пакет &lt;code&gt;manpages-ru&lt;/code&gt;, установим его:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;sudo apt-get install manpages-ru
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Теперь у вас в системе русских &lt;strong&gt;man&lt;/strong&gt;'ов стало больше. :)&lt;/p&gt;</content><category term="Linux"></category><category term="Ubuntu"></category></entry></feed>